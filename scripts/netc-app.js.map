{"version":3,"sources":["app/init-appshell.jsx","app/init.jsx","app/settings.js","app/system/datastore.js","app/system/util/enum.js","app/system/util/jscli.js","app/system/util/path.js","app/system/util/prompts.js","app/system/util/reflection.js","app/test.js","app/unisys/client-datalink-class.js","app/unisys/client-lifecycle.js","app/unisys/client-messager-class.js","app/unisys/client-module-class.js","app/unisys/client-network.js","app/unisys/client-react-component.jsx","app/unisys/client-state.js","app/unisys/client.js","app/unisys/common-defs.js","app/unisys/common-netmessage-class.js","app/unisys/common-session.js","app/unisys/component/SessionShell.jsx","app/unisys/server-database.js","app/unisys/server-logger.js","app/unisys/server-network.js","app/unisys/server.js","app/view/AppDefault.jsx","app/view/dev-db/DevDB.jsx","app/view/dev-db/devdb-logic.js","app/view/dev-react/DevReact.jsx","app/view/dev-react/devreact-logic.js","app/view/dev-session/DevSession.jsx","app/view/dev-session/devsession-logic.js","app/view/dev-unisys/DevUnisys.jsx","app/view/dev-unisys/devunisys-logic.js","app/view/netcreate/NetCreate.jsx","app/view/netcreate/components/AutoComplete.jsx","app/view/netcreate/components/EdgeEditor.jsx","app/view/netcreate/components/EdgeTable.jsx","app/view/netcreate/components/Help.jsx","app/view/netcreate/components/ImportExport.jsx","app/view/netcreate/components/InfoPanel.jsx","app/view/netcreate/components/MarkdownNote.jsx","app/view/netcreate/components/More.jsx","app/view/netcreate/components/NetGraph.jsx","app/view/netcreate/components/NodeDetail.jsx","app/view/netcreate/components/NodeSelector.jsx","app/view/netcreate/components/NodeTable.jsx","app/view/netcreate/components/SaveEditsDialog.jsx","app/view/netcreate/components/Search.jsx","app/view/netcreate/components/Template.jsx","app/view/netcreate/components/Vocabulary.jsx","app/view/netcreate/components/d3-simplenetgraph.js","app/view/netcreate/components/filter/FilterEnums.js","app/view/netcreate/components/filter/FilterGroup.jsx","app/view/netcreate/components/filter/FilterGroupProperties.jsx","app/view/netcreate/components/filter/FiltersPanel.jsx","app/view/netcreate/components/filter/NumberFilter.js","app/view/netcreate/components/filter/SelectFilter.js","app/view/netcreate/components/filter/StringFilter.jsx","app/view/netcreate/filter-logic.js","app/view/netcreate/importexport-logic.js","app/view/netcreate/nc-logic.js","app/view/netcreate/nc-utils.js","app/view/netcreate/template-logic.js","app/view/netcreate/template-schema.js"],"names":["React","require","Alert","Collapse","Navbar","NavbarToggler","NavbarBrand","Nav","NavItem","NavLink","UncontrolledDropdown","DropdownToggle","DropdownMenu","DropdownItem","Switch","withRouter","RRNavLink","renderRoutes","UNISYS","SETTINGS","AppDefault","NetCreate","DevUnisys","DevDB","DevReact","DevSession","Routes","path","exact","component","props","HTML","restricted","NoMatch","isLocalHost","EJSProp","ip","ForceReloadOnNavigation","loc","location","pathname","substring","display","flexFlow","width","height","flex","border","hash","AppShell","toggle","bind","state","isOpen","redirect","HandleMessage","setState","data","history","push","backgroundColor","padding","Component","module","exports","window","NC_DBG","console","log","id","DBG","ReactDOM","HashRouter","document","addEventListener","group","m_SetLifecycleScope","JoinNet","EnterApp","m_RenderApp","SetupDOM","SetupRun","groupEnd","event","Log","UDATA","NewDataLink","LocalCall","ServerDisconnect","routes","hashbits","split","matches","filter","route","length","UMOD","undefined","warn","modscope","SetScope","Promise","resolve","reject","render","querySelector","e","error","EJSPROPS","NC_UNISYS","S","DATE","Date","RELOAD_CHECK","RELOAD_TIMER","MOD","a","b","Set","key","val","Get","clearTimeout","setTimeout","reload","CurrentTime","toDateString","IsAdmin","href","includes","propName","ServerHostName","server","hostname","ServerHostIP","ServerAppURL","suburl","ubits","URL","serverip","url","protocol","host","load","TOML","SESSION","PROMPTS","PR","Pad","NetMessage","HASH_ABET","HASH_MINLEN","DSTOR","NewModule","NCDATA","Hook","UpdateDataPromise","UpdateServerDB","InsertServerDB","MergeServerDB","OnAppStateChange","decodedData","isValid","token","SetSessionGroupID","GlobalSetGroupID","Data","IsStandaloneMode","Call","then","res","OK","PromiseCalculateMaxNodeId","NetCall","maxNodeID","Error","JSON","stringify","PromiseNewNodeID","nodeID","PromiseNewNodeIDs","count","nodeIDs","PromiseCalculateMaxEdgeId","maxEdgeID","PromiseNewEdgeID","edgeID","PromiseNewEdgeIDs","edgeIDs","PromiseJSONFile","jsonFile","promise","xobj","XMLHttpRequest","target","status","responseText","Object","assign","parse","open","send","PromiseTOMLFile","tomlFile","tomlData","PromiseD3Data","SaveTemplateFile","template","GetTemplateTOMLFileName","d3data","mergeData","OverwriteDataPromise","ENUM","EDITORTYPE","TEMPLATE","IMPORTER","NODE","EDGE","SHOW_DOM","JSCLI","CMD","AddFunction","f","HelpString","out","forEach","name","ncHelp","DOM_ShowInstructions","E_SHELL","getElementById","E_OUT","createElement","E_HEADER","appendChild","innerHTML","PATH","rx_dir","rx_file","Parse","str","exec","Dirname","Basename","StripExt","substr","lastIndexOf","REFLECT","IS_NODE","process","release","PAD_SIZE","prompt","psize","len","padEnd","Stars","FunctionName","STACKTRACE","ExtractClassName","obj","funcNameRegex","results","constructor","toString","depth","stack","getSync","frame","fn","functionName","fileName","lineNumber","columnNumber","bits","InspectModule","rm","s","contexts","_","defined","mlist","base","keys","indexOf","i","objName","mod","m_DumpObj","bracket","InspectObject","label","indent","proto","Reflect","getPrototypeOf","prop","type","regexp","args","DBG_Out","msg","selector","Out","DBG_OutClean","TESTS","call","hook","remote","net","PASSED","TEST_GO","ARR_MATCH","m_meta_info","m_failed","m_skipped","m_passed","TM","testname","flag","hasOwnProperty","setting","m_ConfigureTestFlags","SetTitle","text","innerText","SetMeta","meta","value","MetaString","o","entries","k","v","Pass","subtest","m_InitShell","Fail","Passed","passed","Assess","m_PreTest","m_TestResults","AssessArrayMatch","arr1","arr2","AllPassed","subtests","stateChange","stateMerge","stateConcat","hookInit1","hookInit2","hookInitDeferred","hookStart","callHndlrReg","callHndlrData","callHndlrDataProp","callDataReturn","callDataAdd","callDataMulti","remoteCall","remoteData","remoteData2","remoteDataReturn","remoteDataAdd","remoteDataMulti","serverCall","serverCallOrder","serverReturn","serverData","serverDataAdd","netMessageReg","netCallHndlr","netSendHndlr","netSendNoEcho","netSignal","netSignalEcho","netData","netDataReturn","netDataAdd","netDataMulti","pair","pass","m_ShowShell","pEntries","testTitle","concat","join","tnotes","summary","return","register","BAD_OWNER","BAD_NAME","BAD_UID","NO_DATAOBJ","BAD_EJSPROPS","STATE","Messager","UNODE","Map","UNODE_COUNTER","MESSAGER","UnisysDataLink","owner","optName","msgr_type","msgr_name","uid","has","set","namespace","State","newState","SetState","UID","MergeState","ConcatState","listener","OnStateChange","OffStateChange","mesgName","receiverUID","UnhandleMessage","inData","options","toNet","toLocal","srcUID","promises","all","resArray","resObj","Send","Signal","MessageNames","ValidateMessageNames","msgs","valid","HasMessageName","lifecycle","BAD_PATH","PHASE_HOOKS","PHASES","PHASE","scope","m_ExecuteScopedPhase","phase","info","Function","get","Execute","hooks","icount","map","retval","values","catch","err","module_path","Scope","TEST","MSGR_IDCOUNT","handlerMap","messager_id","handlerFunc","handlerUID","syntax","udata_id","handlers","umesg","add","arguments","clear","delete","pkt","SocketSend","p","f_MakeResolverFunction","QueueTransaction","NOT_UNIQUE","LIFECYCLE","MODULES","MODULES_COUNTER","UnisysModule","module_id","AutoName","subnameCounter","ModuleID","connect","handle","DEFS","WARN","ERR_NM_REQ","ERR_NO_SOCKET","ERR_BAD_UDATA","NETSOCK","NETCLIENT","NETSERVER","M0_INIT","M1_CONNECTING","M2_CONNECTED","M3_REGISTERED","M4_READY","M_STANDALONE","M_NOCONNECT","m_status","m_options","m_hearbeat_timer","NETWORK","Connect","datalink","opt","GlobalOfflineMode","success","wsURI","uaddr","uport","ws","WebSocket","AddListener","appCache","applicationCache","UNCACHED","IDLE","CHECKING","DOWNLOADING","UPDATEREADY","OBSOLETE","m_HandleRegistrationMessage","msgEvent","regData","HELLO","UADDR","RemoveListener","DefaultServerUADDR","GlobalSetup","netsocket","m_HandleMessage","m_ResetHearbeatTimer","m_RespondToHeartbeat","readyState","OPEN","heartbeatStopped","message","SERVER_HEARTBEAT_INTERVAL","Message","IsOwnResponse","CompleteTransaction","Type","dbgout","startsWith","SocketUADDR","SourceAddress","LocalSignal","ReturnTransaction","LocalSend","result","SetData","json","SeqNum","Close","code","reason","close","handlerFunction","removeEventListener","LocalInfo","ServerInfo","ServerSocketInfo","UMODULE","UnisysComponent","m","lis","f_deprecated","d","NetSend","NetSignal","ns","AppState","so","SetAppState","AppStateChangeOff","f_unimplemented","f_unsupported","repl","alert","BAD_NSPACE","BAD_LISTENR","NO_UID_FLTR","WARN_PROP_MISMATCH","REACT","TYPEOF","USTATE","STATES","STATES_LISTEN","m_ConformNamespace","toUpperCase","m_ConformState","merge","entry","nprop","t_old","t_new","m_GetStateMessager","nspace","msgr","src_uid","namespaceMessager","UniData","UniModule","UniComponent","uniqueName","RegisterMessagesPromise","messages","SystemInitialize","ForceReloadSingleApp","root_module_id","InScope","currentScope","failure","Run","BeforePause","Paused","PostPause","CleanupRun","ExitApp","items","transact","m_id_counter","m_id_prefix","m_transactions","m_netsocket","m_group_id","M_INIT","M_ONLINE","M_CLOSED","M_ERROR","m_mode","ERR","ERR_NOT_NETMESG","ERR_BAD_PROP","ERR_ERR_BAD_CSTR","ERR_BAD_SOCKET","ERR_DUPE_TRANS","ERR_NO_GLOB_UADDR","ERR_UNKNOWN_TYPE","ERR_NOT_PACKET","ERR_UNKNOWN_RMODE","KNOWN_TYPES","ROUTING_MODE","m_SeqIncrement","m_CheckType","MakeNewID","rmode","memo","seqnum","seqlog","s_uaddr","s_group","s_uid","msgstr","propOrVal","IsTransaction","SourceGroupID","idStr","padStart","socket","GlobalGroupID","dst","dbg","IsServerMessage","m_GetHashKey","m_CheckRMode","resolverFunc","deleteProperty","config","GlobalCleanup","CustomEvent","detail","dispatchEvent","mode","HashIds","SESUTIL","m_current_groupid","DecodeToken","dataset","tokenBits","classId","projId","hashedId","groupId","subId","salt","hashids","decode","Number","isInteger","test","decoded","IsValidToken","MakeToken","MAX_SAFE_INTEGER","encode","SetGroupID","NC_CONFIG","good","GroupID","ReactStrap","InputGroup","InputGroupAddon","Button","Col","Row","Form","FormGroup","FormFeedback","Input","Label","Redirect","INPUT_STYLE","fontFamily","fontWeight","fontSize","textAlign","textTransform","GROUP_STYLE","color","marginTop","LABEL_STYLE","verticalAlign","marginBottom","NAV_LOGIN_STYLE","position","top","right","zIndex","NAV_LOGIN_FEEDBACK_STYLE","SessionShell","renderLogin","renderLoggedIn","handleChange","onSubmit","previousIsValid","classproj","gid","subid","formFeedback","tip","input","match","params","standalone","timestamp","prevProps","preventDefault","BRUTAL_REDIRECT","Loki","FS","LOGGER","TEMPLATE_SCHEMA","RUNTIMEPATH","TEMPLATEPATH","TEMPLATE_EXT","BACKUPPATH","DB_CLONEMASTER","db_file","m_db","m_max_edgeID","m_max_nodeID","m_dupe_set","NODES","EDGES","m_locked_nodes","m_locked_edges","m_open_editors","DB","m_BackupDatabase","ensureDirSync","dirname","existsSync","toISOString","replace","backupDBFilePath","m_GetValidDBFilePath","copySync","InitializeDatabase","ropt","autoload","autoloadCallback","f_DatabaseInitialize","autosave","autosaveCallback","f_AutosaveStatus","autosaveInterval","getCollection","addCollection","dupeNodes","mapReduce","m_CleanObjID","arr","Math","max","Write","m_CleanEdgeEndpoints","saveDatabase","m_LoadTemplate","nodeCount","edgeCount","m_MigrateJSONtoTOML","JSONtemplate","jt","SCHEMA","properties","TOMLtemplate","description","requireLogin","default","hideDeleteNodeButton","nodePrompts","hidden","allowLoggedInUserToImport","duplicateWarning","nodeIsLockedMessage","sourceNodeIsLockedMessage","edgeIsLockedMessage","edgePrompts","templateIsLockedMessage","nodeDefaultTransparency","defaultTransparency","edgeDefaultTransparency","searchColor","sourceColor","citation","citationPrompts","nodeDefs","field","displayLabel","exportLabel","help","includeInGraphTooltip","updated","created","edgeDefs","m_LoadJSONTemplate","templatePath","JSONTEMPLATE","readJsonSync","WriteTemplateTOML","m_LoadTOMLTemplate","templateFilePath","templateFile","readFile","importIsLockedMessage","TOMLtemplateFilePath","m_GetTemplateTOMLFilePath","JSONTemplatePath","PKT_GetDatabase","nodes","chain","removeMeta","edges","Info","PKT_SetDatabase","insert","PKT_InsertDatabase","PKT_MergeDatabase","node","n","PKT_Update","edge","PKT_UpdateDatabase","update","m_CalculateMaxNodeID","PKT_CalculateMaxNodeID","m_GetNewNodeID","PKT_GetNewNodeID","PKT_GetNewNodeIDs","firstId","m_CalculateMaxEdgeID","PKT_CalculateMaxEdgeID","m_GetNewEdgeID","PKT_GetNewEdgeID","PKT_GetNewEdgeIDs","PKT_RequestLockNode","errcode","m_IsInvalidNode","m_MakeLockError","locked","PKT_RequestUnlockNode","unlocked","parseInt","isNaN","find","NOP","INFO","PKT_RequestLockEdge","m_IsInvalidEdge","PKT_RequestUnlockEdge","PKT_RequestUnlockAllNodes","PKT_RequestUnlockAllEdges","PKT_RequestUnlockAll","RequestUnlock","replacementNodeID","AppendNodeLog","updatedNode","findOne","op","findAndUpdate","AppendEdgeLog","updatedEdge","m_CleanID","edgesToProcess","where","source","sourceEdges","findAndRemove","targetEdges","_nlog","el","FilterNodeLog","newNode","_elog","FilterEdgeLog","newEdge","WriteDbJSON","filePath","db","writeFileSync","WriteTemplateJSON","m_GetTemplateTOMLFileName","filename","backupFilePath","toml","outputFile","CloneTemplateTOML","GetEditStatus","templateBeingEdited","importActive","nodeOrEdgeBeingEdited","RequestEditLock","editor","ReleaseEditLock","findIndex","splice","int","regex","FSE","LOG_DIR","Tracer","LOG_DELIMITER","LOG_CONFIG","format","dateformat","preprocess","line","zeroPad","colorConsole","fs_log","e_weekday","dir","__dirname","ensureDir","logname","str_TimeDatedFilename","createWriteStream","LogLine","str_DateStamp","str_TimeStamp","c","write","date","hh","getHours","slice","mm","getMinutes","ss","getSeconds","getMonth","dd","getDate","day","getDay","yyyy","getFullYear","hms","LOG","PKT_LogEvent","m_PromiseServerHandlers","m_PromiseRemoteHandlers","IsType","notsrv","pktArray","reduce","pdata","WSS","Server","ERR_SS_EXISTS","ERR_NULL_SOCKET","DBG_SOCK_BADCLOSE","ERR_INVALID_DEST","ERR_UNKNOWN_PKT","DEFAULT_NET_PORT","DEFAULT_NET_ADDR","mu_wss","mu_options","mu_sockets","mu_sid_counter","m_server_handlers","m_message_map","m_socket_msgs_list","m_heartbeat_interval","m_pong_timer","UNET","SERVER_UADDR","InitializeNetwork","port","StartNetwork","on","m_NewSocketConnected","RegisterRemoteHandlers","regd","registered","m_SocketAdd","m_SocketClientAck","m_SocketMessage","m_SocketDelete","m_StartHeartbeat","setInterval","sendHeartbeat","m_ResetPongTimer","pongTimedOut","m_HandleState","f_make_resolver_func","srcPkt","d_uaddr","f_make_remote_resolver_func","verbose","d_sock","newpkt","CopySourceAddress","sid","m_GetNewUADDR","m_ListSockets","prefix","cstr","rmesgs","Array","isArray","change","UDB","override","RegisterHandlers","serverSays","sprint_message","src","LOGIC","Route","Link","UnisysStateChange","udata","uni_id","className","unit","user","StudentRender","DATASTORE","handler","reply","timeout","ncPushDatabase","AppStateChange","TESTCOUNTER","TESTINTERVAL","clearInterval","u_random_string","possible","charAt","floor","random","ncTest","SessionEdit","InputGroupText","handleTextChange","cat","melon","AppCall","extra","multi","TEST_WAIT","TEST_TIMER","MOD2","UDATA2","PR2","tms","ucontrol","deep","deep_a","MergeAppState","ConcatAppState","deep_b","expected","serialized","mycat","sendorder","recvorder","netOnly","me","delayed_send","greeting","msgcon","dog","NetGraph","Search","NodeSelector","InfoPanel","FiltersPanel","NCLOGIC","FILTERLOGIC","isConnected","isLoggedIn","disconnectMsg","layoutNodesOpen","layoutFiltersOpen","OnDOMReady","OnReset","OnStart","OnAppReady","OnRun","OnDisconnect","onStateChange_SESSION","onDisconnect","onFilterBtnClick","time","toLocaleTimeString","dragger","onmousedown","handleMouseDown","hideGraph","flexDirection","justifyContent","alignItems","overflow","visibility","maxWidth","left","bottom","borderTopLeftRadius","paddingTop","float","Autosuggest","MODE_STATIC","MODE_DISABLED","MODE_LINK","MODE_ACTIVE","_IsMounted","AutoComplete","suggestions","onStateChange_SEARCH","onStateChange_SELECTION","onStateChange_AUTOCOMPLETE","onInputChange","getSuggestionValue","renderSuggestion","onSuggestionsFetchRequested","onSuggestionsClearRequested","onSuggestionSelected","onSuggestionHighlighted","shouldRenderSuggestions","onBlur","identifier","activeAutoCompleteId","searchLabel","disabledValue","inactiveMode","shouldIgnoreSelection","newValue","method","searchString","suggestion","suggestedNodes","inputProps","placeholder","onChange","jsx","selectNode","linkID","mdplugins","emoji","FormText","NodeDetail","EdgeEditor","editLockMessage","formData","sourceId","targetId","notes","category","isNewEdge","sourceNode","targetNode","isLocked","isStandalone","dbIsLocked","disableEdit","isBeingEdited","isExpanded","sourceIsEditable","hasValidSource","targetIsEditable","hasValidTarget","hideModal","setTemplate","updateEditState","setEditState","handleSelection","handleEdgeSelection","handleEdgeEdit","handleEdgeClose","onEdgeClick","onDeleteButtonClick","onEditButtonClick","onCiteButtonClick","onCloseCiteClick","dateFormatted","requestEdit","onSwapSourceAndTarget","onChangeSource","onChangeTarget","onRelationshipChange","onNotesChange","onInfoChange","onCitationChange","onCategoryChange","checkUnload","doUnload","sourceNodes","targetNodes","parentNodeLabel","loadSourceAndTarget","originalEdge","parentNode","clearForm","today","year","String","toTimeString","dateTime","swap","parentNodeIsLocked","fontStyle","sameSourceAndTarget","borderColor","minHeight","hyphens","helpText","option","marginRight","markdownDisplay","paddingRight","returnValue","onIterate","markdownIterate","markdownOptions","typographer","linkify","plugins","Tag","children","level","MarkdownNote","EdgeTable","filteredEdges","sortkey","updateEdgeFilterState","handleDataUpdate","handleFilterDataUpdate","OnTemplateUpdate","onButtonClick","onToggleExpanded","m_FindMatchingObjsByProp","m_FindMatchingEdgeByProp","m_FindEdgeById","setSortKey","sortSymbol","lookupNodeLabel","sortDirection","FILTEREDD3DATA","nodeEdge","revision","titleString","tag","filteredEdge","isFiltered","sourceLabel","targetLabel","sortTable","sort","akey","bkey","localeCompare","attributes","source_a","source_b","sortByID","sortBySourceLabel","sortByTargetLabel","sortByKey","sortByUpdated","nodeId","obj_list","match_me","tableHeight","styles","maxHeight","opacity","filteredTransparency","size","displayUpdated","Table","Help","IELOGIC","NODEFILESTATUS_DEFAULT","EDGEFILESTATUS_DEFAULT","ImportExport","preventImport","importIsActive","nodefile","nodefileStatus","nodeValidationMsgs","nodeOkToImport","edgefile","edgefileStatus","edgeValidationMsgs","edgeOkToImport","okToImport","importMsgs","handleEditStateUpdate","onNodesExportSelect","onEdgesExportSelect","onNodeImportFileSelect","onEdgeImportFileSelect","clearNodefileSelect","clearEdgefileSelect","clearFileSelect","onDoImport","unlockAll","nextNodeId","nextEdgeId","ExportNodes","ExportEdges","files","NodefileValidate","messageTitle","messageJsx","EdgefileValidate","ResetNodeImportData","ResetEdgeImportData","ResetImportData","Import","ISADMIN","importDisabled","importBtnDisabled","importjsx","unlockAlljsx","defaultTabPanelHeight","TabContent","TabPane","classnames","NodeTable","More","activeTab","tabpanelTop","draggerMouseOffsetY","tabpanelHeight","savedTabpanelHeight","draggerTop","hideDragger","filtersSummary","endDrag","handleDrag","UpdateFilterSummary","OnClearBtnClick","CloseMore","tab","stopPropagation","offsetTop","clientY","onmouseup","onmousemove","tabpanel","active","sendGA","cursor","actionType","googlea","ga","hitType","eventCategory","eventAction","eventLabel","np","bReturn","Vocabulary","Template","toggleTab","borderTop","D3NetGraph","d3NetGraph","nodeTypes","edgeTypes","onZoomReset","onZoomIn","onZoomOut","updateLegend","constructGraph","forceUpdate","netgraph","remove","findDOMNode","Deregister","margin","marginLeft","lineHeight","hilitedNode","minWidth","thisIdentifier","isAdmin","degrees","isNewNode","edgesAreLocked","isDuplicateNodeLabel","duplicateNodeID","isValidReplacementNodeID","releaseOpenEditor","getNewNodeID","loadFormFromNode","validateForm","onLabelChange","onTypeChange","onReplacementNodeIDChange","onNewNodeButtonClick","requestEditNode","editNode","onAddNewEdgeButtonClick","onCancelButtonClick","onEditOriginal","onCloseDuplicateDialog","onForceUnlock","needsUpdate","currentNodeID","updatedNodeID","sourceID","targetID","updatedNodeIDs","thisId","usage","sensitivity","newNodeID","newEdgeID","originalNode","filteredNodes","updateNodeFilterState","filteredNode","sortByEdgeCount","sortByLabel","SaveChangesDialog","handleEdit","handleCancel","TEMPLATE_LOGIC","EDITOR","typeOptions","editScope","tomlfile","tomlfileStatus","tomlfileErrors","loadEditor","disableOrigLabelFields","onNewTemplate","onCurrentTemplateLoad","onEditNodeTypes","onEditEdgeTypes","onTOMLfileSelect","onDownloadTemplate","onSaveChanges","onCancelEdit","destroy","parms","cb","schema","startval","theme","disable_edit_json","disable_properties","object_layout","no_additional_properties","JSONEditor","origLabelFields","getElementsByClassName","setAttribute","schemaNodeTypeOptions","NODETYPEOPTIONS","nodeTypeEditorSchema","GetTypeEditorSchema","schemaEdgeTypeOptions","EDGETYPEOPTIONS","edgeTypeEditorSchema","ValidateTOMLFile","templateJSON","errorMsg","DownloadTemplate","getValue","UpdateTemplate","SaveTemplateToFile","editorjsx","gridTemplateColumns","columnGap","rowGap","d3","m_width","m_height","mouseoverNodeId","M_FORCEPROPERTIES","center","x","y","charge","enabled","strength","distanceMin","distanceMax","collide","iterations","radius","forceX","forceY","link","distance","rootElement","d3svg","zoom","zoomWrapper","simulation","clickFn","defaultSize","_HandleZoom","select","append","attr","nodeLabels","selectAll","transition","duration","style","_UpdateLinkStrokeWidth","svg","clientWidth","clientHeight","forceSimulation","_HandleFilteredD3DataUpdate","_SetData","_Initialize","_UpdateGraph","_UpdateForces","_Tick","_ColorMap","_ZoomReset","_ZoomIn","_ZoomOut","_ZoomPanReset","_Dragstarted","_Dragged","_Dragended","newData","svgNodes","oldNodes","alpha","restart","force","forceLink","forceManyBody","forceCollide","forceCenter","COLORMAP","nodeElements","linkElements","elementG","enter","classed","drag","nodeColorMap","tooltipForNode","selected","strokeColor","exit","_UpdateLinkStrokeColor","links","titleText","author","edgeColorMap","scaleTo","_Transition","transform","zoomIdentity","translate","scale","zoomLevel","scaleBy","self","alphaTarget","fx","fy","FILTER","ACTION","HIGHLIGHT","TYPES","STRING","NUMBER","SELECT","HIDDEN","KEY","SOURCE","TARGET","OPERATORS","NO_OP","CONTAINS","NOT_CONTAINS","GT","GT_EQ","LT","LT_EQ","EQ","NOT_EQ","FilterGroup","filters","filterAction","transparency","FilterGroupProperties","OnChangeValue","TriggerChangeHandler","OnSubmit","ButtonGroup","filterGroups","onFiltersChange","UpdateFilterDefs","SelectFilterAction","FDATA","defs","flexGrow","def","OnFilterChange","NumberFilter","keylabel","operator","onChangeHandler","OnChangeOperator","SelectFilter","StringFilter","ey","clone","FDATA_RESTORE","NODE_DEFAULT_TRANSPARENCY","EDGE_DEFAULT_TRANSPARENCY","DATASET","TEMPLATE_URL","m_UpdateFilters","m_FilterDefine","m_ClearFilters","m_ImportFilters","fdata","m_ImportPrompts","prompts","counter","nodeFilters","index","edgeFilters","m_FiltersApply","m_FiltersApplyToNodes","m_FiltersApplyToEdges","m_UpdateFilterSummary","typeSummary","nodeSummary","m_FiltersToString","edgeSummary","m_OperatorToString","m_MatchString","pin","haystack","contains","EscapeRegexChars","trim","RegExp","m_MatchNumber","filterVal","objVal","m_NodeIsFiltered","keepNode","m_IsNodeMatchedByFilter","nodeValue","m_EdgeIsFiltered","keepEdge","m_IsEdgeMatchedByFilter","edgeValue","missingKeys","NODEKEYS","fileKeys","lines","REGEXMatchLFNotInQuotes","headers","shift","nodeKeys","m_flattenKeys","m_NodefileCheckHeaders","EDGEKEYS","edgeKeys","m_EdgefileCheckHeaders","UTILS","NEW_ID_KEYWORD","REGEXMatchCommasNotInQuotes","m_formatDate","toUTCString","m_encode","m_decode","pre","flattenedKeys","flat","m_renderNodeValues","RESULT","prototype","subKeys","m_GenerateNodesArray","nodekeys","nodesArr","m_renderEdgeValues","m_GenerateEdgesArray","edgekeys","edgeArr","DATA","EXPORT","nodeHeadersArr","nodeHeaders","unshift","commaDelimitedNodes","blob","Blob","createObjectURL","download","body","click","removeChild","edgeHeadersArr","edgeHeaders","edgesArr","commaDelimitedEdges","nodeFile","edgeFile","nodesToImport","edgesToImport","IMPORT_NCDATA","m_hasValidSourceTarget","edgeImportErrors","row","m_NodefileLoadNodes","INTERNAL_FIELDS_MAP","subcategories","importFields","l","keysplit","subcategory","subkey","internalLabel","NaN","m_NodefileValidateNodes","nodesAdded","nodesReplaced","nodeImportErrors","toLowerCase","existingNodeIdx","nodeFileName","headerResults","importResults","nodeResults","m_EdgefileLoadEdges","m_EdgefileValidateEdges","edgesAdded","edgesReplaced","existingEdgeIdx","edgeFileName","edgeResults","importedFiles","importedFileNames","D3","DESELECTED_COLOR","DEFAULT_SEARCH_COLOR","DEFAULT_SOURCE_COLOR","TARGET_COLOR","m_PromiseLoadDB","m_MigrateData","RecalculateAllEdgeSizes","RecalculateAllNodeDegrees","USE_CACHE","lstore","localStorage","ld3","getItem","tem","urlParams","URLSearchParams","search","p1","p2","m_ValidateTemplate","m_UpdateColorMap","setItem","m_MarkNodeById","m_UnMarkAllNodes","m_UnStrokeAllNodes","m_SetStrokeColorThatMatch","m_sourceSelect","nodeLabel","m_FindNodeById","m_FindMatchingNodesByLabel","m_MarkNodeByLabel","updatedNodes","m_SetMatchingNodesByProp","replacementNode","m_DeleteMatchingNodesByProp","nodeTypesChanges","changeMap","replacement","edgeTypesChanges","updatedEdges","m_SetMatchingEdgesByProp","m_DeleteMatchingEdgeByProp","selection","m_HandleAutoCompleteSelect","m_SetMatchingObjsByProp","yes","no","returnMatches","matched","m_SetAllObjs","SetAllObjs","defaultEdgeColor","del_me","m_FindMatchingNodeByProp","u_EscapeRegexChars","m_SetMatchingNodesByLabel","REGEX_REGEXCHARS","string","Node_Type","Notes","Relationship","Citations","Category","marked","normal","m_MarkNodesThatMatch","deselect","notmatched","m_MarkSelectedEdges","ncEmptyDatabase","ncUnlockAll","ncUnlockAllNodes","ncUnlockAllEdges","ncNodeColorMap","ncDumpData","ncMakeTokens","clsId","numGroups","pad","inc","getKey","weight","w","tomlText","templateSnippet","title","disable_collapse","disable_array_add","disable_array_delete","disable_array_delete_all_rows","disable_array_delete_last_row","disable_array_reorder","inputAttributes","schemaTypeOptions","class"],"mappings":"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","file":"public/scripts/netc-app.js","sourcesContent":["/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n    init-appshell.jsx\n    application shell loaded and rendered in init.jsx\n\n    These are the top-level React components (\"view\") that are mapped to\n    routes as seen in render() function's <Switch>. There are three styles:\n    (1) a loaded React 'view' that is built entirely with our modular app API\n      and displayed in this application shell.\n    (2) a plain .html file loaded into an IFRAME, useful for adding stand-alone\n      test code with access to the modular app API system, but not other web\n      apps (e.g. can use the data storage module)\n    (3) a NO ROUTE FOUND component function.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n\n/// REACT LIBRARIES ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    const React = require('react');\n    const { Alert, Collapse } = require('reactstrap');\n    const { Navbar, NavbarToggler } = require('reactstrap');\n    const { NavbarBrand, Nav, NavItem, NavLink } = require('reactstrap');\n    const { UncontrolledDropdown, DropdownToggle } = require('reactstrap');\n    const { DropdownMenu, DropdownItem } = require('reactstrap');\n    const { Switch, withRouter } = require('react-router-dom');\n    // workaround name collision in ReactRouterNavLink with ReactStrap\n    const RRNavLink = require('react-router-dom').NavLink;\n    //\n    const { renderRoutes } = require('react-router-config');\n    //\n    const UNISYS = require('unisys/client');\n\n\n\n/** (1) ROUTED COMPONENTS ****************************************************\\\n  Used by render()'s <Switch> to load a React component (what we call a\n  'view' in the NetCreate app). The component should return its elements\n  wrapped in a div with the suggested flexbox pr\n\n  index.html           | body          min-height: 100%\n  index.html           | div#app\n  init-appshell        |   div         display:flex, flex-flow:column nowrap,\n                                       width:100%, height:100vh\n  init-appshell        |     Navbar    position:fixed\n  --- COMPONENT BELOW ---\n  <RequiredComponent>  |     div       this is a child of a flexbox\n\\*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/\n    const SETTINGS          = require('settings');\n    const AppDefault        = require('view/AppDefault');\n    const NetCreate         = require('view/netcreate/NetCreate');\n    const DevUnisys         = require('view/dev-unisys/DevUnisys');\n    const DevDB             = require('view/dev-db/DevDB');\n    const DevReact          = require('view/dev-react/DevReact');\n    const DevSession        = require('view/dev-session/DevSession');\n//  const Prototype         = require('view/prototype/Prototype');\n//  const D3Test            = require('view/d3test/D3Test');\n\n    const Routes = [\n      {\n        path: '/',\n        exact : true,\n        component: NetCreate\n      },\n      {\n        path: '/edit',\n        component: NetCreate\n      },\n      {\n        path: '/dev-unisys',\n        component: DevUnisys\n      },\n      {\n        path: '/dev-db',\n        component: DevDB\n      },\n      {\n        path: '/dev-react',\n        component: DevReact\n      },\n      {\n        path: '/dev-session',\n        component: DevSession\n      },\n      {\n        path: '/simple',\n        component: (props) => {return HTML(props)}\n      },\n      {\n        path: '/vocabulary',\n        component: (props) => {return HTML(props)}\n      },\n      {\n        path: '*',\n        restricted: false,\n        component: NoMatch\n      }\n    ];\n\n    // Joshua added to disable Extras\n    const isLocalHost  = (SETTINGS.EJSProp('client').ip === '127.0.0.1');\n\n\n/** (2) ROUTED FUNCTIONS *****************************************************\\\n  Used by render()'s <Switch> to load a plain html page that is\n  located at app/htmldemos/<route>/<route.html>\n\n  index.html           | body          min-height: 100%\n  index.html           | div#app\n  init-appshell        |   div         display:flex, flex-flow:column nowrap,\n                                       width:100%, height:100vh\n  init-appshell        |     Navbar    position:fixed\n  --- COMPONENT BELOW ---\n  init-appshell.HTML() |     div       display:flex, flex-flow:column nowrap,\n                                       width:100%\n  init-appshell.HTML() |       iframe  flex:1 0 auto, border:0\n\\*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/\n  function HTML ( props ) {\n    SETTINGS.ForceReloadOnNavigation();\n    let loc = props.location.pathname.substring(1);\n    loc  = '/htmldemos/'+loc+'/'+loc+'.html';\n    return (\n      <div style={{display:'flex', flexFlow:'column nowrap',\n           width:'100%', height:'100%'}}>\n        <iframe style={{flex:'1 0 auto',border:'0'}} src={loc} />\n      </div>\n    );\n}\n\n/** (3) NO ROUTE *************************************************************\\\n  Used by render()'s <Switch> when there are no matching routes\n\\*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/\n  function NoMatch ( props ) {\n    let hash = props.location.pathname.substring(1);\n    return (\n      <Alert color=\"warning\">No Match for route <tt>#{hash}</tt></Alert>\n    );\n  }\n\n/** APPLICATION NAVBAR + SWITCHED ROUTER VIEW ********************************\\\n\n    The application shell consists of a navbar implemented with Reactstrap\n    components and a React view associated with the current route via\n    ReactRouter <Switch> and <Route>.\n\n    The AppShell class is exported as the main module object for use with\n    require() statements (thanks to brunch magic)\n\n\\*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/\nclass AppShell extends UNISYS.Component {\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ constructor\n/*/ constructor(props) {\n      super(props);\n      this.toggle = this.toggle.bind(this);\n      this.state = {\n        isOpen: false\n      };\n      // bind handler\n      this.redirect = this.redirect.bind(this);\n      // add UNISYS message for redirects\n      this.HandleMessage('SHELL_REDIRECT',this.redirect);\n    }\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Handle changes in state of his toggle switch\n/*/ toggle() {\n      this.setState({\n        isOpen: !this.state.isOpen\n      });\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Called by SHELL_REDIRECT unisys message\n/*/ redirect(data) {\n      let { redirect } = data;\n      this.props.history.push(redirect);\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Draw top navbar w/ menus. Add route information\n  To add a new HTML, add the link to both the <Nav> and <Switch> staments.\n  To add a new VIEW, load the component\n/*/ render() {\n      /// return component with matching routed view\n      return (\n        <div style={{display:'flex', flexFlow:'column nowrap', width:'100%', height:'100vh'}}>\n          <Navbar fixed=\"top\" light expand=\"md\" style={{ backgroundColor:'#f0f0f0', padding:'4px 10px'}}>\n            <NavbarBrand href=\"#\" style={{padding:'0'}}><img src='images/netcreate-logo.svg' height='26px'/></NavbarBrand>\n            <NavbarToggler onClick={this.toggle} />\n              <Collapse isOpen={this.state.isOpen} navbar>\n              {/*/ (1) add navigation links here /*/}\n              <Nav className=\"ml-auto\" navbar hidden={!isLocalHost}>\n              { /* extra menu items\n                  <NavItem>\n                    <NavLink to=\"/d3forcedemo\" tag={RRNavLink} replace>D3 ForceDemo</NavLink>\n                  </NavItem>\n                  <UncontrolledDropdown direction=\"right\" nav size=\"sm\">\n                    <DropdownToggle>\n                      Extras\n                    </DropdownToggle>\n                    <DropdownMenu>\n                      <DropdownItem>\n                        <NavLink to=\"/dev-react\" tag={RRNavLink} replace>dev-react</NavLink>\n                      </DropdownItem>\n                      <DropdownItem>\n                        <NavLink to=\"/dev-unisys\" tag={RRNavLink} replace>dev-unisys</NavLink>\n                      </DropdownItem>\n                      <DropdownItem>\n                        <NavLink to=\"/dev-db\" tag={RRNavLink} replace>dev-db</NavLink>\n                      </DropdownItem>\n                      <DropdownItem>\n                        <NavLink to=\"/dev-session\" tag={RRNavLink} replace>dev-session</NavLink>\n                      </DropdownItem>\n                      <DropdownItem>\n                        <NavLink to=\"/simple\" tag={RRNavLink} replace>SimpleHTML Example</NavLink>\n                      </DropdownItem>\n                      <DropdownItem>\n                        <NavLink to=\"/vocabulary\" tag={RRNavLink} replace>Network Vocabulary</NavLink>\n                      </DropdownItem>\n                    </DropdownMenu>\n                  </UncontrolledDropdown>\n              */ }\n                </Nav>\n              </Collapse>\n          </Navbar>\n          <div style={{height:'3.5em'}}>{/*/ add space underneath the fixed navbar /*/}</div>\n          <Switch>\n            {renderRoutes(Routes)}\n          </Switch>\n        </div>\n      );\n    } // render()\n  } // AppShell()\n\n/// EXPORT ROUTE INFO /////////////////////////////////////////////////////////\nAppShell.Routes = Routes;\n\n/// EXPORT REACT CLASS ////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// see https://tylermcginnis.com/react-router-programmatically-navigate/\nmodule.exports = withRouter(AppShell);\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n    init.jsx\n    system startup, loaded by app/assets/index.html at end of body.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst DBG = false;\n\n/// SYSTEM-WIDE LANGUAGE EXTENSIONS ///////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// These are loaded in init to make sure they are available globally!\n/// You do not need to copy these extensions to your own module files\nrequire(\"babel-polyfill\"); // enables regenerators for async/await\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst React = require(\"react\");\nconst ReactDOM = require(\"react-dom\");\nconst { HashRouter } = require(\"react-router-dom\");\n\n/// SYSTEM MODULES ////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// demo: require system modules; this will likely be removed\nconst UNISYS = require(\"unisys/client\");\nconst AppShell = require(\"init-appshell\");\n\n/// UNISYS LIFECYCLE LOADER ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ When the DOM is loaded, initialize UNISYS\n/*/\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n  console.group(\"init.jsx bootstrap\");\n  console.log(\n    \"%cINIT %cDOMContentLoaded. Starting UNISYS Lifecycle!\",\n    \"color:blue\",\n    \"color:auto\"\n  );\n  m_SetLifecycleScope();\n  (async () => {\n    await UNISYS.JoinNet(); // UNISYS socket connection (that is all)\n    await UNISYS.EnterApp(); // TEST_CONF, INITIALIZE, LOADASSETS, CONFIGURE\n    await m_RenderApp(); // compose React view\n    await UNISYS.SetupDOM(); // DOM_READY\n    await UNISYS.SetupRun(); // RESET, START, APP_READY, RUN\n    console.log(\n      \"%cINIT %cUNISYS Lifecycle Initialization Complete\",\n      \"color:blue\",\n      \"color:auto\"\n    );\n    console.groupEnd();\n  })();\n});\n\n/// UNISYS LIFECYCLE CLOSE EVENT //////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ this custom event accesses post-run lifecycles defined for 'DOMContentLoaded'\n    `event` is originated by `comment-netmessage-class.GlobalOfflineMode\n    with a custom event message coming from client-network.m_ResetHearbeatTimer\n    This is so we can display an error to the user explaining the disconnect\n/*/\ndocument.addEventListener(\"UNISYSDisconnect\", (event) => {\n  console.log(\n    \"%cDISCONNECT %cUNISYSDisconnect. Closing UNISYS Lifecycle!\",\n    \"color:blue\",\n    \"color:auto\"\n  );\n  // This call will fail if the server is disconnected.\n  UNISYS.Log('Server disconnected with error', event);\n  // hack a local module for now\n  let UDATA = UNISYS.NewDataLink({});\n  UDATA.LocalCall('DISCONNECT', event);\n  (async () => {\n    await UNISYS.ServerDisconnect(); // UNISYS has dropped server\n    console.log(\n      \"%cDISCONNECT %cUNISYSDisconnect Complete\",\n      \"color:blue\",\n      \"color:auto\"\n    );\n  })();\n});\n\n/// LIFECYCLE HELPERS /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ helper to infer view module scope before module is routed lated (!)\n/*/ function m_SetLifecycleScope() {\n  // set scope for UNISYS execution\n  let routes = AppShell.Routes;\n  // check #, and remove any trailing parameters in slashes\n  // we want the first one\n  let hashbits = window.location.hash.split(\"/\");\n  let hash = hashbits[0];\n  let loc = \"/\" + hash.substring(1);\n  let matches = routes.filter(route => {\n    return route.path === loc;\n  });\n  if (matches.length) {\n    if (DBG) console.log(`Lifecycle Module Scope is ${hash}`);\n    let component = matches[0].component;\n    if (component.UMOD === undefined)\n      console.warn(\n        `WARNING: root view '${loc}' has no UMOD property, so can not set UNISYS scope`\n      );\n    let modscope = component.UMOD || \"<undefined>/init.jsx\";\n    UNISYS.SetScope(modscope);\n  } else {\n    console.warn(`m_SetLifecycleScope() could not match scope ${loc}`);\n  }\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Wraps ReactDOM.render() in a Promise. Execution continues in <AppShell>\n    and the routed view in AppShell.Routes\n/*/ function m_RenderApp() {\n  if (DBG)\n    console.log(\"%cINIT %cReactDOM.render() begin\", \"color:blue\", \"color:auto\");\n  return new Promise((resolve, reject) => {\n    try {\n      ReactDOM.render(\n        <HashRouter hashType=\"slash\">\n          <AppShell />\n        </HashRouter>,\n        document.querySelector(\"#app-container\"),\n        () => {\n          console.log(\n            \"%cINIT %cReactDOM.render() complete\",\n            \"color:blue\",\n            \"color:auto\"\n          );\n          resolve();\n        }\n      );\n    } catch (e) {\n      console.error(\n        \"m_RenderApp() Lifecycle Error. Check phase execution order effect on data validity.\\n\",\n        e\n      );\n      debugger;\n    }\n  }); // promise\n}\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n    LOCAL SETTINGS\n    utility function for managing local\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/// GLOBAL NETWORK INFO (INJECTED ON INDEX) ///////////////////////////////////\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// NOTE: server-embedded properties are not defined for simple html apps\nvar EJSPROPS = window.NC_UNISYS || {};\n\n/// STORAGE ///////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nlet S        = {};\nlet DATE     = new Date();\nlet RELOAD_CHECK   = 0;\nlet RELOAD_TIMER = null;\n\n/// MAIN GETTER/SETTER FUNCTION  //////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ settings.js returns a function as its module.exports value so\n    syntax like let a = SETTINGS['key'] can be used.\n/*/ let MOD = ( a, b ) => {\n    if (a===undefined) throw ('SETTINGS requires key or key,value parms');\n    if (typeof a!=='string') throw ('SETTINGS parm1 must be key string');\n\n    if (b===undefined) {\n      return S[a];\n    } else {\n      S[a] = b;\n      return b;\n    }\n  }\n\n/// API ///////////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ alternate call to set a key value pair\n/*/ MOD.Set = (key, val) => {\n      MOD( key, val );\n    };\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ alternate call to retrieve a key\n/*/ MOD.Get = ( key ) => {\n      return MOD( key )\n    };\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Force Reload if another module was navigated to and we want to ensure the\n    entire browser was refreshed so only one set of app modules is loaded\n/*/ MOD.ForceReloadOnNavigation = () => {\n      RELOAD_CHECK++;\n      if (RELOAD_CHECK>1) {\n        console.warn(`SETTINGS: ForceReloadOnNavigation active. Reloading!`);\n        if (RELOAD_TIMER) clearTimeout(RELOAD_TIMER);\n        RELOAD_TIMER = setTimeout(()=>{location.reload()},500);\n      } else {\n        console.warn(`SETTINGS: ForceReloadOnNavigation check OK`);\n      }\n    };\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ test time function\n/*/ MOD.CurrentTime = () => {\n      return DATE.toDateString();\n    };\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ MOD.IsAdmin = () => {\n      return (MOD.EJSProp('client').ip === '127.0.0.1') ||\n        location.href.includes('admin=true');\n    }\n\n/// SERVER-PROVIDED PROPERTIES ////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ searches through the window.NC_UNISYS object that is injected by web page\n    app/static/index.ejs, which contains interesting values from server\n/*/ MOD.EJSProp = ( propName ) => {\n      if (propName===undefined) return EJSPROPS;\n      return EJSPROPS[propName];\n    };\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    MOD.ServerHostName = () => {\n      return EJSPROPS.server.hostname || 'ERROR';\n    };\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    MOD.ServerHostIP = () => {\n      return EJSPROPS.server.ip || 'ERROR';\n    };\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    MOD.ServerAppURL = ( suburl ) => {\n     let ubits = new URL(window.location);\n      let hash = ubits.hash.split('/')[0];\n      let serverip = MOD.ServerHostIP();\n      let url = `${ubits.protocol}//${ubits.host}/${hash}`;\n      if (typeof suburl==='string') url += suburl;\n      return url;\n    };\n\n/// EXPORT MODULE DEFINITION //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = MOD;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n    DATASTORE\n    stub for testing module loading\n    eventually will load data from database\n    data.json is { nodes: [ {} ... {} ] }\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst DBG = { load: true };\n\n/// SYSTEM LIBRARIES //////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst TOML = require(\"@iarna/toml\");\nconst SETTINGS = require(\"settings\");\nconst SESSION = require(\"unisys/common-session\");\nconst UNISYS = require(\"unisys/client\");\nconst PROMPTS = require(\"system/util/prompts\");\nconst PR = PROMPTS.Pad(\"Datastore\");\nconst NetMessage = require(\"unisys/common-netmessage-class\");\n\n/// CONSTANTS /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst HASH_ABET = \"ABCDEFGHIJKLMNPQRSTVWXYZ23456789\";\nconst HASH_MINLEN = 3;\n\n/// INITIALIZE MODULE /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nlet DSTOR = UNISYS.NewModule(module.id);\nlet UDATA = UNISYS.NewDataLink(DSTOR);\nlet NCDATA = {};\n\n/// LIFECYCLE /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ establish message handlers during INITIALIZE phase\n/*/\nDSTOR.Hook(\"INITIALIZE\", () => {\n  // DBUPDATE_ALL is a local call originating from within the app\n  // Used to update the full NCDATA object during template updates\n  UDATA.HandleMessage(\"DBUPDATE_ALL\", function(data) {\n    DSTOR.UpdateDataPromise(data);\n  });\n\n  // DB_UPDATE is a local call originating from within the app\n  // Generally used to update individual nodes and edges\n  UDATA.HandleMessage(\"DB_UPDATE\", function(data) {\n    DSTOR.UpdateServerDB(data);\n  });\n\n  // DB_INSERT is a local call originating from within the app\n  // Generally used to add new nodes and edges after an import\n  UDATA.HandleMessage(\"DB_INSERT\", function(data) {\n    DSTOR.InsertServerDB(data);\n  });\n\n  // DB_MERGE is a local call originating from within the app\n  // Generally used to update or add new nodes and edges after an import\n  // Unlike DB_INSERT, it'll update existing nodes/edges\n  UDATA.HandleMessage(\"DB_MERGE\", DSTOR.MergeServerDB);\n\n  UDATA.OnAppStateChange('SESSION', function( decodedData ) {\n    let { isValid, token } = decodedData;\n    console.log('Handling SESSION',isValid);\n    if (isValid) DSTOR.SetSessionGroupID(decodedData);\n  });\n\n});\n\n\n/// SESSION ///////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ datastore needs to set NetMessage GroupID property on behalf of SESSIONS\n    because SESSION can't include NetMessage (or vice versa)\n/*/\nDSTOR.SetSessionGroupID = function ( decodedData ) {\n  let { token, isValid } = decodedData;\n  if (isValid) {\n    NetMessage.GlobalSetGroupID(token);\n    console.log('setting NetMessage group id',token);\n  } else {\n    console.warn('will not set bad group id:',token);\n  }\n};\n\n/// DB INTERFACE //////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: Placeholder DATA access function\n/*/\nDSTOR.Data = function() {\n  return NCDATA;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: Write update to database\n/*/\nDSTOR.UpdateServerDB = function(data) {\n  // check that network is online\n  if (UNISYS.IsStandaloneMode()) {\n    console.warn(PR,`STANDALONE MODE: UpdateServerDB() suppressed!`);\n    return;\n  }\n  // it is!\n  UDATA.Call(\"SRV_DBUPDATE\", data).then(res => {\n    if (res.OK) {\n      console.log(PR, `server db transaction`, data, `success`);\n    } else {\n      console.log(PR, \"error updating server db\", res);\n    }\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ update max node id count for generating new ids\n/*/\nDSTOR.PromiseCalculateMaxNodeId = function () {\n  return new Promise((resolve, reject) => {\n    UDATA.NetCall(\"SRV_CALCULATE_MAXNODEID\").then(data => {\n      if (data.maxNodeID !== undefined) {\n        if (DBG) console.log(PR, \"server calculated max_node_id\", data.maxNodeID);\n        resolve(data.maxNodeID);\n      } else {\n        reject(new Error(\"unknown error\" + JSON.stringify(data)));\n      }\n    });\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ get a unique NodeID\n/*/\nDSTOR.PromiseNewNodeID = function() {\n  return new Promise((resolve, reject) => {\n    UDATA.NetCall(\"SRV_DBGETNODEID\").then(data => {\n      if (data.nodeID) {\n        if (DBG) console.log(PR, \"server allocated node_id\", data.nodeID);\n        resolve(data.nodeID);\n      } else {\n        if (UNISYS.IsStandaloneMode()) {\n          reject(new Error(\"STANDALONE MODE: UI should prevent PromiseNewNodeID() from running!\"));\n        } else {\n          reject(new Error(\"unknown error\" + JSON.stringify(data)));\n        }\n      }\n    });\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ get multiple unique NodeIDs\n/*/\nDSTOR.PromiseNewNodeIDs = function(count) {\n  return new Promise((resolve, reject) => {\n    UDATA.NetCall(\"SRV_DBGETNODEIDS\", {count}).then(data => {\n      if (data.nodeIDs) {\n        if (DBG) console.log(PR, \"server allocated node_id\", data.nodeIDs);\n        resolve(data.nodeIDs);\n      } else {\n        reject(new Error(\"unknown error\" + JSON.stringify(data)));\n      }\n    });\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ update max edge id count for generating new ids\n/*/\nDSTOR.PromiseCalculateMaxEdgeId = function () {\n  return new Promise((resolve, reject) => {\n    UDATA.NetCall(\"SRV_CALCULATE_MAXEDGEID\").then(data => {\n      if (data.maxEdgeID !== undefined) {\n        if (DBG) console.log(PR, \"server calculated max_edge_id\", data.maxEdgeID);\n        resolve(data.maxEdgeID);\n      } else {\n        reject(new Error(\"unknown error\" + JSON.stringify(data)));\n      }\n    });\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ get a unique Edge\n/*/\nDSTOR.PromiseNewEdgeID = function() {\n  return new Promise((resolve, reject) => {\n    UDATA.NetCall(\"SRV_DBGETEDGEID\").then(data => {\n      if (data.edgeID) {\n        if (DBG) console.log(PR, \"server allocated edge_id:\", data.edgeID);\n        resolve(data.edgeID);\n      } else {\n        if (UNISYS.IsStandaloneMode()) {\n          reject(new Error(\"STANDALONE MODE: UI should prevent PromiseNewEdgeID() from running!\"));\n        } else {\n          reject(new Error(\"unknown error\" + JSON.stringify(data)));\n        }\n      }\n    });\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ get multiple unique EdgeIDs\n/*/\nDSTOR.PromiseNewEdgeIDs = function(count) {\n  return new Promise((resolve, reject) => {\n    UDATA.NetCall(\"SRV_DBGETEDGEIDS\", {count}).then(data => {\n      if (data.edgeIDs) {\n        if (DBG) console.log(PR, \"server allocated edge_id:\", data.edgeIDs);\n        resolve(data.edgeIDs);\n      } else {\n        reject(new Error(\"unknown error\" + JSON.stringify(data)));\n      }\n    });\n  });\n};\n\n/// DATABASE LOADER ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: Load default data set from a JSON file in /assets/data\n/*/\nDSTOR.PromiseJSONFile = function(jsonFile) {\n  if (typeof jsonFile !== \"string\") {\n    throw new Error(\"pass arg <filename_in_assets/data>\");\n  }\n  let promise = new Promise((resolve, reject) => {\n    let xobj = new XMLHttpRequest();\n    xobj.addEventListener(\"load\", event => {\n      if (event.target.status === 404) {\n        reject(new Error(`file not found`));\n        return;\n      }\n      let data = event.target.responseText;\n      NCDATA = Object.assign(NCDATA, JSON.parse(data));\n      resolve(NCDATA);\n    });\n    xobj.open(\"GET\", `${jsonFile}`, true);\n    xobj.send();\n  });\n  return promise;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: Load default data set from a TOML file in /assets/data\n/*/\nDSTOR.PromiseTOMLFile = function (tomlFile) {\n  if (typeof tomlFile !== \"string\") {\n    throw new Error(\"pass arg <filename_in_assets/data>\");\n  }\n  let promise = new Promise((resolve, reject) => {\n    let xobj = new XMLHttpRequest();\n    xobj.addEventListener(\"load\", event => {\n      if (event.target.status === 404) {\n        reject(new Error(`file not found`));\n        return;\n      }\n      const data = event.target.responseText;\n      const tomlData = Object.assign(NCDATA, TOML.parse(data));\n      resolve(tomlData);\n    });\n    xobj.open(\"GET\", `${tomlFile}`, true);\n    xobj.send();\n  });\n  return promise;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: Load D3 Database\n/*/\nDSTOR.PromiseD3Data = function() {\n  // UDATA.Call() returns a promise\n  return UDATA.Call(\"SRV_DBGET\", {}); // server.js\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: Write Template file to Server\n/*/\nDSTOR.SaveTemplateFile = template => {\n  // UDATA.Call() returns a promise\n  return UDATA.Call(\"SRV_TEMPLATESAVE\", {template}); // server.js\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: Get Template File Path.\n    Called by template-logic when downloading template file.\n/*/\nDSTOR.GetTemplateTOMLFileName = () => {\n  return UDATA.Call(\"SRV_GET_TEMPLATETOML_FILENAME\");\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: Update database from d3data-formatted object\n/*/\nDSTOR.UpdateDataPromise = function (d3data) {\n  return new Promise((resolve, reject) => {\n    UDATA.Call(\"SRV_DBUPDATE_ALL\", d3data).then(res => {\n      if (res.OK) {\n        console.log(PR, `database update OK`);\n        resolve(res);\n      } else {\n        reject(new Error(JSON.stringify(res)));\n      }\n    });\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: Insert new records into database from d3data-formatted object\n/*/\nDSTOR.InsertServerDB = function (d3data) {\n  return new Promise((resolve, reject) => {\n    UDATA.Call(\"SRV_DBINSERT\", d3data).then(res => {\n      if (res.OK) {\n        console.log(PR, `database update OK`);\n        resolve(res);\n      } else {\n        reject(new Error(JSON.stringify(res)));\n      }\n    });\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n * API: Add or Insert records into database from d3data-formatted object\n * @param {object} mergeData\n * @param {array} mergeData.nodes\n * @param {array} mergeData.edges\n * @returns\n */\nDSTOR.MergeServerDB = function (mergeData) {\n  return new Promise((resolve, reject) => {\n    UDATA.Call(\"SRV_DBMERGE\", mergeData).then(res => {\n      if (res.OK) {\n        console.log(PR, `database update OK`);\n        resolve(res);\n      } else {\n        reject(new Error(JSON.stringify(res)));\n      }\n    });\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: (WIP) write database from d3data-formatted object\n/*/\nDSTOR.OverwriteDataPromise = function (d3data) {\n  return new Promise((resolve, reject) => {\n    UDATA.Call(\"SRV_DBSET\", d3data).then(res => {\n      if (res.OK) {\n        console.log(PR, `database set OK`);\n        resolve(res);\n      } else {\n        reject(new Error(JSON.stringify(res)));\n      }\n    });\n  });\n};\n\n/// EXPORT MODULE /////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = DSTOR;\n","\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Enumerators\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst ENUM = {};\n\n// EDITORTYPE handles network edit locking messages\nENUM.EDITORTYPE = {\n  TEMPLATE: 'template',\n  IMPORTER: 'importer',\n  NODE: 'node', // parameter sent with packet, listed here for coverage\n  EDGE: 'edge'  // parameter sent with packet, listed here for coverage\n};\n\nmodule.exports = ENUM;\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n    JS CLI\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst DBG         = true;\nconst SHOW_DOM    = true;\n\n/// SYSTEM LIBRARIES //////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst SETTINGS    = require('settings');\nconst UNISYS      = require('unisys/client');\nconst PROMPTS     = require('system/util/prompts');\nconst PR          = PROMPTS.Pad('JSCLI');\n\n/// INITIALIZE MODULE /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nlet JSCLI         = UNISYS.NewModule(module.id);\nlet UDATA         = UNISYS.NewDataLink(JSCLI);\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nlet CMD = [];\n\n/// DEFINE CLI FUNCTIONS //////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    JSCLI.AddFunction = (f) => {\n      if (typeof f!=='function') throw Error('AddFunction() arg is Function object');\n      CMD.push(f);\n    };\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    JSCLI.HelpString = () => {\n      let out = 'The following CLI commands are available\\n\\n';\n      CMD.forEach((f)=>{\n        out+=`  ${f.name}()\\n`;\n      });\n      out += \"\\n\";\n      out += \"Mac shortcuts to open console\\n\";\n      out += \"  Chrome  : cmd-option-j\\n\";\n      out += \"  Firefox : cmd-option-k\\n\";\n      out += \"PC use ctrl-shift instead\\n\";\n      return out;\n    };\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ initialize registered functions\n/*/ JSCLI.Hook('RESET',() => {\n      JSCLI.AddFunction(function ncHelp() { return JSCLI.HelpString() });\n      CMD.forEach((f)=>{\n        window[f.name] = f;\n      });\n      if (SHOW_DOM) JSCLI.DOM_ShowInstructions();\n    });\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    JSCLI.DOM_ShowInstructions = () => {\n      var E_SHELL = document.getElementById('fdshell');\n      if (!E_SHELL) {\n        // console.warn(PR,\"DOM_ShowInstructions() found no id 'fdshell' to append instructions. Type 'ncHelp()' to list available JSCLI functions.\");\n        return;\n      }\n      var E_OUT = document.createElement('pre');\n      var E_HEADER = document.createElement('h4');\n      E_SHELL.appendChild(E_HEADER);\n      E_SHELL.appendChild(E_OUT);\n      E_HEADER.innerHTML='Command Information';\n      E_OUT.innerHTML = JSCLI.HelpString();\n    }\n\n\n/// EXPORT MODULE /////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = JSCLI;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Path Strings\n  REGEX approach from https://stackoverflow.com/a/47212224\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nvar PATH = {};\n\nconst rx_dir   = /(.*)\\/+([^/]*)$/;\nconst rx_file  = /()(.*)$/;\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Return the directory portion of a path\n/*/ PATH.Parse = function(str) {\n      // [0] original string\n      // [1] dirname\n      // [2] filename\n      return rx_dir.exec(str) || rx_file.exec(str);\n    };\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Return the directory portion of a path\n/*/ PATH.Dirname = function(str) {\n      // return str.substring(0,str.lastIndexOf(\"/\"));\n      return (rx_dir.exec(str) || rx_file.exec(str))[1];\n    };\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Return the file portion of a path\n/*/ PATH.Basename = function(str) {\n      // return str.substring(str.lastIndexOf(\"/\")+1);\n      return (rx_dir.exec(str) || rx_file.exec(str))[2];\n    };\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Return the string stripped of extension\n/*/ PATH.StripExt = function(str) {\n      return str.substr(0,str.lastIndexOf('.'));\n    };\n\n/// EXPORT MODULE DEFINITION //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = PATH;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  String Prompts for server\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst REFLECT   = require('./reflection');\nvar   PROMPTS   = {};\n\n/// CONSTANTS /////////////////////////////////////////////////////////////////\n/// detect node environment and set padsize accordingly\nconst IS_NODE   = ((typeof process!=='undefined') && (process.release) &&\n                  (process.release.name==='node'));\nvar   PAD_SIZE  = (IS_NODE)\n                  ? 9  // nodejs\n                  : 0; // not nodejs\n\n/// PROMPT STRING HELPERS /////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ return a string padded to work as a prompt for either browser or node\n    console output\n/*/ PROMPTS.Pad = function( prompt='', psize=PAD_SIZE) {\n      let len = prompt.length;\n      if (IS_NODE) return prompt.padEnd(psize,' ')+'-';\n      // must be non-node environment, so do dynamic string adjust\n      if (!psize) return prompt+':';\n      // if this far, then we're truncating\n      if (len>=psize) prompt = prompt.substr(0,psize-1);\n      else prompt.padEnd(psize,' ');\n      return prompt+':';\n    };\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ returns PAD_SIZE stars\n/*/ PROMPTS.Stars = function( count ) {\n      if (count!==undefined) return ''.padEnd(count,'*');\n      return ''.padEnd(PAD_SIZE,'*');\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ return string of calling object's name\n/*/ PROMPTS.FunctionName = function() {\n      return REFLECT.FunctionName(2);\n    };\n\n\n/// EXPORT MODULE DEFINITION //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = PROMPTS;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Reflection and other Object Inspection Utilities\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst STACKTRACE = require('stacktrace-js');\nconst PATH       = require('./path');\n\n/// INITIALIZE MAIN MODULE ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar   REFLECT    = {};\n\n/// API METHODS ///////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Returns the name of the constructor for the current class\n    https://stackoverflow.com/questions/22777181/typescript-get-to-get-class-name-at-runtime\n/*/ REFLECT.ExtractClassName = function( obj ) {\n       var funcNameRegex = /function (.{1,})\\(/;\n       var results = (funcNameRegex).exec((obj).constructor.toString());\n       return (results && results.length > 1) ? results[1] : \"\";\n    };\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Returns the name of the calling function\n/*/ REFLECT.FunctionName = function( depth=1 ) {\n      let stack = STACKTRACE.getSync();\n      let frame = stack[depth];\n      let fn = frame.functionName;\n      if (!fn) {\n        fn = PATH.Basename(frame.fileName);\n        fn += `:${frame.lineNumber}:${frame.columnNumber}`;\n        return fn;\n      } else {\n        let bits = fn.split('.');\n        return `method ${bits[1]}() called by module ${bits[0]}`;\n      }\n    };\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ InspectModule() prints a list of public properties and methods for each\n    require module that contains the passed string. It returns a string, so\n    you will have to console.log() to see the output.\n/*/ REFLECT.InspectModule = function ( str ) {\n    throw Error(`REFLECT.InspectModule() needs to be rewritten for brunch-style modules.`);\n    var rm = require.s.contexts._.defined;\n    var mlist = [];\n    var base = '1401/';\n    if (str===undefined) str = base;\n    str = (typeof str==='string') ? str : base;\n\n    Object.keys(rm).forEach(function(key) {\n      var name = key.toString();\n      if (name.indexOf(str)>=0) {\n        mlist.push(key);\n      }\n    });\n\n    var out = '\\n';\n    for (var i=0; i<mlist.length; i++) {\n      var objName = mlist[i];\n      out += objName+'\\n';\n      if (str!==base) {\n        out+= \"-----\\n\";\n        var mod = rm[objName];\n        out += m_DumpObj(mod);\n        out += '\\n';\n      }\n    }\n    if (mlist.length) {\n      console.log(out);\n      return mlist.length + ' modules listed';\n    } else {\n      return \"module \" +str.bracket()+\" not found\";\n    }\n  };\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ InspectObject() accepts an object and a label, and prints a list of\n    all the methods and properties in it. It returns a string, so you will\n    have to console.log() to see the output.\n/*/ REFLECT.InspectObject = function ( obj, depth ) {\n    if (!obj) return \"Must pass an object or 1401 watched object key string\";\n\n    var out = \"\";\n    // handle command line calls\n    switch (typeof obj) {\n      case 'object':\n      case 'function':\n        break;\n      default:\n        return \"must pass object or function, not \"+(typeof obj);\n    }\n\n    // handle recursive scan\n    depth = depth || 0;\n    var label = obj.constructor.name || '(anonymous object)';\n    var indent = \"\";\n    for (var i=0; i<=depth; i++) indent+='\\t';\n    out+= label+'\\n';\n    out+= \"\\n\";\n    out += m_DumpObj(obj, depth+1);\n    var proto = Reflect.getPrototypeOf(obj);\n    if (proto) {\n      out += \"\\n\"+indent+\"IN PROTO: \";\n      out += this.InspectObject(proto,depth+1);\n      out += \"\\n\";\n    }\n    if (depth===0) out = '\\n'+out;\n    console.log(out);\n    return obj;\n  };\n\n\n/** SUPPORTING FUNCTIONS ****************************************************/\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Support function for InspectModule() and InspectObject()\n    Also checks m_watching array\n/*/ function m_DumpObj ( obj, depth ) {\n    var indent = \"\";\n    for (var i=0; i<depth; i++) indent+='\\t';\n\n    var str = \"\";\n    Object.keys(obj).forEach(function(key) {\n      var prop = obj[key];\n      var type = typeof prop;\n      str += indent;\n      str += type + '\\t'+key;\n      switch (type) {\n        case 'function':\n          var regexp = /function.*\\(([^)]*)\\)/;\n          var args = regexp.exec(prop.toString());\n          str+= ' ('+args[1]+')';\n          break;\n        default:\n          break;\n      }\n      str += '\\n';\n    });\n    return str;\n  }\n\n\n\n/** GLOBAL HOOKS *************************************************************/\n\nif (typeof window === 'object') {\n  window.InspectModule = REFLECT.InspectModule;\n  window.InspectObject = REFLECT.InspectObject;\n  window.DBG_Out = function ( msg, selector ) {\n    REFLECT.Out(msg,false, selector);\n  };\n  window.DBG_OutClean = function ( msg, selector ) {\n    REFLECT.Out(msg,true,selector);\n  };\n}\n\n\n/// EXPORT MODULE DEFINITION //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = REFLECT;\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n    TEST\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nlet DBG = false;\n\n/// DECLARATIONS //////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ list of tests that are allowed to run\n/*/ let TESTS = {\n      call    : false,  // unisys calls\n      state   : false,  // unisys state manager\n      hook    : false,  // unisys lifecycle hooks\n      remote  : false,  // unisys 'remote' calls to other module\n      net     : false,  // network connection to socket server\n      server  : false   // unisys 'server implemented' calls\n    };\n/*/ groups of tests to run\n/*/ let PASSED = {};\n    let TEST_GO = false;\n/*/ pairs of arrays to match (array of arrays)\n/*/ let ARR_MATCH = [];\n    let PR = 'TEST:';\n    let m_meta_info = {};\n\n    let E_SHELL, E_OUT, E_HEADER;\n    let m_failed   = [];\n    let m_skipped  = [];\n    let m_passed   = [];\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Main TEST ENABLE\n    pass the testname (as listed in TESTS) and either true or false)\n/*/ let TM = ( testname, flag ) => {\n      if (testname===undefined) {\n        console.warn(`${PR} %cConfigured and Active`,`color:red;background-color:yellow`);\n        TEST_GO = true;\n        return true;\n      }\n      if (typeof testname!=='string') throw \"arg1 must be a testname\";\n      if (!TESTS.hasOwnProperty(testname)) throw `\"${testname}\" is not a valid testname`;\n      if (DBG) console.log(PR,'TM',testname,flag||'');\n      if (flag===undefined) {\n        if (!TEST_GO) console.error(`${PR} Test Switch read before testing started`);\n        let setting = TESTS[testname];\n        return setting;\n      } else {\n        TESTS[testname]=flag;\n        m_ConfigureTestFlags(testname,flag);\n        return flag;\n      }\n    };\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    TM.SetTitle = function( text ) {\n      E_HEADER.innerText = text;\n    };\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    TM.SetMeta = function( meta, value ) {\n      if (typeof meta==='string') {\n        let obj = {};\n        obj[meta]=value;\n        meta = obj;\n      }\n      if (typeof meta==='object') {\n        Object.assign(m_meta_info,meta);\n      } else {\n        throw Error('SetMeta() expected either object or string,value');\n      }\n    };\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    TM.MetaString = function() {\n      let o = '';\n      let e = Object.entries(m_meta_info).forEach(([k,v])=>{\n        o+=`${k}:${v} `;\n      });\n      return o;\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: pass the particular subtest\n/*/ TM.Pass = function ( subtest ) {\n      m_InitShell();\n      // initialize tests\n      if (DBG) console.log(`${PR} %cPass %c${subtest}`,\"color:green\",\"color:black\");\n      if (PASSED.hasOwnProperty(subtest)) {\n        if (PASSED[subtest]) ++PASSED[subtest];\n        else PASSED[subtest] = 1;\n      } else {\n        throw Error(`Unknown subtest: ${subtest}`);\n      }\n    };\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: fail the particular subtest\n/*/ TM.Fail = function ( subtest ) {\n      m_InitShell();\n      if (DBG) console.error(`${PR} %cFail ${subtest}`,\"color:red;font-weight:bold\");\n      if (PASSED.hasOwnProperty(subtest)) {\n        // 'null' for 'condition succeed' tests\n        // '0' for 'no error detected' tests\n        let flag = PASSED[subtest];\n        if (typeof flag==='string') {\n          // this has already failed with error\n          PASSED[subtest]=flag+'+';\n          return;\n        }\n        if (flag===null) return; // null flag are skipped\n        if (flag===0) {\n          PASSED[subtest]=-1; // failed once\n          return;\n        }\n        if (flag<=0) {\n          --PASSED[subtest];  // multiple failures\n          return;\n        }\n        // bizarre 'succeeded but now failed'\n        if (flag>0) {\n          PASSED[subtest]=`succeeded ${flag} times, then failed`;\n          return;\n        }\n      }\n      throw Error(`Unknown subtest: ${subtest}`);\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: check if the particular subtests passed have indeed passed\n/*/ TM.Passed = function ( ...args ) {\n      if (DBG) console.log(PR,'Passed');\n      let passed = true;\n      args.forEach((subtest)=>{\n        if (!PASSED.hasOwnProperty(subtest)) throw `\"${subtest}\" is not valid subtest`;\n        passed = passed && PASSED[subtest];\n      });\n      return passed;\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: output test results\n/*/ TM.Assess = function () {\n      if (DBG) console.log(PR,'Assess');\n      m_failed   = [];\n      m_skipped  = [];\n      m_passed   = [];\n      m_PreTest();\n      m_TestResults();\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: assess whether passed arrays match during Assess function()\n/*/ TM.AssessArrayMatch = function( subtest, arr1, arr2 ) {\n      if (DBG) console.log(PR,'AssessArrayMatch');\n      ARR_MATCH.push([subtest,arr1,arr2]);\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: return TRUE if there were no failing tests in the last test.\n    Call TM.Assess() again to retest\n/*/ TM.AllPassed = function () {\n      return m_failed.length!==0;\n    }\n\n\n\n/// TEST FUNCTIONS ////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ sets the PASSED object keys to enable/disable tests prior to running\n/*/ function m_ConfigureTestFlags ( testname, flag ) {\n      if (flag===undefined) throw \"arg2 flag must be true to enable, false to disable\";\n      // the subtest value must be set to false first\n      // to skip tests, the subtest value is set to null\n      if (flag===false) flag=null;\n      if (flag===true) flag=false;\n      // set subtest flags\n      let subtests;\n      switch (testname) {\n        case 'state':\n          subtests = {\n            stateChange       : flag,\n            stateMerge        : flag,\n            stateConcat       : flag\n          };\n          break;\n        case 'hook':\n          subtests = {\n            hookInit1         : flag,\n            hookInit2         : flag,\n            hookInitDeferred  : flag,\n            hookStart         : flag\n          };\n          break;\n        case 'call':\n          subtests = {\n            callHndlrReg      : flag,\n            callHndlrData     : flag,\n            callHndlrDataProp : flag,\n            callDataReturn    : flag,\n            callDataAdd       : flag,\n            callDataMulti     : flag\n          };\n          break;\n        case 'remote':\n          subtests = {\n            remoteCall        : flag,\n            remoteData        : flag,\n            remoteData2       : flag,\n            remoteDataReturn  : flag,\n            remoteDataAdd     : flag,\n            remoteDataMulti   : flag\n          };\n          break;\n        case 'server':\n          subtests = {\n            serverCall        : flag,\n            serverCallOrder   : flag,\n            serverReturn      : flag,\n            serverData        : flag,\n            serverDataAdd     : flag\n          }\n          break;\n        case 'net':\n          subtests = {\n            netMessageReg     : flag,\n            netCallHndlr      : flag,\n            netSendHndlr      : flag,\n            netSendNoEcho     : 0,    // if this stays 0, then NOERR has passed\n            netSignal         : flag,\n            netSignalEcho     : flag,\n            netData           : flag,\n            netDataReturn     : flag,\n            netDataAdd        : flag,\n//          netDataGather     : flag,\n            netDataMulti      : flag\n          }\n          break;\n        default:\n          throw `Unknown test \"${testname}\"`\n      } // end switch\n      Object.assign(PASSED,subtests);\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    function m_PreTest() {\n      // test arrays\n      ARR_MATCH.forEach(function(pair) {\n        let pass = true;\n        let subtest = pair[0];\n        let arr1 = pair[1];\n        let arr2 = pair[2];\n        pass = pass && (arr1.length===arr2.length);\n        for (let i=0; i<arr1.length; i++) {\n          pass = pass && (arr1[i]===arr2[i]);\n        }\n        if (pass) TM.Pass(subtest);\n      });\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ prints the test output to console\n/*/ function m_TestResults() {\n      m_ShowShell();\n      // check all test results\n      let pEntries = Object.entries(PASSED);\n      let padding  = 0;\n      // find longest string\n      pEntries.forEach(( [key,value] ) => {\n        if (key.length>padding) padding = key.length;\n      });\n      // scan test results\n      pEntries.forEach(( [key,value ]) => {\n        let res = '';\n        if (value===null) {\n          // res = `${(key).padEnd(padding)} [ ]\\n`;\n          m_skipped.push(res);\n        } else switch (typeof value) {\n          case 'number':\n            if (value>=1) {\n              if (value===1) res=`${key.padEnd(padding)} [OK]\\n`;\n              if (value > 1) res=`${key.padEnd(padding)} [OK] x ${value}\\n`;\n              m_passed.push(res);\n            } else {\n              if (value===0) {\n                res=`${key.padEnd(padding)} [NP]\\n`;\n                m_passed.push(res);\n              }\n              if (value===-1) {\n                res=`${key.padEnd(padding)} [!!] FAIL\\n`;\n                m_failed.push(res);\n              }\n              if (value< -1) {\n                res=`${key.padEnd(padding)} [!!] FAIL x ${-value}\\n`;\n                m_failed.push(res);\n              }\n            }\n            break;\n          case 'boolean':\n            if (value) {\n              res=`${key.padEnd(padding)} [OK]\\n`;\n              m_passed.push(res);\n            } else {\n              res=`${key.padEnd(padding)} [!!] FAIL\\n`;\n              m_failed.push(res);\n            }\n            break;\n          default:\n            m_passed.push(`${key.padEnd(padding)} [OK] '${value}'\\n`);\n            break;\n        } // switch typeof value\n      }); // pEntries.forEach\n\n      let testTitle = \"UNISYS LOGIC TEST RESULTS\";\n      console.group(testTitle);\n        let out = m_passed.concat(m_failed,m_skipped)\n          .join('');\n\n        // additional help\n        let tnotes = '';\n        if (!TM.Passed('netCallHndlr')) tnotes+= `NOTE: 'netCallHndlr' requires a synched remote app to call-in\\n`;\n        if (!TM.Passed('netSendHndlr')) tnotes+= `NOTE: 'netSendHndlr' requires a synched remote app to call-in\\n`;\n        if (!TM.Passed('netData')) tnotes+= `NOTE: 'netData*' requires a synched remote app to respond to call-out\\n`;\n        if (tnotes) out+='\\n'+tnotes;\n\n        // summary\n        let summary = `${m_passed.length}=passed`;\n        if (m_failed.length) summary+=` ${m_failed.length}=failed`;\n        if (m_skipped.length) summary+=` ${m_skipped.length}=skipped`;\n        console.log(`${out}\\n${summary}`);\n        TM.SetTitle(`${testTitle} ${TM.MetaString()}`);\n        E_OUT.innerText = `${summary}\\n\\n`;\n        E_OUT.innerText += \"OPEN JAVASCRIPT CONSOLE TO SEE DETAILS\\n\";\n        E_OUT.innerText += \"Mac shortcuts to open console\\n\";\n        E_OUT.innerText += \"  Chrome  : cmd-option-j\\n\";\n        E_OUT.innerText += \"  Firefox : cmd-option-k\\n\";\n        E_OUT.innerText += \"PC use ctrl-shift instead\\n\";\n      console.groupEnd();\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ initialize the shell user interface for test results as elements, but\n    don't yet link them because component may not have rendered yet\n/*/ function m_InitShell() {\n      if (!E_OUT) {\n        E_OUT = document.createElement('pre');\n        E_HEADER = document.createElement('h4');\n        E_HEADER.innerText = \"RUNNING TESTS \";\n        E_OUT.innerText = '.';\n      } else {\n        E_OUT.innerText += '.';\n      }\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ show the shell elements by finding root div and appending them\n/*/ function m_ShowShell() {\n      E_SHELL = document.getElementById('fdshell');\n      E_SHELL.appendChild(E_HEADER);\n      E_SHELL.appendChild(E_OUT);\n    }\n\n\n/// EXPORT MODULE DEFINITION //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = TM;\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n    UNISYS DATALINK CLASS\n\n    The UNISYS DATALINK (UDATA) class represents a connection to the UNISYS\n    event messaging system. Instances are created with UNISYS.NewDataLink().\n\n    Each UNODE has a unique UNISYS_ID (the UID) which represents its\n    local address. Combined with the device UADDR, this makes every UNODE\n    on the network addressable.\n\n    * UNODES can get and set global state objects\n    * UNODES can subscribe to state change events\n    * UNODES can register listeners for a named message\n    * UNODES can send broadcast to all listeners\n    * UNODES can call listeners and receive data\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/// DEBUGGING /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG          = { send:false, return:false, register:false };\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst BAD_OWNER    = \"must pass owner object of type React.Component or UniModule with optional 'name' parameter\";\nconst BAD_NAME     = \"name parameter must be a string\";\nconst BAD_UID      = \"unexpected non-unique UID\";\nconst NO_DATAOBJ   = \"syntax error: missing data object\";\nconst BAD_EJSPROPS = \"EJS props (window.NC_UNISYS) is undefined, so can not set datalink IP address\";\nconst PR           = \"UDATA:\";\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst SETTINGS     = require('settings');\nconst STATE        = require('unisys/client-state');\nconst Messager     = require('unisys/client-messager-class');\n\n/// NODE MANAGEMENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar UNODE          = new Map(); // unisys connector node map (local)\nvar UNODE_COUNTER  = 100;       // unisys connector node id counter\n\n/// GLOBAL MESSAGES ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar MESSAGER       = new Messager();\n\n/// UNISYS NODE CLASS /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Instances of this class can register/unregister message handlers and also\n    send messages. Constructor receives an owner, which is inspected for\n    properties to determine how to classify the created messager for debugging\n    purposes\n/*/ class UnisysDataLink {\n\n  /*/ CONSTRUCTOR\n      A messager creates a unique ID within the webapp instance. Since\n      messagers are \"owned\" by an object, we want the ID to reflect\n      the owner's identity too while also allowing multiple instances per\n      owner.\n  /*/ constructor( owner, optName ) {\n        let msgr_type = '?TYPE';\n        let msgr_name = '?NAME';\n\n        if ((optName!==undefined) && (typeof optName!=='string')) {\n          throw Error(BAD_NAME);\n        }\n\n        // require an owner that is an object of some kind\n        if (typeof owner!=='object') throw Error(BAD_OWNER);\n\n        // react components or regular objects\n        if (owner.name) {\n          msgr_type = 'MOD';\n          msgr_name = owner.name || optName;\n        } else if (owner.constructor.name) {\n          msgr_type = 'RCT';\n          msgr_name = owner.constructor.name;\n        } else {\n          throw Error(BAD_OWNER);\n        }\n\n        // generate and save unique id\n        this.uid      = `${msgr_type}_${UNODE_COUNTER++}`;\n        this.name     = msgr_name;\n        if (UNODE.has(this.uid)) throw Error(BAD_UID+this.uid);\n\n        // save module in the global module list\n        UNODE.set(this.uid,this);\n      }\n\n\n  /// UNIQUE UNISYS ID for local application\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// this is used to differentiate sources of events so they don't echo\n      UID() { return this.uid; }\n      Name() { return this.name; }\n\n\n  /// GLOBAL STATE ACCESS\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// global STATE module calls are wrapped by unisys node so the unique\n  /// UnisysID address can be appended\n      AppState( namespace ) {\n        return STATE.State(namespace);\n      }\n      SetAppState( namespace, newState ) {\n        // uid is \"source uid\" designating who is making the change\n        STATE.SetState(namespace,newState,this.UID() );\n      }\n      MergeAppState( namespace, newState ) {\n        // uid is \"source uid\" designating who is making the change\n        STATE.MergeState(namespace,newState,this.UID() );\n      }\n      ConcatAppState( namespace, newState ) {\n        // uid is \"source uid\" designating who is making the change\n        STATE.ConcatState(namespace,newState,this.UID() );\n      }\n      // uid is \"source uid\" of subscribing object, to avoid reflection\n      // if the subscribing object is also the originating state changer\n      OnAppStateChange( namespace, listener ) {\n        STATE.OnStateChange(namespace,listener,this.UID() );\n      }\n      AppStateChangeOff( namespace, listener ) {\n        STATE.OffStateChange(namespace,listener);\n      }\n\n\n  /// MESSAGES ////////////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// mesgName is a string, and is an official event that's defined by the\n  /// subclasser of UnisysNode\n      HandleMessage( mesgName, listener ) {\n        // uid is \"source uid\" of subscribing object, to avoid reflection\n        // if the subscribing object is also the originating state changer\n        if (DBG.register) console.log(`${this.uid}_${PR}`,`${this.name} handler added [${mesgName}]`);\n        MESSAGER.HandleMessage(mesgName,listener,{receiverUID:this.UID()});\n      }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n      UnhandleMessage( mesgName, listener ) {\n        if (DBG.register) console.log(`${this.uid}_${PR}`,`${this.name} handler removed [${mesgName}]`);\n        MESSAGER.UnhandleMessage(mesgName,listener);\n      }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ UDATA wraps Messager.Call(), which returns an array of promises.\n      The UDATA version of Call() manages the promises, and returns a\n  /*/ async Call( mesgName, inData={}, options={} ) {\n        options = Object.assign(options,{type:'mcall'});\n        if (DBG.send) {\n          let status = '';\n          if (!options.toNet) status+='NO_NET ';\n          if (!options.toLocal) status+='NO_LOCAL';\n          if (!(options.toLocal||options.toNet)) status='ERR NO LOCAL OR NET';\n          console.log(`${this.uid}_${PR}`,'** DATALINK CALL ASYNC',mesgName,status);\n        }\n        // uid is \"source uid\" of subscribing object, to avoid reflection\n        // if the subscribing object is also the originating state changer\n        options.srcUID = this.UID();\n        let promises = MESSAGER.Call(mesgName,inData,options);\n        /// MAGICAL ASYNC/AWAIT BLOCK ///////\n        if (DBG.send) console.log(`${this.uid}_${PR}`,'** awaiting...',promises);\n        let resArray = await Promise.all(promises);\n        if (DBG.send) console.log(`${this.uid}_${PR}`,'** promise fulfilled!',mesgName);\n        /// END MAGICAL ASYNC/AWAIT BLOCK ///\n        let resObj = Object.assign({},...resArray);\n        if (DBG.return) console.log(`${this.uid}_${PR}`,`[${mesgName}] returned`,JSON.stringify(resObj));\n        return resObj;\n      }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ Sends the data to all message implementors UNLESS it is originating from\n      the same UDATA instance (avoid echoing back to self)\n  /*/ Send( mesgName, inData={}, options={} ) {\n        if (DBG.send) console.log(`${this.uid}_${PR}`,'** DATALINK SEND',mesgName);\n        options = Object.assign(options,{type:'msend'});\n        // uid is \"source uid\" of subscribing object, to avoid reflection\n        // if the subscribing object is also the originating state changer\n        options.srcUID = this.UID();\n        // uid is \"source uid\" of subscribing object, to avoid reflection\n        // if the subscribing object is also the originating state changer\n        MESSAGER.Send(mesgName,inData,options);\n      }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ Sends the data to all message implementors, irregardless of origin.\n  /*/ Signal( mesgName, inData={}, options={} ) {\n        options = Object.assign(options,{type:'msig'});\n        MESSAGER.Signal(mesgName,inData,options);\n      }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ version of Call that forces local-only calls\n  /*/ LocalCall( mesgName, inData, options={} ) {\n        options = Object.assign(options,{type:'mcall'});\n        options.toLocal = true;\n        options.toNet = false;\n        return this.Call(mesgName,inData,options);\n      }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ version of Send that force local-only calls\n  /*/ LocalSend( mesgName, inData, options={} ) {\n        options = Object.assign(options,{type:'msend'});\n        options.toLocal = true;\n        options.toNet = false;\n        this.Send(mesgName,inData,options);\n      }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ version of Send that force local-only calls\n  /*/ LocalSignal( mesgName, inData, options={} ) {\n        options = Object.assign(options,{type:'msig'});\n        options.toLocal = true;\n        options.toNet = false;\n        this.Signal(mesgName,inData,options);\n      }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ version of Call that forces network-only calls\n  /*/ NetCall( mesgName, inData, options={} ) {\n        options = Object.assign(options,{type:'mcall'});\n        options.toLocal = false;\n        options.toNet = true;\n        return this.Call(mesgName,inData,options);\n      }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ version of Send that force network-only calls\n  /*/ NetSend( mesgName, inData, options={} ) {\n        options = Object.assign(options,{type:'msend'});\n        options.toLocal = false;\n        options.toNet = true;\n        this.Send(mesgName,inData,options);\n      }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ version of Signal that forces network-only signal\n  /*/ NetSignal( mesgName, inData, options={} ) {\n        options.toLocal = false;\n        options.toNet = true;\n        this.Signal(mesgName,inData,options);\n      }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n      NullCallback () {\n        if (DBG.send) console.log(`${this.uid}_${PR}`,'null_callback',this.UID());\n      }\n  } // class UnisysNode\n\n\n/// STATIC CLASS METHODS //////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ There's a single MESSAGER object that handles all registered messages for\n    UNISYS.\n/*/ UnisysDataLink.MessageNames = function () {\n      return MESSAGER.MessageNames();\n    };\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Filter any bad messages from the passed array of strings\n/*/ UnisysDataLink.ValidateMessageNames = function ( msgs=[] ) {\n      let valid=[];\n      msgs.forEach((name)=>{\n        if (MESSAGER.HasMessageName(name)) valid.push(name);\n        else throw new Error(`ValidateMessageNames() found invalid message '${name}'`);\n      });\n      return valid;\n    };\n\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = UnisysDataLink;\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n    LifeCycle - A system manager for application lifecycle events.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst DBG = window.NC_DBG && window.NC_DBG.lifecycle;\nconst BAD_PATH =\n  \"module_path must be a string derived from the module's module.id\";\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst PATH = require(\"system/util/path\");\n\n/// DECLARATIONS //////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar PHASE_HOOKS = new Map(); // functions that might right a Promise\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst PHASES = [\n  \"TEST_CONF\", // setup tests\n  \"INITIALIZE\", // module data structure init\n  \"LOADASSETS\", // load any external data, make connections\n  \"CONFIGURE\", // configure runtime data structures\n  \"DOM_READY\", // when viewsystem has completely composed\n  \"RESET\", // reset runtime data structures\n  \"START\", // start normal execution run\n  \"APP_READY\", // synchronize to UNISYS network server\n  \"RUN\", // system starts running\n  \"UPDATE\", // system is running (periodic call w/ time)\n  \"PREPAUSE\", // system wants to pause run\n  \"PAUSE\", // system has paused (periodic call w/ time)\n  \"POSTPAUSE\", // system wants to resume running\n  \"STOP\", // system wants to stop current run\n  \"DISCONNECT\", // unisys server has gone offline\n  \"RECONNECT\", // unisys server has reconnected\n  \"UNLOADASSETS\", // system releases any connections\n  \"SHUTDOWN\" // system wants to shut down\n];\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar PHASE = PHASES[0] + \"_PENDING\"; // current phase\n\n/// MODULE DEFINITION /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar MOD = {\n  name: \"LifeCycle\",\n  scope: \"system/booting\" // overwritten by UNISYS.SystemInitialize()\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ UTILITY: compare the destination scope with the acceptable scope (the\n    module.id of the root JSX component in a view). Any module not in the\n    system directory will not get called\n/*/\nfunction m_ExecuteScopedPhase(phase, o) {\n  // check for special unisys or system directory\n  if (o.scope.indexOf(\"system\") === 0) return o.f();\n  if (o.scope.indexOf(\"unisys\") === 0) return o.f();\n  // check for subdirectory\n  if (o.scope.includes(MOD.scope, 0)) return o.f();\n  // else do nothing\n  if (DBG)\n    console.info(\n      `LIFECYCLE: skipping [${phase}] for ${o.scope} because scope is ${\n        MOD.scope\n      }`\n    );\n  return undefined;\n}\n\n/// LIFECYCLE METHODS /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: register a Phase Handler which is invoked by MOD.Execute()\n    phase is a string constant from PHASES array above\n    f is a function that does work immediately, or returns a Promise\n/*/\nMOD.Hook = (phase, f, scope) => {\n  // make sure scope is included\n  if (typeof scope !== \"string\")\n    throw Error(`<arg3> scope is required (set to module.id)`);\n  // does this phase exist?\n  if (typeof phase !== \"string\")\n    throw Error(\"<arg1> must be PHASENAME (e.g. 'LOADASSETS')\");\n  if (!PHASES.includes(phase))\n    throw Error(phase, \"is not a recognized lifecycle phase\");\n  // did we also get a promise?\n  if (!(f instanceof Function))\n    throw Error(\"<arg2> must be a function optionally returning Promise\");\n\n  // get the list of promises associated with this phase\n  // and add the new promise\n  if (!PHASE_HOOKS.has(phase)) PHASE_HOOKS.set(phase, []);\n  PHASE_HOOKS.get(phase).push({ f, scope });\n  if (DBG) console.log(`[${phase}] added handler`);\n};\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: Execute all Promises associated with a phase, completing when\n    all the callback functions complete. If the callback function returns\n    a Promise, this is added to a list of Promises to wait for before the\n    function returns control to the calling code.\n/*/\nMOD.Execute = async phase => {\n  // require scope to be set\n  if (MOD.scope === false)\n    throw Error(\n      `UNISYS.SetScope() must be set to RootJSX View's module.id. Aborting.`\n    );\n\n  // note: contents of PHASE_HOOKs are promise-generating functions\n  if (!PHASES.includes(phase))\n    throw Error(`${phase} is not a recognized lifecycle phase`);\n  let hooks = PHASE_HOOKS.get(phase);\n  if (hooks === undefined) {\n    if (DBG) console.log(`[${phase}] no subscribers`);\n    return;\n  }\n\n  // phase housekeeping\n  PHASE = phase + \"_PENDING\";\n\n  // now execute handlers and promises\n  let icount = 0;\n  if (DBG) console.group(phase);\n  // get an array of promises\n  // o contains f, scope pushed in Hook() above\n  let promises = hooks.map(o => {\n    let retval = m_ExecuteScopedPhase(phase, o);\n    if (retval instanceof Promise) {\n      icount++;\n      return retval;\n    }\n    // return undefined to signal no special handling\n    return undefined;\n  });\n  promises = promises.filter(e => {\n    return e !== undefined;\n  });\n  if (DBG && hooks.length)\n    console.log(`[${phase}] HANDLERS PROCESSED : ${hooks.length}`);\n  if (DBG && icount) console.log(`[${phase}] PROMISES QUEUED    : ${icount}`);\n\n  // wait for all promises to execute\n  await Promise.all(promises)\n    .then(values => {\n      if (DBG && values.length)\n        console.log(`[${phase}] PROMISES RETURNED  : ${values.length}`, values);\n      if (DBG) console.groupEnd();\n      return values;\n    })\n    .catch(err => {\n      if (DBG) console.log(`[${phase} EXECUTE ERROR ${err}`);\n      throw Error(`[${phase} EXECUTE ERROR ${err}`);\n    });\n\n  // phase housekeeping\n  PHASE = phase;\n};\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: The scope is used to filter lifecycle events within a particular\n    application path, which are defined under the view directory.\n/*/\nMOD.SetScope = module_path => {\n  if (typeof module_path !== \"string\") throw Error(BAD_PATH);\n  if (DBG) console.log(`setting lifecycle scope to ${module_path}`);\n  // strip out filename, if one exists\n  MOD.scope = PATH.Dirname(module_path);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: The scope\n/*/\nMOD.Scope = () => {\n  return MOD.scope;\n};\n\n/// STATIC METHODS ////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// ...\n\n/// EXPORT MODULE DEFINITION //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = MOD;\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n    Messager - Handle a collection of named events and their handlers\n    https://en.wikipedia.org/wiki/Event-driven_architecture#JavaScript\n\n    NOTE: This class is often WRAPPED by other UNISYS modules that manage\n    a unique ID (such as the unique unisys datalink id) that hide that\n    implementation detail from local users (e.g. unisys-data-class)\n\n    HandleMessasge('MESG_NAME',handlerFunc,options)\n      Add a handlerFunc. Specify options.handlerUID to enable echo rejection\n      (same udata module will not invoke own handler when sending same message)\n    UnhandleMessage('MESG_NAME',handlerFunc)\n      Remove a handlerFunc associated with the handlerFuncFunction\n    Send('MESG_NAME',data,options)\n      Trigger an message+data to all handlers from a particular UDATA id\n      If options.srcUID is specified, echo suppression is enabled\n    Signal('MESG_NAME',data)\n      Similar to Send(), but will ALWAYS broadcast to all implementors\n    Call('MESG_NAME',data,options)\n      Similar to Send(), but can return a value to a callback function\n      options.srcUID is the UDATA id; set for echo supression to that uid\n      options.dataReturnFunc is the callback function.\n\n    NOTE: CallerReturnFunctions receive data object AND control object.\n    The control object has the \"return\" function that closes a transaction;\n    this is useful for async operations without Promises.\n\n    NOTE: HandlerFunctions and CallerReturnFunctions are anotated with the\n    udata_id property, which can be set to avoid echoing a message back to\n    the same originating udata source.\n\n    NOTE: When providing a handlerFunc, you might want to bind it to a\n    specific object context (i.e. 'this') value using bind().\n    e.g. handlerFunction = handlerFunction.bind(this);\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst TEST         = require('test');\nconst NetMessage   = require('unisys/common-netmessage-class');\n\n/// MODULE VARS ///////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar   MSGR_IDCOUNT = 0;\nvar   DBG          = false;\n\n/// UNISYS MESSAGER CLASS /////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nclass Messager {\n/*/ Instances of this class can be used to implement a UNISYS-style message\n    passing scheme with shared semantics. It maintains a Map keyed by mesgName\n    strings, containing a Set object filled with handlers for that mesgName.\n/*/ constructor() {\n      this.handlerMap   = new Map(); // message map storing sets of functions\n      this.messager_id  = ++MSGR_IDCOUNT;\n    }\n\n/// FIRE ONCE EVENTS //////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: subscribe a handlerFunc function with a particular unisys id\n    to receive a particular message. The handlerFunc receives a data obj\n    and should return one as well. If there is an error, return a string.\n/*/ HandleMessage( mesgName, handlerFunc, options={} ) {\n      let { handlerUID } = options;\n      let { syntax } = options;\n      if (typeof handlerFunc !== 'function') {\n        throw \"arg2 must be a function\";\n      }\n      if (typeof handlerUID==='string') {\n        // bind the udata uid to the handlerFunc function for convenient access\n        // by the message dispatcher\n        handlerFunc.udata_id = handlerUID;\n      }\n      let handlers = this.handlerMap.get(mesgName);\n      if (!handlers) {\n        handlers = new Set();\n        this.handlerMap.set( mesgName, handlers );\n      }\n      // syntax annotation\n      if (syntax) handlerFunc.umesg = { syntax };\n      // saved function to handler\n      handlers.add(handlerFunc);\n      return this;\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: unsubscribe a handlerFunc function from a particular event\n/*/ UnhandleMessage( mesgName, handlerFunc ) {\n      if (!arguments.length) {\n        this.handlerMap.clear();\n      } else if (arguments.length===1) {\n        this.handlerMap.delete(mesgName);\n      } else {\n        const handlers = this.handlerMap.get(mesgName);\n        if (handlers) {\n          handlers.delete(handlerFunc);\n        }\n      }\n      return this;\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: trigger a message with the data object payload, sending to all handlers\n    that implement that event. Includer sender's unisys id to prevent the sender\n    to receiving its own message back if it happens to implement the message as\n    well. dstScope is 'net' or 'local' to limit where to send, or 'all'\n    for everyone on net or local\n/*/ Send( mesgName, inData, options={} ) {\n      let { srcUID, type }          = options;\n      let { toLocal=true, toNet=true } = options;\n      const handlers = this.handlerMap.get(mesgName);\n      /// toLocal\n      if (handlers && toLocal) for (let handlerFunc of handlers) {\n        // handlerFunc signature: (data,dataReturn) => {}\n        // handlerFunc has udata_id property to note originating UDATA object\n        // skip \"same origin\" calls\n        if (srcUID && handlerFunc.udata_id===srcUID) {\n          if (DBG) console.warn(`MessagerSend: [${mesgName}] skip call since origin = destination; use Broadcast() if intended`);\n          continue;\n        }\n        // trigger the handler (no return expected)\n        handlerFunc(inData,{/*control functions go here*/});\n      } // end toLocal\n      /// toNetwork\n      if (toNet) {\n        let pkt = new NetMessage(mesgName,inData,type);\n        pkt.SocketSend();\n      } // end toNetwork\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: wrapper for Send() used when you want every handlerFunc, including\n    the sender, to receive the event even if it is the one who sent it.\n/*/ Signal( mesgName, data, options={} ) {\n      if (options.srcUID) {\n        console.warn(`overriding srcUID ${options.srcUID} with NULL because Signal() doesn't use it`);\n        options.srcUID = null;\n      }\n      this.Send(mesgName,data,options);\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: Return an array of Promises. Called by UDATA.Call().\n/*/ Call( mesgName, inData, options={} ) {\n      let { srcUID, type }             = options;\n      let { toLocal=true, toNet=true } = options;\n      const handlers = this.handlerMap.get(mesgName);\n      let promises = [];\n      /// toLocal\n      if (handlers && toLocal) {\n        for (let handlerFunc of handlers) {\n          // handlerFunc signature: (data,dataReturn) => {}\n          // handlerFunc has udata_id property to note originating UDATA object\n          // skip \"same origin\" calls\n          if (srcUID && handlerFunc.udata_id===srcUID) {\n            if (DBG) console.warn(`MessagerCall: [${mesgName}] skip call since origin = destination; use Broadcast() if intended`);\n            continue;\n          }\n          // Create a promise. if handlerFunc returns a promise, it follows\n          let p = f_MakeResolverFunction( handlerFunc, inData );\n          promises.push(p);\n        } // end toLocal\n      }\n      /// resolver function\n      /// remember MESSAGER class is used for more than just Network Calls\n      /// the state manager also uses it, so the resolved value may be of any type\n      function f_MakeResolverFunction( handlerFunc ) {\n        return new Promise(( resolve, reject ) => {\n          let retval = handlerFunc(inData,{/*control functions go here*/});\n          resolve(retval);\n        });\n      }\n      /// toNetwork\n      if (toNet) {\n        type = type || 'mcall';\n        let pkt = new NetMessage(mesgName,inData,type);\n        let p = pkt.QueueTransaction();\n        promises.push(p);\n      } // end toNetwork\n\n      /// return all queued promises\n      return promises;\n    }\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: Return a list of messages handled by this Messager instance\n/*/ MessageNames () {\n      let handlers = [];\n      this.handlerMap.forEach( (value, key ) => {\n        handlers.push(key);\n        if (DBG) console.log('handler: '+key);\n      });\n      return handlers;\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: Verify that message exists\n/*/ HasMessageName ( msg='' ) {\n      return this.handlerMap.has(msg);\n    }\n\n} // class Messager\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = Messager;\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n    UNISYS MODULE SHELL\n\n    A simple shell with a unique id and unique name. Currently this is just\n    a utility class for maintaining naming convention for modules, and\n    serves as the interface for module management within the UNISYS universe\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst DBG            = true;\nconst BAD_NAME       = \"name parameter must be a string or unisys module\";\nconst NOT_UNIQUE     = \"name must be unique\";\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst LIFECYCLE      = require('unisys/client-lifecycle');\nconst PATH           = require('system/util/path');\n\n/// MODULE DECLARATIONS ///////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar MODULES          = new Map(); // unisys modules map\nvar MODULES_COUNTER  = 1;         // unisys modules counter\n\n/// UNISYS MODULE CLASS ///////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Instances of this class are used to participate in the UNISYS lifecycle.\n    Constructor receives the value of module.id, which is used to help scope\n    what lifecycle hooks are distributed to which module\n/*/ class UnisysModule {\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ initializer is the value module.id or another instance of UnisysModule,\n      which is used to create a derivative name of form 'initializer name:0'\n  /*/ constructor( module ) {\n\n        if (module===undefined) throw Error(BAD_NAME);\n        // can pass another unisys modules to create derived name\n        if (module instanceof UnisysModule) {\n          this.module_id = module.AutoName();\n        } else if (typeof module==='string') {\n        // otherwise, copy the initializer\n          this.module_id = module;\n        }\n        if (MODULES.has( this.name )) throw Error(NOT_UNIQUE);\n\n        // save unique information\n        this.uid = `UMOD_${MODULES_COUNTER++}`;\n\n        // save derivative subname counter\n        this.subnameCounter = 0;\n\n        // save module in the global module list\n        MODULES.set( this.module_id, this );\n      }\n\n  /// PROPERTIES //////////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ this is used for identifying the module. It must be unique across all\n  /*/ ModuleID() {\n        return this.module_id;\n      }\n  /*/ utility method to return a short name\n  /*/ ModuleName() {\n        return PATH.Basename(this.module_id);\n      }\n\n  /// UTILITIES ///////////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ used to create a derivative name\n  /*/ AutoName() {\n        return `${this.module_id}:${this.subnameCounter++}`;\n      }\n  /*/ check if the name already exists in the MODULES collection\n  /*/ HasModule( name ) {\n        return MODULES.has(name);\n      }\n\n  /// LIFECYCLE /////////////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ wrap Hook function to include the ModuleID\n  /*/ Hook( phase, f ) {\n        LIFECYCLE.Hook(phase,f,this.ModuleID());\n      }\n\n\n  } // end UnisysModule\n\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = UnisysModule;\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n    UNISYS NETWORK implements network controls and synchronization.\n    It initializes a network connection on the CONNECT lifecycle.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst DBG = { connect: true, handle: false };\n\n/// LOAD LIBRARIES ////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst SETTINGS = require(\"settings\");\nconst NetMessage = require(\"unisys/common-netmessage-class\");\nconst DEFS = require(\"./common-defs\");\nconst PROMPTS = require(\"system/util/prompts\");\n\nconst PR = PROMPTS.Pad(\"NETWORK\");\nconst WARN = PROMPTS.Pad(\"!!!\");\nconst ERR_NM_REQ = \"arg1 must be NetMessage instance\";\nconst ERR_NO_SOCKET = \"Network socket has not been established yet\";\nconst ERR_BAD_UDATA = \"An instance of 'client-datalink-class' is required\";\n\n/// GLOBAL NETWORK INFO (INJECTED ON INDEX) ///////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar NETSOCK = SETTINGS.EJSProp(\"socket\");\nvar NETCLIENT = SETTINGS.EJSProp(\"client\");\nvar NETSERVER = SETTINGS.EJSProp(\"server\");\n\n/// NETWORK ID VALUES /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst M0_INIT = 0;\nconst M1_CONNECTING = 1;\nconst M2_CONNECTED = 2;\nconst M3_REGISTERED = 3;\nconst M4_READY = 4;\nconst M_STANDALONE = 5;\nconst M_NOCONNECT = 6;\nvar m_status = M0_INIT;\nvar m_options = {};\n\n// hearbeat\nvar m_hearbeat_timer;\n\n/// API METHODS ///////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar NETWORK = {};\nvar UDATA = null; // assigned during NETWORK.Connect()\n\n/// CONNECT ///////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Establish connection to UNISYS server. This is called by client.js during\n    NetworkInitialize(), which itself fires after the application has rendered\n    completely.\n/*/\nNETWORK.Connect = function(datalink, opt) {\n  // special case: STANDALONE mode is set by a different set of magical\n  // window.NC_UNISYS properties\n  if (window.NC_UNISYS.server.ip==='standalone') {\n    m_status = M_STANDALONE;\n    console.warn(PR,\"STANDALONE MODE: NETWORK.Connect() suppressed!\");\n    NetMessage.GlobalOfflineMode();\n    if (typeof opt.success === \"function\") opt.success();\n    return;\n  }\n\n  // if multiple network connections occur, emit warning\n  // warning: don't modify this unless you have a deep knowledge of how\n  // the webapp system works or you might break something\n  if (m_status > 0) {\n    let err =\n      \"called twice...other views may be calling UNISYS outside of lifecycle\";\n    console.error(WARN, err);\n    return;\n  }\n  m_status = M1_CONNECTING;\n\n  // check and save parms\n  if (datalink.constructor.name !== \"UnisysDataLink\") {\n    throw Error(ERR_BAD_UDATA);\n  }\n  if (!UDATA) UDATA = datalink;\n  m_options = opt || {};\n\n  // create websocket\n  // uses values that were embedded in index.ejs on load\n  let wsURI = `ws://${NETSOCK.uaddr}:${NETSOCK.uport}`;\n  NETSOCK.ws = new WebSocket(wsURI);\n  if (DBG.connect) console.log(PR, \"OPEN SOCKET TO\", wsURI);\n\n  // create listeners\n  NETWORK.AddListener(\"open\", function(event) {\n    if (DBG.connect) console.log(PR, \"..OPEN\", event.target.url);\n    m_status = M2_CONNECTED;\n    // message handling continues in 'message' handler\n    // the first message is assumed to be registration data\n  });\n  NETWORK.AddListener(\"close\", function(event) {\n    if (DBG.connect) console.log(PR, \"..CLOSE\", event.target.url);\n    NetMessage.GlobalOfflineMode();\n    m_status = M_STANDALONE;\n  });\n  // handle socket errors\n  NETWORK.AddListener(\"error\", function(event) {\n    /*/ DSHACK: For Spring 2019, adding manifest support to try to\n        avoid rewriting the app with service workers\n    /*/\n    let appCache = window.applicationCache;\n    switch (appCache.status) {\n      case appCache.UNCACHED:\n        // this occurs if there is not a cached page\n        console.warn(WARN, \"ERROR opening command socket\", event);\n        throw Error(\"error with command socket\");\n        break;\n      case appCache.IDLE: /* falls-through */\n      case appCache.CHECKING: /* falls-through */\n      case appCache.DOWNLOADING: /* falls-through */\n      case appCache.UPDATEREADY: /* falls-through */\n      case appCache.OBSOLETE:\n        // this occurs\n        console.info(WARN, \"STANDALONE MODE. USING CACHED DATA\");\n        m_status = M_STANDALONE;\n        NetMessage.GlobalOfflineMode(); // deregister socket\n        // force promise to succeed\n        if (typeof m_options.success === \"function\") m_options.success();\n        break;\n      default:\n        m_status = M_NOCONNECT;\n        throw Error(\"unknown appcache status. dumping\", appCache);\n        break;\n    }\n  });\n  // handle incoming messages\n  NETWORK.AddListener(\"message\", m_HandleRegistrationMessage);\n}; // Connect()\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ After 'open' event, we expect the first message on the socket to contain\n    network session-related messages\n/*/\nfunction m_HandleRegistrationMessage(msgEvent) {\n  let regData = JSON.parse(msgEvent.data);\n  let { HELLO, UADDR } = regData;\n  // (1) after receiving the initial message, switch over to regular\n  // message handler\n  NETWORK.RemoveListener(\"message\", m_HandleRegistrationMessage);\n  m_status = M3_REGISTERED;\n  // (2) initialize global settings for netmessage\n  if (DBG.connect) console.log(PR, `connected to ${UADDR}`, NETSOCK);\n  NETSOCK.ws.UADDR = NetMessage.DefaultServerUADDR();\n  NetMessage.GlobalSetup({ uaddr: UADDR, netsocket: NETSOCK.ws });\n  // (3) connect regular message handler\n  NETWORK.AddListener(\"message\", m_HandleMessage);\n  m_status = M4_READY;\n  // (4) network is initialized\n  if (typeof m_options.success === \"function\") m_options.success();\n  // (5) initialize heartbeat timer\n  m_ResetHearbeatTimer();\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ When a heartbeat ping is received, respond with a pong to let the server\n    know that we're still alive.\n/*/\nfunction m_RespondToHeartbeat() {\n  if (NETSOCK.ws.readyState === NETSOCK.ws.OPEN) {\n    NETSOCK.ws.send(\"pong\", (err) => {\n      if (err) console.log(PR, 'error \"', err, '\" while sending response pong');\n    });\n  }\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ If a 'hearbeat' message is not received from the server every 5 seconds\n    we assume the network connection has gone down.  The timeout should be\n    greater than the server heartbeat interval set in\n    server-network.js:m_StartHeartbeat()\n\n    The UNISYSDisconnect handler only goes down when the server closes the\n    connection.  In order to detect the internet connection going down\n    (e.g. wifi) we need to check to see if we are peridically receiving\n    a heartbeat message from the server.\n/*/\nfunction m_ResetHearbeatTimer() {\n  clearTimeout(m_hearbeat_timer);\n  m_hearbeat_timer = setTimeout(function heartbeatStopped() {\n    if (DBG.handle) console.log(PR, 'ping heartbeat not received from server before time ran out -- YOURE DEAD!');\n    NetMessage.GlobalOfflineMode({ message: \"Client Disconnected\" });\n  }, DEFS.SERVER_HEARTBEAT_INTERVAL * 2);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_HandleMessage(msgEvent) {\n\n  // Check Hearbeat\n  if (msgEvent.data === 'ping') {\n    if (DBG.handle) console.log(PR, '...got hearbeat!  Reset timer');\n    m_RespondToHeartbeat();\n    m_ResetHearbeatTimer();\n    return;\n  }\n\n  // Handle Regular Message\n  let pkt = new NetMessage(msgEvent.data);\n  let msg = pkt.Message();\n  if (pkt.IsOwnResponse()) {\n    if (DBG.handle) console.log(PR, \"completing transaction\", msg);\n    pkt.CompleteTransaction();\n    return;\n  }\n  let data = pkt.Data();\n  let type = pkt.Type();\n  let dbgout = DBG.handle && !msg.startsWith(\"SRV_\");\n  /// otherwise, incoming invocation from network\n  switch (type) {\n    case \"state\":\n      if (dbgout) console.log(PR, \"received state change\", msg);\n      break;\n    case \"msig\":\n      if (dbgout) {\n        console.warn(\n          PR,\n          `ME_${NetMessage.SocketUADDR()} received msig '${msg}' from ${pkt.SourceAddress()}`,\n          data\n        );\n      }\n      UDATA.LocalSignal(msg, data);\n      pkt.ReturnTransaction();\n      break;\n    case \"msend\":\n      if (dbgout) {\n        console.warn(\n          PR,\n          `ME_${NetMessage.SocketUADDR()} received msend '${msg}' from ${pkt.SourceAddress()}`,\n          data\n        );\n      }\n      UDATA.LocalSend(msg, data);\n      pkt.ReturnTransaction();\n      break;\n    case \"mcall\":\n      if (dbgout) {\n        console.warn(\n          PR,\n          `ME_${NetMessage.SocketUADDR()} received mcall '${msg}' from ${pkt.SourceAddress()}`\n        );\n      }\n      UDATA.LocalCall(msg, data).then(result => {\n        if (dbgout) {\n          console.log(\n            `ME_${NetMessage.SocketUADDR()} forwarded '${msg}', returning ${JSON.stringify(\n              result\n            )}`\n          );\n        }\n        // now return the packet\n        pkt.SetData(result);\n        pkt.ReturnTransaction();\n      });\n      break;\n    default:\n      throw Error(\"unknown packet type\", type);\n  }\n}\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Send a packet on socket connection, assuming it is valid\n/*/\nNETWORK.Send = function(pkt) {\n  if (!(pkt instanceof NetMessage)) throw Error(ERR_NM_REQ);\n  if (NETSOCK.ws.readyState === 1) {\n    let json = pkt.JSON();\n    if (DBG) console.log(\"SENDING\", pkt.Message(), pkt.Data(), pkt.SeqNum());\n    NETSOCK.ws.send(json);\n  } else {\n    console.log(\"Socket not ReadyState 1, is\", NETSOCK.ws.readyState);\n  }\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Send a packet on socket connection, return Promise\n/*/\nNETWORK.Call = function(pkt) {\n  if (!(pkt instanceof NetMessage)) throw Error(ERR_NM_REQ);\n  if (NETSOCK.ws.readyState === 1) {\n    let json = pkt.JSON();\n    if (DBG) console.log(\"CALLING\", pkt.Message(), json);\n    NETSOCK.ws.send(json);\n  } else {\n    console.log(\"Socket not ReadyState 1, is\", NETSOCK.ws.readyState);\n  }\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Force close of connection, for example if UNISYS.AppReady() fails\n/*/\nNETWORK.Close = function(code, reason) {\n  code = code || 1000;\n  reason = reason || \"unisys forced close\";\n  NETSOCK.ws.close(code, reason);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nNETWORK.AddListener = function(event, handlerFunction) {\n  if (NETSOCK.ws instanceof WebSocket) {\n    NETSOCK.ws.addEventListener(event, handlerFunction);\n  } else {\n    throw Error(ERR_NO_SOCKET);\n  }\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nNETWORK.RemoveListener = function(event, handlerFunction) {\n  if (NETSOCK.ws instanceof WebSocket) {\n    NETSOCK.ws.removeEventListener(event, handlerFunction);\n  } else {\n    throw Error(ERR_NO_SOCKET);\n  }\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nNETWORK.LocalInfo = function() {\n  return NETCLIENT;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nNETWORK.ServerInfo = function() {\n  return NETSERVER;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nNETWORK.ServerSocketInfo = function() {\n  return NETSOCK;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nNETWORK.SocketUADDR = function() {\n  return NetMessage.SocketUADDR();\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nNETWORK.IsStandaloneMode = function() {\n  return m_status === M_STANDALONE;\n};\n\n/// EXPORT MODULE DEFINITION //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = NETWORK;\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Add UNISYS functions to REACT component to hide UDATA and UMODULE details\n  To use, extend components from UNISYS.Component instead of REACT.Component\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst React     = require('react');\nconst UDATA     = require('unisys/client-datalink-class');\nconst UMODULE   = require('unisys/client-module-class');\nconst REFLECT   = require('system/util/reflection');\n\n/// CLASS DECLARATION /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nlet UnisysComponent = class extends React.Component {\n  constructor() {\n    super();\n    this.UMODULE = new UMODULE(module.id);\n    this.UDATA = new UDATA(this.UMODULE);\n  }\n\n  /// MESSAGE HANDLING API METHODS\n  HandleMessage( m, lis ) { this.UDATA.HandleMessage(m,lis) }\n  UnhandleMessage( m, lis ) { f_deprecated('DropMessage'); this.UDATA.UnhandleMessage(m,lis) }\n  DropMessage( m, lis ) { this.UDATA.UnhandleMessage(m,lis) }\n\n  /// SPECIAL EVENTS\n  OnDOMReady( lis ) { this.UMODULE.Hook('DOM_READY',lis) }\n  OnReset( lis ) { this.UMODULE.Hook('RESET',lis) }\n  OnStart( lis ) { this.UMODULE.Hook('START',lis) }\n  OnAppReady( lis ) { this.UMODULE.Hook('APP_READY',lis) }\n  OnRun( lis ) { this.UMODULE.Hook('RUN', lis) }\n  OnDisconnect( lis ) { this.UMODULE.Hook('DISCONNECT', lis) }\n\n  /// MESSAGE INVOCATION API METHODS\n  Call( m, d, o ) { return this.UDATA.Call(m,d,o) }\n  Send( m, d, o ) { this.UDATA.Send(m,d,o) }\n  Signal( m, d, o ) { this.UDATA.Signal(m,d,o) }\n  AppCall( m, d, o ) { return this.UDATA.LocalCall(m,d,o) }\n  AppSend( m, d, o ) { this.UDATA.LocalSend(m,d,o) }\n  AppSignal( m, d, o ) { this.UDATA.LocalSignal(m,d,o) }\n  NetSend( m, d, o ) { this.UDATA.NetSend(m,d,o) }\n  NetCall( m, d, o ) { return this.UDATA.NetCall(m,d,o) }\n  NetSignal( m, d, o ) { this.UDATA.NetSignal(m,d,o) }\n  LocalCall( m, d, o ) { f_deprecated('AppCall'); return this.UDATA.LocalCall(m,d,o) }\n  LocalSend( m, d, o ) { f_deprecated('AppSend'); this.UDATA.LocalSend(m,d,o) }\n  LocalSignal( m, d, o ) { f_deprecated('AppSignal'); this.UDATA.LocalSignal(m,d,o) }\n  /// STATE API METHODS\n  State( ns ) { f_deprecated('AppState'); return this.AppState(ns) }\n  SetState( ns, so ) { f_deprecated('SetAppState'); this.SetAppState(ns,so) }\n  OnStateChange( ns, lis ) { f_deprecated('OnAppStateChange'); this.OnAppStateChange(ns,lis) }\n  OffStateChange( ns, lis ) { f_deprecated('AppStateChangeOff'); this.AppStateChangeOff(ns,lis) }\n  /// NEW STATE API METHODS\n  AppState( ns ) { return this.UDATA.AppState(ns) }\n  SetAppState( ns, so ) { this.UDATA.SetAppState(ns,so) }\n  OnAppStateChange( ns, lis ) { this.UDATA.OnAppStateChange(ns,lis) }\n  AppStateChangeOff( ns, lis ) { this.UDATA.AppStateChangeOff(ns,lis) }\n  NetState( ns ) { f_unimplemented() }\n  SetNetState( ns, so ) { f_unimplemented() }\n  OnNetStateChange( ns, lis ) { f_unimplemented() }\n  NetStateChangeOff( ns, lis ) { f_unimplemented() }\n  /// LIFECYCLE API\n  Hook( p, f ) { f_unsupported('is not available for UNISYS.Component') }\n\n} // UnisysComponent\n\nfunction f_deprecated(repl) {\n  let out = `${REFLECT.FunctionName(2)} is deprecated.`;\n  if (typeof repl==='string') out+=` Use ${repl}() instead.`;\n  console.warn(out);\n}\n\nfunction f_unimplemented() {\n  let out = `${REFLECT.FunctionName(2)} is not yet implemented.`;\n  alert(`${out}\\n\\nCrashing now! Use javascript console to debug`);\n  console.error(out);\n  debugger;\n}\n\nfunction f_unsupported(reason) {\n  let out = `${REFLECT.FunctionName(2)} ${reason}`;\n  alert(`${out}\\n\\nCrashing now! Use javascript console to debug`);\n  console.error(out);\n  debugger;\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = UnisysComponent;\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n    UNISYS STATE CLASS\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst DBG         = false;\nconst BAD_NSPACE  = \"namespace must be string without _ chars\";\nconst BAD_LISTENR = \"listener must be function\";\nconst NO_UID_FLTR = \"UNISYS.OnStateChange: pass DST_UID parameter to enable echo cancellation\";\nconst WARN_PROP_MISMATCH = \"MergeState is changing a property type\";\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst REACT       = require('react');\nconst TYPEOF      = require('type-detect');\nconst Messager    = require('unisys/client-messager-class');\n\n/// MODULE DECLARATIONS ///////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar USTATE        = {};\nvar STATES        = new Map(); // namespace str => shallow state object\nvar STATES_LISTEN = new Map(); // namespace str => emitter\n\n/// STATE /////////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ UNISYS namespaces are transformed to uppercase.\n    A namespace must be a string that does not contain reserved char '_'\n/*/ function m_ConformNamespace( namespace ) {\n      // must be a string\n      if (typeof namespace!=='string') return undefined;\n      // disallow empty string\n      if (!namespace) return undefined;\n      // always uppercase\n      namespace = namespace.toUpperCase();\n      // expand * shortcut to _ROOT\n      if (namespace==='*') return '_ROOT';\n      // disallow _ reserved names\n      if (namespace.indexOf('_')>(-1)) return undefined;\n      // ok we're good\n      return namespace;\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Used for merging and concatenating state, when a simple copy-overwrite\n    simply will not do.\n/*/ function m_ConformState( namespace, newState, opt ) {\n      opt = opt || { merge : true };\n      // make a copy of the old state\n      let state = Object.assign({},STATES.get(namespace));\n      if (DBG) console.log(`merging state namespace '${namespace}' with`,newState);\n\n      // iterate over all properties in newState and merge them\n      // accordingly. This is *NOT* a deep merge.\n      Object.entries(newState).forEach( (entry) => {\n        let k = entry[0];     // current prop name in newstate\n        let v = entry[1];     // current prop value in newstate\n        let prop = state[k],  // old prop value\n            nprop = v,        // new prop value\n            t_old,            // type to be filled-in\n            t_new;\n\n        // use type-detect library to get type\n        t_old = TYPEOF(prop);\n        t_new = TYPEOF(nprop);\n\n        // A BUNCH OF SPECIAL CASE CHECKS //\n        if ((t_old==='undefined') || (t_old==='null')) {\n          // if the value doesn't exist in current state\n          // just update with new prop\n          prop = nprop;\n        } else if (t_old===t_new) {\n          // if there is a type match, then figure\n          // out how to merge based on type\n          switch (t_old) {\n            case 'Object':\n              if (DBG) console.log(`merge objects`);\n              // merge object props\n              prop = Object.assign(prop,nprop);\n              break;\n            case 'Array': // note uppercase (type-detect)\n              if (DBG) console.log(`merge arrays`);\n              // merge arrays no dupes (https://stackoverflow.com/a/36469404)\n              // ES6 fanciness using destructuring (...) and Sets\n              if (opt.merge) prop = [...new Set([...prop ,...nprop])];\n              else if (opt.concat) prop = prop.concat(nprop);\n              break;\n            default:\n              if (DBG) console.log(`copy values`);\n              // just overwrite otherwise\n              prop = nprop;\n          } // end switch t_old\n        } else {\n          // if there is a type mismatch, write\n          console.warn(`${WARN_PROP_MISMATCH} key:${k}\\n type '${t_new}' overwriting '${t_old}'`);\n          prop = nprop;\n        }\n        // update state place\n        state[k] = prop;\n      }); // end Object.entries\n\n      return state;\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Retrieve the emitter associated with a namespace, which contains handles\n    all the listeners associated with a namespace. Always returns a valid\n    emitter, creating it if the passed namespace is valid.\n/*/ function m_GetStateMessager (nspace) {\n      nspace = m_ConformNamespace(nspace);\n      if (!nspace) throw Error(BAD_NSPACE);\n      let msgr = STATES_LISTEN.get(nspace);\n      if (!msgr) {\n        msgr = new Messager();\n        STATES_LISTEN.set(nspace,msgr);\n      }\n      return msgr;\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: update the selected namespace state with new state\n/*/ USTATE.SetState = (namespace, newState, src_uid) => {\n      namespace = m_ConformNamespace(namespace);\n      if (!namespace) throw Error(BAD_NSPACE);\n      // update old state by partially overwrite of state\n      if (!STATES.has(namespace)) STATES.set(namespace,{});\n      // NOTE Because we're using Object.assign:\n      // * Objects already in the state will remain in the state\n      //   if not overwritten by newState.  This can result in\n      //   the mysterious re-appearance of old paramters.\n      // * No deep clones\n      Object.assign(STATES.get(namespace),newState);\n      // forward new state to namespace listeners\n      let msgr = m_GetStateMessager(namespace);\n      // don't pass with source_id because state should go everywhere\n      // a register exists, even if it's the originating module\n      msgr.Send(namespace,newState,{type:'state',toLocal:true, toNet:false});\n      // future: forward also to network\n    };\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: merge objects and arrays in state\n/*/ USTATE.MergeState = (namespace, newState, src_uid) => {\n      namespace = m_ConformNamespace(namespace);\n      if (!namespace) throw Error(BAD_NSPACE);\n      // update old state by partially overwrite of state\n      if (!STATES.has(namespace)) STATES.set(namespace,{});\n\n      // merge the states with no duplicates in arrays\n      let state = m_ConformState(namespace, newState, { merge : true });\n\n      // update the namespace\n      STATES.set(namespace,state);\n\n      // forward new state to namespace listeners\n      let msgr = m_GetStateMessager(namespace);\n      // don't pass with source_id because state should go everywhere\n      // a register exists, even if it's the originating module\n      msgr.Send(namespace,newState,{type:'state',toLocal:true, toNet:false});\n      // future: forward also to network\n    };\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: merge objects and concat arrays in state\n/*/ USTATE.ConcatState = (namespace, newState, src_uid) => {\n      namespace = m_ConformNamespace(namespace);\n      if (!namespace) throw Error(BAD_NSPACE);\n      // update old state by partially overwrite of state\n      if (!STATES.has(namespace)) STATES.set(namespace,{});\n\n      // merge the states with no duplicates in arrays\n      let state = m_ConformState(namespace, newState, { concat : true });\n\n      // update the namespace\n      STATES.set(namespace,state);\n\n      // forward new state to namespace listeners\n      let msgr = m_GetStateMessager(namespace);\n      // don't pass with source_id because state should go everywhere\n      // a register exists, even if it's the originating module\n      msgr.Send(namespace,newState,{type:'state',toLocal:true, toNet:false});\n      // future: forward also to network\n    };\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: retrieve a COPY of state object of namespace\n/*/ USTATE.State = (namespace) => {\n      namespace = m_ConformNamespace(namespace);\n      if (!namespace) throw Error(BAD_NSPACE);\n      return Object.assign({},STATES.get(namespace));\n    };\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: subscribe to namestate updates\n/*/ USTATE.OnStateChange = (namespace, listener, src_uid) => {\n      namespace = m_ConformNamespace(namespace);\n      if (!namespace) throw Error(BAD_NSPACE);\n      if (typeof listener!=='function') throw Error(BAD_LISTENR);\n      if (src_uid===undefined) console.warn(NO_UID_FLTR);\n      let namespaceMessager = m_GetStateMessager(namespace);\n      namespaceMessager.HandleMessage(namespace,listener,{handlerUID:src_uid});\n    };\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: unsubscribe to namestate updates\n/*/ USTATE.OffStateChange = (namespace, listener) => {\n      namespace = m_ConformNamespace(namespace);\n      if (!namespace) throw Error(BAD_NSPACE);\n      if (typeof listener!=='function') throw Error(BAD_LISTENR);\n      let namespaceMessager = m_GetStateMessager(namespace);\n      namespaceMessager.UnhandleMessage(namespace,listener);\n    };\n\n\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = USTATE;\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n    This is the main browser client UNISYS module, which implements:\n\n      LIFECYCLE - a promise-based hooked run order system\n      MESSAGING - a networked remote procedure call/event system\n      STATE     - a networked global application state system\n\n    UNISYS is designed to work with React or our own module system:\n    for modules:\n      UMOD = UNISYS.NewModule()\n      UDATA = UNISYS.NewDataLink(UMOD)\n    for React:\n      COMPONENT = class MyComponent extends UNISYS.Component\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst DBG = {\n  hook: false\n};\n\n/// CLASSES ///////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst UniData = require(\"unisys/client-datalink-class\");\nconst UniModule = require(\"unisys/client-module-class\");\nconst UniComponent = require(\"unisys/client-react-component\");\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst SETTINGS = require(\"settings\");\nconst LIFECYCLE = require(\"unisys/client-lifecycle\");\nconst STATE = require(\"unisys/client-state\");\nconst NETWORK = require(\"unisys/client-network\");\nconst PROMPTS = require(\"system/util/prompts\");\nconst PR = PROMPTS.Pad(\"UNISYS\");\n\n/// INITIALIZE MAIN MODULE ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar UNISYS = new UniModule(module.id);\nvar UDATA = new UniData(UNISYS);\n\n/// UNISYS MODULE MAKING //////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: Make new module with UNISYS convenience methods\n/*/ UNISYS.NewModule = uniqueName => {\n  return new UniModule(uniqueName);\n};\n\n/// UNISYS CONNECTOR //////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: Make new module with UNISYS convenience methods\n/*/ UNISYS.NewDataLink = (\n  module,\n  optName\n) => {\n  return new UniData(module, optName);\n};\n\n/// UNISYS MESSAGE REGISTRATION ///////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nUNISYS.RegisterMessagesPromise = (messages = []) => {\n  if (NETWORK.IsStandaloneMode()) {\n    console.warn(PR,\"STANDALONE MODE: RegisterMessagesPromise() suppressed!\");\n    return Promise.resolve();\n  }\n  if (messages.length) {\n    try {\n      messages = UniData.ValidateMessageNames(messages);\n    } catch (e) {\n      console.error(e);\n    }\n  } else {\n    messages = UniData.MessageNames();\n  }\n  return new Promise((resolve, reject) => {\n    UDATA.Call(\"SRV_REG_HANDLERS\", { messages }).then(data => {\n      resolve(data);\n    });\n  });\n};\n\n/// LIFECYCLE METHODS /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: LIFECYCLE Hook() functions\n/*/\nUNISYS.Hook = (phase, f) => {\n  if (typeof phase !== \"string\") throw Error(\"arg1 is phase as string\");\n  if (typeof f !== \"function\") throw Error(\"arg2 is function callback\");\n  LIFECYCLE.Hook(phase, f, UNISYS.ModuleID()); // pass phase and hook function\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: System Initialize\n/*/\nUNISYS.SystemInitialize = module_id => {\n  UNISYS.SetScope(module_id);\n  SETTINGS.ForceReloadSingleApp();\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API HELPER: LIFECYCLE Scope() functions\n    The 'scope' is used by LIFECYCLE to determine what modules implementing\n    various HOOKS will be called. The root_module_id is a path that will\n    be considered the umbrella of \"allowed to hook\" modules. For REACT apps,\n    this is the root directory of the root view component. Additionally,\n    the unisys and system directories are allowed to run their hooks\n/*/ UNISYS.SetScope = root_module_id => {\n  LIFECYCLE.SetScope(root_module_id); // pass phase and hook function\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API HELPER: SETTINGS ForceReloadSingleApp\n    checks to see if settings flag is \"dirty\"; if it is, then reload the\n    location to ensure no linger apps are running in the background. Yes\n    this is a bit of a hack.\n/*/\nUNISYS.ForceReloadOnNavigation = () => {\n  SETTINGS.ForceReloadOnNavigation();\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API HELPER: return TRUE if passed module.id is within the current set\n    scope\n/*/\nUNISYS.InScope = module_id => {\n  let currentScope = LIFECYCLE.Scope();\n  return module_id.includes(currentScope);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: application startup\n/*/\nUNISYS.EnterApp = () => {\n  return new Promise(async (resolve, reject) => {\n    try {\n      await LIFECYCLE.Execute(\"TEST_CONF\"); // TESTCONFIG hook\n      await LIFECYCLE.Execute(\"INITIALIZE\"); // INITIALIZE hook\n      await LIFECYCLE.Execute(\"LOADASSETS\"); // LOADASSETS hook\n      await LIFECYCLE.Execute(\"CONFIGURE\"); // CONFIGURE support modules\n      resolve();\n    } catch (e) {\n      console.error(\n        \"EnterApp() Lifecycle Error. Check phase execution order effect on data validity.\\n\",\n        e\n      );\n      debugger;\n    }\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: call this when the view system's DOM has stabilized and is ready\n    for manipulation by other code\n/*/\nUNISYS.SetupDOM = () => {\n  return new Promise(async (resolve, reject) => {\n    try {\n      await LIFECYCLE.Execute(\"DOM_READY\"); // GUI layout has finished composing\n      resolve();\n    } catch (e) {\n      console.error(\n        \"SetupDOM() Lifecycle Error. Check phase execution order effect on data validity.\\n\",\n        e\n      );\n      debugger;\n    }\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: network startup\n/*/\nUNISYS.JoinNet = () => {\n  return new Promise((resolve, reject) => {\n    try {\n      NETWORK.Connect(UDATA, { success: resolve, failure: reject });\n    } catch (e) {\n      console.error(\n        \"EnterNet() Lifecycle Error. Check phase execution order effect on data validity.\\n\",\n        e\n      );\n      debugger;\n    }\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: configure system before run\n/*/\nUNISYS.SetupRun = () => {\n  return new Promise(async (resolve, reject) => {\n    try {\n      await LIFECYCLE.Execute(\"RESET\"); // RESET runtime datastructures\n      await LIFECYCLE.Execute(\"START\"); // START running\n      await LIFECYCLE.Execute(\"APP_READY\"); // tell network APP_READY\n      await LIFECYCLE.Execute(\"RUN\"); // tell network APP_READY\n      resolve();\n    } catch (e) {\n      console.error(\n        \"SetupRun() Lifecycle Error. Check phase execution order effect on data validity.\\n\",\n        e\n      );\n      debugger;\n    }\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: handle periodic updates for a simulation-driven timestep\n/*/\nUNISYS.Run = () => {\n  return new Promise(async (resolve, reject) => {\n    try {\n      await LIFECYCLE.Execute(\"UPDATE\");\n      resolve();\n    } catch (e) {\n      console.error(e);\n    }\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: do the Shutdown lifecycle\n    NOTE ASYNC ARROW FUNCTION (necessary?)\n/*/\nUNISYS.BeforePause = () => {\n  return new Promise(async (resolve, reject) => {\n    await LIFECYCLE.Execute(\"PREPAUSE\");\n    resolve();\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: do the Shutdown lifecycle\n    NOTE ASYNC ARROW FUNCTION (necessary?)\n/*/\nUNISYS.Paused = () => {\n  return new Promise(async (resolve, reject) => {\n    await LIFECYCLE.Execute(\"PAUSE\");\n    resolve();\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: do the Shutdown lifecycle\n    NOTE ASYNC ARROW FUNCTION (necessary?)\n/*/\nUNISYS.PostPause = () => {\n  return new Promise(async (resolve, reject) => {\n    await LIFECYCLE.Execute(\"POSTPAUSE\");\n    resolve();\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: do the Shutdown lifecycle\n    NOTE ASYNC ARROW FUNCTION (necessary?)\n/*/\nUNISYS.CleanupRun = () => {\n  return new Promise(async (resolve, reject) => {\n    await LIFECYCLE.Execute(\"STOP\");\n    resolve();\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: application offline\n    NOTE ASYNC ARROW FUNCTION (necessary?)\n/*/\nUNISYS.ServerDisconnect = () => {\n  return new Promise(async (resolve, reject) => {\n    await LIFECYCLE.Execute(\"DISCONNECT\");\n    resolve();\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: application shutdown\n    NOTE ASYNC ARROW FUNCTION (necessary?)\n/*/\nUNISYS.ExitApp = () => {\n  return new Promise(async (resolve, reject) => {\n    await LIFECYCLE.Execute(\"UNLOADASSETS\");\n    await LIFECYCLE.Execute(\"SHUTDOWN\");\n    resolve();\n  });\n};\n\n/// NETWORK INFORMATION ///////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ return the current connected Socket Address (e.g. UADDR_12)\n/*/\nUNISYS.SocketUADDR = () => {\n  return NETWORK.SocketUADDR();\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nUNISYS.IsStandaloneMode = () => {\n  return NETWORK.IsStandaloneMode();\n}\n\n/// DATA LOGGING //////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ send a logging message\n/*/\nUNISYS.Log = (event, ...items) => {\n  if (typeof event !== \"string\") {\n    console.error(\"UNISYS.Log( 'eventString', value, value, value... )\");\n  }\n  UDATA.NetSignal(\"SRV_LOG_EVENT\", { event, items });\n};\n\n/// REACT INTEGRATION /////////////////////////////////////////////////////////\n/*/ return the referene to the UNISYS extension of React.Component\n/*/\nUNISYS.Component = UniComponent;\n\n/// EXPORT MODULE DEFINITION //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = UNISYS;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n    Store common system definitions here between client and server modules.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst DBG         = true;\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar   DEFS = {};\n\nDEFS.SERVER_HEARTBEAT_INTERVAL = 5000; // ms\n\n/// EXPORT MODULE DEFINITION //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = DEFS;\n","/** NetMessage ****************************************************************\\\n\n  NetMessage objects are sent between the browser and server as part of the\n  UNISYS messaging system. Unlike NetMessages of the previous version of STEP,\n  a NetMessage does not require addressing since the SERVER distributes\n  messages to UNISYS addresses that have registered for them.\n\n  The NetMessage declaration is SHARED in both node and browser javascript\n  codebases.\n\n  NetMessages also provide the data context for \"transactions\" of calls.\n  The netmessage_id and data packet are used by the originating webapp\n  to remember a sequence of callback functions. When a NetMessage is\n  received with a seq_num > 0, it's assumed to be a return transaction,\n  and its callback chain can be invoked. The data is forwarded to the\n  callback. For more details, see the CallSequence class that manages\n  the passing of data.\n\n////////////////////////////////////////////////////////////////////////////////\n/** MODULE DECLARATIONS *******************************************************/\n\nconst DBG = { send: false, transact: false };\n\nvar m_id_counter = 0;\nvar m_id_prefix = \"PKT\";\nvar m_transactions = {};\nvar m_netsocket = null;\nvar m_group_id = null;\n\nconst M_INIT = \"init\";\nconst M_ONLINE = \"online\";\nconst M_STANDALONE = \"offline\";\nconst M_CLOSED = \"closed\";\nconst M_ERROR = \"error\";\nvar m_mode = M_INIT;\n\n// constants\nconst PROMPTS = require(\"../system/util/prompts\");\nconst PR = PROMPTS.Pad(\"PKT\");\nconst ERR = \":ERR:\";\nconst ERR_NOT_NETMESG = ERR + PR + \"obj does not seem to be a NetMessage\";\nconst ERR_BAD_PROP = ERR + PR + \"property argument must be a string\";\nconst ERR_ERR_BAD_CSTR = ERR + PR + \"constructor args are string, object\";\nconst ERR_BAD_SOCKET = ERR + PR + \"sender object must implement send()\";\nconst ERR_DUPE_TRANS =\n  ERR + PR + \"this packet transaction is already registered!\";\nconst ERR_NO_GLOB_UADDR =\n  ERR + PR + \"packet sending attempted before UADDR is set!\";\nconst ERR_UNKNOWN_TYPE = ERR + PR + \"packet type is unknown:\";\nconst ERR_NOT_PACKET = ERR + PR + \"passed object is not a NetMessage\";\nconst ERR_UNKNOWN_RMODE = ERR + PR + \"packet routine mode is unknown:\";\nconst KNOWN_TYPES = [\"msend\", \"msig\", \"mcall\", \"state\"];\nconst ROUTING_MODE = [\"req\", \"res\"];\n\n/// UNISYS NETMESSAGE CLASS ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ A UNetMessage encapsulates a specific message and data payload for sending\n    across the network.\n/*/\nclass NetMessage {\n  constructor(msg, data, type) {\n    // OPTION 1\n    // create NetMessage from (generic object)\n    if (typeof msg === \"object\" && data === undefined) {\n      // make sure it has a msg and data obj\n      if (typeof msg.msg !== \"string\" || typeof msg.data !== \"object\") {\n        throw ERR_NOT_NETMESG;\n      }\n      // merge properties into this new class instance and return it\n      Object.assign(this, msg);\n      m_SeqIncrement(this);\n      return this;\n    }\n    // OPTION 2\n    // create NetMessage from JSON-encoded string\n    if (typeof msg === \"string\" && data === undefined) {\n      let obj = JSON.parse(msg);\n      Object.assign(this, obj);\n      m_SeqIncrement(this);\n      return this;\n    }\n    // OPTION 3\n    // create new NetMessage from scratch (mesg,data)\n    // unique id for every NetMessage\n    if (typeof type === \"string\") m_CheckType(type);\n    if (typeof msg !== \"string\" || typeof data !== \"object\") {\n      throw ERR_ERR_BAD_CSTR;\n    }\n    // allow calls with null data by setting to empty object\n    this.data = data || {};\n    this.msg = msg;\n    // id and debugging memo support\n    this.id = this.MakeNewID();\n    this.rmode = ROUTING_MODE[0]; // is default 't_req' (trans request)\n    this.type = type || KNOWN_TYPES[0]; // is default 'msend' (no return)\n    this.memo = \"\";\n    // transaction support\n    this.seqnum = 0; // positive when part of transaction\n    this.seqlog = []; // transaction log\n    // addressing support\n    this.s_uaddr = NetMessage.SocketUADDR() || null; // first originating uaddr set by SocketSend()\n    this.s_group = null; // session groupid is set by external module once validated\n    this.s_uid = null; // first originating UDATA srcUID\n    // filtering support\n  } // constructor\n\n  /// ACCESSSOR METHODS ///////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ returns the type\n  /*/\n  Type() {\n    return this.type;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ returns true if type matches\n  /*/\n  IsType(type) {\n    return this.type === type;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ returns the type\n  /*/\n  SetType(type) {\n    this.type = m_CheckType(type);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ returns the message\n  /*/\n  Message() {\n    return this.msg;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ sets the message field\n  /*/\n  SetMessage(msgstr) {\n    this.msg = msgstr;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ returns the entire data payload or the property within the data payload\n      (can return undefined if property doesn't exist)\n  /*/\n  Data(prop) {\n    if (!prop) return this.data;\n    if (typeof prop === \"string\") return this.data[prop];\n    throw ERR_BAD_PROP;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ convenience method to set data object entirely\n  /*/\n  SetData(propOrVal, val) {\n    if (typeof propOrVal === \"object\") {\n      this.data = propOrVal;\n      return;\n    }\n    if (typeof propOrVal === \"string\") {\n      this.data[propOrVal] = val;\n      return;\n    }\n    throw ERR_BAD_PROP;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ returns truthy value (this.data) if the passed msgstr matches the\n      message associated with this NetMessage\n  /*/\n  Is(msgstr) {\n    return msgstr === this.msg ? this.data : undefined;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ convenience function return true if server message\n  /*/\n  IsServerMessage() {\n    return this.msg.startsWith(\"SRV_\");\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ getter/setter for the memo description field\n  /*/\n  Memo() {\n    return this.memo;\n  }\n  SetMemo(memo) {\n    this.memo = memo;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ convenience function to return JSON version of this object\n  /*/\n  JSON() {\n    return JSON.stringify(this);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ return the session groupid (CLASS-PROJ-HASH) that's been set globally\n  /*/\n  SourceGroupID() {\n    return this.s_group;\n  }\n\n  /// TRANSACTION SUPPORT /////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ The sequence number is positive if this packet is reused\n  /*/\n  SeqNum() {\n    return this.seqnum;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ Return the originating address of this netmessage packet. It is valid\n      only after the packet has been sent at least once.\n  /*/\n  SourceAddress() {\n    // is this packet originating from server to a remote?\n    if (\n      this.s_uaddr === NetMessage.DefaultServerUADDR() &&\n      !this.msg.startsWith(\"SVR_\")\n    ) {\n      return this.s_uaddr;\n    }\n    // this is a regular message forward to remote handlers\n    return this.IsTransaction() ? this.seqlog[0] : this.s_uaddr;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  CopySourceAddress(pkt) {\n    if (pkt.constructor.name !== \"NetMessage\") throw Error(ERR_NOT_PACKET);\n    this.s_uaddr = pkt.SourceAddress();\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ return an informational string about the packet useful for logging\n  /*/\n  Info(key) {\n    switch (key) {\n      case \"src\": /* falls-through */\n      default:\n        return this.SourceGroupID()\n          ? `${this.SourceAddress()} [${this.SourceGroupID()}]`\n          : `${this.SourceAddress()}`;\n    }\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  MakeNewID() {\n    let idStr = (++m_id_counter).toString();\n    this.id = m_id_prefix + idStr.padStart(5, \"0\");\n    return this.id;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ Send packet on either provided socket or default socket. Servers provide\n      the socket because it's handling multiple sockets from different clients.\n  /*/\n  SocketSend(socket = m_netsocket) {\n    if (m_mode === M_ONLINE || m_mode === M_INIT) {\n      this.s_group = NetMessage.GlobalGroupID();\n      let dst = socket.UADDR || \"unregistered socket\";\n      if (!socket) throw Error(\"SocketSend(sock) requires a valid socket\");\n      if (DBG.send) {\n        let status = `sending '${this.Message()}' to ${dst}`;\n        console.log(PR, status);\n      }\n      // for server-side ws library, send supports a function callback\n      // for WebSocket, this is ignored\n      socket.send(this.JSON(),(err) => {\n        if (err) console.error(`\\nsocket ${socket.UADDR} reports error ${err}\\n`);\n      });\n    } else if (m_mode !== M_STANDALONE) {\n      console.log(\n        PR,\n        \"SocketSend: Can't send because NetMessage mode is\",\n        m_mode\n      );\n    } else {\n      console.warn(\n        PR,\n        \"STANDALONE MODE: SocketSend() suppressed!\"\n      );\n    }\n    // FYI: global m_netsocket is not defined on server, since packets arrive on multiple sockets\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ Create a promise to resolve when packet returns\n  /*/\n  QueueTransaction(socket = m_netsocket) {\n    if (m_mode === M_STANDALONE) {\n      console.warn(PR, \"STANDALONE MODE: QueueTransaction() suppressed!\");\n      return Promise.resolve();\n    }\n    // global m_netsocket is not defined on server, since packets arrive on multiple sockets\n    if (!socket) throw Error(\"QueueTransaction(sock) requires a valid socket\");\n    // save our current UADDR\n    this.seqlog.push(NetMessage.UADDR);\n    let dbg = DBG.transact && !this.IsServerMessage();\n    let p = new Promise((resolve, reject) => {\n      var hash = m_GetHashKey(this);\n      if (m_transactions[hash]) {\n        reject(Error(ERR_DUPE_TRANS + \":\" + hash));\n      } else {\n        // save the resolve function in transactions table;\n        // promise will resolve on remote invocation with data\n        m_transactions[hash] = function(data) {\n          if (dbg) {\n            console.log(PR, \"resolving promise with\", JSON.stringify(data));\n          }\n          resolve(data);\n        };\n        this.SocketSend(socket);\n      }\n    });\n    return p;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ return the 'routing mode':\n        req/res is request/reply (message requests and optional response)\n        f_req/f_res is forwarded request/reply (forwarded messages and optional return)\n        the f_res is converted to res and sent back to original requester\n  /*/\n  RoutingMode() {\n    return this.rmode;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  IsRequest() {\n    return this.rmode === \"req\";\n  }\n  IsOwnResponse() {\n    return this.rmode === \"res\";\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n  /*/ If this packet is a returned transaction, then return true\n  /*/\n  IsTransaction() {\n    return (\n      this.rmode !== ROUTING_MODE[0] &&\n      this.seqnum > 0 &&\n      this.seqlog[0] === NetMessage.UADDR\n    );\n  }\n  ///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/\tupdate the sequence metadata and return on same socket\n  /*/\n  ReturnTransaction(socket = m_netsocket) {\n    // global m_netsocket is not defined on server, since packets arrive on multiple sockets\n    if (!socket) throw Error(\"ReturnTransaction(sock) requires a valid socket\");\n    // note: seqnum is already incremented by the constructor if this was\n    // a received packet\n    // add this to the sequence log\n    this.seqlog.push(NetMessage.UADDR);\n    this.rmode = m_CheckRMode(\"res\");\n    this.SocketSend(socket);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ If this is a transaction packet that is returned, then execute the stored\n      resolver function from the promise stored in m_transactions, which will\n      then trigger .then() following any calls\n  /*/\n  CompleteTransaction() {\n    let dbg = DBG.transact && !this.IsServerMessage();\n    var hash = m_GetHashKey(this);\n    var resolverFunc = m_transactions[hash];\n    if (dbg) console.log(PR, \"CompleteTransaction\", hash);\n    if (typeof resolverFunc !== \"function\") {\n      throw Error(\n        `transaction [${hash}] resolverFunction is type ${typeof resolverFunc}`\n      );\n    } else {\n      resolverFunc(this.data);\n      Reflect.deleteProperty(m_transactions[hash]);\n    }\n  }\n} // class NetMessage\n\n/// STATIC CLASS METHODS //////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ set the NETWORK interface object that implements Send()\n    This class operates both under the server and the client.\n    This is a client feature.\n/*/\nNetMessage.GlobalSetup = function(config) {\n  let { netsocket, uaddr } = config;\n  if (uaddr) NetMessage.UADDR = uaddr;\n  // NOTE: m_netsocket is set only on clients since on server, there are multiple sockets\n  if (netsocket) {\n    if (typeof netsocket.send !== \"function\") throw ERR_BAD_SOCKET;\n    console.log(PR, \"GlobalSetup: netsocket set, mode online\");\n    m_netsocket = netsocket;\n    m_mode = M_ONLINE;\n  }\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ cleanup any allocated storage. This class operates both under the\n    server and the client. This is a client feature.\n/*/\nNetMessage.GlobalCleanup = function() {\n  if (m_netsocket) {\n    console.log(PR, \"GlobalCleanup: deallocating netsocket, mode closed\");\n    m_netsocket = null;\n    m_mode = M_CLOSED;\n  }\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ cleanup any allocated storage internally. This class operates both under the\n    server and the client. This is a client feature.\n/*/\nNetMessage.GlobalOfflineMode = function(data) {\n  m_mode = M_STANDALONE;\n  if (m_netsocket) {\n    console.warn(PR, \"STANDALONE MODE: NetMessage disabling network\");\n    m_netsocket = null;\n    // The disconnect is detected by client-network.js.\n    // If the disconnect is due to a missing ping heartbeat from the server\n    // (usually as a result of wifi/internet connection going down)\n    // it will include a data.message explaining 'Client Disconnect'.\n    // If there's no data.message, then this request came from\n    // either a standalone connect, a server \"close\" event,\n    // or a server \"error\" event.\n    let event = new CustomEvent(\"UNISYSDisconnect\", {\n      detail: {\n        message: data ? data.message : \"Server Disconnected\"\n      }\n    });\n    console.log(\"dispatching event to\", document, event);\n    document.dispatchEvent(event);\n  }\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ return the address (socket_id) assigned to this app instance\n/*/\nNetMessage.SocketUADDR = function() {\n  return NetMessage.UADDR;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Return a default server UADDR\n/*/\nNetMessage.DefaultServerUADDR = function() {\n  return \"SVR_01\";\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Return current SessionID string\n/*/\nNetMessage.GlobalGroupID = function() {\n  return m_group_id;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nNetMessage.GlobalSetGroupID = function(token) {\n  m_group_id = token;\n};\n\n/// PRIVATE CLASS HELPERS /////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ when a packet is reconstructed from an existing object or json string,\n    its sequence number is incremented, and the old source uaddr is pushed\n    onto the seqlog stack.\n/*/\nfunction m_SeqIncrement(pkt) {\n  pkt.seqnum++;\n  return pkt;\n}\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\treturn the hash used for storing transaction callbacks\n/*/\nfunction m_GetHashKey(pkt) {\n  let hash = `${pkt.SourceAddress()}:${pkt.id}`;\n  return hash;\n}\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ is this an allowed type? throw error if not\n/*/\nfunction m_CheckType(type) {\n  if (type === undefined) {\n    throw new Error(\"must pass a type string, not \" + type);\n  }\n  if (!KNOWN_TYPES.includes(type)) throw `${ERR_UNKNOWN_TYPE} '${type}'`;\n  return type;\n}\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ is this an allowed mode? throw error if not\n/*/\nfunction m_CheckRMode(mode) {\n  if (mode === undefined) {\n    throw new Error(\"must pass a mode string, not \" + mode);\n  }\n  if (!ROUTING_MODE.includes(mode)) throw `${ERR_UNKNOWN_RMODE} '${mode}'`;\n  return mode;\n}\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = NetMessage;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n    Session Utilities\n    collection of session-related data structures\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/// DEBUGGING /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\n//\nconst PROMPTS = require(\"../system/util/prompts\");\nconst PR = PROMPTS.Pad(\"SESSUTIL\");\n\n/// SYSTEM LIBRARIES //////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst HashIds = require(\"hashids\");\n\n/// MODULE DEFS ///////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nlet SESUTIL = {};\nconst HASH_ABET = \"ABCDEFGHIJKLMNPQRSTVWXYZ23456789\";\nconst HASH_MINLEN = 3;\nvar m_current_groupid = null;\n\n/// SESSION ///////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Given a token of form CLASS-PROJECT-HASHEDID, return an object\n    containing as many decoded values as possible. Check isValid for\n    complete decode succes. groupId is also set if successful\n/*/\nSESUTIL.DecodeToken = function(token, dataset) {\n  if (token === undefined) return {};\n  if (dataset === undefined) {\n    console.error('SESUTIL.DecodeToken called without \"dataset\" parameter.');\n    return {};\n  }\n  let tokenBits = token.split(\"-\");\n  let classId, projId, hashedId, groupId, subId, isValid;\n  // optimistically set valid flag to be negated on failure\n  isValid = true;\n  // check for superficial issues\n  if (token.substr(-1) === \"-\") {\n    isValid = false;\n  }\n  // token is of form CLS-PRJ-HASHEDID\n  // classId, etc will be partially set and returned\n  if (tokenBits[0]) classId = tokenBits[0].toUpperCase();\n  if (tokenBits[1]) projId = tokenBits[1].toUpperCase();\n  if (tokenBits[2]) hashedId = tokenBits[2].toUpperCase();\n  if (tokenBits[3]) subId = tokenBits[3].toUpperCase();\n  // initialize hashid structure\n  let salt = `${classId}${projId}${dataset}`;\n  let hashids = new HashIds(salt, HASH_MINLEN, HASH_ABET);\n  // try to decode the groupId\n  groupId = hashids.decode(hashedId)[0];\n  // invalidate if groupId isn't an integer\n  if (!Number.isInteger(groupId)) {\n    if (DBG) console.error(\"invalid token\");\n    isValid = false;\n    groupId = 0;\n  }\n  // invalidate if groupId isn't non-negative integer\n  if (groupId < 0) {\n    if (DBG) console.error(\"decoded token, but value out of range <0\");\n    isValid = false;\n    groupId = 0;\n  }\n\n  // at this point groupId is valid (begins with ID, all numeric)\n  // check for valid subgroupId\n  if (subId) {\n    if (\n      subId.length > 2 &&\n      subId.indexOf(\"ID\") === 0 &&\n      /^\\d+$/.test(subId.substring(2))\n    ) {\n      if (DBG) console.log(\"detected subid\", subId.substring(2));\n      // subId contains a string \"ID<N>\" where <N> is an integer\n    } else {\n      // subId exists but didn't match subid format\n      if (DBG) console.log(\"invalid subId string\", subId);\n      isValid = false; // groupId is still valid,\n      subId = 0;\n    }\n  }\n\n  // if isValid is false, check groupId is 0 or subId is 0, indicating error\n  let decoded = { token, isValid, classId, projId, hashedId, groupId, subId };\n  return decoded;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Return TRUE if the token decodes into an expected range of values\n/*/\nSESUTIL.IsValidToken = function(token, dataset) {\n  let decoded = SESUTIL.DecodeToken(token, dataset);\n  return decoded && Number.isInteger(decoded.groupId);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Returns a token string of form CLASS-PROJECT-HASHEDID\n    classId and projId should be short and are case-insensitive.\n    groupId must be a non-negative integer\n/*/\nSESUTIL.MakeToken = function(classId, projId, groupId, dataset) {\n  // type checking\n  if (typeof classId !== \"string\")\n    throw Error(`classId arg1 '${classId}' must be string`);\n  if (typeof projId !== \"string\")\n    throw Error(`projId arg2 '${projId}' must be string`);\n  if (classId.length < 1)\n    throw Error(`classId arg1 length should be 1 or more`);\n  if (projId.length < 1) throw Error(`projId arg2 length should be 1 or more`);\n  if (!Number.isInteger(groupId))\n    throw Error(`groupId arg3 '${groupId}' must be integer`);\n  if (groupId < 0) throw Error(`groupId arg3 must be non-negative integer`);\n  if (groupId > Number.MAX_SAFE_INTEGER)\n    throw Error(`groupId arg3 value exceeds MAX_SAFE_INTEGER`);\n  // initialize hashid structure\n  classId = classId.toUpperCase();\n  projId = projId.toUpperCase();\n  let salt = `${classId}${projId}${dataset}`;\n  let hashids = new HashIds(salt, HASH_MINLEN, HASH_ABET);\n  let hashedId = hashids.encode(groupId);\n  return `${classId}-${projId}-${hashedId}`;\n};\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Set the global GROUPID, which is included in all NetMessage\n    packets that are sent to server.\n/*/\n// REVIEW/FIXME\n// `SetGroupID` isn't being called by anyone?\n// If it is, the DecodeToken call needs to add a 'dataset' parameter or it will\n// fail.\nSESUTIL.SetGroupID = function (token) {\n  console.error('SetGroupID calling decodeToken NC_CONFIG IS', window.NC_CONFIG);\n  let good = SESUTIL.DecodeToken(token).isValid;\n  if (good) m_current_groupid = token;\n  return good;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nSESUTIL.GroupID = function() {\n  return m_current_groupid;\n};\n\n/// EXPORT MODULE /////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = SESUTIL;\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n    SessionShell handles route-based parameters in ReactRouter and updates\n    the SESSION manager with pertinent information\n\n    The component stores the credentials\n      classId  : null,\n      projId   : null,\n      hashedId : null,\n      groupId  : null,\n      isValid  : false\n\n    render() calls one of the following depending on the state of\n    SESSION.DecodeToken( token ). It returns an object is isValid prop set.\n    The token is read from this.props.match.params.token, which is provided\n    by ReactRouter.\n\n      renderLoggedIn( decoded ) contains an object with the decoded properties\n      from the original string, and displays the login state\n\n      renderLogin() shows the login text field.\n\n    When text is changing in Login Field, this.handleChange() is called.\n    It gets the value and runs SESSION.DecodeToken() on it.\n    It then uses Unisys.SetAppState to set \"SESSION\" to the decoded value.\n    if a groupId is detected, then it forces a redirect.\n\n\n    A change in logged in status can come from four places:\n\n    1. User has typed in login field.\n       => This is handled by `handleChange()`\n    2. User has hit the \"Login\" submit button.\n       => This is handled by `onSubmit()`\n    3. User has entered a full URL for the first time\n       => This is handled by `componentWillMount()`\n    4. User has changed an existing URL\n       => This does not trigger `compomentWillMount()`\n          so it needs special handling.\n       Changing the url does trigger:\n       * render()\n          render is triggered because the props for the token\n          passed by the Route change.\n          And render does detect the correct login state.\n          However, if this represents a change in login state,\n          the change in state needs to be broadcast.\n       * componentDidUpdate()\n          componentDidUpdate checks for the change in loggedinIn\n          status and sends an AppStateChanged event as needed.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/// DEBUGGING /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst React = require(\"react\");\nconst PROMPTS = require(\"system/util/prompts\");\nconst SESSION = require(\"unisys/common-session\");\nconst PR = PROMPTS.Pad(\"SessionShell\");\nconst ReactStrap = require(\"reactstrap\");\nconst { InputGroup, InputGroupAddon, Button, Col, Row, Form, FormGroup, FormFeedback, Input, Label } = ReactStrap;\nconst { Redirect } = require(\"react-router-dom\");\nconst UNISYS = require(\"unisys/client\");\n\n/// CONSTANTS /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// these styles are copied from AutoComplete.css\nconst INPUT_STYLE = {\n  border: \"1px solid #aaa\",\n  fontFamily: \"Helvetica, sans-serif\",\n  fontWeight: 300,\n  fontSize: \"10px\",\n  textAlign: \"right\",\n  textTransform: \"uppercase\"\n};\nconst GROUP_STYLE = {\n  backgroundColor: \"#777\",\n  color: \"white\",\n  marginTop: \"-10px\"\n};\nconst LABEL_STYLE = {\n  verticalAlign: \"top\",\n  marginBottom: \"0.15rem\",\n  marginTop: \"0.15rem\"\n};\n/// Move login to navbar\nconst NAV_LOGIN_STYLE = {\n  position: 'fixed',\n  top: '7px',\n  right: '20px',\n  zIndex: '2000'\n};\nconst NAV_LOGIN_FEEDBACK_STYLE = {\n  position: \"absolute\",\n  right: \"210px\"\n};\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nclass SessionShell extends UNISYS.Component {\n  constructor() {\n    super();\n    this.renderLogin = this.renderLogin.bind(this);\n    this.renderLoggedIn = this.renderLoggedIn.bind(this);\n    this.handleChange = this.handleChange.bind(this);\n    this.onSubmit = this.onSubmit.bind(this);\n    this.state = {   // `state` tracks the login input field\n      token: null,\n      classId: null,\n      projId: null,\n      hashedId: null,\n      subId: null,\n      groupId: null,\n      isValid: false\n    };\n    this.previousIsValid = false; // to track changes in loggedIn status\n\n    // This will invalidate the token when the server is disconnected\n    // but this can be a problem for projects that require login\n    // to view the graph.\n    // this.OnDisconnect(() => {\n    //   const token = this.props.match.params.token;\n    //   const decoded = SESSION.DecodeToken(token, window.NC_CONFIG.dataset);\n    //   // invalidate the token and announce it\n    //   decoded.isValid = false;\n    //   this.SetAppState(\"SESSION\", decoded);\n    // });\n  }\n\n  /// ROUTE RENDER FUNCTIONS ////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ render successful logged-in\n  /*/\n  renderLoggedIn(decoded) {\n    if (decoded) {\n      let classproj = `${decoded.classId}-${decoded.projId}`;\n      // prefix with unicode non-breaking space\n      let gid = `\\u00A0${decoded.groupId}`;\n      let subid = decoded.subId ? `USER\\u00A0${decoded.subId}` : \"\";\n      return (\n        <div style={NAV_LOGIN_STYLE}>\n          <Label style={LABEL_STYLE} className=\"small\">\n            GROUP{gid}:&nbsp;\n            <br />\n            {subid}\n          </Label>\n          <Label style={LABEL_STYLE} className=\"small\">\n            {classproj}-<strong>{decoded.hashedId}</strong>\n          </Label>\n        </div>\n      );\n\n      // Old Form above NodeSelector\n      // return (\n      //   <FormGroup row style={GROUP_STYLE} style={{position:'fixed',top:'5px',right:'5px',zIndex:'2000'}}>\n      //     <Col sm={3}>\n      //       <Label style={LABEL_STYLE} className=\"small\">\n      //         GROUP{gid}\n      //         <br />\n      //         {subid}\n      //       </Label>\n      //     </Col>\n      //     <Col sm={9} className=\"text-right\">\n      //       <Label style={LABEL_STYLE} className=\"small\">\n      //         {classproj}-<strong>{decoded.hashedId}</strong>\n      //       </Label>\n      //     </Col>\n      //   </FormGroup>\n      // );\n    } else {\n      return <p>ERROR:renderLoggedIn didn't get valid decoded object</p>;\n    }\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ render must login (readonly)\n  /*/\n  renderLogin() {\n    let { token, classId, projId, groupId, subId, hashedId, isValid } = this.state;\n    if (token) token = token.toUpperCase();\n    let formFeedback, tip, input;\n    tip = \"Type group ID\";\n    if (classId) tip = \"Scanning for valid code...\";\n    if (projId) tip = \"Waiting for valid code...\";\n    if (groupId) tip = \"Waiting for extra ID...\";\n    if (hashedId) {\n      if (hashedId.length >= 3) {\n        if (!groupId) tip = `'${token}' is an invalid code`;\n        else {\n          if (subId) tip = `Login in as GROUP ${groupId} ${subId}`;\n          else tip = `Login as GROUP ${groupId} or add -ID<num>`;\n        }\n      }\n    }\n    if (groupId) {\n      if (subId===0) {\n        tip = `e.g. ${classId}-${projId}-${hashedId} followed by -ID<num>`;\n        input = <Input invalid name=\"sessionToken\" id=\"sessionToken\" bsSize=\"sm\" style={INPUT_STYLE} className=\"text-right\" placeholder=\"CLASSID-PROJID-CODE\" onChange={this.handleChange} />\n        formFeedback = <FormFeedback style={NAV_LOGIN_FEEDBACK_STYLE} className=\"text-right\"><small>{tip}</small></FormFeedback>\n      } else {\n        input = <Input valid name=\"sessionToken\" id=\"sessionToken\" bsSize=\"sm\" style={INPUT_STYLE} className=\"text-right\" placeholder=\"CLASSID-PROJID-CODE\" onChange={this.handleChange} />\n        formFeedback = <FormFeedback valid style={NAV_LOGIN_FEEDBACK_STYLE} className=\"text-right\"><small>{tip}</small></FormFeedback>\n      }\n    } else {\n        input = <Input invalid name=\"sessionToken\" id=\"sessionToken\" bsSize=\"sm\" style={INPUT_STYLE} className=\"text-right\" placeholder=\"CLASSID-PROJID-CODE\" onChange={this.handleChange} />\n        formFeedback = <FormFeedback style={NAV_LOGIN_FEEDBACK_STYLE} className=\"text-right\"><small>{tip}</small></FormFeedback>\n    }\n\n    return (\n      <Form onSubmit={this.onSubmit} style={NAV_LOGIN_STYLE}>\n      <FormGroup row>\n        <InputGroup>\n          <InputGroupAddon addonType=\"prepend\"><Button style={{fontSize:'10px'}} color=\"secondary\" size=\"sm\" disabled={!isValid} onSubmit={this.onSubmit}>LOGIN</Button></InputGroupAddon>\n          {input}\n          {formFeedback}\n        </InputGroup>\n      </FormGroup>\n      </Form>\n    );\n\n    // Old Form above NodeSelector\n    // return (\n    //   <Form onSubmit={this.onSubmit} style={{position:'fixed',top:'5px',right:'5px',zIndex:'2000'}}>\n    //   <FormGroup row>\n    //     <Col>\n    //       <InputGroup>\n    //         {formFeedback}\n    //         <InputGroupAddon addonType=\"prepend\"><Button style={{fontSize:'10px'}} color=\"secondary\" size=\"sm\" disabled={!isValid} onSubmit={this.onSubmit}>LOGIN</Button></InputGroupAddon>\n    //         {input}\n    //       </InputGroup>\n    //     </Col>\n    //   </FormGroup>\n    //   </Form>\n    // );\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  componentWillMount() {\n    // the code below reads a pre-existing matching path, which may be set\n    // to a valid token string AFTER the changeHandler() detected a valid\n    // login after a ForceReload. This is a bit hacky and the app would benefit\n    // from not relying on forced reloads. See handleChange().\n    //\n    // This is only called with the initial page load.\n    // Subsequent changes to the URL (e.g. changing token directly in the url)\n    // do not result in a second componentWillMount call.  These are handled\n    // by the componentDidUpdate() call.\n    let token = this.props.match.params.token;\n    let decoded = SESSION.DecodeToken(token, window.NC_CONFIG.dataset) || {};\n    this.SetAppState(\"SESSION\", decoded);\n    this.previousIsValid = decoded.isValid;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ Main Render Function\n  /*/\n  render() {\n    // FUN FACTS\n    // this.state set in constructor\n    // this.props.history, location, match added by withRouter(AppShell)\n    // way back in init-appshell.jsx\n\n    // if standalone mode, no login possible\n    if (UNISYS.IsStandaloneMode()) {\n      const { prompt, timestamp } = window.NC_UNISYS.standalone;\n      return (\n        <div style={NAV_LOGIN_STYLE}>\n          <Col sm={16}>\n            <Label style={LABEL_STYLE} className=\"small\">{prompt}</Label>\n          </Col>\n          </div>\n      );\n    }\n\n    let token = this.props.match.params.token;\n\n    // no token so just render login\n    if (!token) return this.renderLogin();\n\n    // try to decode token\n    let decoded = SESSION.DecodeToken(token, window.NC_CONFIG.dataset);\n    if (decoded.isValid) {\n      return this.renderLoggedIn(decoded);\n    } else {\n      return this.renderLogin(token);\n    }\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  componentDidUpdate(prevProps) {\n    // SIDE EFFECT\n    // Check for changes in logged in status and\n    // trigger AppStateChange if necessary\n\n    // Read token from props (because they are not saved in state)\n    // We have to decode again here because we're using props directly\n    let token = this.props.match.params.token;\n    if (!token) return; // don't bother to check if this was a result of changes from the form\n    let decoded = SESSION.DecodeToken(token, window.NC_CONFIG.dataset);\n    if (decoded.isValid !== this.previousIsValid) {\n      this.SetAppState(\"SESSION\", decoded);\n      this.previousIsValid = decoded.isValid;\n    }\n  }\n\n  /// EVENT HANDLERS ////////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  handleChange(event) {\n    let token = event.target.value;\n    let decoded = SESSION.DecodeToken(token, window.NC_CONFIG.dataset);\n    let { classId, projId, hashedId, subId, groupId } = decoded;\n    this.setState(decoded);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  onSubmit(event) {\n    event.preventDefault();\n    const BRUTAL_REDIRECT = true;\n    if (this.state.isValid) {\n      // force a page URL change\n      if (BRUTAL_REDIRECT) {\n        const redirect = `./#/edit/${this.state.token}`;\n        window.location=redirect;\n      } else {\n        const redirect = `./edit/${this.state.token}`\n        this.props.history.push(redirect);\n      }\n    }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  }\n} // UNISYS.Component SessionShell\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = SessionShell;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\nDATABASE SERVER\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst DBG = false;\n\n/// LOAD LIBRARIES ////////////////////////////////////////////////////////////\n/// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\nconst Loki = require(\"lokijs\");\nconst PATH = require(\"path\");\nconst FS = require(\"fs-extra\");\nconst TOML = require(\"@iarna/toml\");\n\n/// CONSTANTS /////////////////////////////////////////////////////////////////\n/// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\nconst SESSION = require(\"../unisys/common-session\");\nconst LOGGER = require(\"../unisys/server-logger\");\nconst PROMPTS = require(\"../system/util/prompts\");\nconst TEMPLATE_SCHEMA = require(\"../view/netcreate/template-schema\");\nconst { EDITORTYPE } = require(\"../system/util/enum\");\n\nconst PR = PROMPTS.Pad(\"ServerDB\");\nconst RUNTIMEPATH = './runtime/';\nconst TEMPLATEPATH = './app/assets/templates/';\nconst TEMPLATE_EXT = '.template.toml'\nconst BACKUPPATH = 'backups/'; // combined with RUNTIMEPATH, so no leading './'\nconst DB_CLONEMASTER = \"blank.loki\";\nconst NC_CONFIG = require(\"../assets/netcreate-config\");\n\n/// MODULE-WIDE VARS //////////////////////////////////////////////////////////\n/// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\nlet db_file;\nlet m_options; // saved initialization options\nlet m_db; // loki database\nlet m_max_edgeID;\nlet m_max_nodeID;\nlet m_dupe_set; // set of nodeIDs for determine whether there are duplicates\nlet NODES; // loki \"nodes\" collection\nlet EDGES; // loki \"edges\" collection\nlet m_locked_nodes; // map key = nodeID, value = uaddr initiating the lock\nlet m_locked_edges; // map key = nodeID, value = uaddr initiating the lock\nlet TEMPLATE;\nlet m_open_editors = []; // array of template, node, or edge editors\n\n/// API METHODS ///////////////////////////////////////////////////////////////\n/// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\nlet DB = {};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Backup Database File Utility\n    Used by PKT_MergeDatabase to clone the db before importing.\n    Saves the db in the runtime folder with a timestamp suffix.\n/*/\nfunction m_BackupDatabase() {\n  FS.ensureDirSync(PATH.dirname(db_file));\n  if (FS.existsSync(db_file)) {\n    const timestamp = new Date().toISOString()\n      .replace(/:/g, '.');\n    const backupDBFilePath = m_GetValidDBFilePath(BACKUPPATH + NC_CONFIG.dataset + '_' + timestamp);\n    console.log(PR, 'Saving database backup to', backupDBFilePath)\n    FS.copySync(db_file, backupDBFilePath);\n  }\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: Initialize the database\n/*/\nDB.InitializeDatabase = function (options = {}) {\n\n  let dataset = NC_CONFIG.dataset;\n  db_file = m_GetValidDBFilePath(dataset);\n  FS.ensureDirSync(PATH.dirname(db_file));\n  if (!FS.existsSync(db_file)) {\n    console.log(PR, `NO EXISTING DATABASE ${db_file}, so creating BLANK DATABASE...`);\n  }\n  console.log(PR, `LOADING DATABASE ${db_file}`);\n  let ropt = {\n    autoload: true,\n    autoloadCallback: f_DatabaseInitialize,\n    autosave: true,\n    autosaveCallback: f_AutosaveStatus,\n    autosaveInterval: 4000, // save every four seconds\n  };\n  ropt = Object.assign(ropt, options);\n  m_db = new Loki(db_file, ropt);\n  m_options = ropt;\n  m_options.db_file = db_file;        // store for use by DB.WriteJSON\n\n  // callback on load\n  function f_DatabaseInitialize() {\n    // on the first load of (non-existent database), we will have no\n    // collections so we can detect the absence of our collections and\n    // add (and configure) them now.\n    NODES = m_db.getCollection(\"nodes\");\n    if (NODES === null) NODES = m_db.addCollection(\"nodes\");\n    m_locked_nodes = new Map();\n    EDGES = m_db.getCollection(\"edges\");\n    if (EDGES === null) EDGES = m_db.addCollection(\"edges\");\n    m_locked_edges = new Map();\n\n    // initialize unique set manager\n    m_dupe_set = new Set();\n    let dupeNodes = [];\n\n    // find highest NODE ID\n    if (NODES.count() > 0) {\n      m_max_nodeID = NODES.mapReduce(\n        (obj) => {\n          // side-effect: make sure ids are numbers\n          m_CleanObjID('node.id',obj);\n          // side-effect: check for duplicate ids\n          if (m_dupe_set.has(obj.id)) {\n            dupeNodes.push(obj);\n          } else {\n            m_dupe_set.add(obj.id);\n          }\n          // return value\n          return obj.id;\n        },\n        (arr) => {\n          return Math.max(...arr);\n        }\n      )\n    } else {\n      m_max_nodeID = 0;\n    }\n    // remap duplicate NODE IDs\n    dupeNodes.forEach( (obj) => {\n      m_max_nodeID+=1;\n      LOGGER.Write(PR,`# rewriting duplicate nodeID ${obj.id} to ${m_max_nodeID}`);\n      obj.id = m_max_nodeID;\n    });\n\n    // find highest EDGE ID\n    if (EDGES.count() > 0) {\n      m_max_edgeID = EDGES.mapReduce(\n        (obj) => {\n          m_CleanObjID('edge.id',obj);\n          m_CleanEdgeEndpoints(obj.id,obj);\n          return obj.id;\n        },\n        (arr) => {\n          return Math.max(...arr);\n        }\n      ); // end mapReduce edge ids\n    } else {\n      m_max_edgeID = 0;\n    }\n    console.log(PR,`DATABASE LOADED! m_max_nodeID '${m_max_nodeID}', m_max_edgeID '${m_max_edgeID}'`);\n    m_db.saveDatabase();\n\n    m_LoadTemplate();\n\n  } // end f_DatabaseInitialize\n\n  // UTILITY FUNCTION\n  function f_AutosaveStatus() {\n    let nodeCount = NODES.count();\n    let edgeCount = EDGES.count();\n    console.log(PR,`AUTOSAVING! ${nodeCount} NODES / ${edgeCount} EDGES <3`);\n  }\n}; // InitializeDatabase()\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// utility function for loading template\n/*/ Converts a version 1.3 JSON template to a version 1.4 TOML template\n/*/\n// eslint-disable-next-line complexity\nfunction m_MigrateJSONtoTOML(JSONtemplate) {\n  console.log(PR, 'Converting JSON to TOML...');\n  const jt = JSONtemplate;\n  const SCHEMA = TEMPLATE_SCHEMA.TEMPLATE.properties;\n  const TOMLtemplate = {\n    name: jt.name,\n    description: jt.description,\n    requireLogin: jt.requireLogin || SCHEMA.requireLogin.default,\n    hideDeleteNodeButton: (jt.nodePrompts && jt.nodePrompts.delete && jt.nodePrompts.delete.hidden) || SCHEMA.hideDeleteNodeButton.default,\n    allowLoggedInUserToImport: SCHEMA.allowLoggedInUserToImport.default, // new parameter not in old json template\n    duplicateWarning: (jt.nodePrompts && jt.nodePrompts.label && jt.nodePrompts.label.duplicateWarning) || SCHEMA.duplicateWarning.default,\n    nodeIsLockedMessage: (jt.nodePrompts && jt.nodePrompts.label && jt.nodePrompts.label.sourceNodeIsLockedMessage) || SCHEMA.nodeIsLockedMessage.default,\n    edgeIsLockedMessage: (jt.edgePrompts && jt.edgePrompts.edgeIsLockedMessage) || SCHEMA.edgeIsLockedMessage.default,\n    templateIsLockedMessage: SCHEMA.templateIsLockedMessage.default,\n    nodeDefaultTransparency: (jt.nodePrompts && jt.nodePrompts.defaultTransparency) || SCHEMA.nodeDefaultTransparency.default,\n    edgeDefaultTransparency: (jt.edgePrompts && jt.edgePrompts.defaultTransparency) || SCHEMA.edgeDefaultTransparency.default,\n    searchColor: jt.searchColor || SCHEMA.searchColor.default,\n    sourceColor: jt.sourceColor || SCHEMA.sourceColor.default,\n    citation: {\n      text: (jt.citationPrompts && jt.citationPrompts.citation) || jt.name,\n      hidden: (jt.citationPrompts && jt.citationPrompts.hidden) || SCHEMA.citation.properties.hidden.default\n    }\n  }\n  // convert nodePrompts\n  const nodeDefs = {};\n  // 1. Add fields\n  Object.keys(JSONtemplate.nodePrompts).forEach(k => {\n    const field = JSONtemplate.nodePrompts[k];\n    nodeDefs[k] = {\n      type: field.type || 'string', // default to 'string'\n      displayLabel: field.label,\n      exportLabel: field.label,\n      help: field.help,\n      includeInGraphTooltip: field.includeInGraphTooltip || true, // default to show tool tip\n      hidden: field.hidden || false // default to not hidden\n    }\n    if (k === 'type') {\n      // special handling for type options\n      const options = field.options.map(o => {\n        return {\n          label: o.label,\n          color: o.color\n        }\n      });\n      // make sure field type is set to \"select\" -- older templates do not set type\n      nodeDefs[k].type = 'select';\n      console.log(PR,'...migrating nodeDefs field', k,'with options, forcing type to \"select\"')\n      nodeDefs[k].options = options;\n    }\n  })\n  // 2. Add id -- clobbers any existing id\n  nodeDefs.id = {\n    type: 'number',\n    displayLabel: 'id',\n    exportLabel: 'ID',\n    help: 'System-generated unique id number'\n  };\n  // 3. remove deprecated fields\n  Reflect.deleteProperty(nodeDefs, 'delete'); // `delete` -- mapped to hideDeleteNodeButton\n  Reflect.deleteProperty(nodeDefs, 'defaultTransparency'); // `nodeDefaultTransparency` -- moved to root\n\n  // 4. Add other built-ins\n  nodeDefs.updated = {\n    displayLabel: 'Last Updated',\n    exportLabel: 'Last Updated',\n    help: 'Date and time of last update',\n    includeInGraphTooltip: true // default to show tool tip\n  }\n  nodeDefs.created = {\n    displayLabel: 'Created',\n    exportLabel: 'Created',\n    help: 'Date and time node was created',\n    includeInGraphTooltip: true // default to show tool tip\n  }\n\n  // convert edgePrompts\n  const edgeDefs = {};\n  // 1. Add fields\n  Object.keys(JSONtemplate.edgePrompts).forEach(k => {\n    const field = JSONtemplate.edgePrompts[k];\n    edgeDefs[k] = {\n      type: field.type || 'string', // default to 'string'\n      displayLabel: field.label,\n      exportLabel: field.label,\n      help: field.help,\n      hidden: field.hidden || false // default to not hidden\n      // If necessary, user can edit template to hide it again.\n      // We want it visible by default, because of migrations\n      // the original field may not be defined.\n      // e.g. orig template uses \"Relationship\" not \"type\"\n    }\n    if (k === 'type') {\n      // special handling for type options\n      const options = field.options.map(o => {\n        return {\n          label: o.label,\n          color: o.color\n        }\n      })\n      // make sure field type is set to \"select\" -- older templates do not set type\n      edgeDefs[k].type = 'select';\n      console.log(PR,'...migrating edgeDefs field', k,'with options, forcing type to \"select\"')\n      edgeDefs[k].options = options;\n    }\n  })\n  // 2. Add id\n  edgeDefs.id = { // will clobber any existing id\n    type: 'number',\n    displayLabel: 'id',\n    exportLabel: 'ID',\n    help: 'System-generated unique id number'\n  };\n  // 3. remove deprecated fields\n  Reflect.deleteProperty(edgeDefs, 'edgeIsLockedMessage'); // `edgeIsLockedMessage` -- moved to root\n  Reflect.deleteProperty(edgeDefs, 'defaultTransparency'); // `edgeDefaultTransparency` -- moved to root\n\n  TOMLtemplate.nodeDefs = nodeDefs;\n  TOMLtemplate.edgeDefs = edgeDefs;\n  if (DBG) console.log(PR, 'Imported TOML TEMPLATE', TOMLtemplate)\n\n  return TOMLtemplate;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Loads an original circa version 1.3 JSON template\n    and converts it to a TOML template\n/*/\nfunction m_LoadJSONTemplate(templatePath) {\n  // 1. Load JSON\n  console.log(PR, `LOADING JSON TEMPLATE ${templatePath}`);\n  const JSONTEMPLATE = FS.readJsonSync(templatePath);\n  // 2. Convert to TOML\n  TEMPLATE = m_MigrateJSONtoTOML(JSONTEMPLATE);\n  // 3. Save it (and load)\n  DB.WriteTemplateTOML({ data: { template: TEMPLATE } })\n    .then(() => {\n      console.log(PR, '...converted JSON template saved!');\n    });\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Loads a *.template.toml file from the server.\n/*/\nfunction m_LoadTOMLTemplate(templateFilePath) {\n  const templateFile = FS.readFile(templateFilePath, 'utf8', (err, data) => {\n    if (err) throw err;\n    // Read TOML\n    const json = TOML.parse(data);\n    // Ensure key fields are present, else default to schema\n    const SCHEMA = TEMPLATE_SCHEMA.TEMPLATE.properties;\n    json.duplicateWarning = json.duplicateWarning || SCHEMA.duplicateWarning.default;\n    json.nodeIsLockedMessage = json.nodeIsLockedMessage || SCHEMA.nodeIsLockedMessage.default;\n    json.edgeIsLockedMessage = json.edgeIsLockedMessage || SCHEMA.edgeIsLockedMessage.default;\n    json.templateIsLockedMessage = json.templateIsLockedMessage || SCHEMA.templateIsLockedMessage.default;\n    json.importIsLockedMessage = json.importIsLockedMessage || SCHEMA.importIsLockedMessage.default;\n    TEMPLATE = json;\n    console.log(PR, 'Template loaded', templateFilePath);\n  });\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Load Template\n    1. Tries to load a TOML template\n    2. If it can't be found, tries to load the JSON template and convert it\n    3. If that fails, clone the default TOML template and load it\n    Called by\n    * DB.InitializeDatabase\n    * DB.WriteTemplateTOML\n/*/\nfunction m_LoadTemplate() {\n  const TOMLtemplateFilePath = m_GetTemplateTOMLFilePath();\n  FS.ensureDirSync(PATH.dirname(TOMLtemplateFilePath));\n  // Does the TOML template exist?\n  if (FS.existsSync(TOMLtemplateFilePath)) {\n    // 1. If TOML exists, load it\n    m_LoadTOMLTemplate(TOMLtemplateFilePath);\n  } else {\n    // 2/ Try falling back to JSON template\n    const JSONTemplatePath = RUNTIMEPATH + NC_CONFIG.dataset + \".template\";\n    // Does the JSON template exist?\n    if (FS.existsSync(JSONTemplatePath)) {\n      m_LoadJSONTemplate(JSONTemplatePath);\n    } else {\n      // 3. Else, no existing template, clone _default.template.toml\n      console.log(PR, `NO EXISTING TEMPLATE ${TOMLtemplateFilePath}, so cloning default template...`);\n      FS.copySync(TEMPLATEPATH + '_default' + TEMPLATE_EXT, TOMLtemplateFilePath);\n      // then load it\n      m_LoadTOMLTemplate(TOMLtemplateFilePath);\n    }\n  }\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: load database\n    note: InitializeDatabase() was already called on system initialization\n    to populate the NODES and EDGES structures.\n/*/\nDB.PKT_GetDatabase = function(pkt) {\n  let nodes = NODES.chain().data({ removeMeta: false });\n  let edges = EDGES.chain().data({ removeMeta: false });\n  if (DBG) console.log(PR,`PKT_GetDatabase ${pkt.Info()} (loaded ${nodes.length} nodes, ${edges.length} edges)`);\n  LOGGER.Write(pkt.Info(), `getdatabase`);\n  return { d3data: { nodes, edges }, template: TEMPLATE };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: reset database from scratch\n/*/\nDB.PKT_SetDatabase = function (pkt) {\n  if (DBG) console.log(PR, `PKT_SetDatabase`);\n  let { nodes = [], edges = [] } = pkt.Data();\n  if (!nodes.length) console.log(PR, \"WARNING: empty nodes array\");\n  else console.log(PR, `setting ${nodes.length} nodes...`);\n  if (!edges.length) console.log(PR, \"WARNING: empty edges array\");\n  else console.log(PR, `setting ${edges.length} edges...`);\n  NODES.clear();\n  NODES.insert(nodes);\n  EDGES.clear();\n  EDGES.insert(edges);\n  console.log(PR, `PKT_SetDatabase complete. Data available on next get.`);\n  m_db.close();\n  DB.InitializeDatabase();\n  LOGGER.Write(pkt.Info(), `setdatabase`);\n  return { OK: true };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: Add nodes/edges to an existing db\n/*/\nDB.PKT_InsertDatabase = function (pkt) {\n  if (DBG) console.log(PR, `PKT_InsertDatabase`);\n  let { nodes = [], edges = [] } = pkt.Data();\n  if (!nodes.length) console.log(PR, \"WARNING: empty nodes array\");\n  else console.log(PR, `setting ${nodes.length} nodes...`);\n  if (!edges.length) console.log(PR, \"WARNING: empty edges array\");\n  else console.log(PR, `setting ${edges.length} edges...`);\n  NODES.insert(nodes);\n  EDGES.insert(edges);\n  console.log(PR, `PKT_InsertDatabase complete. Data available on next get.`);\n  m_db.close();\n  DB.InitializeDatabase();\n  LOGGER.Write(pkt.Info(), `setdatabase`);\n  return { OK: true };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: Update or add nodes/edges to an existing db\n    If the node/edge exists, update it.\n    Otherwise, insert it.\n    This walks down the node and edge arrays one by one,\n    using PKT_Update to decide whether to insert or update the data.\n    REVIEW: Consider batch operations ala `NODES.insert(nodes)`?\n/*/\nDB.PKT_MergeDatabase = function (pkt) {\n  if (DBG) console.log(PR, `PKT_MergeDatabase`);\n  let { nodes = [], edges = [] } = pkt.Data();\n\n  // Save Backup First!\n  m_BackupDatabase();\n\n  // insert nodes one by one\n  nodes.forEach(n => {\n    pkt.data.node = n;\n    DB.PKT_Update(pkt);\n  });\n  pkt.data.node = undefined; // clear, no longer needed\n\n  edges.forEach(e => {\n    pkt.data.edge = e;\n    DB.PKT_Update(pkt);\n  });\n  pkt.data.edge = undefined; // clear, no longer needed\n\n  return new Promise((resolve, reject) => m_db.saveDatabase(err => {\n    if (err) reject(new Error('rejected'));\n    DB.InitializeDatabase();\n    LOGGER.Write(pkt.Info(), `mergedatabase`);\n    resolve({ OK: true });\n  }));\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: Update all data in existing database.\n    Used to update node/edge types after template edit\n/*/\nDB.PKT_UpdateDatabase = function (pkt) {\n  if (DBG) console.log(PR, `PKT_UpdateDatabase`);\n  let { nodes = [], edges = [] } = pkt.Data();\n  if (!nodes.length) console.log(PR, \"WARNING: empty nodes array\");\n  else console.log(PR, `updating ${nodes.length} nodes...`);\n  if (!edges.length) console.log(PR, \"WARNING: empty edges array\");\n  else console.log(PR, `updating ${edges.length} edges...`);\n  NODES.update(nodes);\n  EDGES.update(edges);\n  console.log(PR, `PKT_UpdateDatabase complete. Disk db file updated.`);\n  m_db.saveDatabase();\n  LOGGER.Write(pkt.Info(), `updatedatabase`);\n  return { OK: true };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Side Effect: Changes `m_max_nodeID`\nfunction m_CalculateMaxNodeID() {\n  if (NODES.count() > 0) {\n    m_max_nodeID = NODES.mapReduce(\n      obj => obj.id,\n      arr => Math.max(...arr)\n    );\n  } else {\n    m_max_nodeID = 0;\n  }\n  return m_max_nodeID;\n}\nDB.PKT_CalculateMaxNodeID = function(pkt) {\n  if (DBG) console.log(PR, `PKT_CalculateMaxNodeID ${pkt.Info()}`);\n  return { maxNodeID: m_CalculateMaxNodeID() };\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_GetNewNodeID() {\n  m_max_nodeID += 1;\n  return m_max_nodeID;\n}\nDB.PKT_GetNewNodeID = function (pkt) {\n  if (DBG) console.log(PR, `PKT_GetNewNodeID ${pkt.Info()} nodeID ${m_max_nodeID}`);\n  return { nodeID: m_GetNewNodeID() };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nDB.PKT_GetNewNodeIDs = function (pkt) {\n  const count = Number(pkt.Data().count);\n  const firstId = m_max_nodeID + 1;\n  const nodeIDs = [];\n  for (let i = 0; i < count; i++) nodeIDs.push(firstId + i);\n  m_max_nodeID += count;\n  if (DBG) console.log(PR, `PKT_GetNewNodeIDS ${pkt.Info()} nodeIDs ${nodeIDs}`);\n  return { nodeIDs };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_CalculateMaxEdgeID () {\n  if (EDGES.count() > 0) {\n    m_max_edgeID = EDGES.mapReduce(\n      obj => obj.id,\n      arr => Math.max(...arr)\n    );\n  } else {\n    m_max_edgeID = 0;\n  }\n  return m_max_edgeID;\n}\nDB.PKT_CalculateMaxEdgeID = function(pkt) {\n  if (DBG) console.log(PR, `PKT_CalculateMaxEdgeID ${pkt.Info()}`);\n  return { maxEdgeID: m_CalculateMaxEdgeID() };\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_GetNewEdgeID() {\n  m_max_edgeID += 1;\n  return m_max_edgeID;\n}\nDB.PKT_GetNewEdgeID = function (pkt) {\n  if (DBG) console.log(PR, `PKT_GetNewEdgeID ${pkt.Info()} edgeID ${m_max_edgeID}`);\n  return { edgeID: m_GetNewEdgeID() };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nDB.PKT_GetNewEdgeIDs = function(pkt) {\n  const count = Number(pkt.Data().count);\n  const firstId = m_max_edgeID + 1;\n  const edgeIDs = [];\n  for (let i = 0; i < count; i++) edgeIDs.push(firstId + i);\n  m_max_edgeID += count;\n  if (DBG) console.log(PR, `PKT_GetNewEdgeIDs ${pkt.Info()} edgeIDs ${edgeIDs}`);\n  return { edgeIDs };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nDB.PKT_RequestLockNode = function(pkt) {\n  let { nodeID } = pkt.Data();\n  const uaddr = pkt.s_uaddr;\n  let errcode = m_IsInvalidNode( nodeID );\n  if (errcode) return errcode;\n  // check if node is already locked\n  if (m_locked_nodes.has(nodeID)) return m_MakeLockError(`nodeID ${nodeID} is already locked`);\n  // SUCCESS\n  // single matching node exists and is not yet locked, so lock it\n  m_locked_nodes.set(nodeID, uaddr);\n  return { nodeID, locked : true };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nDB.PKT_RequestUnlockNode = function (pkt) {\n  let { nodeID } = pkt.Data();\n  const uaddr = pkt.s_uaddr;\n  let errcode = m_IsInvalidNode( nodeID );\n  if (errcode) return errcode;\n  // check that node is already locked\n  if (m_locked_nodes.has(nodeID)) {\n    m_locked_nodes.delete(nodeID);\n    return { nodeID, unlocked:true };\n  }\n  // this is an error because nodeID wasn't in the lock table\n  return m_MakeLockError(`nodeID ${nodeID} was not locked so can't unlock`);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_IsInvalidNode ( nodeID ) {\n  if (!nodeID) return m_MakeLockError(`undefined nodeID`);\n  nodeID = Number.parseInt(nodeID,10);\n  if (isNaN(nodeID)) return m_MakeLockError(`nodeID was not a number`);\n  if (nodeID<0) return m_MakeLockError(`nodeID ${nodeID} must be positive integer`);\n  if (nodeID>m_max_nodeID) return m_MakeLockError(`nodeID ${nodeID} is out of range`);\n    // find if the node exists\n  let matches = NODES.find({ id: nodeID });\n  if (matches.length===0) return m_MakeLockError(`nodeID ${nodeID} not found`);\n  if (matches.length>1) return m_MakeLockError(`nodeID ${nodeID} matches multiple entries...critical error!`);\n  // no retval is no error!\n  return undefined;\n}\nfunction m_MakeLockError( info ) {\n  return { NOP:`ERR`, INFO:info };\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nDB.PKT_RequestLockEdge = function (pkt) {\n  let { edgeID } = pkt.Data();\n  const uaddr = pkt.s_uaddr;\n  let errcode = m_IsInvalidEdge(edgeID);\n  if (errcode) return errcode;\n  // check if edge is already locked\n  if (m_locked_edges.has(edgeID)) return m_MakeLockError(`edgeID ${edgeID} is already locked`);\n  // SUCCESS\n  // single matching edge exists and is not yet locked, so lock it\n  m_locked_edges.set(edgeID, uaddr);\n  return { edgeID, locked: true };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nDB.PKT_RequestUnlockEdge = function (pkt) {\n  let { edgeID } = pkt.Data();\n  const uaddr = pkt.s_uaddr;\n  let errcode = m_IsInvalidEdge(edgeID);\n  if (errcode) return errcode;\n  // check that edge is already locked\n  if (m_locked_edges.has(edgeID)) {\n    m_locked_edges.delete(edgeID);\n    return { edgeID, unlocked: true };\n  }\n  // this is an error because nodeID wasn't in the lock table\n  return m_MakeLockError(`edgeID ${edgeID} was not locked so can't unlock`);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_IsInvalidEdge(edgeID) {\n  if (!edgeID) return m_MakeLockError(`undefined edgeID`);\n  edgeID = Number.parseInt(edgeID, 10);\n  if (isNaN(edgeID)) return m_MakeLockError(`edgeID was not a number`);\n  if (edgeID < 0) return m_MakeLockError(`edgeID ${edgeID} must be positive integer`);\n  if (edgeID > m_max_edgeID) return m_MakeLockError(`edgeID ${edgeID} is out of range`);\n  // find if the node exists\n  let matches = EDGES.find({ id: edgeID });\n  if (matches.length === 0) return m_MakeLockError(`edgeID ${edgeID} not found`);\n  if (matches.length > 1) return m_MakeLockError(`edgeID ${edgeID} matches multiple entries...critical error!`);\n  // no retval is no error!\n  return undefined;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nDB.PKT_RequestUnlockAllNodes = function (pkt) {\n  m_locked_nodes = new Map();\n  return { unlocked: true };\n}\nDB.PKT_RequestUnlockAllEdges = function (pkt) {\n  m_locked_edges = new Map();\n  return { unlocked: true };\n}\nDB.PKT_RequestUnlockAll = function (pkt) {\n  m_locked_nodes = new Map();\n  m_locked_edges = new Map();\n  m_open_editors = [];\n  return { unlocked: true };\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ called by server-network when a client disconnects we want to unlock any\n    nodes and edges they had locked.\n/*/\nDB.RequestUnlock = function (uaddr) {\n  m_locked_nodes.forEach((value, key) => {\n    if (value === uaddr) m_locked_nodes.delete(key);\n  });\n  m_locked_edges.forEach((value, key) => {\n    if (value === uaddr) m_locked_edges.delete(key);\n  });\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n// eslint-disable-next-line complexity\nDB.PKT_Update = function(pkt) {\n  let { node, edge, nodeID, replacementNodeID, edgeID } = pkt.Data();\n  let retval = {};\n  // PROCESS NODE INSERT/UPDATE\n  if (node) {\n    m_CleanObjID(`${pkt.Info()} node.id`,node);\n    let matches = NODES.find({ id: node.id });\n    if (matches.length === 0) {\n      // if there was no node, then this is an insert new operation\n      if (DBG) console.log(PR,`PKT_Update ${pkt.Info()} INSERT nodeID ${JSON.stringify(node)}`);\n\n      // Handle different id types\n      if (isNaN(node.id)) {\n        // If the node id has NOT been defined, generate a new node id\n        node.id = m_GetNewNodeID();\n      }\n\n      LOGGER.Write(pkt.Info(), `insert node`, node.id, JSON.stringify(node));\n      DB.AppendNodeLog(node, pkt); // log GroupId to node stored in database\n      NODES.insert(node);\n      // Return the updated record -- needed to update metadata\n      let updatedNode = NODES.findOne({ id: node.id });\n      if (!updatedNode) console.log(PR, `PKT_Update ${pkt.Info()} could not find node after update!  This should not happen! ${node.id} ${JSON.stringify(node)}`);\n      retval = { op: \"insert\", node: updatedNode };\n    } else if (matches.length === 1) {\n      // there was one match to update\n      NODES.findAndUpdate({ id: node.id }, n => {\n        if (DBG) console.log(PR,`PKT_Update ${pkt.Info()} UPDATE nodeID ${node.id} ${JSON.stringify(node)}`);\n        LOGGER.Write(pkt.Info(), `update node`, node.id, JSON.stringify(node));\n        DB.AppendNodeLog(n, pkt); // log GroupId to node stored in database\n        Object.assign(n, node);\n      });\n      // Return the updated record -- needed to update metadata\n      let updatedNode = NODES.findOne({ id: node.id });\n      if (!updatedNode) console.log(PR, `PKT_Update ${pkt.Info()} could not find node after update!  This should not happen! ${node.id} ${JSON.stringify(node)}`);\n      retval = { op: \"update\", node: updatedNode };\n    } else {\n      if (DBG) console.log(PR,`WARNING: multiple nodeID ${node.id} x${matches.length}`);\n      LOGGER.Write(pkt.Info(), `ERROR`, node.id, \"duplicate node id\");\n      retval = { op: \"error-multinodeid\" };\n    }\n    // Always update m_max_nodeID\n    m_CalculateMaxNodeID();\n    return retval;\n  } // if node\n\n  // PROCESS EDGE INSERT/UPDATE\n  if (edge) {\n    m_CleanObjID(`${pkt.Info()} edge.id`,edge);\n    let matches = EDGES.find({ id: edge.id });\n    if (matches.length === 0) {\n      // this is a new edge\n      if (DBG) console.log(PR,`PKT_Update ${pkt.Info()} INSERT edgeID ${edge.id} ${JSON.stringify(edge)}`);\n\n      // Handle different id types\n      if (isNaN(edge.id)) {\n        // If the edge id has NOT been defined, generate a new edge id\n        edge.id = m_GetNewEdgeID();\n      }\n\n      LOGGER.Write(pkt.Info(), `insert edge`, edge.id, JSON.stringify(edge));\n      DB.AppendEdgeLog(edge, pkt); // log GroupId to edge stored in database\n      EDGES.insert(edge);\n      // Return the updated record -- needed to update metadata\n      let updatedEdge = EDGES.findOne({ id: edge.id });\n      if (!updatedEdge) console.log(PR, `PKT_Update ${pkt.Info()} could not find node after update!  This should not happen! ${node.id} ${JSON.stringify(node)}`);\n      retval = { op: \"insert\", edge: updatedEdge };\n    } else if (matches.length === 1) {\n      // update this edge\n      EDGES.findAndUpdate({ id: edge.id }, e => {\n        if (DBG) console.log(PR,`PKT_Update ${pkt.SourceGroupID()} UPDATE edgeID ${edge.id} ${JSON.stringify(edge)}`);\n        LOGGER.Write(pkt.Info(), `update edge`, edge.id, JSON.stringify(edge));\n        DB.AppendEdgeLog(e, pkt); // log GroupId to edge stored in database\n        Object.assign(e, edge);\n      });\n      // Return the updated record -- needed to update metadata\n      let updatedEdge = EDGES.findOne({ id: edge.id });\n      if (!updatedEdge) console.log(PR, `PKT_Update ${pkt.Info()} could not find node after update!  This should not happen! ${node.id} ${JSON.stringify(node)}`);\n      retval = { op: \"update\", edge: updatedEdge };\n    } else {\n      console.log(PR, `WARNING: multiple edgeID ${edge.id} x${matches.length}`);\n      LOGGER.Write(pkt.Info(), `ERROR`, node.id, \"duplicate edge id\");\n      retval = { op: \"error-multiedgeid\" };\n    }\n    // Always update m_max_edgeID\n    m_CalculateMaxEdgeID();\n    return retval;\n  } // if edge\n\n  // DELETE NODE\n  if (nodeID !== undefined) {\n    nodeID = m_CleanID(`${pkt.Info()} nodeID`,nodeID);\n    if (DBG) console.log(PR, `PKT_Update ${pkt.Info()} DELETE nodeID ${nodeID}`);\n    // Log first so it's apparent what is triggering the edge changes\n    LOGGER.Write(pkt.Info(), `delete node`, nodeID);\n\n    // handle edges\n    let edgesToProcess = EDGES.where(e => {\n      return e.source === nodeID || e.target === nodeID;\n    });\n\n    // handle linked nodes\n    replacementNodeID = m_CleanID(`${pkt.Info()} replacementNodeID`,replacementNodeID);\n    if (replacementNodeID !== -1) {\n      // re-link edges to replacementNodeID...\n      EDGES.findAndUpdate({ source: nodeID }, e => {\n        LOGGER.Write(pkt.Info(),`relinking edge`,e.id,`to`,replacementNodeID);\n        e.source = replacementNodeID;\n      });\n      EDGES.findAndUpdate({ target: nodeID }, e => {\n        LOGGER.Write(pkt.Info(),`relinking edge`,e.id,`to`,replacementNodeID);\n        e.target = replacementNodeID;\n      });\n    } else {\n      // ... or delete edges completely\n      let sourceEdges = EDGES.find({ source: nodeID });\n      EDGES.findAndRemove({ source: nodeID });\n      if (sourceEdges.length) LOGGER.Write(pkt.Info(), `deleting ${sourceEdges.length} sources matching ${nodeID}`);\n      let targetEdges = EDGES.find({ target: nodeID });\n      EDGES.findAndRemove({ target: nodeID });\n      if (targetEdges.length) LOGGER.Write(pkt.Info(), `deleting ${targetEdges.length} targets matching ${nodeID}`);\n    }\n    // ...finally remove the node itself\n    NODES.findAndRemove({ id: nodeID });\n    return { op: \"delete\", nodeID, replacementNodeID };\n  }\n\n  // DELETE EDGES\n  if (edgeID !== undefined) {\n    edgeID = m_CleanID(`${pkt.Info()} edgeID`,edgeID);\n    if (DBG) console.log(PR, `PKT_Update ${pkt.Info()} DELETE edgeID ${edgeID}`);\n    LOGGER.Write(pkt.Info(), `delete edge`, edgeID);\n    EDGES.findAndRemove({ id: edgeID });\n    return { op: \"delete\", edgeID };\n  }\n\n  // return update value\n  return { op: \"error-noaction\" };\n};\n\n/// NODE ANNOTATION ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ write/remove packet SourceGroupID() information into the node before writing\n    the first entry is the insert, subsequent operations are updates\n/*/\nDB.AppendNodeLog = function(node, pkt) {\n  if (!node._nlog) node._nlog = [];\n  let gid = pkt.SourceGroupID() || pkt.SourceAddress();\n  node._nlog.push(gid);\n  if (DBG) {\n    let out = \"\";\n    node._nlog.forEach(el => {\n      out += `[${el}] `;\n    });\n    console.log(PR, \"nodelog\", out);\n  }\n};\nDB.FilterNodeLog = function(node) {\n  let newNode = Object.assign({}, node);\n  Reflect.deleteProperty(newNode, \"_nlog\");\n  return newNode;\n};\n/// EDGE ANNOTATION ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ write/remove packet SourceGroupID() information into the node before writing\n    the first entry is the insert, subsequent operations are updates\n/*/\nDB.AppendEdgeLog = function(edge, pkt) {\n  if (!edge._elog) edge._elog = [];\n  let gid = pkt.SourceGroupID() || pkt.SourceAddress();\n  edge._elog.push(gid);\n  if (DBG) {\n    let out = \"\";\n    edge._elog.forEach(el => {\n      out += `[${el}] `;\n    });\n    console.log(PR, \"edgelog\", out);\n  }\n};\nDB.FilterEdgeLog = function(edge) {\n  let newEdge = Object.assign({}, edge);\n  Reflect.deleteProperty(newEdge, \"_elog\");\n  return newEdge;\n};\n\n/// JSON EXPORT ///////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ called by brunch to generate an up-to-date JSON file to path.\n    creates the path if it doesn't exist\n/*/\nDB.WriteDbJSON = function (filePath) {\n  let dataset = NC_CONFIG.dataset;\n\n  // Ideally we should use m_otions value, but in standlone mode,\n  // m_options might not be defined.\n  let db_file = m_options ? m_options.db_file : m_GetValidDBFilePath(dataset);\n  let db = new Loki(db_file,{\n      autoload: true,\n      autoloadCallback: () => {\n        if (typeof filePath==='string') {\n          if (DBG) console.log(PR,`writing { nodes, edges } to '${filePath}'`);\n          let nodes = db.getCollection(\"nodes\").chain()\n            .data({ removeMeta: false });\n          let edges = db.getCollection(\"edges\").chain()\n            .data({ removeMeta: false });\n          let data = { nodes, edges };\n          let json = JSON.stringify(data);\n          if (DBG) console.log(PR,`ensuring DIR ${PATH.dirname(filePath)}`);\n          FS.ensureDirSync(PATH.dirname( filePath ));\n          if (DBG) console.log(PR,`writing file ${filePath}`);\n          FS.writeFileSync( filePath, json );\n          console.log(PR, `*** WROTE JSON DATABASE ${filePath}`);\n        } else {\n          console.log(PR,`ERR path ${filePath} must be a pathname`);\n        }\n      }\n    }\n  );\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ DEPRECATED.  Replaced by WriteTemplateTOML\n    called by brunch to generate an up-to-date Template file to path.\n    creates the path if it doesn't exist\n/*/\nDB.WriteTemplateJSON = function (filePath) {\n  let templatePath = RUNTIMEPATH + NC_CONFIG.dataset + \".template\";\n  FS.ensureDirSync(PATH.dirname(templatePath));\n  // Does the template exist?\n  if (!FS.existsSync(templatePath)) {\n    console.error(PR, `ERR could not find template ${templatePath}`);\n  } else {\n    FS.copySync(templatePath, filePath);\n    console.log(PR, `*** COPIED TEMPLATE ${templatePath} to ${filePath}`);\n  }\n};\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ called by Template Editor and DB.WriteTemplateTOML\n/*/\nfunction m_GetTemplateTOMLFileName() {\n  return NC_CONFIG.dataset + TEMPLATE_EXT;\n}\nfunction m_GetTemplateTOMLFilePath() {\n  return RUNTIMEPATH + m_GetTemplateTOMLFileName();\n}\nDB.GetTemplateTOMLFileName = () => {\n  return { filename: m_GetTemplateTOMLFileName() };\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ called by Template Editor to save TOML template changes to disk.\n    parm {object} pkt.data.template\n    Loads the template after saving!\n/*/\nDB.WriteTemplateTOML = (pkt) => {\n  const templateFilePath = m_GetTemplateTOMLFilePath();\n  FS.ensureDirSync(PATH.dirname(templateFilePath));\n  // Does the template exist?  If so, rename the old version with curren timestamp.\n  if (FS.existsSync(templateFilePath)) {\n    const timestamp = new Date().toISOString()\n      .replace(/:/g, '.');\n    const backupFilePath = RUNTIMEPATH + NC_CONFIG.dataset + '_' + timestamp + TEMPLATE_EXT;\n    FS.copySync(templateFilePath, backupFilePath);\n    console.log(PR, 'Backed up template to', backupFilePath);\n  }\n  const toml = TOML.stringify(pkt.data.template);\n  return FS.outputFile(templateFilePath, toml)\n    .then(data => {\n      console.log(PR, 'Saved template to', templateFilePath)\n      // reload template\n      m_LoadTemplate();\n      return { OK: true, info: templateFilePath }\n    })\n    .catch(err => {\n      console.log(PR, 'Failed trying to save', templateFilePath, err);\n      return { OK: false, info: 'Failed trying to save', templateFilePath }\n    });\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Clones the existing toml template\n    called by brunch to generate an up-to-date Template file to path\n    for standalone mode.\n    creates the path if it doesn't exist\n/*/\nDB.CloneTemplateTOML = function (filePath) {\n  const TOMLtemplateFilePath = m_GetTemplateTOMLFilePath();\n  FS.ensureDirSync(PATH.dirname(TOMLtemplateFilePath));\n  // Does the template exist?\n  if (!FS.existsSync(TOMLtemplateFilePath)) {\n    console.error(PR, `ERR could not find template ${TOMLtemplateFilePath}`);\n  } else {\n    FS.copySync(TOMLtemplateFilePath, filePath);\n    console.log(PR, `*** COPIED TEMPLATE ${TOMLtemplateFilePath} to ${filePath}`);\n  }\n};\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ OPENEDITORS\n\n    Used to coordinate Template editing, Importing, and Node/Edge editing.\n    They are mutually exclusive: if one is active, the others should be disabled\n    to prevent overwriting data.\n\n    Since Nodes and Edges should not be edited while the Template is being\n    edited or data is being imported, any editor that is opened registers\n    as an OPENEDITOR.  The UI will also pre-emptively disable edit buttons\n    whenever the open editors have been updated via a broacast of the\n    `EDIT_PERMISSIONS_UPDATE` message by server.js.\n\n    * When a Template editor is open, \"Import\", \"Node Edit\", \"Edge Edit\",\n      \"Add New Node\", and \"Add New Edge\" buttons are all disabled.\n    * When an Import file has been successfully selected and validated,\n      \"Template\", \"Node Edit\", \"Edge Edit\", \"Add New Node\", and\n      \"Add New Edge\" buttons are disabled.\n    * When \"Node Edit\", \"Edge Edit\", \"Add New Node\" or \"Add New Edge\" has\n      been triggered, the Template buttons on the Template panel and the\n      \"Import\" pane on the \"More\" panel are disabled.\n\n    m_open_editors is an array of all the editors (node, edge, template,\n    importer) that are currently open.\n\n    Whenever a template is being edited, import is requested, or a node or\n    edge is being edited:\n    1. They will register with `RequestEditLock`.\n    2. When they are finished, they will deregister using `ReleaseEditLock`.\n    3. `GetEditStatus` returns the current state of `m_open_editors`.\n\n    UI elements query `GetEditStatus` to figure out what they should\n    enable or disable.\n\n    UI elements should also listen to `EDIT_PERMISSIONS_UPDATE` to\n    enable or disable elements.\n\n    Note that multiple `node` and `edge` editors can be open at the same\n    time and ALL must be closed before the lock is released.  We support\n    this because each node or edge will have its own entry in m_open_editors,\n    though we do not distinguish between the individual nodes/edges.\n\n    Note that this is a different system from the instance-specific Node/Edge\n    lock that locks out individual node/edge objects for editing used with\n    `PKT_RequestLockNode` and `PKT_RequestLockEdge`.  m_open_editors focuses\n    on categories of editor types rather than locking out individual nodes\n    and edges to prevent others from editing the same node or edge.\n\n/*/\n/**\n * Returns object with flags indicating whether the template is being edited,\n * data is being imported, or node or edge are being edited\n * @returns {templateBeingEdited:boolean, importActive:boolean, nodeOrEdgeBeingEdited:boolean}\n */\nDB.GetEditStatus = () => {\n  // If there are any 'template' open editors, then templateBeingEdited is true\n  const templateBeingEdited = m_open_editors.includes(EDITORTYPE.TEMPLATE);\n  // If there are any 'importers' open editors, then importActive is true\n  const importActive = m_open_editors.includes(EDITORTYPE.IMPORTER);\n  // If there are any 'node' or 'edge' open editors, then nodeOrEdgeBeingEdited is true\n  const nodeOrEdgeBeingEdited = m_open_editors.length > 0 && (m_open_editors.includes( EDITORTYPE.NODE ) || m_open_editors.includes( EDITORTYPE.EDGE ));\n  return { templateBeingEdited, importActive, nodeOrEdgeBeingEdited };\n}\n/**\n * Register a template, import, node or edge as being actively edited.\n * @param {Object} pkt\n * @param {string} pkt.editor - 'template', 'importer', 'node', or 'edge'\n * @returns { templateBeingEdited: boolean, importActive: boolean, nodeOrEdgeBeingEdited: boolean }\n */\nDB.RequestEditLock = pkt => {\n  m_open_editors.push(pkt.Data().editor);\n  return DB.GetEditStatus();\n}\n/**\n * Deregister a template, import, node or edge as being actively edited.\n * @param {Object} pkt\n * @param {string} pkt.editor - 'template', 'importer', 'node', or 'edge'\n * @returns { templateBeingEdited: boolean, importActive: boolean, nodeOrEdgeBeingEdited: boolean }\n */\nDB.ReleaseEditLock = pkt => {\n  const i = m_open_editors.findIndex(e => e === pkt.Data().editor);\n  if (i > -1) m_open_editors.splice(i, 1);\n  return DB.GetEditStatus();\n}\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// utility function for cleaning nodes with numeric id property\nfunction m_CleanObjID(prompt, obj) {\n  if (typeof obj.id==='string') {\n    let int = parseInt(obj.id,10);\n    LOGGER.Write(PR,`! ${prompt} \"${obj.id}\" is string; converting to ${int}`);\n    obj.id=int;\n  }\n  return obj;\n}\nfunction  m_CleanEdgeEndpoints(prompt, edge) {\n  if (typeof edge.source==='string') {\n    let int = parseInt(edge.source,10);\n    LOGGER.Write(PR,`  edge ${prompt} source \"${edge.source}\" is string; converting to ${int}`);\n    edge.source = int;\n  }\n  if (typeof edge.target==='string') {\n    let int = parseInt(edge.target,10);\n    LOGGER.Write(PR,`  edge ${prompt} target \"${edge.target}\" is string; converting to ${int}`);\n    edge.target = int;\n  }\n  return edge;\n}\nfunction m_CleanID(prompt, id) {\n  if (typeof id==='string') {\n    let int = parseInt(id,10);\n    LOGGER.Write(PR,`! ${prompt} \"${id}\" is string; converting to number ${int}`);\n    id = int;\n  }\n  return id;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// utility function for getting a valid file path\nfunction m_GetValidDBFilePath(dataset) {\n  // validate dataset name\n  let regex = /^([A-z0-9-_+./])*$/; // Allow _ - + . /, so nested pathways are allowed\n  if (!regex.test(dataset)) {\n    console.error(PR, `Trying to initialize database with bad dataset name: ${dataset}`);\n  }\n\n  return RUNTIMEPATH + dataset + \".loki\";\n}\n\n/// EXPORT MODULE DEFINITION //////////////////////////////////////////////////\n/// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\nmodule.exports = DB;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  LOGGER - WIP\n  porting PLAE logger for now to get it minimally working\n\n  SUPER UGLY PORT WILL CLEAN UP LATER AVERT YOUR EYES OMG\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst DBG = false;\n\n/// LOAD LIBRARIES ////////////////////////////////////////////////////////////\n/// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\nconst Loki              = require('lokijs');\nconst PATH              = require('path');\nconst FSE               = require('fs-extra');\n\n/// CONSTANTS /////////////////////////////////////////////////////////////////\n/// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\nconst PROMPTS           = require('../system/util/prompts');\nconst PR                = PROMPTS.Pad('SRV-LOG');\nconst NC_CONFIG         = require(\"../assets/netcreate-config\");\n\n/// MODULE-WIDE VARS //////////////////////////////////////////////////////////\n/// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\n\nconst LOG_DIR           = '../../runtime/logs';\nconst Tracer \t\t\t      = require('tracer');\nconst LOG_DELIMITER     = '\\t';\nconst LOG_CONFIG = {\n  format : \"{{line}}  {{message}}\",\n  dateformat : \"HH:MM:ss.L\",\n  preprocess : function (data) {\n    data.line = 'C '+Number(data.line).zeroPad(4);\n  }\n};\nconst LOGGER = Tracer.colorConsole(LOG_CONFIG);\nlet   fs_log \t\t= null;\n// enums for outputing dates\nconst e_weekday = [ 'Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday' ];\n\n// initialize event logger\nvar dir = PATH.resolve(PATH.join(__dirname,LOG_DIR));\nFSE.ensureDir(dir, function (err) {\n  if (err) throw new Error('could not make '+dir+' directory');\n  var logname = str_TimeDatedFilename('log')+'.txt';\n  var pathname = dir+'/'+logname;\n  fs_log = FSE.createWriteStream(pathname);\n  LogLine(`NETCREATE APPSERVER SESSION LOG for ${str_DateStamp()} ${str_TimeStamp()}`);\n  LogLine('---');\n});\n\n/**\tLOGGING FUNCTIONS ******************************************************/\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\tLog a standard system log message\n/*/\tfunction LogLine ( ...args ) {\n\t\tif (!fs_log) return;\n\n\t\tvar out = str_TimeStamp()+LOG_DELIMITER;\n    out += NC_CONFIG.dataset+LOG_DELIMITER;\n\t\tvar c = args.length;\n    // arguments are delimited\n\t\tif (c) {\n\t\t\tfor (let i=0; i<c; i++) {\n\t\t\t\tif (i>0) out += LOG_DELIMITER;\n\t\t\t\tout += args[i];\n\t\t\t}\n\t\t}\n\t\tout += '\\n';\n\t\tfs_log.write(out);\n\t}\n\n/////////////////////////////////////////////////////////////////////////////\n/**\tUTILITY FUNCTIONS ******************************************************/\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    function str_TimeStamp () {\n      var date = new Date();\n      var hh = (\"0\"+date.getHours()).slice(-2);\n      var mm = (\"0\"+date.getMinutes()).slice(-2);\n      var ss = (\"0\"+date.getSeconds()).slice(-2);\n      return hh+':'+mm+':'+ss;\n    }\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    function str_DateStamp() {\n      var date = new Date();\n      var mm = (\"0\"+(date.getMonth()+1)).slice(-2);\n      var dd = (\"0\"+date.getDate()).slice(-2);\n      var day = e_weekday[date.getDay()];\n      var yyyy = date.getFullYear();\n      return yyyy+'/'+mm+'/'+dd+' '+day;\n    }\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    function str_TimeDatedFilename   ( ...args ) {\n      // construct filename\n      var date = new Date();\n      var dd = (\"0\"+date.getDate()).slice(-2);\n      var mm = (\"0\"+(date.getMonth()+1)).slice(-2);\n      var hms = (\"0\"+date.getHours()).slice(-2);\n      hms += (\"0\"+date.getMinutes()).slice(-2);\n      hms += (\"0\"+date.getSeconds()).slice(-2);\n      var filename;\n      filename = \tdate.getFullYear().toString();\n      filename += '-'+mm+dd;\n      var c = arguments.length;\n      if (c) filename += filename.concat('-',...args);\n      filename += '-'+hms;\n      return filename;\n  }\n\n/// API METHODS ///////////////////////////////////////////////////////////////\n/// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\nlet LOG = {};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: Handle incoming log events\n/*/ LOG.PKT_LogEvent = function ( pkt ) {\n      let {event,items} = pkt.Data();\n      if (DBG) console.log(PR,pkt.Info(),event,...items);\n      LogLine(pkt.Info(),event||'-',...items);\n      return { OK : true };\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API: Write to log as delimited arguments\n/*/ LOG.Write = LogLine;\n\n\n/// EXPORT MODULE DEFINITION //////////////////////////////////////////////////\n/// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\nmodule.exports = LOG;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  WebSocketServer and Network Management for UNISYS\n  WORK IN PROGRESS\n\n  [x] - socket listener\n  [ ] - socket dictionary\n  [ ] - socket metadata for UNISYS defined, stored in sockets\n  [ ] - message dictionary\n  [ ] - message dispatching\n  [ ] - system message declaration\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst DBG = true;\n\n///\tLOAD LIBRARIES ////////////////////////////////////////////////////////////\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar   WSS               = require('ws').Server;\nvar   FSE               = require('fs-extra');\nvar   NetMessage        = require('../unisys/common-netmessage-class');\nconst LOGGER            = require('../unisys/server-logger');\nvar   DB                = require('../unisys/server-database');\nvar   DEFS              = require('./common-defs');\n\n/// CONSTANTS /////////////////////////////////////////////////////////////////\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst PROMPTS           = require('../system/util/prompts');\nconst PR                = PROMPTS.Pad('SRV-NET');\nconst ERR               = PROMPTS.Pad('!!!');\nconst ERR_SS_EXISTS     = \"socket server already created\";\nconst ERR_NULL_SOCKET   = \"require valid socket\";\nconst DBG_SOCK_BADCLOSE = \"closing socket is not in mu_sockets\";\nconst ERR_INVALID_DEST  = \"couldn't find socket with provided address\";\nconst ERR_UNKNOWN_PKT   = \"unrecognized netmessage packet type\";\nconst DEFAULT_NET_PORT  = 2929;\nconst DEFAULT_NET_ADDR  = '127.0.0.1';\n\n/// MODULE-WIDE VARS //////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// sockets\nvar mu_wss;                         // websocket server\nvar mu_options;                     // websocket options\nvar mu_sockets = new Map();         // sockets mapped by socket id\nvar mu_sid_counter = 0;             // for generating  unique socket ids\n// storage\nvar m_server_handlers = new Map();  // message map storing sets of functions\nvar m_message_map     = new Map();  // message map storing other handlers\nvar m_socket_msgs_list = new Map(); // message map by uaddr\n// heartbeat\nvar m_heartbeat_interval;\nvar m_pong_timer = [];\n\n/// API MEHTHODS //////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar   UNET = {};\nconst SERVER_UADDR      = NetMessage.DefaultServerUADDR(); // is 'SVR_01'\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Initialize() is called by brunch-server.js to define the default UNISYS\n    network values, so it can embed them in the index.ejs file for webapps\n/*/ UNET.InitializeNetwork = ( options ) => {\n      options = options || {};\n      options.port = options.port || DEFAULT_NET_PORT;\n      options.uaddr = options.uaddr || SERVER_UADDR;\n      if (mu_wss !== undefined) throw Error(ERR_SS_EXISTS);\n      NetMessage.GlobalSetup({ uaddr: options.uaddr });\n      mu_options = options;\n      return mu_options;\n    }; // end InitializeNetwork()\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\tCreateNetwork() is called by brunch-server after the Express webserver\n    has started listening, initializing the UNISYS NETWORK socket listener.\n/*/\tUNET.StartNetwork = () => {\n      // create listener.\n      if (DBG) console.log(PR,`UNISYS NETWORK initialized on port ${mu_options.port}`);\n      mu_wss = new WSS(mu_options);\n      mu_wss.on('listening',function() {\n        if (DBG) console.log(PR,`listening on port ${mu_options.port}`);\n        mu_wss.on('connection',m_NewSocketConnected);\n      });\n    }; // end CreateNetwork()\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ HandleMessage() registers a server-implemented handler.\n    The handlerFunc receives a NetMessage and should return one as well.\n    It can also return a non-object if there is an error.\n    Logic is similar to client-datalink-class.js equivalent\n/*/ UNET.HandleMessage = function( mesgName, handlerFunc ) {\n      if (typeof handlerFunc !== 'function') {\n        throw \"arg2 must be a function\";\n      }\n      let handlers = m_server_handlers.get(mesgName);\n      if (!handlers) {\n        handlers = new Set();\n        m_server_handlers.set( mesgName, handlers );\n      }\n      handlers.add(handlerFunc);\n      return this;\n    }; // end HandleMessage()\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ UnhandleMessage() de-registers a server-implemented handler, in case you\n    ever want to do that.\n    Logic is similar to client-datalink-class.js equivalent\n/*/ UNET.UnhandleMessage = function( mesgName, handlerFunc ) {\n      if (!arguments.length) {\n        m_server_handlers.clear();\n      } else if (arguments.length===1) {\n        m_server_handlers.delete(mesgName);\n      } else {\n        const handlers = m_server_handlers.get(mesgName);\n        if (handlers) {\n          handlers.delete(handlerFunc);\n        }\n      }\n      return this;\n    }; // end UnhandleMessage()\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Call remote handler, with possible return value\n/*/ UNET.NetCall = async function ( mesgName, data ) {\n      let pkt = new NetMessage(mesgName,data);\n      let promises = m_PromiseRemoteHandlers(pkt);\n      if (DBG) console.log(PR,`${pkt.Info()} NETCALL ${pkt.Message()} to ${promises.length} remotes`);\n      /// MAGICAL ASYNC/AWAIT BLOCK ///////\n      let resArray = await Promise.all(promises);\n      /// END MAGICAL ASYNC/AWAIT BLOCK ///\n      let resObj = Object.assign({},...resArray);\n      return resObj;\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Send data to remote handler, no expected return value\n/*/ UNET.NetSend = function ( mesgName, data ) {\n      let pkt = new NetMessage(mesgName,data);\n      let promises = m_PromiseRemoteHandlers(pkt);\n      // we don't care about waiting for the promise to complete\n      if (DBG) console.log(PR,`${pkt.Info()} NETSEND ${pkt.Message()} to ${promises.length} remotes`);\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Send signal to remote handler, no expected return value\n/*/ UNET.NetSignal = function ( mesgName, data ) {\n      console.warn(PR,'NOTE: Use NetSend(), not NetSignal() since the server doesnt care.');\n      UNET.NetSend(mesgName,data);\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ RegisterRemoteHandlers() accepts a RegistrationPacket with data = { messages }\n    and writes to the two main maps for handling incoming messages\n/*/ UNET.RegisterRemoteHandlers = function( pkt ) {\n      if (pkt.Message()!=='SRV_REG_HANDLERS') throw Error('not a registration packet');\n      let uaddr = pkt.SourceAddress();\n      let { messages=[] } = pkt.Data();\n      let regd=[];\n      // save message list, for later when having to delete\n      m_socket_msgs_list.set(uaddr,messages);\n      // add uaddr for each message in the list\n      // m_message_map[mesg] contains a Set\n      messages.forEach((msg)=>{\n        let entry = m_message_map.get(msg);\n        if (!entry) {\n          entry = new Set();\n          m_message_map.set(msg,entry);\n        }\n        if (DBG) console.log(PR,`adding '${msg}' reference to ${uaddr}`);\n        entry.add(uaddr);\n        regd.push(msg);\n      });\n      return { registered: regd };\n    };\n\n\n/// MODULE HELPER FUNCTIONS ///////////////////////////////////////////////////\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ The socket has connected, so let's save this to our connection list\n/*/ function m_NewSocketConnected( socket ) {\n      if (DBG) console.log(PR,'socket connected');\n\n      m_SocketAdd(socket);\n      m_SocketClientAck(socket);\n      // subscribe socket to handlers\n      socket.on('message', ( json ) => {\n        m_SocketMessage(socket,json);\n      });\n      socket.on('close', () => {\n        // The socket wil not receive a close event immediately if the client\n        // loses their internet connection.  The close event WILL fire if the\n        // client comes back online and reconnects on a new UADDR.\n        // The socket will close eventually after about 4 minutes.\n        m_SocketDelete(socket);\n      });\n\n      // start heartbeat\n      m_StartHeartbeat();\n    }\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ When a new socket is connected, we send a periodic heartbeat to let them\n    know we're still here, and so client can detect when network is lost.\n    This will keep sending a heartbeat to the socket so long as it is open.\n/*/ function m_StartHeartbeat() {\n      if (DBG) console.log(PR, 'starting heartbeat');\n      if (m_heartbeat_interval) return; // already started\n      m_heartbeat_interval = setInterval(function sendHeartbeat() {\n        mu_sockets.forEach((socket, key, map) => {\n          // if (DBG) console.log(PR, 'sending heartbeat to', socket.UADDR);\n          if (socket.readyState === socket.OPEN) {\n            socket.send(\"ping\", (err) => {\n              if (err) console.log(PR, 'error \"', err, '\" while sending heartbeat to', socket.UADDR);\n            });\n          }\n        });\n      }, DEFS.SERVER_HEARTBEAT_INTERVAL);\n    }\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ If a 'pong' message is not received from the client 5 seconds\n    after we send the client a ping message, we assume the network connection\n    has gone down.\n\n    The socket close handler is only triggered when the server closes the\n    connection.  In order to detect the internet connection going down\n    (e.g. loss of wifi) we need to check to see if we are peridically receiving\n    a heartbeat message from the client.\n/*/\n    function m_ResetPongTimer(uaddr) {\n      clearTimeout(m_pong_timer[uaddr]);\n      m_pong_timer[uaddr] = setTimeout(function pongTimedOut() {\n        if (DBG) console.log(PR, uaddr, 'pong not received before time ran out -- CONNECTION DEAD!');\n        LOGGER.Write(PR, uaddr, 'pong not received before time ran out -- CLIENT CONNECTION DEAD!');\n        DB.RequestUnlock(uaddr);\n      }, DEFS.SERVER_HEARTBEAT_INTERVAL * 2);\n    }\n\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ When a new socket connection happens, send back the special registration\n    packet (WIP)\n/*/ function m_SocketClientAck( socket ) {\n      let data = {\n        HELLO : 'Welcome to UNISYS',\n        UADDR : socket.UADDR\n      }\n      socket.send(JSON.stringify(data));\n    }\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Handle all incoming socket messages asynchronously through Promises\n/*/ function m_SocketMessage(socket, json) {\n        // Check Heartbeat\n        if (json === 'pong') {\n          if (socket.UADDR === undefined) {\n            console.log(PR, '!!!!!!!!!!!!!!!!!! Bad socket.UADDR', socket.UADDR, '! Skipping pong timer reset.');\n            return; // Don't start the timer if we get a bad UADDR\n          }\n          m_ResetPongTimer(socket.UADDR);\n          return;\n        }\n\n        let pkt = new NetMessage(json);\n        // figure out what to do\n        switch (pkt.Type()) {\n          case 'state':\n            m_HandleState(socket,pkt);\n            break;\n          case 'msig':\n          case 'msend':\n          case 'mcall':\n            m_HandleMessage(socket,pkt);\n            break;\n          default:\n            throw new Error(`${PR} unknown packet type '${pkt.Type()}'`);\n        } // end switch\n    } // end m_SocketMessage()\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ handle global state and rebroadcast\n/*/ function m_HandleState( socket, pkt ) {\n      //\n    }\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ handle messages that are a Send(), Signal(), or Call()\n/*/ async function m_HandleMessage( socket, pkt ) {\n        // is this a returning packet that was forwarded?\n        if (pkt.IsOwnResponse()) {\n          // console.log(PR,`-- ${pkt.Message()} completing transaction ${pkt.seqlog.join(':')}`);\n          pkt.CompleteTransaction();\n          return;\n        }\n        // console.log(PR,`packet source incoming ${pkt.SourceAddress()}-${pkt.Message()}`);\n        // (1) first check if this is a server handler\n        let promises = m_PromiseServerHandlers(pkt);\n\n        // (2) if it wasn't, then see if we have remote handlers defined\n        if (promises.length===0) promises = m_PromiseRemoteHandlers(pkt);\n\n        // (3) FAIL if no promises were returned, because there were no eligible\n        // UADDR targets, possibly because the sources are not allowed to call itself\n        // except in the case of the SIGNAL type\n        if (promises.length===0) {\n          console.log(PR,`info: '${pkt.Message()}' no eligible UADDR targets`);\n          // return transaction to resolve callee\n          pkt.SetData({NOP:`no handler found for '${pkt.Message()}'`});\n          if (pkt.IsType('mcall')) pkt.ReturnTransaction(socket);\n          return;\n        }\n        // got this far? let's skip all server messages for debugging purposes\n        let notsrv = !pkt.Message().startsWith('SRV_');\n        let json = JSON.stringify(pkt.Data());\n        /* MAGICAL ASYNC/AWAIT BLOCK *****************************/\n        if (DBG) console.log(PR,`${pkt.Info()} FORWARD ${pkt.Message()} to ${promises.length} remotes`);\n        // if (notsrv) console.log(PR,`>> '${pkt.Message()}' queuing ${promises.length} Promises w/ data ${json}'`);\n        let pktArray = await Promise.all(promises);\n        // if (notsrv) console.log(PR,`<< '${pkt.Message()}' resolved`);\n        if (DBG) console.log(PR,`${pkt.Info()} RETURN ${pkt.Message()} from ${promises.length} remotes`);\n        /* END MAGICAL ASYNC/AWAIT BLOCK *************************/\n\n        // (4) only mcall packets need to receive the data back return\n        if (!pkt.IsType('mcall')) return;\n\n        // (5) got this far? this is a call, so gather data and return it\n        let data = pktArray.reduce((d,p) => {\n          let pdata = (p instanceof NetMessage) ? p.Data() : p;\n          let retval = Object.assign(d,pdata);\n          // if (notsrv) console.log(PR,`'${pkt.Message()}' reduce`,JSON.stringify(retval));\n          return retval;\n        },{});\n        // json = JSON.stringify(data);\n        // if (notsrv) console.log(PR,`'${pkt.Message()}' returning transaction data ${json}`);\n        pkt.SetData(data);\n        pkt.ReturnTransaction(socket);\n    } // m_HandleMessage()\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ m_PromiseServerHandlers() returns an array of promises, which should be used\n     by Promises.all() inside an async/await function (m_SocketMessage above)\n    Logic is similar to client-datalink-class.js Call()\n/*/ function m_PromiseServerHandlers( pkt ) {\n      let mesgName = pkt.Message();\n      const handlers = m_server_handlers.get(mesgName);\n      /// create promises for all registered handlers\n      let promises = [];\n      if (handlers) for (let handlerFunc of handlers) {\n        // handlerFunc signature: (data,dataReturn) => {}\n        let p = f_make_resolver_func(pkt,handlerFunc);\n        promises.push(p);\n      }\n      /// return all queued promises\n      return promises;\n\n      /// inline utility function /////////////////////////////////////////////\n      function f_make_resolver_func( srcPkt, handlerFunc ) {\n        return new Promise(( resolve, reject ) => {\n          let retval = handlerFunc(srcPkt);\n          if (retval===undefined) throw `'${mesgName}' message handler MUST return object or error string`;\n          if (typeof retval!=='object') reject(retval);\n          else resolve(retval);\n        });\n      }\n    }\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ If a handler is registered elsewhere on UNET, then dispatch to them for\n    eventual reflection back through server aggregation of data.\n/*/ function m_PromiseRemoteHandlers( pkt ) {\n      // debugging values\n      let s_uaddr = pkt.SourceAddress();\n      // logic values\n      let promises = [];\n      let mesgName = pkt.Message();\n      let type = pkt.Type();\n      // iterate!\n      let handlers = m_message_map.get(mesgName);\n      if (handlers) handlers.forEach((d_uaddr)=>{\n        // don't send packet to originating UADDR because it already has handled it\n        // locally\n        switch (type) {\n          case 'msig':\n            promises.push(f_make_remote_resolver_func(pkt,d_uaddr));\n            break;\n          case 'msend':\n          case 'mcall':\n            if (s_uaddr!==d_uaddr) {\n              promises.push(f_make_remote_resolver_func(pkt,d_uaddr));\n            } else {\n              // console.log(PR,`${type} '${pkt.Message()}' -NO ECHO- ${d_uaddr}`);\n            }\n            break;\n          default:\n            throw Error(`{ERR_UNKNOWN_PKT} ${type}`);\n        }\n      });\n      /// return all queued promises\n      return promises;\n      /// f_make_remote_resolver_function returns the promise created by QueueTransaction()\n      /// made on a new netmessage.\n      function f_make_remote_resolver_func(srcPkt ,d_uaddr,opt={}) {\n        let {verbose} = opt;\n        // get the address of the destination implementor of MESSAGE\n        let d_sock = mu_sockets.get(d_uaddr);\n        if (d_sock===undefined) throw Error(ERR_INVALID_DEST+` ${d_uaddr}`);\n        // Queue transaction from server\n        // sends to destination socket d_sock\n        // console.log(PR,`++ '${pkt.Message()}' FWD from ${pkt.SourceAddress()} to ${d_uaddr}`);\n        let newpkt = new NetMessage(srcPkt);\n        newpkt.MakeNewID();\n        newpkt.CopySourceAddress(srcPkt);\n        if (verbose) {\n          console.log('make_resolver_func:',`PKT: ${srcPkt.Type()} '${srcPkt.Message()}' from ${srcPkt.Info()} to d_uaddr:${d_uaddr} dispatch to d_sock.UADDR:${d_sock.UADDR}`);\n        }\n        return newpkt.QueueTransaction(d_sock);\n      }\n    }\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ function m_SocketAdd( socket ) {\n      // save socket by socket_id\n      let sid = m_GetNewUADDR();\n      // store additional props in socket\n      socket.UADDR = sid;\n      // save socket\n      mu_sockets.set(sid,socket);\n      if (DBG) console.log(PR,`socket ADD ${socket.UADDR} to network`);\n      LOGGER.Write(socket.UADDR,'joined network');\n      if (DBG) m_ListSockets(`add ${sid}`);\n    }\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ function m_GetNewUADDR( prefix='UADDR' ) {\n      ++mu_sid_counter;\n      let cstr = mu_sid_counter.toString(10).padStart(2,'0');\n      return `${prefix}_${cstr}`;\n    }\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ function m_SocketDelete( socket ) {\n      let uaddr = socket.UADDR;\n      if (!mu_sockets.has(uaddr)) throw Error(DBG_SOCK_BADCLOSE);\n      if (DBG) console.log(PR,`socket DEL ${uaddr} from network`);\n      LOGGER.Write(socket.UADDR,'left network');\n      mu_sockets.delete(uaddr);\n      // delete socket reference from previously registered handlers\n      let rmesgs = m_socket_msgs_list.get(uaddr);\n      if (Array.isArray(rmesgs)) {\n        rmesgs.forEach( (msg) => {\n          let handlers = m_message_map.get(msg);\n          if (DBG) console.log(PR,`deleting '${msg}' reference to ${uaddr}`);\n          if (handlers) handlers.delete(uaddr);\n        });\n      }\n      if (DBG) m_ListSockets(`del ${socket.UADDR}`);\n    }\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ function m_ListSockets( change ) {\n      console.log(PR,'SocketList change:',change);\n      // let's use iterators! for..of\n      let values = mu_sockets.values();\n      let count = 1;\n      for (let socket of values) {\n       console.log(PR,`${count} - ${socket.UADDR}`);\n      }\n    }\n\n\n/// EXPORT MODULE DEFINITION //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = UNET;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  UNISYS server loader\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst DBG = false;\n\n///\tLOAD LIBRARIES ////////////////////////////////////////////////////////////\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst UNET      = require('./server-network');\nconst UDB       = require('./server-database');\nconst LOGGER    = require('./server-logger');\n\n/// CONSTANTS /////////////////////////////////////////////////////////////////\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst PROMPTS    = require('../system/util/prompts');\nconst PR         = PROMPTS.Pad('SRV');\n\n/// MODULE VARS ///////////////////////////////////////////////////////////////\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n\n/// API CREATE MODULE /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar UNISYS = {};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Initialize() is called by brunch-server.js to define the default UNISYS\n    network values, so it can embed them in the index.ejs file for webapps\n    override = { port }\n/*/ UNISYS.InitializeNetwork = override => {\n      UDB.InitializeDatabase(override);\n      return UNET.InitializeNetwork(override);\n    };\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ RegisterHandlers() is called before network is started, so they're\n    ready to run. These are server-implemented reserved messages.\n/*/ UNISYS.RegisterHandlers = () => {\n\n      UNET.HandleMessage('SRV_REFLECT',function(pkt) {\n        pkt.Data().serverSays='REFLECTING';\n        pkt.Data().stack.push('SRV_01');\n        if (DBG) console.log(PR,sprint_message(pkt));\n        // return the original packet\n        return pkt;\n      });\n\n      UNET.HandleMessage('SRV_REG_HANDLERS',function(pkt) {\n        if (DBG) console.log(PR,sprint_message(pkt));\n        // now need to store the handlers somehow.\n        let data = UNET.RegisterRemoteHandlers(pkt);\n        // or return a new data object that will replace pkt.data\n        return data;\n      });\n\n      UNET.HandleMessage('SRV_DBGET',function(pkt) {\n        if (DBG) console.log(PR,sprint_message(pkt));\n        return UDB.PKT_GetDatabase(pkt);\n      });\n\n      UNET.HandleMessage('SRV_DBSET', function (pkt) {\n        if (DBG) console.log(PR,sprint_message(pkt));\n        return UDB.PKT_SetDatabase(pkt);\n      });\n\n      /// Add new node/edges to db after an import\n      UNET.HandleMessage('SRV_DBINSERT', function (pkt) {\n        if (DBG) console.log(PR,sprint_message(pkt));\n        return UDB.PKT_InsertDatabase(pkt);\n      });\n\n      /// Update or add new node/edges to db after an import\n      UNET.HandleMessage('SRV_DBMERGE', function (pkt) {\n        if (DBG) console.log(PR,sprint_message(pkt));\n        return UDB.PKT_MergeDatabase(pkt);\n      });\n\n      /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n      /// TEMPLATE / IMPORT / NODE / EDGE EDITOR LOCKING\n      /**\n       * Reports on whether template, import, or node/edge are being edited\n       * @return { templateBeingEdited: boolean, importActive: boolean, nodeOrEdgeBeingEdited: boolean }\n       */\n      UNET.HandleMessage('SRV_GET_EDIT_STATUS', pkt => { // server-database\n        if (DBG) console.log(PR, sprint_message(pkt));\n        const data = UDB.GetEditStatus(pkt);\n        return data;\n      });\n      /**\n       * Requested by Node / Edge Editor when user wants to edit node / edge\n       * @return { templateBeingEdited: boolean, importActive: boolean, nodeOrEdgeBeingEdited: boolean }\n       */\n      UNET.HandleMessage('SRV_REQ_EDIT_LOCK', pkt => { // server-database\n        if (DBG) console.log(PR, sprint_message(pkt));\n        const data = UDB.RequestEditLock(pkt);\n        // Broadcast Lock State\n        UNET.NetCall('EDIT_PERMISSIONS_UPDATE', data);\n        return data;\n      });\n      /**\n       * @return { templateBeingEdited: boolean, importActive: boolean, nodeOrEdgeBeingEdited: boolean }\n       */\n      UNET.HandleMessage('SRV_RELEASE_EDIT_LOCK', pkt => { // server-database\n        if (DBG) console.log(PR, sprint_message(pkt));\n        const data = UDB.ReleaseEditLock(pkt);\n        // Broadcast Lock State\n        UNET.NetCall('EDIT_PERMISSIONS_UPDATE', data);\n        return data;\n      });\n\n\n      /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n      /// TEMPLATE EDITING\n      UNET.HandleMessage('SRV_TEMPLATESAVE', pkt => { // server-database\n        if (DBG) console.log(PR, sprint_message(pkt));\n        UNET.NetCall('NET_TEMPLATE_UPDATE', pkt.data.template); // Broadcast template to other computers on the net\n        return UDB.WriteTemplateTOML(pkt);\n      });\n\n      UNET.HandleMessage('SRV_GET_TEMPLATETOML_FILENAME', () => {\n        return UDB.GetTemplateTOMLFileName();\n      })\n\n      /// Update all EXISTING nodes/edges after a Template edit\n      UNET.HandleMessage('SRV_DBUPDATE_ALL', function (pkt) {\n        if (DBG) console.log(PR, sprint_message(pkt));\n        return UDB.PKT_UpdateDatabase(pkt);\n      });\n\n      /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n      /// NODE/EDGE EDITING\n\n      // receives a packet from a client\n      UNET.HandleMessage('SRV_DBUPDATE',function(pkt) {\n        if (DBG) console.log(PR, sprint_message(pkt));\n        let data = UDB.PKT_Update(pkt);\n        // add src attribute for client SOURCE_UPDATE to know\n        // this is a remote update\n        data.src = 'remote';\n        // fire update messages\n        if (data.node) UNET.NetSend('SOURCE_UPDATE',data);\n        if (data.edge) UNET.NetSend('EDGE_UPDATE', data);\n        if (data.nodeID!==undefined) UNET.NetSend('NODE_DELETE', data);\n        if (data.edgeID!==undefined) UNET.NetSend('EDGE_DELETE',data);\n        // return SRV_DBUPDATE value (required)\n        return { OK:true, info:'SRC_DBUPDATE' };\n      });\n\n      UNET.HandleMessage('SRV_CALCULATE_MAXNODEID',function(pkt) {\n        if (DBG) console.log(PR,sprint_message(pkt));\n        return UDB.PKT_CalculateMaxNodeID(pkt);\n      });\n      UNET.HandleMessage('SRV_DBGETNODEID',function(pkt) {\n        if (DBG) console.log(PR,sprint_message(pkt));\n        return UDB.PKT_GetNewNodeID(pkt);\n      });\n      UNET.HandleMessage('SRV_DBGETNODEIDS',function(pkt) {\n        if (DBG) console.log(PR,sprint_message(pkt));\n        return UDB.PKT_GetNewNodeIDs(pkt);\n      });\n\n      UNET.HandleMessage('SRV_DBLOCKNODE', function (pkt) {\n        if (DBG) console.log(PR, sprint_message(pkt));\n        return UDB.PKT_RequestLockNode(pkt);\n      });\n\n      UNET.HandleMessage('SRV_DBUNLOCKNODE',function(pkt) {\n        if (DBG) console.log(PR,sprint_message(pkt));\n        return UDB.PKT_RequestUnlockNode(pkt);\n      });\n\n      UNET.HandleMessage('SRV_DBLOCKEDGE', function (pkt) {\n        if (DBG) console.log(PR, sprint_message(pkt));\n        return UDB.PKT_RequestLockEdge(pkt);\n      });\n\n      UNET.HandleMessage('SRV_DBUNLOCKEDGE', function (pkt) {\n        if (DBG) console.log(PR, sprint_message(pkt));\n        return UDB.PKT_RequestUnlockEdge(pkt);\n      });\n\n      UNET.HandleMessage('SRV_DBUNLOCKALLNODES', function (pkt) {\n        if (DBG) console.log(PR, sprint_message(pkt));\n        return UDB.PKT_RequestUnlockAllNodes(pkt);\n      });\n      UNET.HandleMessage('SRV_DBUNLOCKALLEDGES', function (pkt) {\n        if (DBG) console.log(PR, sprint_message(pkt));\n        return UDB.PKT_RequestUnlockAllEdges(pkt);\n      });\n      UNET.HandleMessage('SRV_DBUNLOCKALL', function (pkt) {\n        if (DBG) console.log(PR, sprint_message(pkt));\n        const res = UDB.PKT_RequestUnlockAll(pkt);\n        // Broadcast Lock State\n        const data = UDB.GetEditStatus();\n        UNET.NetCall('EDIT_PERMISSIONS_UPDATE', data);\n        return res;\n      });\n\n      UNET.HandleMessage('SRV_CALCULATE_MAXEDGEID',function(pkt) {\n        if (DBG) console.log(PR,sprint_message(pkt));\n        return UDB.PKT_CalculateMaxEdgeID(pkt);\n      });\n      UNET.HandleMessage('SRV_DBGETEDGEID', function (pkt) {\n        if (DBG) console.log(PR,sprint_message(pkt));\n        return UDB.PKT_GetNewEdgeID(pkt);\n      });\n      UNET.HandleMessage('SRV_DBGETEDGEIDS', function (pkt) {\n        if (DBG) console.log(PR,sprint_message(pkt));\n        return UDB.PKT_GetNewEdgeIDs(pkt);\n      });\n\n      UNET.HandleMessage('SRV_LOG_EVENT',function(pkt) {\n        if (DBG) console.log(PR,sprint_message(pkt));\n        return LOGGER.PKT_LogEvent(pkt);\n      });\n\n      // utility function //\n      function sprint_message(pkt) {\n        return `got '${pkt.Message()}' data=${JSON.stringify(pkt.Data())}`;\n      }\n    };\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\tStartNetwork() is called by brunch-server after the Express webserver\n/*/\tUNISYS.StartNetwork = () => {\n      UNET.StartNetwork();\n    };\n\n\n/// EXPORT MODULE DEFINITION //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = UNISYS;\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst React = require('react');\nconst UNISYS = require('unisys/client');\n\n/** REACT COMPONENT **********************************************************\\\n    Used by render()'s <Switch> to load a React component (what we call a\n    'view' in the NetCreate app). The component should return its elements\n    wrapped in a div with the suggested flexbox pr\n\n    index.html           | body          min-height: 100%\n    index.html           | div#app\n    init-appshell        |   div         display:flex, flex-flow:column nowrap,\n                                         width:100%, height:100vh\n    init-appshell        |     Navbar    position:fixed\n    --- COMPONENT BELOW ---\n    <RequiredComponent>  |     div       this is a child of a flexbox\n\\* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */\nclass AppDefault extends React.Component {\n  constructor() {\n    super();\n    /* UNISYS LIFECYCLE INITIALIZATION */\n    // initialize UNISYS before declaring any hook functions\n    UNISYS.SystemInitialize('assets/htmldemos/d3forcedemo');\n  }\n  render() {\n    return (\n    <div style={{display:'flex', flexFlow:'row nowrap',\n         width:'100%', height:'100%'}}>\n      <div id=\"left\" style={{flex:'1 0 auto'}}>\n      </div>\n      <div id=\"middle\" style={{flex:'3 0 auto'}}>\n        <p>AppDefault.jsx</p>\n        <h4>NetCreate welcomes you</h4>\n        <p>This is a work in progress.</p>\n      </div>\n      <div id=\"right\" style={{flex:'1 0 auto'}}>\n      </div>\n    </div>\n    );\n  }\n  componentDidMount () {\n    console.log('AppDefault mounted');\n  }\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = AppDefault;\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/// SYSTEM INTEGRATION ////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst UNISYS      = require('unisys/client');\nconst REFLECT     = require('system/util/reflection');\n/// MAGIC: DevDBLogic will add UNISYS Lifecycle Hooks on require()\nconst LOGIC       = require('./devdb-logic');\nconst {Switch, Route, Redirect, Link} = require('react-router-dom');\n\nvar   DBG         = false;\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst React       = require('react');\nconst ReactStrap  = require('reactstrap');\nconst PROMPTS     = require('system/util/prompts');\nconst PR          = PROMPTS.Pad('DevDB');\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ This is the root component for the view\n/*/ class DevDB extends UNISYS.Component {\n      constructor(props) {\n        super(props);\n        UNISYS.ForceReloadOnNavigation();\n\n        /* INITIALIZE COMPONENT STATE from UNISYS */\n        // get any state from 'VIEW' namespace; empty object if nothing\n        // UDATA.AppState() returns a copy of state obj; mutate/assign freely\n        let state = this.AppState('VIEW');\n        // initialize some state variables\n        state.description = state.description || 'exerciser for database server testing';\n        // REACT TIP: setting state directly works ONLY in React.Component constructor!\n        this.state = state;\n\n        /* UNISYS STATE CHANGE HANDLERS */\n        // bind 'this' context to handler function\n        // then use for handling UNISYS state changes\n        this.UnisysStateChange = this.UnisysStateChange.bind(this);\n        // NOW set up handlers...\n        this.OnAppStateChange('VIEW', this.UnisysStateChange);\n\n      } // constructor\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// UNISYS state change handler - registered by UNISYS.OnStateChange()\n  /// state is coming from UNISYS\n      UnisysStateChange( state ) {\n        if (DBG) console.log(`.. REACT <- state`,state,`via ${this.udata.UID()}'`);\n        // update local react state, which should force an update\n        this.setState(state);\n      }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// COMPONENT state change handler - registered in render()\n  /// state is coming FROM component, which is updating already\n      handleTextChange( event ) {\n        let target = event.target;\n        let state = {\n          description : target.value\n        }\n        if (DBG) console.log(`REACT -> state`,state,`to ${this.udata.UID()}`);\n        this.SetAppState('VIEW',state,this.uni_id);\n      }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// COMPONENT this interface has composed\n      componentDidMount() {\n        // start the application phase\n        let className = REFLECT.ExtractClassName(this);\n        if (DBG) console.log(`${className} componentDidMount`);\n      } // componentDidMount\n\n      StudentRender ({ match }) {\n        console.log('-- STUDENT RENDER --');\n        return (\n          <p style={{color:'red'}}><small>matching subroute: {match.params.unit} {match.params.user}!</small></p>\n        );\n      }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ Try to route the following\n      http://localhost:3000/#dev-unisys/use/student/UNIT_KEY/USER_KEY/\n  /*/ render() {\n        return (\n            <div id='fdshell' style={{padding:'10px'}}>\n              <h2>DB DEVTEST SHELL</h2>\n              <Route path={`${this.props.match.path}/student/:unit/:user`} component={this.StudentRender}/>\n              <p>{this.state.description}</p>\n            </div>\n        );\n      } // render\n\n    } // class DevUnisys\n\n/// EXPORT UNISYS SIGNATURE ///////////////////////////////////////////////////\n/// used in init.jsx to set module scope early\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nDevDB.UMOD = module.id;\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = DevDB;\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n    DevDBLogic is the companion module that implements the console CLI for\n    manipulating the database on the server\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/// SYSTEM LIBRARIES //////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    const SETTINGS      = require('settings');\n    const UNISYS        = require('unisys/client');\n    const DATASTORE     = require('system/datastore');\n\n/// DEBUG SUPPORT /////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    const DBG           = { handler:false };\n    const PROMPTS       = require('system/util/prompts');\n    const JSCLI         = require('system/util/jscli');\n\n/// INITIALIZE MODULE /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    // module 1\n    const PR            = PROMPTS.Pad('DevDBLogic');\n    var   MOD           = UNISYS.NewModule(module.id);\n    var   UDATA         = UNISYS.NewDataLink( MOD );\n\n/// COMPATIBILITY MODES  //////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Provide Compatibility with DevUnisys instances\n/*/ MOD.Hook('INITIALIZE', function () {\n      console.log('*** INITIALIZE ***');\n      // without NET_SEND_TEST:\n      // fail netCallHandlr, netData, netDataAdd, netDataMulti, netDataReturn\n      // fail netSendHndlr\n\n      // spy on NET_SEND_TEST\n      // does not affect tests\n      UDATA.HandleMessage('NET_SEND_TEST',function(data) {\n        console.log(PR,'snooping NET_SEND_TEST data',JSON.stringify(data));\n      });\n      // add NET_CALL_TEST handler\n      // netData passes, but not specific data tests\n      UDATA.HandleMessage('NET_CALL_TEST',function(data) {\n        console.log(PR,'snooping NET_CALL_TEST data',JSON.stringify(data));\n        // add data.stack to pass netDataMulti, netDataReturn\n        if (data.stack===undefined) data.stack = [];\n        data.stack.push(`DBLOGIC_SNOOP`);\n        data.stack.push(`DBLOGIC_SNOOP`);\n        // add data.reply to pass netDataAdd\n        data.reply = 'DBLOGIC_SNOOP';\n        // must return data for promise to return data to handler\n        // otherwise returns null\n        return data;\n      });\n    });\n\n/// APP_READY MESSAGE REGISTRATION ////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ The APP_READY hook is fired after all initialization phases have finished\n    and may also fire at other times with a valid info packet\n/*/ MOD.Hook('APP_READY', function( info ) {\n      console.log('*** APP_READY ***');\n      return new Promise((resolve,reject) => {\n        let timeout = setTimeout(()=>{\n          reject(Error('UNISYS REGISTER TIMEOUT'));\n        },5000);\n        UNISYS.RegisterMessagesPromise()\n        .then((data)=>{\n          clearTimeout(timeout);\n          console.log('RegisterMessagesPromise() registered handlers with server',data);\n          console.log('This SocketUADDR is',UNISYS.SocketUADDR());\n          resolve();\n        });\n      });\n    });\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ MOD.Hook('START', function () {\n      console.log('*** START ***');\n    });\n\n/// COMMAND LINE UTILITIES ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    MOD.Hook('INITIALIZE', () => {\n      JSCLI.AddFunction(ncPushDatabase);\n    });\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Command: RESET THE DATABASE from default data\n/*/ function ncPushDatabase( jsonFile ) {\n      jsonFile = jsonFile || 'data.reducedlinks.json';\n      DATASTORE.PromiseJSONFile(jsonFile)\n      .then((data)=>{\n        // data is { nodes, edges }\n        console.log(PR,`Sending data from ${jsonFile} to Server`,data);\n        // UDATA.Call() returns a promise, so return it to\n        // continue the asynchronous chain\n        return UDATA.Call('SRV_DBSET', data);\n      })\n      .then((d)=>{\n        if (d.OK) {\n          console.log(`${PR} %cServer Database has been overwritten with ${jsonFile}`,'color:blue');\n          console.log(`${PR} Reload apps to see new data`);\n        } else {\n          console.error(PR,'Server Error',d);\n        }\n      });\n      // return syntax help\n      return \"FYI: ncPushDatabase(jsonFile) can load file in assets/data\";\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n/// EXPORT MODULE /////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = MOD;\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/// SYSTEM INTEGRATION ////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst UNISYS      = require('unisys/client');\nconst REFLECT     = require('system/util/reflection');\nconst LOGIC       = require('./devreact-logic');\nconst {Route}     = require('react-router-dom');\n\nvar   DBG         = true;\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst React       = require('react');\nconst PROMPTS     = require('system/util/prompts');\nconst PR          = PROMPTS.Pad('DevReact');\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ This is the root component for the view\n/*/ class DevReact extends UNISYS.Component {\n      constructor(props) {\n        super(props);\n        UNISYS.ForceReloadOnNavigation()\n\n        /* INITIALIZE COMPONENT STATE from UNISYS */\n        // get any state from 'VIEW' namespace; empty object if nothing\n        // UDATA.AppState() returns a copy of state obj; mutate/assign freely\n        let state = this.AppState('VIEW');\n        // initialize some state variables\n        state.description = state.description || 'exerciser for database server testing';\n        // REACT TIP: setting state directly works ONLY in React.Component constructor!\n        this.state = state;\n\n        /* UNISYS STATE CHANGE HANDLERS */\n        // bind 'this' context to handler function\n        // then use for handling UNISYS state changes\n        this.AppStateChange = this.AppStateChange.bind(this);\n        // NOW set up handlers...\n        this.OnAppStateChange('VIEW',this.AppStateChange);\n\n      } // constructor\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// UNISYS state change handler - registered by UNISYS.OnStateChange()\n  /// state is coming from UNISYS\n      AppStateChange( state ) {\n        if (DBG) console.log(`.. REACT <- state`,state,`via ${this.UDATA.UID()}'`);\n        // update local react state, which should force an update\n        this.setState(state);\n      }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// COMPONENT this interface has composed\n      componentDidMount() {\n        // start the application phase\n        let className = REFLECT.ExtractClassName(this);\n        if (DBG) console.log(`${className} componentDidMount`);\n      } // componentDidMount\n\n      StudentRender ({ match }) {\n        console.log('-- STUDENT RENDER --');\n        return (\n          <p style={{color:'red'}}><small>matching subroute: {match.params.unit} {match.params.user}!</small></p>\n        );\n      }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ Try to route the following\n      http://localhost:3000/#dev-unisys/use/student/UNIT_KEY/USER_KEY/\n  /*/ render() {\n        return (\n            <div id='fdshell' style={{padding:'10px'}}>\n              <h2>UNISYS-REACT INTEGRATION TEST SHELL</h2>\n              <Route path={`${this.props.match.path}/student/:unit/:user`} component={this.StudentRender}/>\n              <p>{this.state.description}</p>\n            </div>\n        );\n      } // render\n\n\n    } // class DevUnisys\n\n/// EXPORT UNISYS SIGNATURE ///////////////////////////////////////////////////\n/// used in init.jsx to set module scope early\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nDevReact.UMOD = module.id;\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = DevReact;\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n    const DBG           = { handler:false };\n    const JSCLI         = require('system/util/jscli');\n\n/// SYSTEM LIBRARIES //////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    const SETTINGS      = require('settings');\n    const UNISYS        = require('unisys/client');\n\n/// DEBUG SUPPORT /////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    const PROMPTS       = require('system/util/prompts');\n    const PR            = PROMPTS.Pad('DevReactLogic');\n\n/// INITIALIZE MODULE /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    // module 1\n    var   MOD           = UNISYS.NewModule(module.id);\n    var   UDATA         = UNISYS.NewDataLink( MOD );\n\n/// COMPATIBILITY MODES  //////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Provide Compatibility with DevUnisys instances\n/*/ MOD.Hook('INITIALIZE', function () {\n      console.log('*** INITIALIZE ***');\n    });\n\n\n/// APP START HOOK\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ MOD.Hook('START', function () {\n      console.log('*** START ***');\n  /*/ call counter function 3 times 500ms apart, then check that all tests passed\n      set a periodic timer update\n  /*/ var TESTCOUNTER = 3;\n      var TESTINTERVAL = setInterval( function() {\n        if (--TESTCOUNTER<0) {\n          clearInterval(TESTINTERVAL);\n        }\n        // https://stackoverflow.com/questions/1349404/generate-random-string-characters-in-javascript\n        function u_random_string() {\n          var text = \"\";\n          var possible = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n          for (var i = 0; i < 5; i++) {\n            text += possible.charAt(Math.floor(Math.random() * possible.length));\n          }\n          return text;\n        }\n        let state = { random: u_random_string() };\n        UDATA.SetAppState('VIEW',state,UDATA.UID());\n      },500);\n    });\n\n/// APP_READY HOOK REGISTRATION ///////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ The APP_READY hook is fired after all initialization phases have finished\n    and may also fire at other times with a valid info packet\n/*/ MOD.Hook('APP_READY', function( info ) {\n      info = info || {};\n      console.log('*** APP_READY ***');\n    });\n\n/// COMMAND LINE UTILITIES ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    let CMD = [];\n    MOD.Hook('INITIALIZE', () => {\n      JSCLI.AddFunction(ncTest);\n    });\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Command: RESET THE DATABASE from default data\n/*/ function ncTest( jsonFile ) {\n      return \"ncTest() exiting\";\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n/// EXPORT MODULE /////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = MOD;\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/// SYSTEM INTEGRATION ////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst UNISYS      = require('unisys/client');\nconst REFLECT     = require('system/util/reflection');\n/// MAGIC: DevDBLogic will add UNISYS Lifecycle Hooks on require()\nconst LOGIC       = require('./devsession-logic');\nconst {Switch, Route, Redirect, Link} = require('react-router-dom');\n\nvar   DBG         = false;\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst React       = require('react');\nconst ReactStrap  = require('reactstrap');\nconst PROMPTS     = require('system/util/prompts');\nconst PR          = PROMPTS.Pad('DevSession');\nconst SESSION     = require('unisys/common-session');\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ This is the root component for the view\n/*/ class DevSession extends UNISYS.Component {\n      constructor(props) {\n        super(props);\n        UNISYS.ForceReloadOnNavigation();\n\n        /* INITIALIZE COMPONENT STATE from UNISYS */\n        // get any state from 'VIEW' namespace; empty object if nothing\n        // UDATA.AppState() returns a copy of state obj; mutate/assign freely\n        let state = this.AppState('VIEW');\n        // initialize some state variables\n        state.description = state.description || 'session logic testbed';\n        // REACT TIP: setting state directly works ONLY in React.Component constructor!\n        this.state = state;\n\n        /* UNISYS STATE CHANGE HANDLERS */\n        // bind 'this' context to handler function\n        // then use for handling UNISYS state changes\n        this.UnisysStateChange = this.UnisysStateChange.bind(this);\n        // NOW set up handlers...\n        this.OnAppStateChange('VIEW', this.UnisysStateChange);\n\n      } // constructor\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// UNISYS state change handler - registered by UNISYS.OnStateChange()\n  /// state is coming from UNISYS\n      UnisysStateChange( state ) {\n        if (DBG) console.log(`.. REACT <- state`,state,`via ${this.udata.UID()}'`);\n\n        // update local react state, which should force an update\n        this.setState(state);\n      }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// COMPONENT state change handler - registered in render()\n  /// state is coming FROM component, which is updating already\n      handleTextChange( event ) {\n        let target = event.target;\n        let state = {\n          description : target.value\n        }\n        if (DBG) console.log(`REACT -> state`,state,`to ${this.udata.UID()}`);\n        this.SetAppState('VIEW',state,this.uni_id);\n      }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// COMPONENT this interface has composed\n      componentDidMount() {\n        // start the application phase\n        let className = REFLECT.ExtractClassName(this);\n        if (DBG) console.log(`${className} componentDidMount`);\n      } // componentDidMount\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n      SessionEdit ({ match, location }) {\n        console.log(`SessionEdit edit/${match.params.token}`);\n        let token = match.params.token;\n        let decoded = SESSION.DecodeToken(token);\n        if (decoded) {\n          console.log('DECODED',decoded);\n          return (\n            <div>\n              <p>\n                <small>matching subroute: [{token}]</small><br/>\n                <span style={{color:'green'}}><small>valid token: groupID {decoded.groupId}</small></span>\n              </p>\n            </div>\n          );\n        } else {\n          return (\n            <div>\n              <p>\n                <small>matching subroute: [{token}]</small><br/>\n                <span style={{color:'red'}}><small>COULD NOT DECODE TO VALID GROUP ID</small></span>\n              </p>\n            </div>\n          );\n        }\n      }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ Try to route the following\n      http://localhost:3000/#dev-unisys/use/student/UNIT_KEY/USER_KEY/\n  /*/ render() {\n        return (\n            <div id='fdshell' style={{padding:'10px'}}>\n              <h2>SESSIONS DEV TESTING</h2>\n              <Route path={`${this.props.match.path}/edit/:token`} component={this.SessionEdit}/>\n              <p>{this.state.description}</p>\n            </div>\n        );\n      } // render\n\n    } // class DevUnisys\n\n/// EXPORT UNISYS SIGNATURE ///////////////////////////////////////////////////\n/// used in init.jsx to set module scope early\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nDevSession.UMOD = module.id;\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = DevSession;\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n    DevDBLogic is the companion module that implements the console CLI for\n    manipulating the database on the server\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/// SYSTEM LIBRARIES //////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    const SETTINGS      = require('settings');\n    const UNISYS        = require('unisys/client');\n    const DATASTORE     = require('system/datastore');\n    const SESSION       = require('unisys/common-session');\n    const JSCLI         = require('system/util/jscli');\n\n/// DEBUG SUPPORT /////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    const PROMPTS       = require('system/util/prompts');\n    const DBG           = { handler:false };\n\n/// INITIALIZE MODULE /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    // module 1\n    const PR            = PROMPTS.Pad('DevDBLogic');\n    var   MOD           = UNISYS.NewModule(module.id);\n    var   UDATA         = UNISYS.NewDataLink( MOD );\n\n/// COMPATIBILITY MODES  //////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ MOD.Hook('INITIALIZE', function () {\n      console.log('*** INITIALIZE ***');\n    });\n\n/// APP_READY MESSAGE REGISTRATION ////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ The APP_READY hook is fired after all initialization phases have finished\n    and may also fire at other times with a valid info packet\n/*/ MOD.Hook('APP_READY', function( info ) {\n      console.log('*** APP_READY ***');\n      return new Promise((resolve,reject) => {\n        let timeout = setTimeout(()=>{\n          reject(Error('UNISYS REGISTER TIMEOUT'));\n        },5000);\n        UNISYS.RegisterMessagesPromise()\n        .then((data)=>{\n          clearTimeout(timeout);\n          console.log('RegisterMessagesPromise() registered handlers with server',data);\n          console.log('This SocketUADDR is',UNISYS.SocketUADDR());\n          resolve();\n        });\n      });\n    });\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ MOD.Hook('START', function () {\n      console.log('*** INITIALIZE ***');\n    });\n\n\n/// EXPORT MODULE /////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = MOD;\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/// SYSTEM INTEGRATION ////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst UNISYS      = require('unisys/client');\nconst REFLECT     = require('system/util/reflection');\n/// MAGIC: DevUnisysLogic will add UNISYS Lifecycle Hooks on require()\nconst LOGIC       = require('./devunisys-logic');\nconst {Switch, Route, Redirect, Link} = require('react-router-dom');\n\n\nconst TEST        = require('test');\nvar   DBG         = false;\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst React       = require('react');\nconst ReactStrap  = require('reactstrap');\nconst { InputGroup, InputGroupAddon, InputGroupText, Input } = ReactStrap;\nconst { Alert }   = ReactStrap;\nconst PROMPTS     = require('system/util/prompts');\nconst PR          = PROMPTS.Pad('DevUnisys');\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ This is the root component for the view\n/*/ class DevUnisys extends UNISYS.Component {\n      constructor(props) {\n        super(props);\n        UNISYS.ForceReloadOnNavigation();\n\n        /* INITIALIZE COMPONENT STATE from UNISYS */\n        // get any state from 'VIEW' namespace; empty object if nothing\n        // UDATA.AppState() returns a copy of state obj; mutate/assign freely\n        let state = this.AppState('VIEW');\n        // initialize some state variables\n        state.description = state.description || 'uninitialized description';\n        // REACT TIP: setting state directly works ONLY in React.Component constructor!\n        this.state = state;\n\n        /* LOCAL INTERFACE HANDLERS */\n        this.handleTextChange  = this.handleTextChange.bind(this);\n\n        /* UNISYS STATE CHANGE HANDLERS */\n        // bind 'this' context to handler function\n        // then use for handling UNISYS state changes\n        this.UnisysStateChange = this.UnisysStateChange.bind(this);\n        // NOW set up handlers...\n        this.OnAppStateChange('VIEW', this.UnisysStateChange);\n        this.OnAppStateChange('LOGIC', this.UnisysStateChange);\n\n        /* UNISYS TEST HANDLERS */\n        // note: in a UNISYS.Component, register your handlers in\n        // the constructor\n        if (TEST('remote')) {\n          this.HandleMessage('REMOTE_CALL_TEST',(data) => {\n            data.cat = 'calico';\n            data.melon += '_ack';\n            return data;\n          });\n        }\n        if (TEST('call')) {\n          this.HandleMessage('TEST_CALL',(data)=>{\n            if (!data.stack) data.stack=[]; data.stack.push('TRI-JSX');\n            return data;\n          });\n        }\n\n      } // constructor\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// UNISYS state change handler - registered by UNISYS.OnStateChange()\n  /// state is coming from UNISYS\n      UnisysStateChange( state ) {\n        if (DBG) console.log(`.. REACT <- state`,state,`via ${this.udata.UID()}'`);\n        // update local react state, which should force an update\n        this.setState(state);\n      }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// COMPONENT state change handler - registered in render()\n  /// state is coming FROM component, which is updating already\n      handleTextChange( event ) {\n        let target = event.target;\n        let state = {\n          description : target.value\n        }\n        if (DBG) console.log(`REACT -> state`,state,`to ${this.udata.UID()}`);\n        this.SetAppState('VIEW',state,this.uni_id);\n      }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// COMPONENT this interface has composed\n      componentDidMount() {\n        // start the application phase\n        let className = REFLECT.ExtractClassName(this);\n        if (DBG) console.log(`${className} componentDidMount`);\n\n        /* UNISYS TEST MESSAGE HANDLER INVOCATION */\n        if (TEST('call')) {\n          // INVOKE remove call\n          this.AppCall('TEST_CALL',{ source : 'DevUnisysJSX' })\n          // test data return\n          .then((data)=>{\n            if (data && data.source && data.source==='DevUnisysLogic-Return') TEST.Pass('callDataReturn');\n            if (data && data.extra && data.extra==='AddedData') TEST.Pass('callDataAdd');\n            if (data && data.multi && data.stack && data.stack.length===3 && data.multi==='MultiData') TEST.Pass('callDataMulti');\n          });\n        }\n      } // componentDidMount\n\n      StudentRender ({ match }) {\n        console.log('-- STUDENT RENDER --');\n        return (\n          <p style={{color:'red'}}><small>matching subroute: {match.params.unit} {match.params.user}!</small></p>\n        );\n      }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ Try to route the following\n      http://localhost:3000/#dev-unisys/use/student/UNIT_KEY/USER_KEY/\n  /*/ render() {\n        return (\n            <div id='fdshell' style={{padding:'10px'}}>\n              <h2>Unisys Feature Development Shell</h2>\n              <Route path={`${this.props.match.path}/student/:unit/:user`} component={this.StudentRender}/>\n              <h4>UISTATE TESTS</h4>\n              <p>{this.state.description}</p>\n              <Input type=\"text\" name=\"desc\" id=\"desc\" placeholder=\"text to change\" onChange={this.handleTextChange} />\n              <p>random string from LOGIC: {this.state.random || 'notset'}</p>\n            </div>\n        );\n      } // render\n\n\n    } // class DevUnisys\n\n/// EXPORT UNISYS SIGNATURE ///////////////////////////////////////////////////\n/// used in init.jsx to set module scope early\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nDevUnisys.UMOD = module.id;\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = DevUnisys;\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n    TEST REACT INTEGRATION through UNISYS\n\n    Things that UNISYS has to do:\n    [x] handle startup phases\n    [ ] how to handle the update cycle? need to review bencode\n    [ ] how to handle loading of app settings? punt\n    [ ] using subscribers\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/// SYSTEM LIBRARIES //////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    const SETTINGS      = require('settings');\n    const UNISYS        = require('unisys/client');\n    // master TEST enable is in DevUnisys.JSX constructor()\n    // but most are tested and passed in this module\n    const TEST          = require('test');\n\n/// DEBUG SUPPORT /////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    const DBG           = { handler:false };\n    const PROMPTS       = require('system/util/prompts');\n    const JSCLI         = require('system/util/jscli');\n    // these constants are used in m_StartTests()\n    const TEST_WAIT     = 3000;\n    var   TEST_TIMER    = null;\n\n/// INITIALIZE MODULE /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    // module 1\n    const PR            = PROMPTS.Pad('DUL');\n    var   MOD           = UNISYS.NewModule(module.id);\n    var   UDATA         = UNISYS.NewDataLink( MOD );\n    // module 2\n    var   MOD2          = UNISYS.NewModule(module.id);\n    var   UDATA2        = UNISYS.NewDataLink(MOD2,'SimRemote');\n    const PR2           = PROMPTS.Pad('DUL-REM');\n\n/// CONFIGURE TESTS ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ TEST_CONF lifecycle hook runs before anything else except for unscoped\n    code in a module\n/*/ MOD.Hook('TEST_CONF', function () {\n      /* CONFIGURE UNISYS TESTS */\n      // enable debug output and tests\n      // true = enabled, false = skip\n      TEST('state'  , true);  // state events and changes\n      TEST('hook'   , true);  // lifecycle hooks\n      TEST('call'   , true);  // internal instance calls\n      TEST('remote' , true);  // instance-to-instance calls\n      TEST('server' , true);  // server calls\n      TEST('net'    , true);  // network initialization\n      TEST();\n    });\n\n/// LIFECYCLE TESTS ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ First INITIALIZE Hook takes some time to resolve asynchronously\n    Enable this feature by returning a Promise\n/*/ MOD.Hook('INITIALIZE', function () {\n      if (!TEST('hook')) return Promise.resolve('immediate');\n      TEST.Pass('hookInit1');\n      let tms = 1000;\n      let p = new Promise(function (resolve,reject) {\n        setTimeout(\n          () => {\n            // if a hook returns a promise, then lifecycle waits\n            // until all promises are resolved\n            TEST.Pass('hookInitDeferred');\n            resolve('hookInitDeferred');\n          },\n          tms\n        );\n      }); // new Promise\n      return p;\n    });\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Second INITIALIZE Hook just runs a normal function.\n    Enable this feature by returning a Function\n/*/ MOD.Hook('INITIALIZE', function() {\n      if (TEST('hook')) TEST.Pass('hookInit2');\n    }); // end INITIALIZE 2\n\n\n/// OTHER TESTS ///////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Initialize message handlers during INITIALIZE so we can run them later\n    during START\n/*/ MOD.Hook('INITIALIZE', function() {\n      if (TEST('call')) {\n\n        // 'TEST_CALL' is invoked from DevUnisys.jsx\n        UDATA.HandleMessage('TEST_CALL',(data)=>{\n          if (data && data.source) TEST.Pass('callHndlrReg');\n          if (typeof data==='object') TEST.Pass('callHndlrData');\n          if (typeof data.source==='string' && data.source==='DevUnisysJSX') TEST.Pass('callHndlrDataProp');\n          data.source = 'DevUnisysLogic-Return';\n          if (!data.stack) data.stack=[]; data.stack.push('TRI-1');\n          data.extra = 'AddedData';\n          return data;\n        });\n        // a second 'TEST_CALL' to test aggregate data return\n        UDATA.HandleMessage('TEST_CALL',(data)=>{\n          if (!data.stack) data.stack=[]; data.stack.push('TRI-2');\n          return Object.assign(data,{ multi : 'MultiData' });\n        });\n      }\n\n      // 'REMOTE_CALL_TEST' is invoked from MOD2\n      // note that there are multiple handlers for 'REMOTE_CALL_TEST'\n      // to test collecting data from all of them\n      if (TEST('remote')) {\n        UDATA.HandleMessage('REMOTE_CALL_TEST',(data,ucontrol) => {\n          if (DBG.handler) console.log('REMOTE_CALL_TEST got data',data);\n          TEST.Pass('remoteCall');\n          if (data&&Array.isArray(data.results)) {\n            TEST.Pass('remoteData');\n            data.results.push('UDATA_instance');\n          }\n          // caller should check remoteDataAdd and remoteDataMulti\n          return data;\n        });\n      }\n    }); // end INITIALIZE 3\n\n/// TEST STATE ////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Initialize in module 1\n/*/ MOD.Hook('INITIALIZE', function () {\n      let state = {\n        deep : { deep_a : 1 },\n        arr : [ 1, 3, 2 ],\n        a : 1\n      };\n      UDATA.MergeAppState('testmerge', state);\n      state = {\n        arr : [ 1, 2, 3 ]\n      }\n      UDATA.ConcatAppState('testconcat', state);\n    });\n/*/ Initialize in module 2\n/*/ MOD2.Hook('INITIALIZE', function () {\n      let state = {\n        deep : { deep_b : 2 },\n        arr : [ 10, 11, 12 ],\n        b : 2\n      };\n      UDATA2.MergeAppState('testmerge', state);\n      state = {\n        arr : [ 1, 2, 3 ]\n      }\n      UDATA.ConcatAppState('testconcat', state);\n    });\n/*/ test merging in module 2\n/*/ MOD2.Hook('START', function () {\n      let expected = '{\"deep\":{\"deep_a\":1,\"deep_b\":2},\"arr\":[1,3,2,10,11,12],\"a\":1,\"b\":2}';\n      let serialized = JSON.stringify(UDATA2.AppState('testmerge'));\n      if (expected===serialized) TEST.Pass('stateMerge');\n      expected = '{\"arr\":[1,2,3,1,2,3]}';\n      serialized = JSON.stringify(UDATA.AppState('testconcat'));\n      if (expected===serialized) TEST.Pass('stateConcat');\n      console.log(serialized);\n    });\n\n\n/// APP_READY MESSAGE REGISTRATION ////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ The APP_READY hook is fired after all initialization phases have finished\n    and may also fire at other times with a valid info packet\n/*/ MOD.Hook('APP_READY', function( info ) {\n      info = info || {};\n      if (TEST('hook')) TEST.Pass('hookStart');\n      UNISYS.RegisterMessagesPromise()\n      .then((data)=>{\n        // console.log('RegisterMessagesPromise() registered handlers with server',data);\n        if (TEST('net')) TEST.Pass('netMessageReg');\n      });\n    });\n\n/// SECOND MODULE for MODULE-to-MODULE TESTS //////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ MOD2 is a completely different UNISYS MODULE declaration for ensuring that\n    modules can access data in other modules. Has its own LIFECYCLE naturally.\n    First declare message handlers during INITIALIZE\n/*/ MOD2.Hook('INITIALIZE', function() {\n      if (TEST('remote')) {\n        UDATA2.HandleMessage('REMOTE_CALL_TEST',(data) => {\n          if (data&&Array.isArray(data.results)) {\n            data.results.push('UDATA2_instance');\n            if (DBG.handler) console.log(PR2,'got REMOTE_CALL_TEST message with data',data);\n            TEST.Pass('remoteData2');\n          }\n        });\n      }\n    });\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Now test message handlers during START\n/*/ MOD2.Hook('START', function() {\n      if (TEST('remote')) {\n        // test remote data call (local, not network)\n        UDATA2.LocalCall('REMOTE_CALL_TEST',{ mycat:'kitty',results:[] })\n        .then((data)=>{\n          if (data.mycat==='kitty') TEST.Pass('remoteDataReturn');\n        });\n      }\n    });\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Test State is set during start\n    'test' a,b were set by separate INITIALIZE methods\n    in different modules\n/*/ MOD2.Hook('START', function() {\n      if (TEST('remote')) {\n        // test remote data call (local, not network)\n        UDATA2.LocalCall('REMOTE_CALL_TEST',{ mycat:'kitty',results:[] })\n        .then((data)=>{\n          if (data.mycat==='kitty') TEST.Pass('remoteDataReturn');\n        });\n      }\n    });\n\n\n/// SERVER CALL TESTS /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Now test message handlers during START\n/*/ MOD2.Hook('START', function() {\n      // TEST SERVER NETWORK CALL\n      if (TEST('server')) {\n        // used for order testing\n        let sendorder = [];\n        let recvorder = [];\n        // only test network calls\n        let netOnly = { toLocal : false, toNet : true };\n        for (let i=0; i<5; i++) {\n          setTimeout(function() {\n            sendorder.push(i);\n            UDATA2.Call('SRV_REFLECT',{\n              me    : 'DevUnisysLogic:MOD2.Start',\n              stack : ['DevUnisysLogic'],\n              count : i\n            }, netOnly)\n            .then((data)=>{\n              if (DBG.handler) console.log(PR2,'got SRV_RFLECT',data);\n              TEST.Pass('serverCall');\n              if ((data!==undefined)&&(Array.isArray(data.stack))) TEST.Pass('serverData');\n              if ((data.stack)&&(data.stack.length===2)&&(data.stack[1]==='SRV_01')) TEST.Pass('serverDataAdd');\n              if (data.me && data.me==='DevUnisysLogic:MOD2.Start') TEST.Pass('serverReturn');\n              recvorder.push(data.count);\n            });\n          },Math.random()*1000);\n        }\n        TEST.AssessArrayMatch('serverCallOrder',sendorder,recvorder);\n      } // end TEST('server')\n    });\n\n\n/// UNISYS NETWORK SEND/CALL/SIGNAL TESTS /////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ define test handler\n/*/ MOD2.Hook('INITIALIZE', function() {\n      if (TEST('net')) {\n        UDATA2.HandleMessage('NET_CALL_TEST',(data) => {\n          // console.log(`*** NET_CALL_TEST (1) got data called by ${JSON.stringify(data.stack)} from socket ${UNISYS.SocketUADDR()}`);\n          data.reply=`hi from ${UNISYS.SocketUADDR()}`;\n          if (data.stack===undefined) data.stack = [];\n          data.stack.push(`${UNISYS.SocketUADDR()}_01`);\n          TEST.Pass('netCallHndlr');\n          return data;\n        });\n        UDATA2.HandleMessage('NET_CALL_TEST',(data) => {\n          // console.log(`*** NET_CALL_TEST (2) got data called by ${JSON.stringify(data.stack)} from socket ${UNISYS.SocketUADDR()}`);\n          if (data.stack===undefined) data.stack = [];\n          data.stack.push(`${UNISYS.SocketUADDR()}_02`);\n          return data;\n        });\n        UDATA2.HandleMessage('NET_SIGNAL_TEST',(data) => {\n          if (typeof data.source==='string') TEST.Pass('netSignal');\n          if (data.source===UNISYS.SocketUADDR()) TEST.Pass('netSignalEcho');\n        });\n        UDATA2.HandleMessage('NET_SEND_TEST',(data) => {\n          // send only targets other instances, not the sending one\n          // console.log(`*** NET_SEND_TEST got data called by ${data.source} from socket ${UNISYS.SocketUADDR()}`);\n          if (data.source===UNISYS.SocketUADDR()) {\n            TEST.Fail('netSendNoEcho');\n            // console.log(`*** NET_SEND_TEST fail netSendNoEcho`);\n          } else {\n            // this triggers if the data source DOES NOT MATCH our own data socket\n            TEST.Pass('netSendHndlr');\n            // console.log(`*** NET_SEND_TEST pass netSend`);\n          }\n        });\n      }\n    });\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ invoke test handler on OTHER instance\n/*/ MOD2.Hook('START', function() {\n      setTimeout(delayed_send,2000);\n      // inline function\n      function delayed_send() {\n        if (!TEST('net')) return;\n        let uaddr = UNISYS.SocketUADDR();\n        let greeting = `hi from ${uaddr}`;\n        let call = { test:'netcall', greeting };\n        // test signal\n        UDATA2.NetSignal('NET_SIGNAL_TEST',{ test:'netsignal', source : uaddr });\n        // test call (note this is from UDATA, not UDATA2)\n        UDATA.NetCall('NET_CALL_TEST', call)\n        .then((d)=>{\n          // console.log(`*** NET_CALL_TEST (REPLY) got data returned ${JSON.stringify(d.stack)} from socket ${UNISYS.SocketUADDR()}`);\n          if ((typeof d==='object')&&(!d.NOP)) TEST.Pass('netData');\n          if (typeof d.reply==='string') TEST.Pass('netDataAdd');\n          if (d.greeting===greeting) TEST.Pass('netDataReturn');\n          if (Array.isArray(d.stack) && d.stack.length>1) TEST.Pass('netDataMulti');\n        });\n        // test send\n        UDATA2.NetSend('NET_SEND_TEST',{ test:'netsend', source : uaddr  });\n      }\n    });\n\n/// TEST STARTUP //////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ The START phase executes after INITIALIZE has completed.\n    we register handlers to the VIEW state namespace,\n    and also set different namespace states on timers\n/*/ MOD.Hook('START', function () {\n  /// ASSESS TESTS AFTER TEST_WAIT MS\n      console.log('*** RUNNING UNISYS TESTS ***');\n      TEST.SetTitle('RUNNING TESTS');\n      TEST.SetMeta('socket',UNISYS.SocketUADDR());\n      TEST_TIMER = setTimeout(TEST.Assess,TEST_WAIT);\n\n  /// STATE CHANGE TESTING\n  /*/ register state change handler for 'VIEW' namespace\n  /*/ if (TEST('state')) {\n        UDATA.OnAppStateChange('VIEW',(state)=>{\n          TEST.Pass('stateChange');\n        });\n        // Do the state change test!\n        setTimeout( function () {\n          let state = { description : 'test stateChange succeeded' };\n          UDATA.SetAppState('VIEW',state,UDATA.UID());\n        },1000);\n      } // if TEST state\n\n  /// NETWORK TESTING\n  /*/ remote method invocation of REMOTE_CALL_TEST is expected to return data in a callback\n  /*/ if (TEST('remote')) {\n        UDATA.HandleMessage('REMOTE_CALL_TEST',(data, msgcon) => {\n          // 'REMOTE_CALL_TEST' is also implemented in DevUnisys.jsx\n          // so its return data will be merged with this\n          return { dog : 'spotted' };\n        });\n        // Do the call test!\n        UDATA.LocalCall('REMOTE_CALL_TEST',{melon:'logicmelon'})\n        .then((data) => {\n          if (data && data.melon && data.cat) TEST.Pass('remoteData');\n          if (data.melon==='logicmelon_ack' && data.cat==='calico') TEST.Pass('remoteDataAdd');\n          if (data.dog && data.dog==='spotted') TEST.Pass('remoteDataMulti');\n        });\n      } // if TEST remote\n\n  /*/ call counter function 3 times 500ms apart, then check that all tests passed\n      set a periodic timer update\n  /*/ var TESTCOUNTER = 3;\n      var TESTINTERVAL = setInterval( function() {\n        if (--TESTCOUNTER<0) {\n          clearInterval(TESTINTERVAL);\n        }\n        // https://stackoverflow.com/questions/1349404/generate-random-string-characters-in-javascript\n        function u_random_string() {\n          var text = \"\";\n          var possible = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n          for (var i = 0; i < 5; i++) {\n            text += possible.charAt(Math.floor(Math.random() * possible.length));\n          }\n          return text;\n        }\n        let state = { random: u_random_string() };\n        UDATA.SetAppState('LOGIC',state,UDATA.UID());\n      },500);\n  }); // end START TEST HOOK\n\n\n/// EXPORT MODULE /////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = MOD;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n    NetCreate\n\n    The basic React Component structure of the app looks like this:\n\n        NetCreate\n        +- NodeSelector\n        |  +- NodeDetail\n        |  +- AutoComplete\n        |  |  +- AutoSuggest\n        |  +- EdgeEntry\n        |     +- *AutoComplete (for Target Node)*\n        +- NetGraph\n           +- D3SimpleNetGraph\n              +- D3\n\n    `NetCreate` is the root element. It is a wrapper for the key app\n    elements `NodeSelector` and `NetGraph`.\n\n    It does not do any data or event handling.  Those are handled individually\n    by the respective Components.\n\n  * All state is maintained in `nc-logic.js`\n  * It handles events from NodeSelector, EdgeEntry, and NetGraph components\n      and passes data and upates across them.\n\n    PROPS  ... (none)\n    STATE  ... (none)\n    EVENTS ... (none)\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/// UNISYS INITIALIZE REQUIRES for REACT ROOT /////////////////////////////////\nconst UNISYS       = require('unisys/client');\nconst SessionShell = require('unisys/component/SessionShell');\n\n/// DEBUG SWITCHES ////////////////////////////////////////////////////////////\nvar   DBG          = false;\nconst PROMPTS      = require('system/util/prompts');\nconst PR           = PROMPTS.Pad('ACD');\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst React        = require('react');\nconst { Route }    = require('react-router-dom');\nconst ReactStrap   = require('reactstrap');\nconst { Button } = ReactStrap;\nconst NetGraph     = require('./components/NetGraph');\nconst Search       = require('./components/Search');\nconst NodeSelector = require('./components/NodeSelector');\nconst InfoPanel    = require('./components/InfoPanel');\nconst FiltersPanel = require('./components/filter/FiltersPanel');\nconst NCLOGIC      = require('./nc-logic'); // require to bootstrap data loading\nconst FILTERLOGIC  = require('./filter-logic'); // handles filtering functions\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ class NetCreate extends UNISYS.Component {\n      constructor () {\n        super();\n        UNISYS.ForceReloadOnNavigation();\n        this.state = {\n          isConnected: true,\n          isLoggedIn: false,\n          requireLogin: this.AppState('TEMPLATE').requireLogin,\n          disconnectMsg: '',\n          layoutNodesOpen: true,\n          layoutFiltersOpen: false\n        };\n        this.OnDOMReady(()=>{\n          if (DBG) console.log(PR,'OnDOMReady');\n        });\n        this.OnReset(()=>{\n          if (DBG) console.log(PR,'OnReset');\n        });\n        this.OnStart(()=>{\n          if (DBG) console.log(PR,'OnStart');\n        });\n        this.OnAppReady(()=>{\n          if (DBG) console.log(PR,'OnAppReady');\n        });\n        this.OnRun(()=>{\n          if (DBG) console.log(PR,'OnRun');\n        });\n        this.OnDisconnect((e) => {\n          if (DBG) console.log(PR,'OnDisconnect');\n          // This is now handled by the UDATA \"DISCONNECT\" message.\n          // so that we can show a message explaining the cause of disconnect.\n          // this.setState({ isConnected: false });\n        });\n\n        this.onStateChange_SESSION = this.onStateChange_SESSION.bind(this);\n        this.onDisconnect = this.onDisconnect.bind(this);\n        this.onFilterBtnClick = this.onFilterBtnClick.bind(this);\n\n        this.OnAppStateChange('SESSION', this.onStateChange_SESSION);\n\n        const UDATA = UNISYS.NewDataLink(this);\n        UDATA.HandleMessage(\"DISCONNECT\", this.onDisconnect);\n      }\n\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ SESSION is called by SessionShell when the ID changes\n      Show or hide netgraph depending on template settings.\n  /*/ onStateChange_SESSION( decoded ) {\n        this.setState({ isLoggedIn: decoded.isValid });\n      }\n\n      onDisconnect(e) {\n        const time = new Date().toLocaleTimeString();\n        this.setState({\n          isConnected: false,\n          disconnectMsg: `${e.detail.message} ${time}`\n        });\n      }\n\n  /// REACT LIFECYCLE METHODS ///////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ This is the root component, so this fires after all subcomponents have\n      been fully rendered by render().\n  /*/ componentDidMount () {\n        // Init dragger\n        let dragger = document.getElementById('dragger');\n        dragger.onmousedown = this.handleMouseDown;\n      }\n\n      componentWillUnmount() {\n        this.AppStateChangeOff('SESSION',this.onStateChange_SESSION);\n      }\n\n    /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n      onFilterBtnClick(e) {\n        this.setState(state => {\n          return {layoutFiltersOpen: !state.layoutFiltersOpen}\n        })\n      }\n\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ Define the component structure of the web application\n  /*/ render() {\n        const { isLoggedIn, disconnectMsg, layoutNodesOpen, layoutFiltersOpen } = this.state;\n\n        // show or hide graph\n        // Use 'visibiliity' css NOT React's 'hidden' so size is properly\n        // calculated on init\n        let hideGraph = 'visible';\n        if (this.state.requireLogin && !isLoggedIn) hideGraph = 'hidden';\n\n        return (\n          <div>\n            <div hidden={this.state.isConnected} style={{\n              width: '100%', height: '38px', position: 'fixed',\n              backgroundColor: 'rgba(256,0,0,0.5',\n              display: 'flex', flexDirection: 'column',\n              justifyContent: 'space-evenly', alignItems: 'center', zIndex: '3000'\n            }}>\n              <div style={{color:'#fff',width:'100%',textAlign:'center'}}>\n                <b>{disconnectMsg}!</b> Your changes will not be saved!  Please report \"{disconnectMsg}\" to your administrator to restart the graph.\n              </div>\n            </div>\n            <Route path='/edit/:token' exact={true} component={SessionShell}/>\n            <Route path='/edit' exact={true} component={SessionShell}/>\n            <Route path='/' exact={true} component={SessionShell}/>\n            <div style={{display:'flex', flexFlow:'row nowrap',\n              width: '100%', height: '100vh', overflow: 'hidden',\n              visibility: hideGraph\n            }}>\n              <div id=\"left\" style={{backgroundColor:'#EEE',flex:'1 1 25%',maxWidth:'400px',padding:'10px',overflow:'scroll',marginTop:'38px'}}>\n                <div style={{display:'flex',flexFlow:'column nowrap'}}>\n                  <Search/>\n                  <NodeSelector/>\n                </div>\n              </div>\n              <div id=\"middle\" style={{backgroundColor:'#fcfcfc', flex:'3 0 60%',marginTop:'38px'}}>\n                <InfoPanel/>\n                <NetGraph/>\n                <div style={{fontSize:'10px',position:'fixed',left:'0px',bottom:'0px',right:'0px',zIndex:'1500',color:'#aaa',backgroundColor:'#eee',padding:'5px 10px'}}>Please contact Professor\n                Kalani Craig, Institute for Digital Arts & Humanities at\n                (812) 856-5721 (BH) or\n                craigkl@indiana.edu with questions or concerns and/or to\n                request information contained on this website in an accessible\n                format.</div>\n              </div>\n              {layoutFiltersOpen\n                // OPEN\n                ? <div id=\"right\" style={{\n                    marginTop: '38px', padding: '0 5px', backgroundColor: '#6c757d',\n                    borderTopLeftRadius: '10px', width: 'auto'\n                  }}>\n                    <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'end' }}>\n                      <Button onClick={this.onFilterBtnClick}\n                        style={{ width: '90px' }}\n                      >\n                        FILTER &gt;\n                      </Button>\n                      <FiltersPanel />\n                    </div>\n                  </div>\n                // CLOSED\n                : <div id=\"right\" style={{\n                    marginTop: '38px', paddingTop: '0px', backgroundColor: '#6c757d',\n                    width: '10px', height: '100%'\n                  }}>\n                    <Button\n                      onClick={this.onFilterBtnClick}\n                      style={{ width: '90px', float: 'right' }}\n                    >&lt; FILTER</Button>\n                  </div>\n              }\n            </div>\n          </div>\n        ); // end return\n      } // end render()\n    } // end class NetCreate\n\n/// EXPORT UNISYS SIGNATURE ///////////////////////////////////////////////////\n/// used in init.jsx to set module scope early\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nNetCreate.UMOD = module.id;\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = NetCreate\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n      ## OVERVIEW\n\n      AutoComplete is the text input field for entering node labels to:\n      * search for nodes,\n      * edit existing nodes,\n      * and add new nodes.\n      * view the current selection/setting when searching for a node\n      * view the current selection/setting for an edge source or target\n\n\n\n      ## MAIN FEATURES\n\n      * It interactively provides a list of suggestions that match the current\n        input, e.g. typing \"ah\" will display a list of suggestions including \"Ah\n        Long\", \"Ah Seung\", and \"Oahu Railroad Station\".\n\n      * Users can highlight suggestions (via mouseover or with keyboard arrows)\n\n      * Users can select a suggestion (via clicking or hitting return)\n\n      * Only one AutoComplete component can be active at a time in an app.\n        Since there can be multiple AutoComplete components on a single page\n        (e.g. multiple edges along with the source), we disable the component\n        when it isn't active.\n\n      * When the AutoComplete component is disabled, it will display a\n        generic INPUT component instead of the Autosuggest component.\n\n      * When the AutoComplete component is disabled, since it will not\n        receive SELECTION updates, we need to pass it the current field\n        value via the this.props.disabledValue.\n\n      AutoComplete is a wrapper class for the open source AutoSuggest component,\n      which handles the actual rendering of the suggestions list.  AutoComplete\n      provides an interface to NodeSelector and EdgeEntry.  AutoComplete also\n      provides the handler routines for generating the suggestions list and\n      handling highlights and selections.  Data is passed to AutoComplete via\n      UDATA SELECTION state changes.\n\n      This relies on the react-autosuggest component.\n      See documentation: https://github.com/moroshko/react-autosuggest\n\n\n\n      ## TO USE\n\n          <AutoComplete\n            isDisabled={this.state.canEdit}\n            disabledValue={this.state.formData.label}\n            inactiveMode={'disabled'}\n          />\n\n\n\n      ## TECHNICAL DESCRIPTION\n\n      AutoComplete handles five basic functions:\n\n      1. Show suggestions when the user types in the input search field.\n      2. Mark nodes on graph when the user changes the search field.\n      3. Set selection when user clicks on a suggestion.\n      4. Show the label if the node is selected externally\n         (via a click on the graph)\n      5. Provide an edit field for the label when the user is editing a node\n         (during edit, show suggestions, but don't select anything?)\n\n      The Autosuggest input field is a controlled field.\n      It is controlled via this.state.value.\n      See https://reactjs.org/docs/forms.html#controlled-components\n\n      Sequence of Events\n\n      1. When the user types in the Autosuggest input field,\n      2. AutoComplete makes a UDATA SOURCE_SEARCH call\n      3. nc-logic handles the call and returns a SELECTION state update\n      4. AutoComplete then sets the Autosuggest input field value via\n         this.state.value.\n      5. The updated SELECTION state also contains a list of\n         suggestedNodeLabels that is used by Autosuggest whenever it\n         requests a list of suggestions.\n\n\n\n      ## HIGHLIGHTING vs MARKING\n\n      \"Highlighting\" refers to the temporary rollover highlight of a suggested node\n      in the suggestion list.  \"Marking\" refers to the stroked color of a node\n      circle on the D3 graph.\n\n\n\n      ## PROPS\n\n      identifier\n\n            A unique ID for identifying which AutoComplete component is active\n            within the whole app system.\n\n      disabledValue\n\n            When the AutoComplete component is not active, it should display\n            the currently selected node (rather than be an active input field\n            for selecting a new node).  This is the label for that node.\n\n      inactiveMode\n\n            When the AutoComplete component is not active, it can be either\n            'static' or 'disabled' depending on the parent field.  This prop\n            sets which of these modes the field should default to:\n\n            'static'   -- an unchangeable field, e.g. the Source node for an\n                          edge is always going to be the Source label.  It\n                          cannot be changed.\n            'disabled' -- a changeable field that is not currently activated,\n                          e.g. the Target node for an edge.\n\n      shouldIgnoreSelection\n\n            Used by NodeSelector and EdgeEditor's target node field\n            to prevent user from selecting another node\n            while editing a node.\n\n      Based on example code from https://codepen.io/moroshko/pen/vpBzMr\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nvar DBG = false;\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst React       = require('react');\nconst ReactStrap  = require('reactstrap');\nconst { Input }   = ReactStrap;\nconst Autosuggest = require('react-autosuggest');\n\nconst UNISYS      = require('unisys/client');\n\nconst MODE_STATIC   = 'static';   // Can't be edited ever\nconst MODE_DISABLED = 'disabled'; // Can be edited, but not at the moment\nconst MODE_LINK     = 'link';     // Can be edited, but not at the moment, and it links to a view until then\nconst MODE_ACTIVE   = 'active';   // Currently able to edit\n\nvar   _IsMounted  = false;\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// export a class object for consumption by brunch/require\nclass AutoComplete extends UNISYS.Component {\n\n    constructor() {\n      super();\n      this.state = {\n        value       : '',\n        suggestions : [],\n        id          : '',\n        mode        : MODE_DISABLED\n      };\n\n      this.onStateChange_SEARCH        = this.onStateChange_SEARCH.bind(this);\n      this.onStateChange_SELECTION     = this.onStateChange_SELECTION.bind(this);\n      this.onStateChange_AUTOCOMPLETE  = this.onStateChange_AUTOCOMPLETE.bind(this);\n      this.onInputChange               = this.onInputChange.bind(this);\n      this.getSuggestionValue          = this.getSuggestionValue.bind(this);\n      this.renderSuggestion            = this.renderSuggestion.bind(this);\n      this.onSuggestionsFetchRequested = this.onSuggestionsFetchRequested.bind(this);\n      this.onSuggestionsClearRequested = this.onSuggestionsClearRequested.bind(this);\n      this.onSuggestionSelected        = this.onSuggestionSelected.bind(this);\n      this.onSuggestionHighlighted     = this.onSuggestionHighlighted.bind(this);\n      this.shouldRenderSuggestions     = this.shouldRenderSuggestions.bind(this);\n      this.onBlur                      = this.onBlur.bind(this);\n\n      // NOTE: do this AFTER you have used bind() on the class method\n      // otherwise the call will fail due to missing 'this' context\n      this.OnAppStateChange('SEARCH',             this.onStateChange_SEARCH);\n      this.OnAppStateChange('SELECTION',          this.onStateChange_SELECTION);\n      this.OnAppStateChange('ACTIVEAUTOCOMPLETE', this.onStateChange_AUTOCOMPLETE);\n\n    } // constructor\n\n/// UNISYS STATE CHANGE HANDLERS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n/*/ 'SEARCH' handler\n/*/ onStateChange_SEARCH ( data ) {\n      // grab entire global state for 'SELECTION\n      // REVIEW // autocompleteid probab;y should be stored elsewhere or use a\n      // different mechanism\n      if (DBG) console.log('AutoComplete',this.props.identifier,': Got SEARCH',data);\n      let { activeAutoCompleteId } = this.AppState('ACTIVEAUTOCOMPLETE');\n      if (activeAutoCompleteId===this.props.identifier) {\n        // This is the currently active AutoComplete field\n        // Update the autosuggest input field's value with the current search data\n        if (DBG) console.log('...AutoComplete',this.props.identifier,': ACTIVE setting search value to',data.searchLabel);\n        if (data.searchLabel!==undefined) {\n          this.setState({\n            mode  : MODE_ACTIVE,\n            value : data.searchLabel\n          });\n        }\n      } else {\n        // This is not the active AutoComplete field\n        // Use the disabledValue prop to display\n        // REVIEW: this probably is handled better in render()\n        if (_IsMounted) {\n          if (DBG) console.log('...AutoComplete',this.props.identifier,': NOT ACTIVE setting search value to',this.props.disabledValue);\n          this.setState({\n            mode    : this.props.inactiveMode,\n            value   : this.props.disabledValue\n          });\n        } else {\n          if (DBG) console.log('...AutoComplete',this.props.identifier,': NOT ACTIVE, but skipping update because component is unmounted');\n        }\n      }\n    } // onStateChange_SEARCH\n\n/*/ 'SELECTION' handler\n    Update this AutoComplete input value when the currently selected SELECTION has changed\n    AND we are active and have the current activeAutoCompleteId.\n    This is especially important for when adding a target field to a new EdgeEditor.\n/*/ onStateChange_SELECTION ( data ) {\n      if (DBG) console.log('...AutoComplete',this.props.identifier,': Got SELECTION',data);\n      if (this.props.shouldIgnoreSelection) {\n        if (DBG) console.log('...AutComplete',this.props.identifier,': Ignoring SELECTION (probably because NodeSelector is in edit mode).');\n        return;\n      }\n      let activeAutoCompleteId = this.AppState('ACTIVEAUTOCOMPLETE').activeAutoCompleteId;\n      if ( (this.props.identifier===activeAutoCompleteId) ||\n           (activeAutoCompleteId==='search') ) {\n        // Update the searchLabel if either this nodeSelector or the 'search' field is\n        // is the current active AutoComplete field.\n        // We only ignore SELECTION updates if an edge target field has the current focus.\n        // This is necessary for the case when the user clicks on a node in the D3 graph\n        // and the search field has the current AutoComplete focus.  Otherwise the state.value\n        // is never updated.\n        if (DBG) console.log('...AutoComplete',this.props.identifier,': ACTIVE got SELECTION');\n        let nodes = data.nodes;\n        if (nodes!==undefined &&\n            nodes.length>0 &&\n            nodes[0]!==undefined &&\n            nodes[0].label!==undefined) {\n          let searchLabel = nodes[0].label;\n          if (DBG) console.log('...AutoComplete',this.props.identifier,': ACTIVE got SELECTION, searchLabel',searchLabel);\n          // FIX: This line causes the \"Can't call setState (or forceUpdate) on an unmounted component\" error\n          // is it because it's not actually visible (unmounted)?\n          this.setState({value: searchLabel});\n        }\n      }\n    }\n\n/*/ 'AUTOCOMPLETE' handler\n    Update this AutoComplete state when the currently selected AUTOCOMPLETE field has changed\n/*/ onStateChange_AUTOCOMPLETE ( data ) {\n      if (DBG) console.log('...AutoComplete',this.props.identifier,': Got AUTOCOMPLETE',data);\n      let mode = this.state.mode;\n      if (data.activeAutoCompleteId === this.props.identifier) {\n        mode = MODE_ACTIVE;\n      } else {\n        mode = this.props.inactiveMode;\n      }\n      this.setState({mode: mode});\n    }\n\n/// AUTOSUGGEST HANDLERS ////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Handle Autosuggest's input event trigger\n    User has typed something new into the field\n/*/ onInputChange (event, { newValue, method }) {\n      // Pass the input value (node label search string) to UDATA\n      // which will in turn pass the searchLabel back to the SEARCH\n      // state handler in the constructor, which will in turn set the state\n      // of the input value to be passed on to AutoSuggest\n      this.AppCall('SOURCE_SEARCH', { searchString: newValue });\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Handle Autosuggest's request to set the value of the input field when\n    a selection is clicked.\n/*/ getSuggestionValue (suggestion) {\n      return suggestion.label;\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Handle Autosuggest's request for HTML rendering of suggestions\n/*/ renderSuggestion (suggestion) {\n      return suggestion.label;\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Handle Autosuggest's request for list of suggestions\n    lexicon =  string array of node labels\n\n    lexicon is a one-dimensional string array that represents the complete list\n    of all possible suggestions that are then filtered based on the user typing\n    for suggestions.\n\n    We construct the list on the fly based on the NCDATA data.  If the data model\n    changes, we'll need to update this lexicon constructor.\n/*/ onSuggestionsFetchRequested () {\n      let data = this.AppState('SEARCH');\n      if (data.suggestedNodes) {\n        this.setState({\n          suggestions: (data.suggestedNodes)\n        });\n      } else {\n        if (DBG) console.log('AutoComplete.onSuggestionsFetchRequested: No suggestions.');\n      }\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Handle Autosuggest's request to clear list of suggestions\n/*/ onSuggestionsClearRequested () {\n      this.setState({\n        suggestions: []\n      });\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Autosuggest's callback when a selection is made\n    If a new value is suggested, we call SOURCE_SELECT.\n    Autocomplete-logic should handle the creation of a new data object.\n/*/ onSuggestionSelected (event, { suggestion }) {\n      // User selected an existing node in the suggestion list\n      this.AppCall('SOURCE_SELECT',{ nodeIDs: [suggestion.id] });\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Autosuggest calls this whenever the user has highlighted a different suggestion\n    from the suggestion list.\n/*/ onSuggestionHighlighted ({ suggestion }) {\n      if (suggestion && suggestion.id) this.AppCall('SOURCE_HILITE',{ nodeID: suggestion.id });\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Autosuggest checks this before rendering suggestions\n    Set the prop to turn off suggestions\n/*/ shouldRenderSuggestions (value) {\n      return this.state.mode===MODE_ACTIVE;\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ The AutoComplete field has lost focus.\n    Check to see if it references a valid node, if so, select it\n/*/ onBlur (value) {\n      // User selected an existing node in the suggestion list\n      // or User clicked on d3 graph\n      // or User clicked outside of field\n      if (DBG) console.log('AutoComplete.onBlur',value);\n      this.AppCall('SOURCE_SEARCH_AND_SELECT', { searchString: this.state.value } );\n    }\n\n/// REACT LIFECYCLE /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ AutoComplete fields are routinely constructed and deconstructed as different\n    edges and nodes are selected.  We need to keep track of whether it's\n    mounted or not so that we know when it's valid to call setState.  Otherwise\n    we might call setState on an unmounted component and generate a React warning.\n    https://reactjs.org/blog/2015/12/16/ismounted-antipattern.html\n/*/ componentDidMount () {\n      _IsMounted = true;\n      this.setState({ mode: this.props.inactiveMode });\n    }\n/*/\n/*/\n  componentWillUnmount() {\n    _IsMounted = false;\n    // deregister ACTIVEAUTOMPLETE when component unmounts\n    // otherwise state updates trigger a setState on unmounted component error\n    this.AppStateChangeOff('SEARCH',             this.onStateChange_SEARCH);\n    this.AppStateChangeOff('SELECTION',          this.onStateChange_SELECTION);\n    this.AppStateChangeOff('ACTIVEAUTOCOMPLETE', this.onStateChange_AUTOCOMPLETE);\n  }\n\n/*/ Conditionally render components based on current 'mode'. The mode\n    is passed\n/*/ render () {\n      const { value, suggestions } = this.state;\n      const inputProps = {\n        placeholder : this.props.placeholder || 'Type node name...',\n        value       : value,\n        onChange    : this.onInputChange,\n        onBlur      : this.onBlur\n      };\n      let jsx;\n\n      // Show different widgets depending on mode.\n      // If MODE_ACTIVE is just show the active state,\n      // otherwise, use the current inactive mode in this.props.inactiveMode\n      // to define the inactive state\n      // because this.state.mode may not be up to date if the mode is inactive\n      // due to prop changes not triggering mode updates.\n      // e.g. if the parent container changed props from a disabled to\n      // static state, it does not trigger a mode update in AUTOCOMPLETE.\n      // This is mostly an edge case with EDGE_EDITs which will update props\n      // without a corresponding UNISYS message call to trigger the mode\n      // change.\n      if (this.state.mode === MODE_ACTIVE) {\n        jsx = (\n          <Autosuggest\n            suggestions={suggestions}\n            shouldRenderSuggestions={this.shouldRenderSuggestions}\n            // Map to Local Handlers for Autosuggest event triggers (requests)\n            onSuggestionsFetchRequested={this.onSuggestionsFetchRequested}\n            onSuggestionsClearRequested={this.onSuggestionsClearRequested}\n            getSuggestionValue={this.getSuggestionValue}\n            renderSuggestion={this.renderSuggestion}\n            // Receive Data from Autosuggest\n            onSuggestionHighlighted={this.onSuggestionHighlighted}\n            onSuggestionSelected={this.onSuggestionSelected}\n            // Pass Data to Autosuggest\n            inputProps={inputProps}\n          />\n        );\n      } else if (this.props.inactiveMode === MODE_STATIC) {\n        jsx = (<p>{this.props.disabledValue}</p>);\n      } else if (this.props.inactiveMode === MODE_DISABLED) {\n        jsx = (<Input type=\"text\" value={this.props.disabledValue} readOnly={true} />);\n      } else if (this.props.inactiveMode === MODE_LINK){\n      jsx = (<a href=\"#\" onClick={(e)=>this.selectNode(this.props.linkID,e)}>{this.props.disabledValue}</a>);\n      } else {\n        throw Error(`AutoComplete: Unhandled mode '${this.state.mode}'`);\n      }\n\n      // OLD METHOD\n      // This relied on mode being updated, but a change in props does not\n      // trigger a corresponding change in mode.\n      // switch (this.state.mode) {\n      //   case MODE_STATIC:\n      //     jsx = ( <p>{this.props.disabledValue}</p> );\n      //     break;\n      //   case MODE_DISABLED:\n      //     jsx = ( <Input type=\"text\" value={this.props.disabledValue} readOnly={true}/> );\n      //     break;\n      //   case MODE_ACTIVE:\n      //     jsx = (\n      //       <Autosuggest\n      //         suggestions={suggestions}\n      //         shouldRenderSuggestions={this.shouldRenderSuggestions}\n      //         // Map to Local Handlers for Autosuggest event triggers (requests)\n      //         onSuggestionsFetchRequested={this.onSuggestionsFetchRequested}\n      //         onSuggestionsClearRequested={this.onSuggestionsClearRequested}\n      //         getSuggestionValue={this.getSuggestionValue}\n      //         renderSuggestion={this.renderSuggestion}\n      //         // Receive Data from Autosuggest\n      //         onSuggestionHighlighted={this.onSuggestionHighlighted}\n      //         onSuggestionSelected={this.onSuggestionSelected}\n      //         // Pass Data to Autosuggest\n      //         inputProps={inputProps}\n      //       />\n      //     );\n      //     break;\n      //   default:\n      //     throw Error(`AutoComplete: Unhandled mode '${this.state.mode}'`);\n      // }\n\n      return jsx;\n    } // render()\n\n    selectNode (id, event) {\n      event.preventDefault();\n      // REVIEW: For some reason React converts the integer IDs into string\n      // values when returned in event.target.value.  So we have to convert\n      // it here.\n      // Load Source\n      var UDATA = UNISYS.NewDataLink(this);\n      UDATA.LocalCall('EDGE_CLOSE');\n      UDATA.LocalCall('SOURCE_SELECT',{ nodeIDs: [parseInt(id)] });\n    }\n\n/// END OF CLASS //////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = AutoComplete;\n\n\n\n","/* eslint-disable complexity */\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  ## OVERVIEW\n\n    EdgeEditor is used to to view, edit, and create new edges.\n\n    The EdgeEditor has two basic views:\n\n    1. Minimized Summary view displays just the source and target node info.\n    2. Expanded View shows the full edge information.\n\n    You can get an expanded view by clicking on the minized view.\n    The expanded view has two modes:\n\n    1. View Mode displays the edge data but does not allow editing.\n    2. Edit Mode displays an editable form.\n\n    We assume that when you create an edge, you will have already identified\n    the source node, so the source node is never editable.\n\n    We assume that once you create an edge, the only editing you might do\n    is to change the relationship, notes, and citations.  You wouldn't\n    change the source or target nodes.  If you need to change them, you'd\n    use DELETE.\n\n\n  ## TO USE\n\n    EdgeEditors are usually included as a repeating element, e.g.\n\n      <FormText>EDGES</FormText>\n      {this.state.edges.map( (edge,i) =>\n        <EdgeEditor key={i}\n          edgeID={edge.id}\n          parentNodeLabel={this.state.formData.label}\n        />\n      )}\n\n\n  ## PROPS\n\n    edgeID            edgeID provides a unique identifier for the EdgeEditor\n                      displaying the particular edge.  The edgeID is\n                      used to also uniquely identify the AutoComplete\n                      fields within the EdgeEditor.\n\n    parentNodeLabel   parentNodeLabel is the label of the source node that\n                      the EdgeEditor is displayed within.  This is used\n                      by the EdgeEditor to determine whether it should\n                      display the edge nodes as targets or sources.\n\n    parentNodeIsLocked The parent node is locked when the server disconnects\n                       this will disable the Delete and Edit buttons.\n\n  ## STATES\n\n      dbIsLocked\n                      If someone else has selected the edge for editing,\n                      this flag will cause the dbIsLockedMessage\n                      to be displayed.  This is only checked when\n                      the user clicks \"Edit\".\n\n      disableEdit     Template is being edited, disable \"Edit Edge\" button\n\n      isBeingEdited   The form fields are active and text can be changed.\n\n\n  ## TECHNICAL DESCRIPTION\n\n    EdgeEditor works directly with raw NCDATA, unprocessed by d3.\n    This means that `edge.source` and `edge.target` are IDs, NOT the node objects\n    that d3 will convert them into.\n\n\n  ## TESTING\n\n\n    Displaying Current Edge(s)\n        0. When the app starts, no edges should be displayed in the Node Selector.\n        1. Click on \"Board of Health\"\n              * A summary view of the four nodes connected to Board of Health\n                should be displayed.\n        2. Click on \"me -> Residents of Chinatown\"\n              * The form information should be displayed, including ID,\n                relationship, info, and notes.\n              * The form fields should be disabled (not able to be edited)\n              * A \"Done\" button should appear.\n              * A \"Edit Edge\" button should appear.\n        3. Click \"Done\"\n              * The \"Residents of Chinatown\" edge editor should collapse.\n              * The other 3 Board of Health edges should still be dispalyed.\n        4. Click outside of \"Board of Health\"\n              * All edges should be removed.\n        5. Click on a node without an edge, e.g. \"Ah Sop\"\n              * No edges should be displayed\n              * The \"Add New Edge\" button should be displayed in the EDGES area.\n\n    Edit Existing Edge\n        1. Click on \"Board of Health\"\n        2. Click on \"me -> Residents of Chinatown\"\n        3. Click on \"Edit Edge\"\n              * The \"NOTES\" and \"DATE\" fields will become editable.\n        4. Click \"Save\"\n        5. Select the updated edge.\n              * The changed notes and dates should appear.\n\n    Create New Edge\n        1. Click on \"Board of Health\"\n        2. Click on \"Add New Edge\"\n              * \"Board of Health\" should be automatically set as the Source field\n              * A new ID \"59\" should be automatically inserted.\n              * All fields except \"Source\" and \"ID\" should be editable.\n              * A \"Save\" button should appear.\n              * A \"Done\" button should NOT appear.\n        3. Select a Type\n              * There should be multiple type options available.\n        4. Select a Target\n              * The AutoComplete field should allow typing.\n              * As you type you should see suggestions.\n              * Each suggestion should be marked in the graph\n              * You should be able to click on a suggestion from\n                the suggestions list, or use the keyboard to\n                select a suggestion.\n        5. Type in some info.\n              * The field text should update with whatever you type.\n        6. Type in some notes.\n              * The field text should update with whatever you type.\n        7. Click \"Save\"\n              * The selected target node should be connected to Board of Health\n                in the graph.\n              * The EdgeEditor form should be cleared.\n              * The NodeSelector form should be cleared.\n        8. Click on \"Board of Health\"\n              * The new edge should be displayed as one of the edges.\n        9. Click on the new target node summary view\n              * You should see the relationship, type, and info changes.\n        10. Click on the new target node in the graph\n              * You should see the component along with an edge\n                linked to \"Board of Health\"\n\n    Delete Edge\n        1. Click on \"Board of Health\"\n        2. Click on \"me -> Residents of Chinatown\"\n        3. Click on \"DELETE\"\n              * The edge should be removed.\n              * The graph should update with the edge remvoed.\n              * The EdgeEditor for the deleted edge shoudl close.\n              * The source node should remain selected.\n              * The non-deleted edges should still be listed.\n\n    Swap\n        1. Select an edge where the node is the source (the edge should read \"this -> OtherNode\".\n        2. Click \"Edit Edge\"\n              * You should see a swap button with up/down arrows and a \"Change Target\" button.\n        3. Click on the swap button\n              * The selected node should now be the target.\n        4. Click \"Save\" to save the change.\n        5. Review the node to make sure the change took place.\n        6. Reload the graph to make sure the change was saved.\n\n    Change Target\n        1. Select an edge where the node is the source (the edge should read \"this -> OtherNode\".\n        2. Click \"Edit Edge\"\n              * You should see a swap button with up/down arrows and a \"Change Target\" button.\n        3. Click on the \"Change Target\" button\n              * You should be able to search for another target node, or click on the graph to select a target node.\n        4. When you've selected a target node, the Target Node field should become disabled (light blue, can't type in it).\n        5. Click on \"Change Target\" again to pick a different target.\n        6. Click \"Save\" to save the change.\n        7. Review the node to make sure the change took place.\n        8. Reload the graph to make sure the change was saved.\n\n    Change Source\n        1. Select an edge where the node is the source (the edge should read \"this -> OtherNode\".\n        2. Click \"Edit Edge\"\n              * You should see a \"Change Source\" button next to the source, and just the swap button next to the target.\n        3. Click on the \"Change Source\" button\n        4. You should be able to search for another source node, or click on the graph to select a source node.\n        5. When you've selected a source node, the Source Node field should become disabled (light blue, can't type in it).\n        6. Click on \"Change Source\" again to pick a different source.\n        7. Click \"Save\" to save the change.\n        8. Review the node to make sure the change took place.\n        9. Reload the graph to make sure the change was saved.\n\n    Save\n        * The \"Save\" button should only be visible when the edge is being edited\n        * The \"Save\" button should only be enabled if both the Source and Target\n          fields point to valid nodes.\n        * Otherwise, the \"Save\" button should be disabled.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nimport { mdReact } from 'markdown-react-js';\nconst mdplugins = {\n  emoji: require('markdown-it-emoji')\n};\n\nconst DBG = false;\nconst PR  = \"EdgeEditor\";\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst React        = require('react');\nconst ReactStrap   = require('reactstrap');\nconst { Button, Col, Form, FormGroup, FormText, Input, Label } = ReactStrap;\nconst AutoComplete = require('./AutoComplete');\nconst NodeDetail   = require('./NodeDetail');\n\nconst UNISYS   = require('unisys/client');\nconst { EDITORTYPE } = require(\"system/util/enum\");\nvar   UDATA    = null;\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// export a class object for consumption by brunch/require\nclass EdgeEditor extends UNISYS.Component {\n    constructor (props) {\n      super(props);\n      const TEMPLATE = this.AppState('TEMPLATE');\n      this.state = {\n        edgeDefs: TEMPLATE.edgeDefs,\n        citation: TEMPLATE.citation,\n        edgeIsLockedMessage: TEMPLATE.edgeIsLockedMessage,\n        editLockMessage: '',\n        formData: {                 // Holds the state of the form fields\n          sourceId:     '',\n          targetId:     '',\n          type: '',\n          info:         '',\n          notes:        '',\n          citation:     '',\n          category:     '',\n          id:           '',\n          isNewEdge:    true\n        },\n        sourceNode: {               // Holds the current selected source node\n            label:     '',\n            type:      '',\n            info:      '',\n            notes:     '',\n            id:        ''\n        },\n        targetNode: {               // Holds the current selected target node\n            label:     '',\n            type:      '',\n            info:      '',\n            notes:     '',\n            id:        ''\n        },\n        isLocked:        true,       // User has not logged in, don't allow edge edit\n        isStandalone: false,         // Standalone mode, view only\n        dbIsLocked:      false,      // Server Database is locked because someone else is editing\n        disableEdit: false,          // Template is being edited, disable \"Edit Edge\" button\n        isBeingEdited: false,        // Form is in an editable state\n        isExpanded:      false,      // Show EdgeEditor Component in Summary view vs Expanded view\n        sourceIsEditable:false,      // Source ndoe field is only editable when source is not parent\n        hasValidSource:  false,      // Used by SwapSourceAndTarget and the Change Source button\n        targetIsEditable:false,      // Target ndoe field is only editable when target is not parent\n        hasValidTarget:  false,      // Used by SwapSourceAndTarget and the Change Target button\n        placeholder:     undefined,\n        hideModal: true              // used by the citation window\n      };\n\n      /// Initialize UNISYS DATA LINK for REACT\n      UDATA = UNISYS.NewDataLink(this);\n\n      this.setTemplate = this.setTemplate.bind(this);\n      this.updateEditState = this.updateEditState.bind(this);\n      this.setEditState = this.setEditState.bind(this);\n      this.handleSelection        = this.handleSelection.bind(this);\n      this.handleEdgeSelection    = this.handleEdgeSelection.bind(this);\n      this.handleEdgeEdit         = this.handleEdgeEdit.bind(this);\n      this.handleEdgeClose = this.handleEdgeClose.bind(this);\n      this.onStateChange_SESSION  = this.onStateChange_SESSION.bind(this);\n      this.onEdgeClick            = this.onEdgeClick.bind(this);\n      this.onDeleteButtonClick    = this.onDeleteButtonClick.bind(this);\n      this.onEditButtonClick      = this.onEditButtonClick.bind(this);\n      this.onCiteButtonClick      = this.onCiteButtonClick.bind(this);\n      this.onCloseCiteClick       = this.onCloseCiteClick.bind(this);\n      this.dateFormatted          = this.dateFormatted.bind(this);\n      this.requestEdit            = this.requestEdit.bind(this);\n      this.onSwapSourceAndTarget  = this.onSwapSourceAndTarget.bind(this);\n      this.onChangeSource         = this.onChangeSource.bind(this);\n      this.onChangeTarget         = this.onChangeTarget.bind(this);\n      this.onRelationshipChange   = this.onRelationshipChange.bind(this);\n      this.onNotesChange          = this.onNotesChange.bind(this);\n      this.onInfoChange           = this.onInfoChange.bind(this);\n      this.onCitationChange       = this.onCitationChange.bind(this);\n      this.onCategoryChange       = this.onCategoryChange.bind(this);\n      this.onSubmit               = this.onSubmit.bind(this);\n      this.checkUnload            = this.checkUnload.bind(this);\n      this.doUnload               = this.doUnload.bind(this);\n\n      // Always make sure class methods are bind()'d before using them\n      // as a handler, otherwise object context is lost\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ SESSION is called by SessionShell when the ID changes\n      set system-wide. data: { classId, projId, hashedId, groupId, isValid }\n  /*/ this.OnAppStateChange('SESSION', this.onStateChange_SESSION);\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n      this.OnAppStateChange('SELECTION', this.handleSelection);\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n      UDATA.HandleMessage('EDGE_SELECT', this.handleEdgeSelection);\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n      UDATA.HandleMessage('EDGE_EDIT', this.handleEdgeEdit);\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n      UDATA.HandleMessage('EDGE_CLOSE', this.handleEdgeClose);\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n      // Template handlers\n      this.OnAppStateChange('TEMPLATE', this.setTemplate);\n      UDATA.HandleMessage('EDIT_PERMISSIONS_UPDATE', this.setEditState);\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ Prevent editing if server is disconnected.\n      This is necessary to hide the \"Add New Node\" button.\n  /*/\n      this.OnDisconnect(() => {\n        console.log('EdgeSelector got disconnect')\n        this.setState({ isLocked: true });\n      });\n\n    } // constructor\n\n\n/// UTILITIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ clearForm () {\n      this.setState({\n        formData: {\n          sourceId:     '',\n          targetId:     '',\n          type: '',\n          info:         '',\n          notes:        '',\n          citation:     '',\n          category:     '',\n          id:           '',\n          isNewEdge:    true\n        },\n        sourceNode: {\n            label:     '',\n            type:      '',\n            info:      '',\n            notes:     '',\n            id:        ''\n        },\n        targetNode: {\n            label:     '',\n            type:      '',\n            info:      '',\n            notes:     '',\n            id:        ''\n        },\n        isBeingEdited:        false,\n        isExpanded:           false,      // Summary view vs Expanded view\n        dbIsLocked:           false,\n        sourceIsEditable:     false,      // Source ndoe field is only editable when source is not parent\n        hasValidSource:       false,      // Used by SwapSourceAndTarget and the Change Source button\n        targetIsEditable:     false,      // Target ndoe field is only editable when target is not parent\n        hasValidTarget:       false,      // Used by SwapSourceAndTarget and the Change Target button\n        hideModal: true                   // for the citation window\n\n      });\n  }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    setTemplate(data) {\n      this.setState({ edgeDefs: data.edgeDefs });\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Disable Edge Edit if a Template is being edited\n/*/\n    updateEditState() {\n      UDATA.NetCall(\"SRV_GET_EDIT_STATUS\")\n        .then(data => {\n          this.setEditState(data);\n        });\n    }\n    setEditState(data) {\n      if (DBG) console.log(PR, 'SRV_GET_EDIT_STATUS received', data)\n      const disableEdit = data.templateBeingEdited || data.importActive;\n      const TEMPLATE = this.AppState('TEMPLATE');\n      let editLockMessage = '';\n      if (data.templateBeingEdited) editLockMessage = TEMPLATE.templateIsLockedMessage;\n      if (data.importActive) editLockMessage = TEMPLATE.importIsLockedMessage;\n      this.setState({ disableEdit, editLockMessage });\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ populate formdata from NCDATA\n/*/ loadSourceAndTarget () {\n      if (DBG) console.log('EdgeEditor.loadSourceAndTarget!')\n\n      let edgeID = this.props.edgeID || '';\n      // Clean Data\n      if (isNaN(edgeID)) { edgeID = parseInt(edgeID); }\n\n      const NCDATA = this.AppState('NCDATA');\n\n      // parseInt in case of old bad string id\n      let edges = NCDATA.edges ? NCDATA.edges.filter( edge=>parseInt(edge.id)===edgeID ) : [];\n      if (!edges) {\n        throw 'EdgeEditor: Passed edgeID '+edgeID+' not found!';\n      }\n      let edge = edges[0];\n      if (DBG) console.log('EdgeEditor.loadSourceAndTarget: Loading edge', edge);\n\n      let sourceNode, sourceNodes, targetNode, targetNodes;\n\n      if (edge===undefined) {\n\n        // DEFINE NEW EDGE\n\n        // Create a dummy empty edge object\n        // This will be edited and saved\n        if (DBG) console.log('...EdgeEditor.loadSourceAndTarget: New edge!  No target yet!');\n        // Get a real source node, since we know the parent of this link is the currently\n        // selected source node.\n        sourceNodes = NCDATA.nodes.filter( node => node.label===this.props.parentNodeLabel );\n        // We don't know what target the user is going to pick yet, so just display a\n        // placeholder for now, otherwise, the render will choke on an invalid targetNode.\n        targetNodes = [{label:'pick one...'}];\n        // Define `edge` so it can be loaded later during setState.\n        edge = {\n          id: edgeID,\n          source: parseInt(sourceNodes[0].id),  // REVIEW: d3data 'source' is id, rename this to 'sourceId'?\n                                      // though after d3 processes, source does become an object.\n          target: undefined,\n          type: '',\n          notes: '',\n          info: '',\n          citation: '',\n          category: ''\n        }\n        // Expand this EdgeEditor and set it to Edit mode.\n        this.setState({\n          isExpanded:           true,\n          targetIsEditable:     true,\n          isBeingEdited:        true\n        }, () => {\n            // AUTOCOMPLETE mode needs to be set AFTER the edit state has already been set\n            // otherwise, the <AutoComplete> component may not have even been defined in the collapsed view.\n            this.AppCall('AUTOCOMPLETE_SELECT', { id: 'edge' + this.props.edgeID + 'target' });\n        });\n\n        this.AppCall('EDGEEDIT_LOCK', { edgeID: this.props.edgeID });\n\n      } else {\n\n        // LOAD EXISTING EDGE\n\n        // NOTE: NCDATA has not expanded source/target into objects, but remain ids\n        sourceNodes = NCDATA.nodes.filter( node => parseInt(node.id)===parseInt(edge.source) );\n        targetNodes = NCDATA.nodes.filter( node => parseInt(node.id)===parseInt(edge.target) );\n\n        // Assume we have a valid target node\n        this.setState({\n          hasValidSource:       true,\n          hasValidTarget:       true\n        });\n\n      }\n\n      if (!sourceNodes) {\n        throw 'EdgeEditor: Source ID'+edge.source+'not found!';\n      }\n      sourceNode = sourceNodes[0];\n      if (!targetNodes) {\n        throw 'EdgeEditor: Target ID'+edge.target+'not found!';\n      }\n      targetNode = targetNodes[0];\n\n      if (DBG) console.log('...EdgeEditor.loadSourceAndTarget: Setting formData sourceID to',edge.source,'and sourceNode to',sourceNode,'and targetNode to',targetNode);\n      this.setState({\n        formData: {\n          id:           parseInt(edge.id) || '',\n          sourceId:     edge.source,\n          targetId:     edge.target,\n          type: edge.type || '',   // Make sure there's valid data\n          info: edge.info || '',\n          citation: edge.citation || '',\n          category: edge.category || '',\n          notes: edge.notes || '',\n          isNewEdge:    false\n        },\n        sourceNode: sourceNode,\n        targetNode: targetNode,\n        dbIsLocked: false\n      })\n    }\n\n\n\n/// UDATA STATE HANDLERS //////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ When the user is creating a new node, they need to set a target node.\n    The target node is set via an AutoComplete field.\n    When a node is selected via the AutoComplete field, the SELECTION state is updated.\n    So EdgeEditor needs to listen to the SELECTION state in order to\n    know the target node has been selected.\n    SELECTION is also triggered when the network updates an edge.\n/*/ handleSelection ( data ) {\n      if (DBG) console.log('EdgeEditor',this.props.edgeID,'got SELECTION data',data);\n\n      // If we're one of the edges that have been updated, and we're not currently being edited,\n      // then update the data.\n      // If we're not currently being edited, then if edges have been updated, update self\n      if (data.edges !== undefined) {\n        let updatedEdge = data.edges.find((edge) => { return edge.id === this.state.formData.id; });\n        if (!this.state.isBeingEdited && updatedEdge !== undefined) {\n          if (DBG) console.log('EdgeEditor: Updating edges with', updatedEdge);\n          this.loadSourceAndTarget();\n          return;\n        }\n      }\n\n      // We're being edited, and the updated node is either our source or target\n      // Technically we probably ought to also check to make sure we're the current\n      // activeAutoCompleteId, but we wouldn't be editable if we weren't.\n      if (this.state.isBeingEdited && data.nodes && data.nodes.length > 0) {\n        // A node was selected, so load it\n\n          let node = data.nodes[0];\n\n        // Are we editing the source or the target?\n        if (this.state.sourceIsEditable) {\n          // SOURCE\n          if (DBG) console.log('EdgeEditor.handleSelection:',this.props.edgeID,'setting source node to',node);\n\n          // Set sourceNode state\n          this.setState({\n            sourceNode: node\n          });\n          // Also update the formdata\n          let formData = this.state.formData;\n          formData.sourceId = node.id;\n          this.setState({\n            formData: formData\n          });\n          // And let the switch button know we have a valid target\n          // And exit edit mode\n          this.setState({\n            hasValidSource:   true,\n            sourceIsEditable: false\n          });\n\n        } else if (this.state.targetIsEditable) {\n          // TARGET\n          if (DBG) console.log('EdgeEditor.handleSelection:',this.props.edgeID,'setting target node to',node);\n\n          // Set targetNode state\n          this.setState({\n            targetNode: node\n          });\n          // Also update the formdata\n          let formData = this.state.formData;\n          formData.targetId = node.id;\n          this.setState({\n            formData: formData\n          });\n          // And let the switch button know we have a valid target\n          // And exit edit mode\n          this.setState({\n            hasValidTarget:   true,\n            targetIsEditable: false\n          });\n\n        }\n        // pass currentAutoComplete back to search\n        this.AppCall('AUTOCOMPLETE_SELECT',{id:'search'});\n        this.setState({ isExpanded: true });\n      } else {\n        // No node selected, so we don't need to do anything\n        // AutoComplete will take care of its own search label updates\n      }\n\n    } // handleSelection\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Someone externally has selected an edge.\n    Usually someone has clicked a button in the EdgeList to view/edit an edge\n/*/ handleEdgeSelection ( data ) {\n      if (DBG) console.log('EdgeEditor',this.props.edgeID,': got state EDGE_SELECT',data);\n      if (this.state.formData.id === data.edgeID) {\n        // pass currentAutoComplete back to search\n        this.AppCall('AUTOCOMPLETE_SELECT',{id:'search'});\n        this.setState({ isExpanded: true });\n      }\n\n    } // handleEdgeSelection\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Someone externally has selected an edge for editing.\n    Usually someone has clicked a button in the EdgeTable to edit an edge\n/*/ handleEdgeEdit ( data ) {\n      const { formData, isBeingEdited, isLocked } = this.state;\n      if (DBG) console.log('EdgeEditor',this.state.formData.id,': got state EDGE_EDIT',data,'formData is',this.state.formData);\n      if ((data.edgeID !== undefined) && (typeof data.edgeID === \"number\") && !isBeingEdited &&\n        data.edgeID === formData.id\n      ) {\n        if (!isLocked) {\n          this.requestEdit();\n        } else {\n          console.warn(\"EdgeEditor.EDGE_EDIT denied because isLocked\", isLocked, 'but we will gladly show it!');\n          this.handleEdgeSelection(data);\n        }\n      } else {\n        if (typeof data.edgeID !== \"number\") console.warn(\"EdgeEditor.EDGE_EDIT called with bad data.nodeID:\", data.edgeID);\n        if (isBeingEdited) console.warn(\"EdgeEditor.EDGE_EDIT denied because isBeingEdited\", isBeingEdited);\n      }\n\n    } // handleEdgeEdit\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ handleEdgeClose() {\n      if (this.state.isExpanded) this.setState({ isExpanded: false });\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Handle change in SESSION data\n    Called both by componentDidMount() and AppStateChange handler.\n    The 'SESSION' state change is triggered in two places in SessionShell during\n    its handleChange() when active typing is occuring, and also during\n    SessionShell.componentWillMount()\n/*/ onStateChange_SESSION( decoded ) {\n      let update = { isLocked:   !decoded.isValid };\n      this.setState(update);\n    }\n\n\n/// UI EVENT HANDLERS /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Expand if the edge is collapsed.\n    Cancel editing if the edge is expanded.\n/*/ onEdgeClick () {\n      // Cancel/Close\n      if (this.state.isExpanded) {\n        // collapse\n        this.setState({ isExpanded: false });\n\n        // If we were editing, then revert and exit\n        if (this.state.isBeingEdited) {\n          const NCDATA = this.AppState('NCDATA');\n\n          this.setState({ isBeingEdited: false, targetIsEditable: false });\n          // Return focus of autocomplete to Search field.\n          this.AppCall('AUTOCOMPLETE_SELECT', { id: 'search' });\n          // Tell parent node to exit out of edge edit mode\n          this.AppCall('EDGEEDIT_UNLOCK', { edgeID: this.props.edgeID });\n          // Deregister as an open editor\n          if (this.state.isBeingEdited) UDATA.NetCall(\"SRV_RELEASE_EDIT_LOCK\", { editor: EDITORTYPE.EDGE });\n\n          // Cancel edit existing or cancel edit new?\n          let originalEdge = NCDATA.edges.filter(edge => parseInt(edge.id) === this.props.edgeID)[0];\n          if (originalEdge === undefined) {\n            // user abandoned editing a new node that was never saved\n            const parentNode = NCDATA.nodes.find(node => node.label === this.props.parentNodeLabel);\n            // parentNode might be missing if the admin user deleted it.\n            if (parentNode) {\n              // Unlock edges and reselect the source node\n              UDATA.LocalCall('EDGE_NEW_CANCEL', { nodeID: parentNode.id });\n            } else {\n              // Unlock edges and deselect the missing source node\n              UDATA.LocalCall('EDGE_NEW_CANCEL');\n            }\n            this.clearForm();\n          } else {\n            // User is abandoning edits to an existing edge.\n            // restore original edge\n            this.loadSourceAndTarget();\n            // unlock\n            this.NetCall('SRV_DBUNLOCKEDGE', { edgeID: this.state.formData.id })\n              .then((data) => {\n                if (data.NOP) {\n                  if (DBG) console.log(`SERVER SAYS: ${data.NOP} ${data.INFO}`);\n                } else if (data.unlocked) {\n                  if (DBG) console.log(`SERVER SAYS: unlock success! you have released Edge ${data.edgeID}`);\n                  this.setState({ dbIsLocked: false });\n                }\n              });\n          }\n        }\n      } else {\n        // expand, but don't set the autocomplete field, since we're not editing\n        this.setState({ isExpanded: true });\n      }\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ onDeleteButtonClick () {\n      this.clearForm();\n      this.AppCall('AUTOCOMPLETE_SELECT', { id: 'search' });\n      if (this.state.isBeingEdited) UDATA.NetCall(\"SRV_RELEASE_EDIT_LOCK\", { editor: EDITORTYPE.EDGE });\n      this.AppCall('EDGEEDIT_UNLOCK', { edgeID: this.props.edgeID }); // inform NodeSelector\n      this.AppCall('DB_UPDATE',{edgeID:this.props.edgeID});\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ onEditButtonClick () {\n      this.setState({ hideModal: true });\n\n      this.requestEdit(this.state.formData.id);\n\n      // Don't allow editing of the source or target fields.\n      // If you want to change the edge, delete this one and create a new one.\n      // if (this.props.parentNodeLabel===this.state.sourceNode.label) {\n      //   // The source node is the currently selected node in NodeSelector.  Edit the target.\n      //   UDATA.LocalCall('AUTOCOMPLETE_SELECT',{id:'edge'+this.props.edgeID+'target', searchString: this.state.targetNode.label});\n      // } else {\n      //   // The NodeSelector node is the target.  Allow editing the source.\n      //   UDATA.LocalCall('AUTOCOMPLETE_SELECT',{id:'edge'+this.props.edgeID+'source', searchString: this.state.sourceNode.label});\n      // }\n    }\n\n    /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/\n  /*/\n  onCiteButtonClick(event) {\n    event.preventDefault();\n\n    this.setState({ hideModal: false });\n\n  } // onCiteButtonClick\n\n  onCloseCiteClick (event) {\n    event.preventDefault();\n\n    this.setState({ hideModal: true });\n\n  } //   this.onCloseCiteClick\n\n  dateFormatted () {\n    var today = new Date();\n    var year = String(today.getFullYear());\n    var date = (today.getMonth()+1)+\"/\"+today.getDate()+\"/\"+ year.substr(2,4);\n    var time = today.toTimeString().substr(0,5);\n    var dateTime = time+' on '+date;\n    return dateTime;\n  }\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ requestEdit() {\n      let edgeID = this.state.formData.id;\n      if (edgeID && edgeID!=='' && !isNaN(edgeID) && (typeof edgeID ===\"number\") && !this.state.isBeingEdited) {\n        this.NetCall('SRV_DBLOCKEDGE', { edgeID: edgeID })\n          .then((data) => {\n            if (data.NOP) {\n              // Edge is locked, can't edit\n              if (DBG) console.log(`SERVER SAYS: ${data.NOP} ${data.INFO}`);\n              this.setState({\n                dbIsLocked: true,\n                isExpanded: true\n              });\n            } else if (data.locked) {\n              if (DBG) console.log(`SERVER SAYS: lock success! you can edit Edge ${data.edgeID}`);\n              if (DBG) console.log(`SERVER SAYS: unlock the edge after successful DBUPDATE`);\n              this.setState({\n                isBeingEdited: true,\n                isExpanded: true,\n                dbIsLocked: false\n              });\n              this.Signal('EDGEEDIT_LOCK', { edgeID: this.props.edgeID });\n              // When a edge is being edited, lock the Template from being edited\n              UDATA.NetCall(\"SRV_REQ_EDIT_LOCK\", { editor: EDITORTYPE.EDGE })\n                .then(res => {\n                  const disableEdit = res.isBeingEdited;\n                  this.setState({ disableEdit });\n                });\n            }\n          });\n      }\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ onSwapSourceAndTarget () {\n      let formData = this.state.formData;\n\n      // swap formadata\n      let targetId = formData.targetId;\n      formData.targetId = formData.sourceId;\n      formData.sourceId = targetId;\n\n      // swap this.state.source and target\n      let swap   = this.state.sourceNode;\n      let source = this.state.targetNode;\n      let target = swap;\n\n      // REVIEW\n      // Get rid of separate this.state.source and this.state.target\n      // and just use formData?!?\n\n      this.setState({\n        formData: formData,\n        sourceNode: source,\n        targetNode: target\n      });\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ onChangeSource () {\n      this.setState({\n        sourceIsEditable: true,\n        hasValidSource: false,\n        placeholder: this.state.sourceNode.label\n      });\n      this.AppCall('AUTOCOMPLETE_SELECT',{id:'edge'+this.props.edgeID+'source'});\n      // Whenever we set the autocomplete to source, we have to update the label\n      // Clear the AutoComplete field so that onBlur does not select the same node\n      this.AppCall('SOURCE_SEARCH', { searchString: '' });\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ onChangeTarget () {\n      this.setState({\n        targetIsEditable: true,\n        hasValidTarget: false,\n        placeholder: this.state.targetNode.label\n      });\n      this.AppCall('AUTOCOMPLETE_SELECT',{id:'edge'+this.props.edgeID+'target'});\n      // Whenever we set the autocomplete to target, we have to update the label\n      // Clear the AutoComplete field so that onBlur does not select the same node\n      this.AppCall('SOURCE_SEARCH', { searchString: '' });\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ onRelationshipChange (event) {\n      let formData = this.state.formData;\n      formData.type = event.target.value;\n      this.setState({formData: formData});\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ onInfoChange (event) {\n      let formData = this.state.formData;\n      formData.info = event.target.value;\n      this.setState({formData: formData});\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ onCitationChange (event) {\n      let formData = this.state.formData;\n      formData.citation = event.target.value;\n      this.setState({formData: formData});\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ onCategoryChange (event) {\n      let formData = this.state.formData;\n      formData.category = event.target.value;\n      this.setState({formData: formData});\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ onNotesChange (event) {\n      let formData = this.state.formData;\n      formData.notes = event.target.value;\n      this.setState({formData: formData});\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ onSubmit ( event ) {\n      event.preventDefault()\n      let formData = this.state.formData\n      // Read current edge values\n      // This is necessary because the SOURCE and TARGET labels\n      // are bound to selectedSourceNode and selectedTargetNode, not selectedEdge\n      let edge = {\n        id:             formData.id,\n        source:         this.state.sourceNode.id,   // REVIEW: d3data 'source' is id, rename this to 'sourceId'?\n                                                    // though after d3 processes, source does become an object.\n        target:         this.state.targetNode.id,   // REVIEW: d3data 'target' is id, rename this to 'targetId'?\n        type: formData.type,\n        info: formData.info,\n        citation: formData.citation,\n        category: formData.category,\n        notes: formData.notes\n      }\n      if (DBG) console.group('EdgeEntry.onSubmit submitting',edge)\n\n      // Make sure source and target still exist before saving an edge in case\n      // admin user deletes a node. This is to prevent data corruption by\n      // linking to non-existent nodes. This should probably be moved to nc-logic.\n      if (edge) {\n        // check source\n        const NCDATA = this.AppState('NCDATA');\n        const source = NCDATA.nodes.find(node => node.id === edge.source);\n        if (!source) {\n          alert('Sorry, the source node has been removed.  Please recreate your edge.');\n          // Trigger Cancel\n          this.onEdgeClick();\n          return;\n        }\n        // check target\n        const target = NCDATA.nodes.find(node => node.id === edge.target);\n        if (!target) {\n          alert('Sorry, the target node has been removed.  Please recreate your edge.');\n          // Trigger Cancel\n          this.onEdgeClick();\n          return;\n        }\n      }\n\n      // Deregister as an open editor\n      UDATA.NetCall(\"SRV_RELEASE_EDIT_LOCK\", { editor: 'edge' });\n      this.AppCall('EDGEEDIT_UNLOCK', { edgeID: this.props.edgeID }); // inform NodeSelector\n      // pass currentAutoComplete back to nodeselector\n      this.AppCall('AUTOCOMPLETE_SELECT',{id:'search'});\n      this.setState({ isBeingEdited: false, sourceIsEditable: false, targetIsEditable: false });\n      this.AppCall('DB_UPDATE', { edge })\n        .then(() => {\n          this.NetCall('SRV_DBUNLOCKEDGE', { edgeID: edge.id })\n            .then((data) => {\n              if (data.NOP) {\n                if (DBG) console.log(`SERVER SAYS: ${data.NOP} ${data.INFO}`);\n              } else if (data.unlocked) {\n                if (DBG) console.log(`SERVER SAYS: unlock success! you have released Edge ${data.edgeID}`);\n                this.setState({ dbIsLocked: false });\n              }\n            });\n        });\n\n  } // onSubmit\n\n\n\n/// REACT LIFECYCLE METHODS ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ This is not yet implemented as of React 16.2.  It's implemented in 16.3.\n    getDerivedStateFromProps (props, state) {\n      console.error('getDerivedStateFromProps!!!');\n    }\n/*/\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ render () {\n      const { edgeID, parentNodeLabel, parentNodeIsLocked } = this.props;\n      const {\n        formData,\n        sourceNode,\n        targetNode,\n        edgeDefs,\n        isStandalone,\n        edgeIsLockedMessage,\n        editLockMessage,\n        disableEdit\n      } = this.state;\n      let {citation} = this.state;\n      if (edgeDefs.category === undefined) { // for backwards compatability\n        edgeDefs.category = {};\n        edgeDefs.category.label = \"\";\n        edgeDefs.category.hidden = true;\n      }\n      if (citation === undefined) { // if citation were left out, simply make them hidden\n        citation = {};\n        citation.hidden = true;\n      }\n      const me = <span style={{ color: \"rgba(0,0,0,0.2)\", fontStyle: \"italic\" }}>this node</span>;\n      // special override to allow editing an edge that has the same parent node for both source and target\n      let sameSourceAndTarget = (sourceNode.label === this.props.parentNodeLabel) &&\n        (targetNode.label === this.props.parentNodeLabel);\n\n      // Optimize Edge Loading\n      // If not expanded, just show the button\n      // Only bother to render the whole EdgeEditor if the Edge is being edited\n      // This speeds up render times by almost 2 seconds\n      if (!this.state.isExpanded) {\n        return (\n          <div>\n            <Button\n              outline\n              size=\"sm\"\n              style={{ backgroundColor: \"#a9d3ff\", borderColor: 'transparent', width: '100%', marginBottom: '3px', textAlign: \"left\", overflow: \"hidden\" }}\n              onClick={this.onEdgeClick}\n            >{parentNodeLabel === sourceNode.label ? me : sourceNode.label}\n              &nbsp;<span title={formData.type}>&#x2794;</span>&nbsp;\n              {parentNodeLabel === targetNode.label ? me : targetNode.label}\n            </Button>\n          </div>\n        );\n      }\n\n      return (\n        <div>\n\n          <div className={this.state.isExpanded?'':'d-none'}>\n            <Form className=\"nodeEntry\"\n                  style={{backgroundColor:\"#C9E1FF\",minHeight:'300px',padding:'5px',marginBottom:'10px'}}\n                  onSubmit={this.onSubmit}>\n              <FormText onClick={this.onEdgeClick}><b>EDGE {formData.id}</b></FormText>\n              <FormGroup row>\n                <Col sm={3} style={{hyphens: 'auto'}} className=\"pr-0\">\n                  <Label for=\"source\" className=\"tooltipAnchor small text-muted\">\n                    <div className=\"badge\">?</div>\n                    {edgeDefs.source.displayLabel}\n                    <span className=\"tooltiptext\">{this.helpText(edgeDefs.source)}</span>\n                  </Label>\n                </Col>\n                <Col sm={9}>\n                  <AutoComplete\n                    identifier={'edge'+edgeID+'source'}\n                    disabledValue={sourceNode.label}\n                    inactiveMode={parentNodeLabel===sourceNode.label ? 'static' : this.state.isBeingEdited ? 'disabled' : 'link'}\n                    linkID={sourceNode.id}\n                    shouldIgnoreSelection={!this.state.sourceIsEditable}\n                    placeholder={this.state.placeholder}\n                  />\n                  <Button outline size=\"sm\" className=\"float-right\"\n                    hidden={ !(this.state.isBeingEdited &&\n                               this.state.hasValidSource &&\n                               (sourceNode.label!==this.props.parentNodeLabel)) }\n                    onClick={this.onChangeSource}\n                    title=\"Select a different source node\"\n                  >Change Source</Button>\n                </Col>\n              </FormGroup>\n              <FormGroup row hidden={edgeDefs.type.hidden}>\n                <Col sm={3} style={{hyphens: 'auto'}} className=\"pr-0\">\n                  <Label for=\"relationship\" className=\"tooltipAnchor small text-muted\">\n                    <div className=\"badge\">?</div>\n                    {edgeDefs.type.displayLabel}\n                    <span className=\"tooltiptext\">{this.helpText(edgeDefs.type)}</span>\n                  </Label>\n                </Col>\n                <Col sm={9}>\n                  <Input type=\"select\" name=\"relationship\"\n                    value={formData.type}\n                    onChange={this.onRelationshipChange}\n                    disabled={!this.state.isBeingEdited}\n                    >\n                    {edgeDefs.type.options.map( option => (\n                      <option key={option.label}>{option.label}</option>\n                    ))}\n                  </Input>\n                </Col>\n              </FormGroup>\n              <FormGroup row>\n                <Col sm={3} style={{hyphens: 'auto'}} className=\"pr-0\">\n                  <Label for=\"nodeLabel\" className=\"tooltipAnchor small text-muted\">\n                    <div className=\"badge\">?</div>\n                    {edgeDefs.target.displayLabel}\n                    <span className=\"tooltiptext\">{this.helpText(edgeDefs.target)}</span>\n                  </Label>\n                </Col>\n                <Col sm={9}>\n                  <AutoComplete\n                    identifier={'edge'+edgeID+'target'}\n                    disabledValue={targetNode.label}\n                    inactiveMode={ ( parentNodeLabel===targetNode.label && !sameSourceAndTarget ) ? 'static' : this.state.isBeingEdited ? 'disabled' : 'link'}\n                    linkID={targetNode.id}\n                    shouldIgnoreSelection={!this.state.targetIsEditable}\n                    placeholder={this.state.placeholder}\n                  />\n                  <Button outline size=\"sm\" className=\"float-right\"\n                    hidden={ !(this.state.isBeingEdited &&\n                               this.state.hasValidTarget &&\n                               ( (targetNode.label !== this.props.parentNodeLabel) ||\n                                 sameSourceAndTarget )\n                              )\n                            }\n                    onClick={this.onChangeTarget}\n                    title=\"Select a different target node\"\n                  >Change Target</Button>\n                  <Button outline size=\"sm\" className=\"float-right\" style={{marginRight:'5px'}}\n                    hidden={!(this.state.isBeingEdited && this.state.hasValidTarget)}\n                    onClick={this.onSwapSourceAndTarget}\n                    title=\"Swap 'Source' and 'Target' nodes\"\n                  >&uarr;&darr;</Button>\n                </Col>\n              </FormGroup>\n              <FormGroup row hidden={edgeDefs.category.hidden}>\n                <Col sm={3} style={{hyphens: 'auto'}} className=\"pr-0\">\n                  <Label for=\"category\" className=\"tooltipAnchor small text-muted\">\n                    <div className=\"badge\">?</div>\n                    {edgeDefs.category.displayLabel}\n                    <span className=\"tooltiptext\">{this.helpText(edgeDefs.category)}</span>\n                  </Label>\n                </Col>\n                <Col sm={9}>\n                  <Input type=\"text\" name=\"category\"\n                    value={formData.category}\n                    onChange={this.onCategoryChange}\n                    readOnly={!this.state.isBeingEdited}\n                  />\n                </Col>\n              </FormGroup><FormGroup row hidden={edgeDefs.citation.hidden}>\n                <Col sm={3} style={{hyphens: 'auto'}} className=\"pr-0\">\n                  <Label for=\"citation\" className=\"tooltipAnchor small text-muted\">\n                    <div className=\"badge\">?</div>\n                    {edgeDefs.citation.displayLabel}\n                    <span className=\"tooltiptext\">{this.helpText(edgeDefs.citation)}</span>\n                  </Label>\n                </Col>\n                <Col sm={9}>\n                  <Input type=\"text\" name=\"citation\"\n                    value={formData.citation}\n                    onChange={this.onCitationChange}\n                    readOnly={!this.state.isBeingEdited}\n                  />\n                </Col>\n              </FormGroup>\n              <FormGroup row hidden={edgeDefs.notes.hidden}>\n                <Col sm={3} style={{hyphens: 'auto'}} className=\"pr-0\">\n                  <Label for=\"notes\" className=\"tooltipAnchor small text-muted\">\n                    <div className=\"badge\">?</div>\n                    {edgeDefs.notes.displayLabel}\n                    <span className=\"tooltiptext\">{this.helpText(edgeDefs.notes)}</span>\n                  </Label>\n                </Col>\n                <Col sm={9}>\n                  <Input type=\"textarea\" name=\"notes\"\n                    style={{display: this.state.isBeingEdited ? 'block' : 'none'}}\n                    value={formData.notes}\n                    onChange={this.onNotesChange}\n                    readOnly={!this.state.isBeingEdited}\n                  />\n                  {this.markdownDisplay(this.state.formData.notes||'')}\n                </Col>\n              </FormGroup>\n              <FormGroup row hidden={edgeDefs.info.hidden}>\n                <Col sm={3} style={{hyphens: 'auto'}} className=\"pr-0\">\n                  <Label for=\"info\" className=\"tooltipAnchor small text-muted\">\n                    <div className=\"badge\">?</div>\n                    {edgeDefs.info.displayLabel}\n                    <span className=\"tooltiptext\">{this.helpText(edgeDefs.info)}</span>\n                  </Label>\n                </Col>\n                <Col sm={9}>\n                  <Input type=\"text\" name=\"info\"\n                    value={formData.info}\n                    onChange={this.onInfoChange}\n                    readOnly={!this.state.isBeingEdited}\n                  />\n                </Col>\n              </FormGroup>\n              <div id=\"citationWindow\" hidden={this.state.hideModal} className=\"modal-content\">\n                <span className=\"close\" onClick={this.onCloseCiteClick}>&times;</span>\n                <p><em>Copy the text below:</em><br/><br/>\n                  NetCreate {this.AppState('TEMPLATE').name} network, Edge: {this.state.formData.label} (ID {this.state.formData.id}), from \"{sourceNode.label}\" to \"{targetNode.label}\". {citation.text}. Last accessed at {this.dateFormatted()}.</p>\n              </div><br/>\n              <FormGroup className=\"text-right\" style={{paddingRight:'5px'}}>\n                <Button className=\"small float-left btn btn-outline-light\" size=\"sm\"\n                  hidden={this.state.isLocked || isStandalone || parentNodeIsLocked}\n                  onClick={this.onDeleteButtonClick}\n                >Delete</Button>&nbsp;\n                <Button outline size=\"sm\"\n                  hidden={ citation.hidden}\n                  onClick={this.onCiteButtonClick}\n                >Cite Edge</Button>&nbsp;&nbsp;\n                <Button outline size=\"sm\"\n                  hidden={this.state.isLocked || isStandalone || this.state.isBeingEdited || parentNodeIsLocked}\n                  disabled={disableEdit}\n                  onClick={this.onEditButtonClick}\n                >{this.state.isBeingEdited ? \"Add New Edge\" : \"Edit Edge\"}</Button>&nbsp;\n                <Button size=\"sm\"\n                  outline={this.state.isBeingEdited}\n                  onClick={this.onEdgeClick}\n                >{this.state.isBeingEdited?'Cancel':'Close'}</Button>&nbsp;\n                <Button color=\"primary\" size=\"sm\"\n                  hidden={!this.state.isBeingEdited}\n                  disabled={ !(this.state.isBeingEdited && this.state.hasValidTarget) }\n                >Save</Button>\n                <div hidden={this.state.isLocked || this.state.isBeingEdited || parentNodeIsLocked} style={{ display: 'inline' }}>\n                  <p hidden={!this.state.dbIsLocked} className=\"small text-danger warning\">{edgeIsLockedMessage}</p>\n                  <p hidden={!disableEdit} className=\"small text-danger warning\">{editLockMessage}</p>\n                </div>\n              </FormGroup>\n            </Form>\n          </div>\n\n        </div>\n      );\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ componentDidMount () {\n      if (DBG) console.log('EdgeEditor.componentDidMount!');\n      this.loadSourceAndTarget();\n      this.onStateChange_SESSION(this.AppState('SESSION'));\n      this.updateEditState();\n      this.setState({\n        // hide Edit button if in standalone mode\n        isStandalone: UNISYS.IsStandaloneMode()\n      });\n      window.addEventListener(\"beforeunload\", this.checkUnload);\n      window.addEventListener(\"unload\", this.doUnload);\n    }\n\n    checkUnload(e) {\n      e.preventDefault();\n      if (this.state.isBeingEdited) {\n        (e || window.event).returnValue = null;\n      } else {\n        Reflect.deleteProperty(e, 'returnValue');\n      }\n      return e;\n    }\n\n    doUnload(e) {\n      if (this.state.isBeingEdited) {\n        this.NetCall('SRV_DBUNLOCKEDGE', { edgeID: this.state.formData.id });\n        this.NetCall(\"SRV_RELEASE_EDIT_LOCK\", { editor: EDITORTYPE.EDGE });\n      }\n    }\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Release the lock if we're unmounting\n/*/ componentWillUnmount() {\n      if (DBG) console.log('EdgeEditor.componentWillUnMount!');\n      if (this.state.isBeingEdited) {\n        this.NetCall('SRV_DBUNLOCKEDGE', { edgeID: this.state.formData.id })\n          .then((data) => {\n            if (data.NOP) {\n              if (DBG) console.log(`SERVER SAYS: ${data.NOP} ${data.INFO}`);\n            } else if (data.unlocked) {\n              if (DBG) console.log(`SERVER SAYS: unlock success! you have released Edge ${data.edgeID}`);\n              this.setState({ dbIsLocked: false });\n            }\n          });\n        // Deregister as an open editor\n        this.NetCall(\"SRV_RELEASE_EDIT_LOCK\", { editor: EDITORTYPE.EDGE });\n      }\n      // deregister ACTIVEAUTOMPLETE when component unmounts\n      // otherwise state updates trigger a setState on unmounted component error\n      this.AppStateChangeOff('SESSION', this.onStateChange_SESSION);\n      this.AppStateChangeOff('SELECTION', this.handleSelection);\n      this.AppStateChangeOff('TEMPLATE', this.setTemplate);\n      UDATA.UnhandleMessage('EDGE_SELECT', this.handleEdgeSelection);\n      UDATA.UnhandleMessage('EDGE_EDIT', this.handleEdgeEdit);\n      UDATA.UnhandleMessage('EDGE_CLOSE', this.handleEdgeClose);\n      UDATA.UnhandleMessage('EDIT_PERMISSIONS_UPDATE', this.setEditState);\n      window.removeEventListener(\"beforeunload\", this.checkUnload);\n      window.removeEventListener(\"unload\", this.doUnload);\n    }\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/\n\n    helpText(obj) {\n      var text = \"\";\n      if (obj.help === undefined || obj.help === \"\") text = obj.label;\n      else text = obj.help;\n      return text;\n    }\n\n\n    markdownDisplay (text) {\n      if (!this.state.isBeingEdited) {\n        return mdReact({\n          onIterate: this.markdownIterate,\n          markdownOptions: { typographer: true, linkify: true },\n          plugins: [mdplugins.emoji]\n        })(text);\n      }\n    }\n\n    markdownIterate(Tag, props, children, level) {\n      if (Tag === 'a') {\n        props.target = '_blank';\n      }\n      return <Tag {...props}>{children}</Tag>;\n    }\n\n} // class EdgeEditor\n\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = EdgeEditor;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  ## OVERVIEW\n\n    EdgeTable is used to to display a table of edges for review.\n\n    It displays NCDATA.\n    But also read FILTEREDD3DATA to show highlight/filtered state\n\n\n  ## TO USE\n\n    EdgeTable is self contained and relies on global NCDATA to load.\n\n      <EdgeTable/>\n\n\n    Set `DBG` to true to show the `ID` column.\n\n  ## 2018-12-07 Update\n\n    Since we're not using tab navigation:\n    1. The table isExpanded is now true by default.\n    2. The \"Show/Hide Table\" button is hidden.\n\n    Reset these to restore previous behavior.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n\nvar DBG = false;\n\nconst SETTINGS     = require('settings');\nconst isLocalHost  = (SETTINGS.EJSProp('client').ip === '127.0.0.1') || (location.href.includes('admin=true'));\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst React        = require('react');\nconst ReactStrap   = require('reactstrap');\nconst { Button }    = ReactStrap;\nconst MarkdownNote = require('./MarkdownNote');\n\nconst UNISYS   = require('unisys/client');\nvar   UDATA    = null;\n\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// export a class object for consumption by brunch/require\nclass EdgeTable extends UNISYS.Component {\n    constructor (props) {\n      super(props);\n\n      this.state = {\n        edgeDefs: this.AppState('TEMPLATE').edgeDefs,\n        edges: [],\n        filteredEdges: [],\n        nodes: [], // needed for dereferencing source/target\n        isLocked: false,\n        isExpanded: true,\n        sortkey:      'Relationship'\n      };\n\n      this.onStateChange_SESSION = this.onStateChange_SESSION.bind(this);\n      this.updateEdgeFilterState = this.updateEdgeFilterState.bind(this);\n      this.handleDataUpdate = this.handleDataUpdate.bind(this);\n      this.handleFilterDataUpdate = this.handleFilterDataUpdate.bind(this);\n      this.OnTemplateUpdate = this.OnTemplateUpdate.bind(this);\n      this.onButtonClick            = this.onButtonClick.bind(this);\n      this.onToggleExpanded         = this.onToggleExpanded.bind(this);\n      this.m_FindMatchingObjsByProp = this.m_FindMatchingObjsByProp.bind(this);\n      this.m_FindMatchingEdgeByProp = this.m_FindMatchingEdgeByProp.bind(this);\n      this.m_FindEdgeById           = this.m_FindEdgeById.bind(this);\n      this.setSortKey               = this.setSortKey.bind(this);\n      this.sortSymbol               = this.sortSymbol.bind(this);\n      this.lookupNodeLabel = this.lookupNodeLabel.bind(this);\n\n      this.sortDirection = 1;\n\n\n      /// Initialize UNISYS DATA LINK for REACT\n      UDATA = UNISYS.NewDataLink(this);\n\n      // SESSION is called by SessionSHell when the ID changes\n      //  set system-wide. data: { classId, projId, hashedId, groupId, isValid }\n      this.OnAppStateChange('SESSION',this.onStateChange_SESSION);\n\n      // Always make sure class methods are bind()'d before using them\n      // as a handler, otherwise object context is lost\n      this.OnAppStateChange('NCDATA', this.handleDataUpdate);\n\n      // Handle Template updates\n      this.OnAppStateChange('TEMPLATE', this.OnTemplateUpdate);\n\n      // Track Filtered Data Updates too\n      this.OnAppStateChange('FILTEREDD3DATA', this.handleFilterDataUpdate);\n\n  } // constructor\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ componentDidMount () {\n      if (DBG) console.log('EdgeTable.componentDidMount!');\n\n      this.onStateChange_SESSION(this.AppState('SESSION'));\n\n      // Explicitly retrieve data because we may not have gotten a NCDATA\n      // update while we were hidden.\n      // filtered data needs to be set before D3Data\n      const FILTEREDD3DATA = UDATA.AppState('FILTEREDD3DATA');\n      this.setState({ filteredEdges: FILTEREDD3DATA.edges },\n        () => {\n          let NCDATA = this.AppState('NCDATA');\n          this.handleDataUpdate(NCDATA);\n        }\n      )\n}\n\n    componentWillUnmount() {\n      this.AppStateChangeOff('SESSION', this.onStateChange_SESSION);\n      this.AppStateChangeOff('NCDATA', this.handleDataUpdate);\n      this.AppStateChangeOff('FILTEREDD3DATA', this.handleFilterDataUpdate);\n      this.AppStateChangeOff('TEMPLATE', this.OnTemplateUpdate);\n    }\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Handle change in SESSION data\n    Called both by componentWillMount() and AppStateChange handler.\n    The 'SESSION' state change is triggered in two places in SessionShell during\n    its handleChange() when active typing is occuring, and also during\n    SessionShell.componentWillMount()\n/*/ onStateChange_SESSION( decoded ) {\n      this.setState({ isLocked: !decoded.isValid });\n    }\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  displayUpdated(nodeEdge) {\n      // Prevent error if `meta` info is not defined yet, or not properly imported\n      if (!nodeEdge.meta) return;\n\n      var d = new Date(nodeEdge.meta.revision > 0 ? nodeEdge.meta.updated : nodeEdge.meta.created);\n\n      var year = String(d.getFullYear());\n      var date = (d.getMonth()+1)+\"/\"+d.getDate()+\"/\"+ year.substr(2,4);\n      var time = d.toTimeString().substr(0,5);\n      var dateTime = date+' at '+time;\n      var titleString = \"v\" + nodeEdge.meta.revision;\n      if (nodeEdge._nlog) titleString += \" by \" + nodeEdge._nlog[nodeEdge._nlog.length-1];\n      var tag = <span title={titleString}> {dateTime} </span>;\n\n      return tag;\n  }\n\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// Set edge filtered status based on current filteredNodes\n  updateEdgeFilterState(edges, filteredEdges) {\n    // add highlight/filter status\n    if (filteredEdges.length > 0) {\n      edges = edges.map(edge => {\n        const filteredEdge = filteredEdges.find(n => n.id === edge.id);\n        edge.isFiltered = !filteredEdge;\n        return edge;\n      });\n    }\n    this.setState({edges});\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ Handle updated SELECTION: NCDATA updates\n  /*/\n  handleDataUpdate(data) {\n    if (data && data.edges && data.nodes) {\n      // NCDATA.edges no longer uses source/target objects\n      // ...1. So we need to save nodes for dereferencing.\n      this.setState({ nodes: data.nodes }, () => {\n        // ...2. So we stuff 'sourceLabel' and 'targetLabel' into the local edges array\n        let edges = data.edges.map(e => {\n          e.sourceLabel = this.lookupNodeLabel(e.source); // requires `state.nodes` be set\n          e.targetLabel = this.lookupNodeLabel(e.target);\n          return e;\n        })\n        // ...   sort it also\n        edges = this.sortTable(this.state.sortkey, edges);\n        // ...1. So we need to save nodes for dereferencing.\n        this.setState({ edges });\n        const { filteredEdges } = this.state;\n        this.updateEdgeFilterState(edges, filteredEdges);\n      });\n    }\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ Handle FILTEREDD3DATA updates sent by filters-logic.m_FiltersApply\n      Note that edge.soourceLabel and edge.targetLabe should already be set\n      by filter-logic.\n  /*/\n  handleFilterDataUpdate(data) {\n    if (data.edges) {\n      const filteredEdges = data.edges;\n      this.setState({ filteredEdges }, () => {\n        const edges = this.sortTable(this.state.sortkey, this.state.edges);\n        this.updateEdgeFilterState(edges, filteredEdges);\n      });\n    }\n  }\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  OnTemplateUpdate(data) {\n    this.setState({edgeDefs: data.edgeDefs});\n  }\n\n\n/// UTILITIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ sortByID (edges) {\n      if (edges) {\n        return edges.sort( (a,b) => {\n          let akey = a.id,\n              bkey = b.id;\n          if (akey<bkey) return -1*Number(this.sortDirection);\n          if (akey>bkey) return 1*Number(this.sortDirection);\n          return 0;\n        });\n      }\n      return undefined;\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ sortBySourceLabel (edges) {\n      if (edges) {\n        return edges.sort( (a,b) => {\n          let akey = a.sourceLabel,\n              bkey = b.sourceLabel;\n          return (akey.localeCompare(bkey)*this.sortDirection);\n        });\n      }\n      return undefined;\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ sortByTargetLabel (edges) {\n      if (edges) {\n        return edges.sort( (a,b) => {\n          let akey = a.targetLabel,\n              bkey = b.targetLabel;\n\n          return (akey.localeCompare(bkey)*this.sortDirection);\n\n        });\n      }\n      return undefined;\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ DEPRECATED -- 'attributes' is no longer being used\n/*/ sortByAttribute (edges, key) {\n      if (edges) {\n        return edges.sort( (a,b) => {\n          let akey = a.attributes[key],\n              bkey = b.attributes[key];\n          if (akey<bkey) return -1*Number(this.sortDirection);\n          if (akey>bkey) return 1*Number(this.sortDirection);\n          if (akey===bkey) {\n            // Secondary sort on Source label\n            let source_a = a.sourceLabel;\n            let source_b = b.sourceLabel;\n            if (source_a<source_b) return -1*Number(this.sortDirection);\n            if (source_a>source_b) return 1*Number(this.sortDirection);\n          }\n          return 0;\n        });\n      }\n      return undefined;\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ sortByKey (edges, key) {\n      if (edges) {\n        return edges.sort( (a,b) => {\n          let akey = a[key],\n              bkey = b[key];\n          if (akey<bkey) return -1*Number(this.sortDirection);\n          if (akey>bkey) return 1*Number(this.sortDirection);\n          if (akey===bkey) {\n            // Secondary sort on Source label\n            let source_a = a.sourceLabel;\n            let source_b = b.sourceLabel;\n            if (source_a<source_b) return -1*Number(this.sortDirection);\n            if (source_a>source_b) return 1*Number(this.sortDirection);\n          }\n          return 0;\n        });\n      }\n      return undefined;\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ sortByUpdated(edges) {\n      if (edges) {\n        return edges.sort( (a,b) => {\n          let akey = (a.meta.revision > 0 ? a.meta.updated : a.meta.created),\n              bkey = (b.meta.revision > 0 ? b.meta.updated : b.meta.created);\n          if (akey<bkey) return -1*Number(this.sortDirection);\n          if (akey>bkey) return 1*Number(this.sortDirection);\n          return 0;\n        });\n      }\n      return undefined;\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ If no `sortkey` is passed, the sort will use the existing state.sortkey\n/*/ sortTable ( sortkey=this.state.sortkey, edges) {\n      switch (sortkey) {\n        case 'id':\n          return this.sortByID(edges);\n          break;\n        case 'source':\n          return this.sortBySourceLabel(edges);\n          break;\n        case 'target':\n          return this.sortByTargetLabel(edges);\n          break;\n        case 'Info':\n          return this.sortByKey(edges, 'info');\n          break;\n        case 'Notes':\n          return this.sortByKey(edges, 'notes');\n          break;\n        case 'Category':\n          return this.sortByKey(edges, 'category');\n          break;\n        case 'Citations':\n          return this.sortByKey(edges, 'citation');\n          break;\n        case 'Updated':\n          return this.sortByUpdated(edges);\n          break;\n        case 'Relationship':\n        default:\n          return this.sortByKey(edges, 'type');\n          break;\n      }\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ sortSymbol(key) {\n      if (key !== this.state.sortkey) return \"\"; // this is not the current sort, so don't show anything\n      else return this.sortDirection===1?\"\":\"\"; // default to \"decreasing\" and flip if clicked again\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Look up the Node label for source / target ids\n/*/ lookupNodeLabel(nodeId) {\n      const node = this.state.nodes.find(n => n.id === nodeId);\n      if (node === undefined) throw new Error('EdgeTable: Could not find node', nodeId);\n      return node.label;\n    }\n\n    /// UI EVENT HANDLERS /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ onButtonClick (event) {\n      event.preventDefault();\n\n      let edgeID = parseInt( event.target.value );\n      let edge = this.m_FindEdgeById( edgeID );\n\n      if (DBG) console.log('EdgeTable: Edge id',edge.id,'selected for editing');\n\n      // Load Source then Edge\n      UDATA.LocalCall('SOURCE_SELECT',{ nodeIDs: [edge.source] })\n      .then(()=>{\n        UDATA.LocalCall('EDGE_EDIT',{ edgeID: edge.id });\n      });\n\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ onToggleExpanded (event) {\n      this.setState({\n        isExpanded: !this.state.isExpanded\n      })\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ setSortKey (key) {\n      if (key === this.state.sortkey) this.sortDirection = (-1 * this.sortDirection);// if this was already the key, flip the direction\n      else this.sortDirection = 1;\n\n      const edges = this.sortTable(key, this.state.edges);\n      this.setState({\n        edges,\n        sortkey: key\n      });\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ selectNode (id, event) {\n      event.preventDefault();\n\n      // Load Source\n      if (DBG) console.log('EdgeTable: Edge id',id,'selected for editing');\n      UDATA.LocalCall('SOURCE_SELECT',{ nodeIDs: [id] });\n    }\n\n\n/// OBJECT HELPERS ////////////////////////////////////////////////////////////\n/// these probably should go into a utility class\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Return array of objects that match the match_me object keys/values\n    NOTE: make sure that strings are compared with strings, etc\n/*/ m_FindMatchingObjsByProp( obj_list, match_me={} ) {\n      // operate on arrays only\n      if (!Array.isArray(obj_list)) throw Error(\"FindMatchingObjectsByProp arg1 must be array\");\n      let matches = obj_list.filter( obj => {\n        let pass = true;\n        for (let key in match_me) {\n          if (match_me[key]!==obj[key]) pass=false; break;\n        }\n        return pass;\n      });\n      // return array of matches (can be empty array)\n      return matches;\n    }\n\n/// EDGE HELPERS //////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Return array of nodes that match the match_me object keys/values\n    NOTE: make sure that strings are compared with strings, etc\n/*/ m_FindMatchingEdgeByProp( match_me={} ) {\n      return this.m_FindMatchingObjsByProp(this.state.edges,match_me);\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Convenience function to retrieve edge by ID\n/*/ m_FindEdgeById( id ) {\n      return this.m_FindMatchingEdgeByProp({ id })[0];\n    }\n\n\n\n/// REACT LIFECYCLE METHODS ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ This is not yet implemented as of React 16.2.  It's implemented in 16.3.\n    getDerivedStateFromProps (props, state) {\n      console.error('getDerivedStateFromProps!!!');\n    }\n/*/\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ render () {\n      let { edgeDefs, isLocked } = this.state;\n\n      if (edgeDefs.category === undefined) { // for backwards compatability\n        edgeDefs.category = {};\n        edgeDefs.category.label = \"\";\n        edgeDefs.category.hidden = true;\n      }\n\n      const { tableHeight } = this.props;\n      const styles = `thead, tbody { font-size: 0.8em }\n                      .table {\n                        display: table; /* override bootstrap for fixed header */\n                        border-spacing: 0;\n                      }\n                      .table th {\n                        position: -webkit-sticky;\n                        position: sticky;\n                        top: 0;\n                        background-color: #eafcff;\n                        border-top: none;\n                      }\n                      xtbody { overflow: auto; }\n                      .btn-sm { font-size: 0.6rem; padding: 0.1rem 0.2rem }\n                      `\n      return (\n        <div style={{\n          overflow: 'auto',\n          position: 'relative',\n          display: 'block',\n          left: '1px', right: '10px',\n          height: tableHeight,\n          backgroundColor: '#eafcff'\n        }}>\n          <style>{styles}</style>\n          <Button size=\"sm\" outline hidden\n            onClick={this.onToggleExpanded}\n          >{this.state.isExpanded ? \"Hide Edge Table\" : \"Show Edge Table\"}</Button>\n          <table hidden={!this.state.isExpanded}\n            // size=\"sm\" hover responsive striped // ReactStrap properties\n            // Need to use a standard 'table' not ReactStrap so that we can set\n            // the container div height and support non-scrolling headers\n            className=\"table table-striped table-responsive table-hover table-sm edgetable w-auto\"\n          >\n            <thead>\n              <tr>\n                <th width=\"4%\" hidden={!DBG}><Button size=\"sm\"\n                      onClick={()=>this.setSortKey(\"id\")}\n                    >ID {this.sortSymbol(\"id\")}</Button></th>\n                <th hidden={!DBG}>Size</th>\n                <th width=\"4%\"><div style={{color: '#f3f3ff'}}>_Edit_</div></th>\n                <th hidden={!DBG}>Src ID</th>\n                <th  width=\"10%\"><Button size=\"sm\"\n                      onClick={()=>this.setSortKey(\"source\")}\n                    >{edgeDefs.source.displayLabel} {this.sortSymbol(\"source\")}</Button></th>\n                <th hidden={edgeDefs.type.hidden} width=\"10%\"><Button size=\"sm\"\n                      onClick={()=>this.setSortKey(\"Relationship\")}\n                    >{edgeDefs.type.displayLabel} {this.sortSymbol(\"Relationship\")}</Button></th>\n                <th hidden={!DBG}>Target ID</th>\n                <th width=\"10%\"><Button size=\"sm\"\n                      onClick={()=>this.setSortKey(\"target\")}\n                    >{edgeDefs.target.displayLabel} {this.sortSymbol(\"target\")}</Button></th>\n                <th width=\"8%\" hidden={edgeDefs.category.hidden}><Button size=\"sm\"\n                      onClick={()=>this.setSortKey(\"Category\")}\n                    >{edgeDefs.category.displayLabel} {this.sortSymbol(\"Category\")}</Button></th>\n                <th width=\"10%\" hidden={edgeDefs.citation.hidden}><Button size=\"sm\"\n                      onClick={()=>this.setSortKey(\"Citations\")}\n                    >{edgeDefs.citation.displayLabel} {this.sortSymbol(\"Citations\")}</Button></th>\n                <th width=\"20%\" hidden={edgeDefs.notes.hidden}><Button size=\"sm\"\n                      onClick={()=>this.setSortKey(\"Notes\")}\n                    >{edgeDefs.notes.displayLabel} {this.sortSymbol(\"Notes\")}</Button></th>\n                <th  width=\"10%\"hidden={edgeDefs.info.hidden}><Button size=\"sm\"\n                      onClick={()=>this.setSortKey(\"Info\")}\n                    >{edgeDefs.info.displayLabel} {this.sortSymbol(\"Info\")}</Button></th>\n                <th  width=\"10%\"hidden={!isLocalHost}><Button size=\"sm\"\n                      onClick={()=>this.setSortKey(\"Updated\")}\n                    >Updated {this.sortSymbol(\"Updated\")}</Button></th>\n\n              </tr>\n            </thead>\n            <tbody style={{ maxHeight: tableHeight }}>\n            {this.state.edges.map( (edge,i) => (\n              <tr key={i}\n                style={{\n                  color: edge.isFiltered ? 'red' : 'black',\n                  opacity: edge.isFiltered ? edge.filteredTransparency : 1\n                }}>\n                <td hidden={!DBG}>{edge.id}</td>\n                <td hidden={!DBG}>{edge.size}</td>\n                <td><Button size=\"sm\" outline\n                      value={edge.id}\n                      onClick={this.onButtonClick}\n                    >{isLocked ? \"View\" : \"Edit\"}</Button>\n                </td>\n                <td hidden={!DBG}>{edge.source}</td>\n                <td><a href=\"#\" onClick={(e)=>this.selectNode(edge.source,e)}\n                    >{edge.sourceLabel}</a></td>\n                <td hidden={edgeDefs.type.hidden}>{edge.type}</td>\n                <td hidden={!DBG}>{edge.target}</td>\n                <td><a href=\"#\" onClick={(e)=>this.selectNode(edge.target,e)}\n                    >{edge.targetLabel}</a></td>\n                <td hidden={edgeDefs.category.hidden}>{edge.category}</td>\n                <td hidden={edgeDefs.citation.hidden}>{edge.citation}</td>\n                <td hidden={edgeDefs.notes.hidden}>\n                  {edge.notes ? <MarkdownNote text={edge.notes} /> : \"\" }\n                </td>\n                <td hidden={edgeDefs.info.hidden}>{edge.info}</td>\n                <td hidden={!isLocalHost}>{this.displayUpdated(edge)}</td>\n              </tr>\n            ))}\n            </tbody>\n          </table>\n        </div>\n      );\n    }\n} // class EdgeTable\n\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = EdgeTable;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  ## OVERVIEW\n\n    Help displays a hideable generic help screen.\n\n\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nvar DBG = false;\nvar UDATA = null;\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst React        = require('react');\nconst ReactStrap   = require('reactstrap');\nconst { Button, Table }    = ReactStrap;\n\nconst UNISYS   = require('unisys/client');\n\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// export a class object for consumption by brunch/require\nclass Help extends UNISYS.Component {\n  render () {\n    return (\n      <div\n        style={{backgroundColor:'rgba(240,240,240,0.95)',padding:'10px 20px'}}>\n        <h1>Why Net.Create</h1>\n        <p>In Net.Create, users can simultaneously do data entry on nodes and the edges between them.</p>\n        <h1>Navigation</h1>\n        <ul>\n          <li>Recenter the graph -- press the * button</li>\n          <li>Zoom --\n            <ul>\n              <li>on screen -- use the +/- buttons</li>\n              <li>mouse -- use mousewheel</li>\n              <li>trackpad -- two fingers up/down</li>\n              <li>tablet -- two fingers pinch</li>\n            </ul>\n          </li>\n          <li>Pan -- drag empty space</li>\n        </ul>\n        <h1>Nodes</h1>\n        <ul>\n          <li>Select -- Click on a node, or start typing the node label in\n          the Label field and select a node from the suggestions.</li>\n        </ul>\n        <h1>Edges</h1>\n        <ul>\n          <li>Create -- To create an edge, first select the source node, then\n          click \"Add New Edge\".</li>\n          <li>Select -- To select an edge, select either of the nodes it is attached to.</li>\n          <li>Editing -- To change the source or target of an existing edge,\n          delete it and create a new one.</li>\n          <li>View Full List -- Click on \"Show Edge Table\" to view a table\n          of all the edges.  Click on a column header to sort the table by\n          that parameter.</li>\n        </ul>\n        <h1>About Net.Create</h1>\n        <p>Net.Create is funded through the <a href=\"https://www.nsf.gov/pubs/policydocs/pappguide/nsf09_1/gpg_2.jsp#IID2\" target=\"NSF\">EAGER program</a> at <a href=\"https://www.nsf.gov/\" target=\"NSF\">NSF</a> under award #<a href=\"https://www.nsf.gov/awardsearch/showAward?AWD_ID=1848655\" target=\"NSF\">1848655</a>. <a href=\"http://www.kalanicraig.com\" target=\"Craig\">Kalani Craig</a> is the PI, with Co-PIs <a href=\"http://www.joshuadanish.com\" target=\"Danish\">Joshua Danish</a> and <a href=\"https://education.indiana.edu/about/directory/profiles/hmelo-silver-cindy.html\" target=\"Hmelo-Silver\">Cindy Hmelo-Silver</a>. Software development provided by <a href=\"http://inquirium.net\" target=\"Inquirium\">Inquirium</a>. For more information, see <a href=\"http://netcreate.org\" target=\"NetCreateOrg\">Net.Create.org</a></p>\n\n      </div>\n    );\n  }\n} // class Help\n\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = Help;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  ## OVERVIEW\n\n  Provides tools to import and export node/edge data files.\n\n  This also provides a \"Force Unlock All\" button that can be used by Admins\n  to unlock all edit locks requested by node editors, edge editors, template\n  editors, and importers on the network.\n\n  This displays a subpanel on the \"More...\" tab.\n\n  `importexport-logic.js` (IELOGIC) handles all of the business logic for\n  importing and exporting.  See that file for details.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst DBG = false;\nconst PR = 'ImportExport';\nvar UDATA = null;\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst React        = require('react');\nconst ReactStrap   = require('reactstrap');\nconst { Button, Table }    = ReactStrap;\nconst SETTINGS = require(\"settings\");\nconst NetMessage = require(\"unisys/common-netmessage-class\");\n\nconst UNISYS   = require('unisys/client');\nconst DATASTORE = require(\"system/datastore\");\nconst { EDITORTYPE } = require(\"system/util/enum\");\n\nconst IELOGIC = require(\"../importexport-logic\");\n\n/// CONSTANTS /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst NODEFILESTATUS_DEFAULT = 'Select a node .csv file to import';\nconst EDGEFILESTATUS_DEFAULT = 'Select an edge .csv file to import';\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// export a class object for consumption by brunch/require\nclass ImportExport extends UNISYS.Component {\n  constructor (props) {\n    super(props);\n    const TEMPLATE = this.AppState('TEMPLATE');\n    this.state = {\n      isExpanded: true,\n      preventImport: false, // an external source has disabled import for us\n      importIsActive: false, // internal source: keeps track of whether THIS panel has valid import files selected\n      nodefile: undefined,\n      nodefileStatus: NODEFILESTATUS_DEFAULT,\n      nodeValidationMsgs: undefined,\n      nodeOkToImport: false,\n      edgefile: undefined,\n      edgefileStatus: EDGEFILESTATUS_DEFAULT,\n      edgeValidationMsgs: undefined,\n      edgeOkToImport: false,\n      okToImport: false,\n      importMsgs: undefined,\n      allowLoggedInUserToImport: TEMPLATE.allowLoggedInUserToImport\n    };\n    this.checkUnload = this.checkUnload.bind(this);\n    this.doUnload = this.doUnload.bind(this);\n    this.handleEditStateUpdate = this.handleEditStateUpdate.bind(this);\n    this.updateEditState = this.updateEditState.bind(this);\n    this.onNodesExportSelect = this.onNodesExportSelect.bind(this);\n    this.onEdgesExportSelect = this.onEdgesExportSelect.bind(this);\n    this.onNodeImportFileSelect = this.onNodeImportFileSelect.bind(this);\n    this.onEdgeImportFileSelect = this.onEdgeImportFileSelect.bind(this);\n    this.clearNodefileSelect = this.clearNodefileSelect.bind(this);\n    this.clearEdgefileSelect = this.clearEdgefileSelect.bind(this);\n    this.clearFileSelect = this.clearFileSelect.bind(this);\n    this.onDoImport = this.onDoImport.bind(this);\n    this.unlockAll = this.unlockAll.bind(this);\n\n    UDATA = UNISYS.NewDataLink(this);\n    UDATA.HandleMessage(\"EDIT_PERMISSIONS_UPDATE\", this.handleEditStateUpdate);\n  } // constructor\n\n  componentDidMount() {\n    this.updateEditState();\n    window.addEventListener(\"beforeunload\", this.checkUnload);\n    window.addEventListener(\"unload\", this.doUnload);\n  }\n\n  componentWillUnmount() {\n    UDATA.NetCall(\"SRV_RELEASE_EDIT_LOCK\", { editor: EDITORTYPE.IMPORTER});\n    UDATA.UnhandleMessage(\"EDIT_PERMISSIONS_UPDATE\", this.handleEditStateUpdate);\n    window.removeEventListener(\"beforeunload\", this.checkUnload);\n    window.removeEventListener(\"unload\", this.doUnload);\n  }\n\n  checkUnload(e) {\n    e.preventDefault();\n    if (this.state.importIsActive) {\n      (e || window.event).returnValue = null;\n    } else {\n      Reflect.deleteProperty(e, 'returnValue');\n    }\n    return e;\n  }\n\n  doUnload(e) {\n    if (this.state.importIsActive) {\n      this.NetCall(\"SRV_RELEASE_EDIT_LOCK\", { editor: EDITORTYPE.IMPORTER });\n    }\n  }\n\n  /// UI EVENT HANDLERS /////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  handleEditStateUpdate(data) {\n    const { importIsActive } = this.state;\n    if (!importIsActive) {\n      const preventImport = data.templateBeingEdited || data.importActive || data.nodeOrEdgeBeingEdited || UNISYS.IsStandaloneMode();\n      this.setState({ preventImport });\n    }\n  }\n  updateEditState() {\n    // disable edit if someone else is editing a template, node, or edge\n    UDATA.NetCall(\"SRV_GET_EDIT_STATUS\")\n      .then(this.handleEditStateUpdate);\n    DATASTORE.PromiseCalculateMaxNodeId().then(data => {\n      this.setState({ nextNodeId: data + 1 })\n    })\n    DATASTORE.PromiseCalculateMaxEdgeId().then(data => {\n      this.setState({ nextEdgeId: data + 1 })\n    })\n  }\n\n  onNodesExportSelect() { IELOGIC.ExportNodes(); }\n  onEdgesExportSelect() { IELOGIC.ExportEdges(); }\n\n  onNodeImportFileSelect(e) {\n    const nodefile = e.target.files[0];\n    IELOGIC.NodefileValidate({ nodefile })\n      .then(result => {\n        const msg = (\n          <div>\n            <div>{result.messageTitle}</div>\n            {result.messageJsx}\n          </div>\n        )\n        // if edge file was already okToImport, then this remains OK.\n        const okToImport = this.state.edgeOkToImport || result.isValid;\n        this.setState({\n          nodeOkToImport: result.isValid,\n          okToImport,\n          nodefileStatus: result.isValid ? 'Ready to Import' : NODEFILESTATUS_DEFAULT,\n          nodeValidationMsgs: msg,\n          importMsgs: undefined\n        });\n        // Clear \"Choose File\"\n        if (!result.isValid) document.getElementById('nodefileInput').value = \"\";\n      });\n  }\n  onEdgeImportFileSelect(e) {\n    const edgefile = e.target.files[0];\n    IELOGIC.EdgefileValidate({ edgefile })\n      .then(result => {\n        const msg = (\n          <div>\n            <div>{result.messageTitle}</div>\n            {result.messageJsx}\n          </div>\n        )\n        // if edge file was already okToImport, then this remains OK.\n        const okToImport = this.state.nodeOkToImport || result.isValid;\n        this.setState({\n          edgeOkToImport: result.isValid,\n          okToImport,\n          edgefileStatus: result.isValid ? 'Ready to Import' : EDGEFILESTATUS_DEFAULT,\n          edgeValidationMsgs: msg,\n          importMsgs: undefined\n        });\n        // Clear \"Choose File\"\n        if (!result.isValid) document.getElementById('edgefileInput').value = \"\";\n      });\n  }\n\n  clearNodefileSelect() {\n    // User Cancelled, reset to default\n    // If edge import is active, then import remains active\n    const importIsActive = this.state.importIsActive || false;\n    this.setState({\n      importIsActive,\n      nodefile: undefined,\n      nodefileStatus: NODEFILESTATUS_DEFAULT,\n      nodeValidationMsgs: undefined\n    });\n    // Clear validated data so it doesn't get imported\n    if (!importIsActive) UDATA.NetCall(\"SRV_RELEASE_EDIT_LOCK\", { editor: EDITORTYPE.IMPORTER });\n    IELOGIC.ResetNodeImportData();\n   }\n\n  clearEdgefileSelect() {\n    // User Cancelled, reset to default\n    // If node import is active, then import remains active\n    const importIsActive = this.state.importIsActive || false;\n    this.setState({\n      importIsActive,\n      edgefile: undefined,\n      edgefileStatus: EDGEFILESTATUS_DEFAULT,\n      edgeValidationMsgs: undefined\n    });\n    // Clear validated data so it doesn't get imported\n    if (!importIsActive) UDATA.NetCall(\"SRV_RELEASE_EDIT_LOCK\", { editor: EDITORTYPE.IMPORTER });\n    IELOGIC.ResetEdgeImportData();\n  }\n\n  clearFileSelect() {\n    // User Cancelled, reset to default\n    UDATA.NetCall(\"SRV_RELEASE_EDIT_LOCK\", { editor: EDITORTYPE.IMPORTER });\n    document.getElementById('nodefileInput').value = \"\";\n    document.getElementById('edgefileInput').value = \"\";\n    this.clearNodefileSelect();\n    this.clearEdgefileSelect();\n\n    IELOGIC.ResetImportData();\n    this.setState({\n      nodeValidationMsgs: undefined,\n      edgeValidationMsgs: undefined,\n      importMsgs: undefined\n    })\n  }\n\n  onDoImport() {\n    if (DBG) console.log(PR, 'onDoImport');\n    IELOGIC.Import().then(result => {\n      this.setState({\n        okToImport: false, // imported, so hide \"Import\" button\n        nodeOkToImport: false,\n        edgeOkToImport: false,\n        importMsgs: result.messageJsx\n      });\n      document.getElementById('nodefileInput').value = \"\";\n      document.getElementById('edgefileInput').value = \"\";\n    });\n  }\n\n  unlockAll() {\n    UDATA.NetCall(\"SRV_DBUNLOCKALL\");\n  }\n\n/// REACT LIFECYCLE METHODS ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n  render() {\n    const {\n      preventImport,\n      importIsActive,\n      nodefile,\n      nodefileStatus,\n      edgefile,\n      edgefileStatus,\n      importMsgs,\n      allowLoggedInUserToImport,\n      nextNodeId,\n      nextEdgeId,\n      nodeValidationMsgs,\n      edgeValidationMsgs,\n      okToImport\n    } = this.state;\n\n    // Set Import Permissions\n    // -- Admins can always import\n    // -- If allowLoggedInUserToImport, logged in users can also import\n    const ISADMIN = SETTINGS.IsAdmin();\n    const isLoggedIn = NetMessage.GlobalGroupID();\n    const importDisabled = !(ISADMIN || (allowLoggedInUserToImport && isLoggedIn));\n\n    const importBtnDisabled = !okToImport;\n\n    let importjsx;\n    if (preventImport && !importIsActive) {\n      importjsx = (\n        <div\n          style={{\n            backgroundColor: 'rgba(240,240,240,0.95)',\n            marginTop: '10px',\n            padding: '10px 20px'\n          }}\n        >\n          <p><i>You cannot import data while someone is editing a node, edge,\n            or template, or in standalone view.</i></p>\n          <p><i>Please finish editing and try again.</i></p>\n        </div>\n      );\n    } else {\n      importjsx = (\n        <div\n          hidden={importDisabled}\n          style={{\n            backgroundColor: 'rgba(240,240,240,0.95)',\n            marginTop: '10px',\n            padding: '10px 20px'\n          }}\n        >\n          <h1>Import Data</h1>\n          <div className=\"small text-muted\"><i>Import .csv data</i></div>\n          <div className=\"small text-muted\">\n            To specify node and edge IDs in your import file, use the next unused ID:\n            <ul>\n              <li>Next unused NODE ID: {nextNodeId}</li>\n              <li>Next unused EDGE ID: {nextEdgeId}</li>\n            </ul>\n          </div>\n          <label className=\"small text-muted\">\n            Nodes:&nbsp;\n            <input type=\"file\" accept=\"text/csv\" id=\"nodefileInput\" onInput={this.onNodeImportFileSelect}\n              onClick={e => {\n                // Clear the selected node file whenever \"Choose File\" is clicked so that if the user\n                // cancels, the form is reset to a blank state.  This is necessary to clear out\n                // validation errors after selecting a bad node file.\n                this.clearNodefileSelect();\n              }}\n            />\n            &nbsp;<i className=\"small\">{nodefileStatus}</i><br />\n          </label><br />\n          <label className=\"small text-muted\">\n            Edges:&nbsp;\n            <input type=\"file\" accept=\"text/csv\" id=\"edgefileInput\" onInput={this.onEdgeImportFileSelect}\n              onClick={e => {\n                // Clear the selected edge file whenever \"Choose File\" is clicked so that if the user\n                // cancels, the form is reset to a blank state.  This is necessary to clear out\n                // validation errors after selecting a bad edge file.\n                this.clearEdgefileSelect();\n              }}\n            />\n            &nbsp;<i className=\"small\">{edgefileStatus}</i><br />\n          </label><br />\n          <label>\n            <Button style={{ fontSize: '0.8em', padding: '0px 2px' }} outline onClick={this.clearFileSelect}>\n              Clear File Selections\n            </Button>\n          </label><br />\n          {nodeValidationMsgs && <div className='small'>{nodeValidationMsgs}</div>}\n          {edgeValidationMsgs && <div className='small'>{edgeValidationMsgs}</div>}\n          {importMsgs && <div className='small'>{importMsgs}</div>}\n          <Button size=\"sm\" outline color={importBtnDisabled ? \"light\" : \"primary\"} disabled={importBtnDisabled} onClick={this.onDoImport}>\n            Import\n          </Button>&nbsp;\n        </div>\n      )\n    }\n\n    let unlockAlljsx;\n    if (ISADMIN) {\n      unlockAlljsx = (\n        <div>\n          <hr />\n          <h1>Admin Tools</h1>\n          <Button size=\"sm\" outline color={\"warning\"} onClick={this.unlockAll}>\n            Force Unlock All\n          </Button>\n          <label className=\"small text-muted\">\n            Unlock ALL Template, Import, Node, and Edge Editing.<br />\n            When someone on the network is editing a template, importing data, or editing a node or edge, everyone\n            else on the network is prevented from editing a template or importing data and editing nodes and edges.<br />\n            ADMINS: Use this force the server to release the lock on editing if you know the lock was left on in error,\n            e.g. you know that there is no one on the network actively editing a template, importing, editing a node or an edge.\n            <p><b>WARNING</b>: Use this with utmost caution!  If someone is actively editing or importing, you can delete their work, or even worse, <b>corrupt the database!</b></p>\n          </label>\n        </div>\n      )\n    }\n\n    return (\n      <div>\n        <div\n          style={{\n            backgroundColor: 'rgba(240,240,240,0.95)',\n            padding: '10px 20px'\n          }}\n        >\n          <h1>Export Data</h1>\n\n          <i className=\"small text-muted\">Export data in .csv format.</i><br/>\n          <Button size=\"sm\" outline onClick={this.onNodesExportSelect}>\n            Export Nodes\n          </Button>&nbsp;\n          <Button size=\"sm\" outline onClick={this.onEdgesExportSelect}>\n            Export Edges\n          </Button>&nbsp;\n        </div>\n\n        {importjsx}\n        {unlockAlljsx}\n      </div>\n    );\n  }\n\n} // class Help\n\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = ImportExport;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  ## OVERVIEW\n\n  InfoPanel shows a tab panel for selecting:\n  * hiding (showing the Graph)\n  * Filters\n  * Nodes Table\n  * Edges Table\n  * More -- Export/Import, Vocabulary, Help\n\n  The panel itself can be resized vertically.\n\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nvar DBG = false;\nvar UDATA = null;\n\nconst defaultTabPanelHeight = 42; // show only tab buttons, no gap\n\n/// UNISYS INITIALIZE REQUIRES for REACT ROOT /////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst UNISYS = require('unisys/client');\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst React = require('react');\nconst ReactStrap = require('reactstrap');\nconst { TabContent, TabPane, Nav, NavItem, NavLink, Row, Col, Button } = ReactStrap;\nconst classnames = require('classnames');\n\nconst NodeTable = require('./NodeTable');\nconst EdgeTable = require('./EdgeTable');\nconst More = require('./More');\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// export a class object for consumption by brunch/require\nclass InfoPanel extends UNISYS.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      activeTab: '1',\n      tabpanelTop: '0',\n      draggerMouseOffsetY: '0',   // Mouse click position inside dragger\n                                  // Allows user to grab dragger from the middle\n      tabpanelHeight: `${defaultTabPanelHeight}px`,\n      tableHeight: '308px', // 350 - defaultTabPanelHeight\n      savedTabpanelHeight: '350px',\n      draggerTop: 'inherit',\n      hideDragger: true,\n      filtersSummary: ''\n    }\n\n    this.toggle = this.toggle.bind(this);\n    this.handleMouseDown = this.handleMouseDown.bind(this);\n    this.endDrag = this.endDrag.bind(this);\n    this.handleDrag = this.handleDrag.bind(this);\n    this.UpdateFilterSummary = this.UpdateFilterSummary.bind(this);\n    this.OnClearBtnClick = this.OnClearBtnClick.bind(this);\n    this.CloseMore = this.CloseMore.bind(this);\n\n    UDATA = UNISYS.NewDataLink(this);\n    UDATA.HandleMessage(\"FILTER_SUMMARY_UPDATE\", this.UpdateFilterSummary);\n    UDATA.HandleMessage(\"UI_CLOSE_MORE\", this.CloseMore);\n  } // constructor\n\n\n\n  /// UI EVENT HANDLERS /////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/\n  /*/\n  toggle(tab) {\n    window.event.stopPropagation();\n    if (this.state.activeTab !== tab) {\n      this.setState({ activeTab: tab });\n      if ((tab === `1`) || (tab === '6')) { // graph or help\n        this.setState({\n          tabpanelHeight: `${defaultTabPanelHeight}px`, // show only tab buttons\n          hideDragger: true\n        });\n      } else {\n        this.setState({\n          tabpanelHeight: this.state.savedTabpanelHeight,\n          hideDragger: false\n        });\n      }\n    } else {\n      // Second click on currently open tab\n      // so select tab 1\n      this.setState({ activeTab: `1` });\n      this.setState({\n        tabpanelHeight: `${defaultTabPanelHeight}px`, // show only tab buttons\n        hideDragger: true\n      });\n    }\n  }\n\n  handleMouseDown(e) {\n    e.stopPropagation();\n\n    let dragger = e.target;\n    this.setState({ draggerMouseOffsetY: dragger.offsetTop - e.clientY });\n\n    document.onmouseup = this.endDrag;\n    document.onmousemove = this.handleDrag;\n  }\n  handleDrag(e) {\n    e.stopPropagation();\n    // limit to 122 to keep from dragging up past the tabpanel\n    // 122 = navbar + tabpanel height\n    let top = Math.max(122, e.clientY + this.state.draggerMouseOffsetY + defaultTabPanelHeight);\n    this.setState({\n      tabpanelHeight: (top - this.state.tabpanelTop - 40) + 'px',\n      tableHeight: (top - this.state.tabpanelTop - 40 - defaultTabPanelHeight) + 'px',\n      savedTabpanelHeight: (top - this.state.tabpanelTop - 40) + 'px'  // remember height when switching tabs\n    });\n  }\n  endDrag() {\n    document.onmouseup = null;\n    document.onmousemove = null;\n  }\n\n  UpdateFilterSummary(data) {\n    this.setState({ filtersSummary: data.filtersSummary });\n  }\n\n  OnClearBtnClick() {\n    UDATA.LocalCall('FILTER_CLEAR');\n  }\n\n  CloseMore() {\n    this.toggle('1');\n  }\n\n\n  /// REACT LIFECYCLE METHODS ///////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ This is not yet implemented as of React 16.2.  It's implemented in 16.3.\n      getDerivedStateFromProps (props, state) {\n        console.error('getDerivedStateFromProps!!!');\n      }\n  /*/\n  /*/ This this fires after render().\n  /*/\n  componentDidMount() {\n    let tabpanel = document.getElementById('tabpanel');\n    this.setState({\n      tabpanelTop: tabpanel.offsetTop\n    });\n  }\n\n  componentWillUnmount() {\n    UDATA.UnhandleMessage(\"FILTER_SUMMARY_UPDATE\", this.UpdateFilterSummary);\n    UDATA.UnhandleMessage(\"UI_CLOSE_MORE\", this.CloseMore);\n  }\n\n  shouldComponentUpdate(props) {\n    return true;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/\n  /*/\n  render() {\n    const {\n      activeTab, tabpanelHeight, tableHeight, hideDragger, draggerTop, filtersSummary\n    } = this.state;\n    //send flag in with tableheight\n    return (\n      <div>\n        <div id='tabpanel'\n          style={{ height: tabpanelHeight, overflow: 'hidden', backgroundColor: '#eee'}}>\n          <Nav tabs className=''>\n            <NavItem>\n              <NavLink\n                className={classnames({ active: activeTab === '1' })}\n                onClick={() => { this.toggle('1'); this.sendGA('Graph', window.location); } }\n              >\n                Graph\n              </NavLink>\n            </NavItem>\n            <NavItem>\n              <NavLink\n                className={classnames({ active: activeTab === '3' })}\n                onClick={() => { this.toggle('3'); this.sendGA('Nodes Table', window.location); }}\n              >\n                Nodes Table\n              </NavLink>\n            </NavItem>\n            <NavItem>\n              <NavLink\n                className={classnames({ active: activeTab === '4' })}\n                onClick={() => { this.toggle('4'); this.sendGA('Edges Table', window.location); }}\n              >\n                Edges Table\n              </NavLink>\n            </NavItem>\n            <NavItem>\n              <NavLink\n                className={classnames({ active: activeTab === '6' })}\n                onClick={() => { this.toggle('6'); this.sendGA('Help', window.location); }}\n              >\n                More...\n              </NavLink>\n            </NavItem>\n          </Nav>\n          <TabContent activeTab={activeTab} style={{height:'100%',overflow: 'hidden', backgroundColor: 'rgba(0,0,0,0.1)'}}>\n            <TabPane tabId=\"1\">\n            </TabPane>\n            <TabPane tabId=\"3\">\n              <Row>\n                <Col sm=\"12\">\n                  {activeTab===\"3\" && <NodeTable tableHeight={tableHeight} /> }\n                </Col>\n              </Row>\n            </TabPane>\n            <TabPane tabId=\"4\">\n              <Row>\n                <Col sm=\"12\">\n                  {activeTab===\"4\" && <EdgeTable tableHeight={tableHeight} /> }\n                </Col>\n              </Row>\n            </TabPane>\n            <TabPane tabId=\"6\">\n              <More />\n            </TabPane>\n          </TabContent>\n        </div>\n\n        <div id='dragger' hidden={hideDragger}\n          style={{\n            position: 'relative', top: '0px', left: '0px', right: '0px', height: '10px', backgroundColor: 'gray',\n            cursor: 'ns-resize'\n          }}\n          onMouseDown={this.handleMouseDown}\n        ></div>\n\n        <div hidden={!hideDragger || filtersSummary===''}\n          style={{ padding: '3px 5px', fontSize: '0.8em', textAlign: 'right', color:'#fff', backgroundColor:'#3339'}}\n        >\n          {filtersSummary}&nbsp;<Button size=\"sm\" outline onClick={this.OnClearBtnClick} style={{ color: '#eee', borderColor: '#ddd', fontSize: '0.8em', padding: '0.1rem 0.2rem' }}>Clear Filters</Button>\n        </div>\n      </div>\n    );\n  }\n\n  sendGA(actionType, url){\n\n          let googlea = NC_CONFIG.googlea;\n          if(googlea != \"0\"){\n            ga('send', { hitType: 'event', eventCategory: 'Tab', eventAction: actionType, eventLabel: '' + url  });\n          }\n  }\n\n} // class InfoPanel\n\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = InfoPanel;\n","/*\n    Optimized Markdwon React Component\n\n    This is based on Joshua's implementation of Markdown React in NodeTable and EdgeTable.\n\n    This component wrap the MDReactComponent and only updates when the text changes.\n\n */\n\n\nimport MDReactComponent from 'markdown-react-js';\nconst mdplugins = {\n  emoji: require('markdown-it-emoji')\n};\n\nconst React = require('react');\nconst UNISYS = require('unisys/client');\n\n\nclass MarkdownNote extends UNISYS.Component {\n  constructor() {\n    super();\n    this.markdownIterate = this.markdownIterate.bind(this);\n  }\n\n  markdownIterate(Tag, props, children) {\n    if (Tag === 'a') {\n      props.target = '_blank';\n    }\n    return <Tag {...props}>{children}</Tag>;\n  }\n\n  shouldComponentUpdate(np,ns) {\n    let bReturn = true;\n    if (this.text === np.text) bReturn = false;\n    else this.text = np.text;\n    return bReturn;\n  }\n\n  render() {\n    const { text } = this.props;\n    return (\n      <MDReactComponent\n        text={text}\n        onIterate={this.markdownIterate}\n        markdownOptions={{ typographer: true, linkify: true }}\n        plugins={[mdplugins.emoji]}\n      />\n    );\n  }\n\n}\n\nmodule.exports = MarkdownNote;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  ## OVERVIEW\n\n  \"More\" displays:\n  * Export/Import\n  * Help\n  * Vocabulary\n\n\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nvar DBG = false;\nvar UDATA = null;\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst React        = require('react');\nconst ReactStrap   = require('reactstrap');\nconst { TabContent, TabPane, Nav, NavItem, NavLink, Row, Col, Button } = ReactStrap;\nconst classnames = require('classnames');\nconst SETTINGS = require('settings');\nconst Help = require('./Help');\nconst Vocabulary = require('./Vocabulary');\nconst ImportExport = require('./ImportExport');\nconst Template = require('./Template');\n\nconst UNISYS   = require('unisys/client');\n\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// export a class object for consumption by brunch/require\nclass More extends UNISYS.Component {\n  constructor (props) {\n    super(props);\n    this.state = {\n      isExpanded: true,\n      activeTab: '1'\n    };\n    this.toggleTab = this.toggleTab.bind(this);\n\n    UDATA = UNISYS.NewDataLink(this);\n  } // constructor\n\n\n  /// UI EVENT HANDLERS /////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  toggleTab(tab) {\n    window.event.stopPropagation();\n    if (this.state.activeTab !== tab) {\n      this.setState({ activeTab: tab });\n    }\n  }\n\n/// REACT LIFECYCLE METHODS ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ This is not yet implemented as of React 16.2.  It's implemented in 16.3.\n    getDerivedStateFromProps (props, state) {\n      console.error('getDerivedStateFromProps!!!');\n    }\n/*/\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  render() {\n    const { activeTab } = this.state;\n    const ISADMIN = SETTINGS.IsAdmin();\n    return (\n      <div className=\"help\"\n        style={{\n          position: 'fixed',\n          right: '10px',\n          width: '50%',\n          height: '90%',\n          overflow: 'hidden',\n          zIndex: '3000',\n          padding: '10px',\n          backgroundColor: '#fff', // match tab\n          border: '1px solid #999',\n          borderTop: 'none'\n        }}\n      >\n        <div style={{\n          height: '100%',\n          overflow: 'hidden',\n          padding: '10px'\n        }}>\n          <div id='tabpanel' >\n            <Nav tabs>\n              <NavItem>\n                <NavLink\n                  className={classnames({ active: activeTab === '1' })}\n                  onClick={() => { this.toggleTab('1') } }\n                >\n                  Help\n                </NavLink>\n              </NavItem>\n              <NavItem>\n                <NavLink\n                  className={classnames({ active: activeTab === '2' })}\n                  onClick={() => { this.toggleTab('2') }}\n                >\n                  Vocabulary\n                </NavLink>\n              </NavItem>\n              <NavItem>\n                <NavLink\n                  className={classnames({ active: activeTab === '3' })}\n                  onClick={() => { this.toggleTab('3') }}\n                >\n                  Import / Export\n                </NavLink>\n              </NavItem>\n              <NavItem>\n                <NavLink\n                  hidden={!ISADMIN}\n                  className={classnames({ active: activeTab === '4' })}\n                  onClick={() => { this.toggleTab('4') }}\n                >\n                  Edit Template\n                </NavLink>\n              </NavItem>\n            </Nav>\n          </div>\n          <TabContent activeTab={activeTab} style={{\n            height: '100%',\n            overflow: 'scroll'\n          }}>\n            <TabPane tabId=\"1\">\n              {activeTab===\"1\" && <Help /> }\n            </TabPane>\n            <TabPane tabId=\"2\">\n              {activeTab===\"2\" && <Vocabulary /> }\n            </TabPane>\n            <TabPane tabId=\"3\">\n              {activeTab===\"3\" && <ImportExport /> }\n            </TabPane>\n            <TabPane tabId=\"4\">\n              {activeTab===\"4\" && <Template /> }\n            </TabPane>\n          </TabContent>\n        </div>\n      </div>\n    );\n  }\n\n} // class Help\n\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = More;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n    NetGraph is a React wrapper for a D3 net graph component.\n\n    This component uses React to create the base dom element, but D3NetGraph\n    handles the data updates, rendering and animation updates.\n\n    React is explicitly prevented from updating the component (see\n    shouldComponentUpdate)\n\n    ## TO USE\n\n            <NetGraph/>\n\n    ## Why not use FauxDom?\n\n    https://lab.oli.me.uk/react-faux-dom-state/\n    This article suggests that maybe using force graphs with react-faux-dom\n    not quite work.\n        \"If you want to animate things, use a React animation library (theyre\n         great and work fine with faux DOM), you have to find the React way to\n         do things, sadly some D3 concepts just dont translate. If you want\n         some physics based graph full of state then youre probably better\n         off keeping to the original way of embedding D3 in React, dropping\n         out of React and letting D3 mutate that element.\"\n    Indeed, in our testing, the animation updates were not optimal.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nvar DBG = false;\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst React      = require('react')\nconst ReactDOM   = require('react-dom')\nconst ReactStrap = require('reactstrap');\nconst { Button } = ReactStrap;\nconst D3NetGraph = require('./d3-simplenetgraph')\nconst UNISYS     = require('unisys/client');\n\nlet UDATA = null;\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// export a class object for consumption by brunch/require\nclass NetGraph extends UNISYS.Component {\n    constructor (props) {\n      super(props)\n      this.state = {\n        d3NetGraph: {},\n        nodeTypes: [],\n        edgeTypes: []\n      }\n\n      this.onZoomReset = this.onZoomReset.bind(this);\n      this.onZoomIn    = this.onZoomIn.bind(this);\n      this.onZoomOut   = this.onZoomOut.bind(this);\n      this.updateLegend = this.updateLegend.bind(this);\n      this.constructGraph = this.constructGraph.bind(this);\n\n      /// Initialize UNISYS DATA LINK for REACT\n      UDATA = UNISYS.NewDataLink(this);\n\n      this.OnAppStateChange('TEMPLATE', this.updateLegend);\n      UDATA.HandleMessage('CONSTRUCT_GRAPH', this.constructGraph);\n\n    } // constructor\n\n\n/// CLASS PRIVATE METHODS /////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ onZoomReset() {\n      this.AppCall('ZOOM_RESET', {});\n    }\n/*/\n/*/ onZoomIn() {\n      this.AppCall('ZOOM_IN', {});\n    }\n/*/\n/*/ onZoomOut() {\n      this.AppCall('ZOOM_OUT', {});\n    }\n\n    updateLegend() {\n      // Update Legends\n      const TEMPLATE = this.AppState('TEMPLATE');\n      const nodeTypes = TEMPLATE.nodeDefs.type.options;\n      const edgeTypes = TEMPLATE.edgeDefs.type.options;\n      this.setState({ nodeTypes, edgeTypes }, () => {\n        this.forceUpdate(); // just once, needed to overcome shouldComponentUpdate override\n      });\n    }\n\n\n    /// REACT LIFECYCLE ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ constructGraph() {\n      // first destroy any existing SVG graph elements\n      const netgraph = document.getElementById('netgraph');\n      if (netgraph) netgraph.remove();\n\n      // D3NetGraph Constructor\n      const el = ReactDOM.findDOMNode(this);\n      const TEMPLATE = this.AppState('TEMPLATE');\n      if (this.state.d3NetGraph && this.state.d3NetGraph.Deregister) {\n        // if d3NetGraph was previously created, deregister it so it stops receiving data updates\n        this.state.d3NetGraph.Deregister();\n      }\n      const d3NetGraph = new D3NetGraph(el, TEMPLATE.nodeDefs);\n      const nodeTypes = TEMPLATE.nodeDefs.type.options;\n      const edgeTypes = TEMPLATE.edgeDefs.type.options;\n      this.setState({ d3NetGraph, nodeTypes, edgeTypes });\n      this.forceUpdate(); // just once, needed to overcome shouldComponentUpdate override\n    }\n\n/// REACT LIFECYCLE ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ componentDidMount() {\n      this.constructGraph();\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ componentWillUnMount() {\n      this.AppStateChangeOff('TEMPLATE', this.updateLegend);\n      UDATA.UnhandleMessage('CONSTRUCT_GRAPH', this.constructGraph);\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ shouldComponentUpdate () {\n      // This prevents React from updating the component,\n      // allowing D3 to handle the simulation animation updates\n      // This is also necessary for D3 to handle the\n      // drag events.\n      return false;\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ render() {\n      const { nodeTypes, edgeTypes } = this.state;\n      return (\n        <div style={{ height: '100%' }}>\n          <div style={{ margin: '10px 0 0 10px' }}>\n            <div className=\"tooltipAnchor\">\n              <span style={{ fontSize: '9px' }}>\n                <div className=\"badge\">?</div>\n                NETGRAPH for {this.AppState('TEMPLATE').name}\n              </span>\n                <span style={{ fontSize: '12px' }} className=\"tooltiptext\">{this.AppState('TEMPLATE').description}</span>\n            </div>\n          </div>\n          <div style={{ position: 'absolute', right: '10px', width: '50px', zIndex:1001 }}>\n            <Button outline onClick={this.onZoomIn} style={{ width:'35px', backgroundColor: '#fff', opacity: '0.8' }}>+</Button>&nbsp;\n            <Button outline onClick={this.onZoomReset} style={{ width: '35px', backgroundColor: '#fff', opacity: '0.8'  }}>&bull;</Button>&nbsp;\n            <Button outline onClick={this.onZoomOut} style={{ width: '35px', backgroundColor: '#fff', opacity: '0.8'  }}>-</Button>\n          </div>\n          <div style={{ position: 'absolute', bottom: '40px', marginLeft: '10px', marginBottom: '15px',fontSize: '10px' }}>\n\n            <div style={{ display: 'inline-block', paddingRight: '2em' }}>KEY</div>\n            <br></br>\n            <div style={{ display: 'inline-block', paddingRight: '2em' }}> - Node Types:</div>\n            {nodeTypes.map((type, i) => (\n               <div key={i} className=\"tooltipAnchor\">\n                <div style={{ display: 'inline-block', paddingRight: '2em', lineHeight: '10px' }}>\n                  <div style={{ display: 'inline-block', width: '10px', height: '8px', backgroundColor: type.color }}></div>\n                    &nbsp;{ (type.label==='') ? 'No Type Selected' : type.label }\n                  </div>\n                   <span className=\"tooltiptextabove\">{ (type.label==='') ? 'No Type Selected' : type.help || type.label }</span>\n                </div>\n\n            ))}\n           <br></br>\n          <div style={{ display: 'inline-block', paddingRight: '2em' }}> - Edge Types:</div>\n            {edgeTypes.map((type, i) => (\n               <div key={i} className=\"tooltipAnchor\">\n                <div style={{ display: 'inline-block', paddingRight: '2em', lineHeight: '10px' }}>\n                  <div style={{ display: 'inline-block', width: '10px', height: '8px', backgroundColor: type.color }}></div>\n                    &nbsp;{ (type.label==='') ? 'No Type Selected' : type.label }\n                  </div>\n                   <span className=\"tooltiptextabove\">{ (type.label==='') ? 'No Type Selected' : type.help || type.label }</span>\n                </div>\n\n            ))}\n\n          </div>\n        </div>\n      )\n    }\n} // class NetGraph\n\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = NetGraph;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Node Detail is a display widget that shows all of the meta information\n  contained in each data node.\n\n  If label is undefined the component will not be shown.\n\n  Node Detail automatically shows the SELECTION.hilitedNode object.\n\n\n  ## TO USE\n\n    Add the following to the render() of the parent component:\n\n      render() {\n        return (\n          ...\n                <NodeDetail/>\n          ...\n        )\n      }\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nvar DBG = false;\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst React = require('react')\nconst ReactStrap = require('reactstrap')\nconst { Table, FormText } = ReactStrap\n\nconst UNISYS   = require('unisys/client');\n\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// export a class object for consumption by brunch/require\nclass NodeDetail extends UNISYS.Component {\n    constructor (props) {\n      super(props)\n      this.state = {\n        label: undefined,\n        type: '',\n        info: '',\n        notes: ''\n      }\n      this.handleSelection  = this.handleSelection.bind(this);\n\n      // Always make sure that class methods are bind()'d before\n      // assigning them to a handler\n      this.OnAppStateChange('SELECTION',( stateChange ) => {\n        this.handleSelection(stateChange.hilitedNode);\n      });\n    } // constructor\n\n\n\n/// UI HANDLERS ///////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ handleSelection( hilitedNode ) {\n      let node = hilitedNode || {};\n      node.attributes = node.attributes || {};    // validate attributes\n      this.setState({\n        label: node.label,\n        type: node.type,\n        info: node.info,\n        notes: node.notes\n      });\n    } // handleSelection\n\n\n\n/// REACT LIFECYCLE METHODS ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ render () {\n      return (\n        <div className={this.state.label===undefined ? \"d-none\" : \"\"}\n             style={{minHeight:'300px',minWidth:'240px',backgroundColor:'#c7f1f1',padding:'5px',marginBottom:'10px'}}>\n          <FormText>NODE DETAIL (RF)</FormText>\n          <Table borderless striped size=\"sm\"><tbody>\n            <tr><td>Label:&nbsp;&nbsp;</td><td>{this.state.label}</td></tr>\n            <tr><td>Type: </td><td>{this.state.type}</td></tr>\n            <tr><td>Notes:</td><td>{this.state.notes}</td></tr>\n            <tr><td>Info: </td><td>{this.state.info}</td></tr>\n          </tbody></Table>\n        </div>\n      )\n    }\n} // class NodeDetail\n\n\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = NodeDetail;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n    ## OVERVIEW\n\n    NodeSelector is a form for searching for, viewing, selecting, and editing\n    Node information.\n\n    NodeSelector does not modify any data.  It passes all events (text updates,\n    highlights, and suggestion selections) up to nc-logic. it\n    should process the events and update the data accordingly.  The\n    updated data is then rendered by NodeSelector.\n\n    ## USAGE\n\n      <NodeSelector/>\n\n    ## TECHNICAL DESCRIPTION\n\n    NodeSelector handles three basic functions:\n\n    1. Display the current SELECTION.nodes[0]\n    2. Support input of node fields\n    3. Send updated node field data to SOURCE_UPDATE\n\n    As the user edits the form, we locally save the changes and send it to UNISYS\n    when the user clicks \"SAVE\"\n\n    The currently selected/editing node is set via SELECTION.nodes.\n\n    Updates are sent to UNISYS via SOURCE_UPDATE.\n\n    The AutoComplete search field is handled a little differently from the other\n    input fields because it is independent of NodeSelector.  In order to keep\n    NodeSelector's internal representation of form data up-to-date, we rely on\n    the SELECTION updates' searchLabel field to update the label.\n\n    There are different levels of write-access:\n\n      isLocked        Nodes can be selected for viewing, but editing\n                      cannot be enabled.\n\n      isStandalone    Nodes can be selected for viewing, but editing\n                      cannot be enabled.\n\n      disableEdit     Template is being edited, disable \"Edit Node\" button\n\n      isBeingEdited   The form fields are active and text can be changed.\n\n\n    Delete Button\n    The Delete button is only displayed for an admin user.  Right now we are detecting\n    this by displaying it only when the user is on `localhost`,\n\n\n    ## STATES\n\n      formData        Node data that is shown in the form\n\n      isLocked        If true (defauilt), nodes can be displayed, but\n                      \"Add New Node\" and \"Edit Node\" buttons are hidden.\n                      The state is unlocked when the user logs in.\n\n      isEditable      If true, form fields are enabled for editing\n                      If false, form is readonly\n\n      dbIsLocked\n                      If someone else has selected the node for editing,\n                      this flag will cause the dbIsLockedMessage\n                      to be displayed.  This is only checked when\n                      the user clicks \"Edit\".\n\n\n    ## TESTING\n\n    Edit Existing Node\n\n      1. Type 'ah'\n            * Nodes on graph should hilite\n            * Suggestions should be displayed\n            * \"Add New Node\" should be shown.\n      2. Highlight 'Ah Sing'\n            * Ah Sing node detail should be shown\n      3. Unhighlight all selections (move mouse out)\n            * NodeDetail should disappear\n      4. Click 'Ah Sing'\n            * 'Ah Sing's details should load in form\n            * \"Edit Node\" button should be shown.\n      5. Click \"Edit Node\"\n            * \"Save\" should be shown\n            * All fields should be enabled\n      6. Edit 'Ah Sing' to 'Ah Sing A'\n            * Form should not change\n            * Hilited graph node should go away\n      7. Edit fields (add text)\n      8. Click \"Save\"\n            * Form should clear\n      9. Check 'Ah Sing' contents to make sure changes were saved\n\n    Create New Node\n\n      1. Type 'ah'\n            * Nodes on graph should hilite\n            * Suggestions should be displayed\n            * \"Add New Node\" should be shown.\n      2. Click 'Add New Node'\n            * Fields should be enabled\n            * A new ID should be added\n            * \"Save\" button should appear\n      3. Edit fields\n      4. Click \"Save\"\n            * New node should appear in graph\n            * The node should have the label you added 'ah'\n      5. Select the node to verify the contents\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nimport { mdReact } from 'markdown-react-js';\nconst mdplugins = {\n  emoji: require('markdown-it-emoji')\n};\n\nconst DBG = false;\nconst PR  = 'NodeSelector';\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst React        = require('react');\nconst ReactStrap   = require('reactstrap');\nconst { Button, Col, Form, FormGroup, FormFeedback, FormText, Label, Input } = ReactStrap;\nconst AutoComplete = require('./AutoComplete');\nconst NodeDetail   = require('./NodeDetail');\nconst EdgeEditor   = require('./EdgeEditor');\n\nconst UNISYS       = require('unisys/client');\nconst DATASTORE    = require('system/datastore');\nconst SETTINGS     = require('settings');\nconst { EDITORTYPE } = require(\"system/util/enum\");\n\nconst thisIdentifier = 'nodeSelector';   // SELECTION identifier\n\nconst isAdmin  = SETTINGS.IsAdmin();\n\nvar   UDATA        = null;\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// export a class object for consumption by brunch/require\nclass NodeSelector extends UNISYS.Component {\n    constructor (props) {\n      super(props);\n      const TEMPLATE = this.AppState('TEMPLATE');\n      this.state = {\n        nodeDefs: TEMPLATE.nodeDefs,\n        citation: TEMPLATE.citation,\n        duplicateWarning: TEMPLATE.duplicateWarning,\n        nodeIsLockedMessage: TEMPLATE.nodeIsLockedMessage,\n        editLockMessage: '',\n        hideDeleteNodeButton: TEMPLATE.hideDeleteNodeButton,\n        formData: {\n            label:     '',\n            type:      '',\n            info:      '',\n            notes:     '',\n            degrees: -1,\n            id:        '',   // Always convert this to a Number\n            isNewNode: true\n        },\n        edges:         [],\n        isLocked:       true,\n        isStandalone: false,\n        edgesAreLocked: false,\n        dbIsLocked: false,\n        disableEdit: false,\n        isBeingEdited: false,\n        isValid:       false,\n        isDuplicateNodeLabel: false,\n        duplicateNodeID:   '',\n        replacementNodeID: '',\n        isValidReplacementNodeID: true,\n        hideModal: true\n      };\n      // Bind functions to this component's object context\n      this.clearForm                             = this.clearForm.bind(this);\n      this.setTemplate = this.setTemplate.bind(this);\n      this.updateEditState = this.updateEditState.bind(this);\n      this.setEditState = this.setEditState.bind(this);\n      this.releaseOpenEditor = this.releaseOpenEditor.bind(this);\n      this.getNewNodeID                          = this.getNewNodeID.bind(this);\n      this.handleSelection                       = this.handleSelection.bind(this);\n      this.onStateChange_SEARCH                  = this.onStateChange_SEARCH.bind(this);\n      this.onStateChange_SESSION                 = this.onStateChange_SESSION.bind(this);\n      this.loadFormFromNode                      = this.loadFormFromNode.bind(this);\n      this.validateForm                          = this.validateForm.bind(this);\n      this.onLabelChange                         = this.onLabelChange.bind(this);\n      this.onTypeChange                          = this.onTypeChange.bind(this);\n      this.onNotesChange                         = this.onNotesChange.bind(this);\n      this.onInfoChange                          = this.onInfoChange.bind(this);\n      this.onReplacementNodeIDChange             = this.onReplacementNodeIDChange.bind(this);\n      this.onNewNodeButtonClick                  = this.onNewNodeButtonClick.bind(this);\n      this.onDeleteButtonClick                   = this.onDeleteButtonClick.bind(this);\n      this.onEditButtonClick                     = this.onEditButtonClick.bind(this);\n      this.onCiteButtonClick                     = this.onCiteButtonClick.bind(this);\n      this.onCloseCiteClick                      = this.onCloseCiteClick.bind(this);\n      this.dateFormatted                         = this.dateFormatted.bind(this);\n      this.requestEditNode                       = this.requestEditNode.bind(this);\n      this.editNode                              = this.editNode.bind(this);\n      this.onAddNewEdgeButtonClick               = this.onAddNewEdgeButtonClick.bind(this);\n      this.onCancelButtonClick                   = this.onCancelButtonClick.bind(this);\n      this.onEditOriginal                        = this.onEditOriginal.bind(this);\n      this.onCloseDuplicateDialog                = this.onCloseDuplicateDialog.bind(this);\n      this.onSubmit                              = this.onSubmit.bind(this);\n      this.checkUnload                           = this.checkUnload.bind(this);\n      this.doUnload                              = this.doUnload.bind(this);\n      this.onForceUnlock                         = this.onForceUnlock.bind(this);\n\n      // NOTE: assign UDATA handlers AFTER functions have been bind()'ed\n      // otherwise they will lose context\n\n      /// Initialize UNISYS DATA LINK for REACT\n      UDATA = UNISYS.NewDataLink(this);\n\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ SESSION is called by SessionSHell when the ID changes\n      set system-wide. data: { classId, projId, hashedId, groupId, isValid }\n  /*/ this.OnAppStateChange('SESSION',this.onStateChange_SESSION);\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n      this.OnAppStateChange('SELECTION',this.handleSelection);\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n      this.OnAppStateChange('SEARCH', this.onStateChange_SEARCH);\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n      // Handle Template updates\n      this.OnAppStateChange('TEMPLATE', this.setTemplate);\n      UDATA.HandleMessage(\"EDIT_PERMISSIONS_UPDATE\", this.setEditState);\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ If someone on the network updates a node or edge, SOURCE_UPDATE is broadcast.\n      We catch it here and update the selection if the node we're displaying matches\n      the updated node.\n      This basically handles updated Node labels in both the main node and in related\n      edges.\n  /*/\n      UDATA.HandleMessage(\"SOURCE_UPDATE\", (data) => {\n        let needsUpdate = false;\n        let currentNodeID = this.state.formData.id;\n        let updatedNodeID = data.node.id;\n        if (currentNodeID === updatedNodeID) needsUpdate = true;\n        this.state.edges.forEach(edge => {\n          if ((edge.source === updatedNodeID) || (edge.target === updatedNodeID)) needsUpdate = true;\n        })\n        if (needsUpdate) {\n          if (DBG) console.log('NodeSelector.SOURCE_UPDATE triggering SOURCE_SELECT with', currentNodeID)\n          UDATA.LocalCall('SOURCE_SELECT', { nodeIDs: [currentNodeID] });\n        }\n      });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ NODE_EDIT is usually requested by NodeTable.\n      Only allow edit if the request has a valid nodeID\n      Ignore the request if we're already editing a node.\n  /*/\n      UDATA.HandleMessage(\"NODE_EDIT\", (data) => {\n        const { isBeingEdited, isLocked } = this.state;\n        if ( (data.nodeID!==undefined) && (typeof data.nodeID===\"number\") && !isBeingEdited && !isLocked ) {\n          this.requestEditNode(data.nodeID);\n        } else {\n          if (typeof data.nodeID !== \"number\") console.warn(\"NodeSelector.NODE_EDIT called with bad data.nodeID:\", data.nodeID);\n          if (isBeingEdited) console.warn(\"NodeSelector.NODE_EDIT denied because isBeingEdited\", isBeingEdited);\n          if (isLocked) console.warn(\"NodeSelector.NODE_EDIT denied because isLocked\", isLocked);\n        }\n      });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ This will add any new edges that have links to the currently selected node\n      to the list of edges in the NodeSelector.\n      IMPORTANT: We ignore edge updates if an edge is currently being edited to\n      prevent edge updates from clobbering the edit.  The list of edges is\n      updated after the edit is completed, so new edges are added then.\n  /*/\n      UDATA.HandleMessage(\"EDGE_UPDATE\", (data) => {\n        if (DBG) console.log('NodeSelector: Received EDGE_UPDATE edgesAreLocked', this.state.edgesAreLocked, data);\n        let currentNodeID = this.state.formData.id;\n        /* EDGE_UPDATES are triggered under two circumnstances:\n           a. When an existing edge is updated\n           b. When a new edge is created\n           The call sequence is:\n           1. EdgeEditor.Submit calls datastore.DB_UPDATE\n           2. datastore.DB_UPDATE calls server.SRV_DBUPDATE\n           3. server.SRV_DBUPDATE broadcasts EDGE_UPDATE\n              At this point, edge.source and edge.target are broadcast as Numbers.\n           4. EDGE_UPDATE is handled by:\n              a. nc-logic.handleMessage(\"EDGE_UPDATE\"), and\n              b. NodeSelector.handlemMessage(\"EDGE_UPDATE\") (this method)\n           5. nc-logic.handleMessage(\"EDGE_UPDATE\") processes the data and\n              actually adds a new edge or updates the existing edge in D3DATA.\n              *** The key is that there is a difference in how it's handled.\n              For updates, the edge is simply updated.\n              But for new edges, the edge object is updated and then pushed to D3DATA.\n           6. When the edge object is pushed to D3DATA, D3 processes it and converts\n              edge.source and edge.target into node objects.\n              *** By the time NodeSelector receives the edge data, edge.source and\n              edge.target are node objects, not numbers.\n           So this method needs to account for the fact that edge.source and edge.target might be\n           received as either numbers or objects.\n        */\n        let sourceID = typeof data.edge.source === \"number\" ? data.edge.source : data.edge.source.id;\n        let targetID = typeof data.edge.target === \"number\" ? data.edge.target : data.edge.target.id;\n        let updatedNodeIDs = [sourceID, targetID];\n        if (updatedNodeIDs.includes(currentNodeID) && !this.state.edgesAreLocked) {\n          if (DBG) console.log('NodeSelector: EDGE UPDATE: Calling SOURCE_SELECT!');\n          UDATA.LocalCall('SOURCE_SELECT', { nodeIDs: [currentNodeID] });\n        }\n      });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ Handler for canceling a new edge\n      Called by EdgeEditor\n      Normally we would just use SOURCE_SELECT to reload the node.\n      There are two issues with just using SOURCE_SELECT:\n      1. This special handler is necessary because the newly added edge\n         component is not affected by updates to this.state.edges.  Its key\n         is not in the this.state.edges array, so it is not properly cleared\n         even if we use SOURCE_SELECT to reset the node.\n      2. In order for `handleSelection` to properly reload all the edges,\n         two states have to be cleared first: this node needs to NOT be\n         the ACTIVEAUTOCOMPLETE field, and this node's edges need to be\n         EDGEEDIT_UNLOCKed.  The problem is that these states are set\n         asynchronously, so `handleSelection` ends up getting called\n         before the states are updated.\n      To fix this, we use setState's callback to trigger the reload.\n\n      Call this with no data object to trigger deselect.  Used when\n      source is deleted by admin user.\n  /*/\n      UDATA.HandleMessage(\"EDGE_NEW_CANCEL\", data => {\n        if (data.nodeID === this.state.formData.id) {\n          this.setState({ edgesAreLocked: false }, () => {\n            // Do this in callback, otherwise, edges are not unlocked\n            // and the source_select never triggers an update\n            UDATA.LocalCall('SOURCE_SELECT', { nodeIDs: [this.state.formData.id] });\n          });\n        } else {\n          // Edge is requesting a SOURCE deselect because the source\n          // node was deleted by admin\n          this.setState({ edgesAreLocked: false }, () => {\n            // Do this in callback, otherwise, edges are not unlocked\n            // and the source_select never triggers an update\n            UDATA.LocalCall('SOURCE_SELECT');  // Deselect\n          });\n        }\n      });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n      // This handler is not necessary because SELECTION event clears the form\n      // UDATA.HandleMessage(\"NODE_DELETE\", (data) => {\n      // });\n      // This handler is not necessary because SELECTION event will update the edges\n      // UDATA.HandleMessage(\"EDGE_DELETE\", (data) => {\n      // });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ This keeps track of whether an edge is being edited to prevent network\n      updates from clobbering an in-process edit.\n  /*/\n      UDATA.HandleMessage(\"EDGEEDIT_LOCK\", (data) => {\n        this.setState({ edgesAreLocked: true });\n      });\n      UDATA.HandleMessage(\"EDGEEDIT_UNLOCK\", (data) => {\n        this.setState({ edgesAreLocked: false });\n      });\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ Prevent editing if server is disconnected.\n      This is necessary to hide the \"Add New Node\" button.\n  /*/\n      this.OnDisconnect(() => {\n        console.log('NodeSelector got disconnect')\n        this.setState({ isLocked: true });\n      });\n\n    } // constructor\n\n/// UTILITIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Clear the form with optional label\n/*/ clearForm(label = '') {\n      this.releaseOpenEditor();\n      this.setState({\n        formData: {\n            label,\n            type:      '',\n            info:      '',\n            notes:     '',\n            degrees: -1,\n            id:         '',   // Always convert this to a Number\n            isNewNode: true\n        },\n        edges: [],\n        dbIsLocked: false,\n        isBeingEdited: false,\n        isValid:         false,\n        isDuplicateNodeLabel: false,\n        duplicateNodeID:   '',\n        replacementNodeID: '',\n        isValidReplacementNodeID: true,\n        hideModal: true\n      });\n    } // clearFform\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    setTemplate(data) {\n      this.setState({ nodeDefs: data.nodeDefs });\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Disable Node Edit if a Template is being edited\n/*/\n    updateEditState() {\n      // disable edit if template is being edited\n      this.NetCall(\"SRV_GET_EDIT_STATUS\")\n        .then(data => {\n          this.setEditState(data);\n        });\n    }\n    setEditState(data) {\n      const disableEdit = data.templateBeingEdited || data.importActive;\n      const TEMPLATE = this.AppState('TEMPLATE');\n      let editLockMessage = '';\n      if (data.templateBeingEdited) editLockMessage = TEMPLATE.templateIsLockedMessage;\n      if (data.importActive) editLockMessage = TEMPLATE.importIsLockedMessage;\n      this.setState({ disableEdit, editLockMessage });\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Deregister as an open editor\n    Remove 'node' from OPENEDITORS\n/*/\n    releaseOpenEditor() {\n      // NOTE: We only deregister if we're currently actively editing\n      //       otherwise we might inadvertently deregister\n      if (this.state.isBeingEdited) this.NetCall(\"SRV_RELEASE_EDIT_LOCK\", { editor: EDITORTYPE.NODE });\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Return a new unique ID\n    REVIEW: Should this be in nc-logic?\n    ANSWER: YES. There shouldn't be ANY data-synthesis code in a component!\n    HACK: Replace this code with a server call\n/*/ getNewNodeID () {\n      throw new Error(\"Don't use getNewNodeID() because it is not network safe\");\n      /*/\n      let highestID = 0;\n      let ids  = this.AppState('D3DATA').nodes.map( node => { return Number(node.id) } );\n      if (ids.length>0) {\n        highestID = ids.reduce( (a,b) => { return Math.max(a,b) } );\n      }\n      // REVIEW: Should ids be strings or numbers?\n      // Right now most edge ids are strings\n      return (highestID+1).toString();\n      /*/\n    } // getNewNodeID\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Return a new unique ID\n/*/ getNewEdgeID () {\n      throw new Error(\"Don't use getNewEdgeID() because it is not network safe\");\n      /*/\n      let highestID = 0;\n      let ids  = this.AppState('D3DATA').edges.map( edge => { return Number(edge.id) } )\n      if (ids.length>0) {\n        highestID = ids.reduce( (a,b) => { return Math.max(a,b) } );\n      }\n      // REVIEW: Should ids be strings or numbers?\n      // Right now most edge ids are strings\n      return (highestID+1).toString();\n      /*/\n    } // getNewEdgeID\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Handle updated SELECTION\n/*/ handleSelection ( data ) {\n      if (DBG) console.log('NodeSelector: got state SELECTION',data);\n\n      // Only update if we are the currently active field\n      // otherwise an Edge might be active\n      let { activeAutoCompleteId } = this.AppState('ACTIVEAUTOCOMPLETE');\n      if ( (activeAutoCompleteId!==thisIdentifier) &&\n           (activeAutoCompleteId!=='search')          ) return;\n\n        if (!this.state.isBeingEdited && !this.state.edgesAreLocked) {\n        if (data.nodes && data.nodes.length>0) {\n\n          // A node was selected, so load it\n          // We're not editing, so it's OK to update the form\n          if (DBG) console.log('NodeSelector: updating selection',data.nodes[0]);\n          // grab the first node\n          let node = data.nodes[0];\n          this.loadFormFromNode( node );\n\n          // Load edges\n          let thisId = this.state.formData.id;\n          // -- First, sort edges by source, then target\n          data.edges.sort((a, b) => {\n            // same source label, sort on target\n            if (a.sourceLabel === b.sourceLabel) {\n              if (a.targetLabel < b.targetLabel) { return -1; }\n              if (a.targetLabel > b.targetLabel) { return 1;  }\n            }\n            // Always list `this` node first\n            if (a.source === thisId) { return -1; }\n            if (b.source === thisId) { return 1;  }\n            // Otherwise sort on source\n            if (a.sourceLabel < b.sourceLabel) { return -1; }\n            if (a.sourceLabel > b.sourceLabel) { return 1;  }\n\n            return 0;\n          });\n          this.setState({\n            edges: data.edges\n          })\n          // Exit now because we just selected a node and don't want to\n          // override the form label with form updates.  Otherwise, the\n          // the form label is overriden with old form data.\n          return;\n        } else {\n          if (DBG) console.log('NodeSelector: No data.nodes, so clearing form');\n          this.clearForm();\n        }\n      } else {\n        // We're already editing, and another selection has come in.\n        // What should we do?\n        // * force exit?\n        // * prevent load?\n        // * prevent selection?\n        if (DBG) console.log('NodeSelector: Already editing, ignoring SELECTION');\n      }\n\n      this.validateForm();\n\n    } // handleSelection\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Handle change in SESSION data\n    Called both by componentWillMount() and AppStateChange handler.\n    The 'SESSION' state change is triggered in two places in SessionShell during\n    its handleChange() when active typing is occuring, and also during\n    SessionShell.componentWillMount()\n/*/ onStateChange_SESSION( decoded ) {\n      let update = { isLocked: !decoded.isValid };\n      this.setState(update);\n    }\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Handle updated SEARCH\n    AutoComplete handles its internal updates, but we do need to validate the form\n    When AutoComplete's input field is updated, it sends a SOURCE_SEARCH to ACL\n    which returns the updated value in SEARCH state.  AutoComplete updates\n    the input field using SEARCH.  We need to update the form data here\n    and validate it for NodeSelector.\n/*/ onStateChange_SEARCH ( data ) {\n      // Only update if we are the currently active field\n      // otherwise an Edge might be active\n      let { activeAutoCompleteId } = this.AppState('ACTIVEAUTOCOMPLETE');\n      if ( activeAutoCompleteId!==thisIdentifier ) return;\n      let formData = this.state.formData;\n      formData.label = data.searchLabel;\n\n      // \"Duplicate Node Label\" is only a warning, not an error.\n      // We want to allow students to enter a duplicate label if necessary\n      // This is a case insensitive search\n      var isDuplicateNodeLabel = false;\n      var duplicateNodeID = void 0;\n      if (formData.label !== '' && this.AppState('NCDATA').nodes.find(function (node) {\n        if (node.id !== formData.id)\n        {\n\n          if(node.label)\n          {\n            if(node.label.localeCompare(formData.label, 'en', { usage: 'search', sensitivity: 'base' }) === 0)\n            {\n              duplicateNodeID = node.id;\n              return true;\n            }\n            return false;\n          }else\n          {\n            console.log(\"error processing node: \" + node.id + \" in netc-app.js\\n\");\n            return false;\n          }\n\n      }})) {\n        isDuplicateNodeLabel = true;\n      }\n\n\n      this.setState({\n        formData,\n        isDuplicateNodeLabel,\n        duplicateNodeID\n      });\n\n      this.validateForm();\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Copy the node data passed via SELECTION in the form\n/*/ loadFormFromNode ( newNode ) {\n      if (DBG) console.log('NodeSelector.loadFormFromNode',newNode);\n      if (newNode===undefined) {\n        throw \"NodeSelector.loadFormFromNode called with undefined newNode!\";\n      }\n      // Clean data\n      // REVIEW: Basic data structure probably needs updating\n      let node = {attributes:{}};\n      if (newNode.attributes === undefined) { newNode.attributes = {} }\n      // Backward Compatibility: Always convert ids to a Number or loki lookups will fail.\n      if (isNaN(newNode.id)) { newNode.id = parseInt(newNode.id); }\n      //\n      node.label                    = newNode.label || '';\n      node.id                       = newNode.id || '';\n      node.type = newNode.type;\n      node.info = newNode.info;\n      node.notes = newNode.notes;\n      node.degrees = newNode.degrees;\n\n      // Copy to form\n      this.releaseOpenEditor();\n      this.setState({\n        formData: {\n          label: node.label,\n          type:      node.type,\n          info:      node.info,\n          notes:     node.notes,\n          degrees: node.degrees,\n          id:        node.id,\n          isNewNode: false\n        },\n        dbIsLocked: false,\n        isBeingEdited: false,\n        isDuplicateNodeLabel: false,\n        hideModal: true\n      });\n\n      this.validateForm();\n    } // loadFormFromNode\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ validateForm () {\n      let isValid = false;\n      let formData = this.state.formData;\n\n      if (formData.label!=='' && formData.label!==undefined) isValid=true;\n      if (DBG) console.log('NodeSElector.validateForm: Validating',isValid,'because label is',formData.label,'!');\n      this.setState({\n        isValid: isValid\n      })\n    }\n\n/// UI EVENT HANDLERS /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// REVIEW: Do we really need to manage each input field change with a state update\n/// or can we just grab the final text during the \"SAVE\"?\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ onLabelChange (label) {\n      // REVIEW: Currently this is not being called because AutoComplete\n      // doesn't have a change handler\n      let node = this.state.formData;\n      node.label = label;\n      this.setState({ formData: node });\n      this.validateForm();\n    } // onLabelChange\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ onTypeChange (event) {\n      let node = this.state.formData;\n      node.type = event.target.value;\n      this.setState({ formData: node });\n    } // onTypeChange\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ onNotesChange (event) {\n      let node = this.state.formData;\n      node.notes = event.target.value;\n      this.setState({ formData: node });\n    } // onNotesChange\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ onInfoChange (event) {\n      let node = this.state.formData;\n      node.info = event.target.value;\n      this.setState({ formData: node });\n    } // onInfoChange\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/\n  onReplacementNodeIDChange(event) {\n    let replacementNodeID = parseInt( event.target.value );\n    let isValid = false;\n    // Allow `` because we use a a blank field to indicate delete node without relinking edges.\n    if ((event.target.value === '') ||\n        (this.AppState('NCDATA').nodes.find(node => { return node.id === replacementNodeID; })) ) {\n      isValid = true;\n    }\n    this.setState({\n      replacementNodeID: replacementNodeID,\n      isValidReplacementNodeID: isValid\n    });\n  } // onReplacementNodeIDChange\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ onNewNodeButtonClick (event) {\n      event.preventDefault();\n\n      // Save the search label to re-insert into the new node\n      let label = this.AppState('SEARCH').searchLabel;\n\n      // claim the AutoComplete form and populate it with the\n      // current search term\n      this.AppCall('AUTOCOMPLETE_SELECT',{id:thisIdentifier})\n      .then(()=>{\n        this.AppCall('SOURCE_SEARCH', { searchString: label });\n      });\n      // HACK: call server to retrieve an unused node ID\n      // FIXME: this kind of data manipulation should not be in a GUI component\n      DATASTORE.PromiseNewNodeID()\n        .then((newNodeID) => {\n          this.setState({\n            formData: {\n                label:     label,\n                type:      '',\n                info:      '',\n                notes:     '',\n                degrees: -1,\n                id:        newNodeID,\n                isNewNode: true\n            },\n            edges: [],\n            isBeingEdited: true,\n            isValid:         false\n          });\n\n        this.validateForm();\n      });\n    } // onNewNodeButtonClick\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/\n  /*/\n  onDeleteButtonClick() {\n    // nodeID needs to be a Number.  It should have been set in loadFormFromNode\n    let nodeID = this.state.formData.id;\n\n    // Re-link edges or delete edges?\n    // `NaN` is not valid JSON, so we need to pass -1\n    let replacementNodeID = this.state.replacementNodeID==='' ? -1 : parseInt( this.state.replacementNodeID );   // '' = Delete edges by default\n\n    this.clearForm();\n    this.AppCall('DB_UPDATE', {\n      nodeID: nodeID,\n      replacementNodeID: replacementNodeID\n    });\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/\n  /*/\n  // this is an admin only function to allow unlocking of locked nodes without having to reload\n  onForceUnlock() {\n    // nodeID needs to be a Number.  It should have been set in loadFormFromNode\n    let nodeID = this.state.formData.id;\n\n    this.NetCall('SRV_DBUNLOCKNODE', { nodeID: this.state.formData.id })\n          .then((data) => {\n            if (data.NOP) {\n              if (DBG) console.log(`SERVER SAYS: ${data.NOP} ${data.INFO}`);\n            } else if (data.unlocked) {\n              if (DBG) console.log(`SERVER SAYS: unlock success! you have released Node ${data.nodeID}`);\n              this.setState({ dbIsLocked: false });\n            }\n          });\n  }\n\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/\n  /*/\n  onEditButtonClick(event) {\n    event.preventDefault();\n\n    // hide the modal window if it is open (probably this can be handled better)\n    this.setState({ hideModal: true });\n\n    // nodeID needs to be a Number.  It should have been set in loadFormFromNode\n    let nodeID = this.state.formData.id;\n    this.requestEditNode(nodeID);\n  } // onEditButtonClick\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/\n  /*/\n  onCiteButtonClick(event) {\n    event.preventDefault();\n\n    this.setState({ hideModal: false });\n\n  } // onCiteButtonClick\n\n    onCloseCiteClick (event) {\n    event.preventDefault();\n\n    this.setState({ hideModal: true });\n\n  } //   this.onCloseCiteClick\n\n  dateFormatted (){\n    var today = new Date();\n    var year = \"\" + today.getFullYear();\n    var date = (today.getMonth()+1)+\"/\"+today.getDate()+\"/\"+ year.substr(2,4);\n    var time = today.toTimeString().substr(0,5);\n    var dateTime = time+' on '+date;\n    return dateTime;\n  }\n\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/\n\n\n  requestEditNode(nodeID) {\n    this.NetCall('SRV_DBLOCKNODE', { nodeID: nodeID })\n      .then((data) => {\n        if (data.NOP) {\n          console.log(`SERVER SAYS: ${data.NOP} ${data.INFO}`);\n          this.setState({ dbIsLocked: true });\n        } else if (data.locked) {\n          console.log(`SERVER SAYS: lock success! you can edit Node ${data.nodeID}`);\n          console.log(`SERVER SAYS: unlock the node after successful DBUPDATE`);\n          this.setState({ dbIsLocked: false });\n          this.editNode();\n        }\n      });\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/\n  /*/\n  editNode() {\n    // Add ID if one isn't already defined\n    let formData = this.state.formData;\n    if (formData.id==='') {\n      throw Error('NodeSelector.onEditButtonClick trying to edit a node with no id!  This shouldn\\'t happen!');\n    }\n    this.AppCall('AUTOCOMPLETE_SELECT',{id:thisIdentifier}).then(()=>{\n      // Set AutoComplete field to current data, otherwise, previously canceled label\n      // might be displayed\n      // this.AppCall('SOURCE_SEARCH', { searchString: formData.label }); // JD removed because I think it is redundant and slowing things down?\n    });\n    this.setState({\n      formData,\n      isBeingEdited: true\n    });\n    this.validateForm();\n\n    // When a node is being edited, lock the Template from being edited\n    this.NetCall(\"SRV_REQ_EDIT_LOCK\", { editor: EDITORTYPE.NODE })\n      .then(data => {\n        const disableEdit = data.isBeingEdited;\n        this.setState({ disableEdit });\n      });\n  } // editNode\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ onAddNewEdgeButtonClick (event) {\n      event.preventDefault();\n      /*\n            When creating a new edge, we first\n            1. Add a bare bones edge object with a new ID to the local state.edges\n            2. Pass it to render, so that a new EdgeEditor will be created.\n            3. In EdgeEditor, we create a dummy edge object\n      */\n\n      // HACK: call server to retrieve an unused edge ID\n      // FIXME: this kind of data manipulation should not be in a GUI component\n      DATASTORE.PromiseNewEdgeID()\n      .then((newEdgeID)=>{\n        // Add it to local state for now\n        let edge = {\n          id          : newEdgeID,\n          source      : undefined,\n          target      : undefined,\n          attributes  : {}\n        };\n        let edges = this.state.edges;\n        edges.push(edge);\n        this.setState({ edges: edges });\n      });\n    } // onAddNewEdgeButtonClick\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ onCancelButtonClick () {\n      // If we were editing, then revert and exit\n      if (this.state.isBeingEdited) {\n        let originalNode = this.AppState('NCDATA').nodes.filter( node => { return node.id === this.state.formData.id; } )[0];\n        if (originalNode===undefined) {\n          // user abandoned editing a new node that was never saved\n          this.clearForm();\n        } else {\n          // restore original node\n          this.loadFormFromNode(originalNode);\n          this.releaseOpenEditor();\n          this.setState({ isBeingEdited: false });\n          // unlock\n          this.NetCall('SRV_DBUNLOCKNODE', { nodeID: this.state.formData.id })\n            .then((data) => {\n              if (data.NOP) {\n                console.log(`SERVER SAYS: ${data.NOP} ${data.INFO}`);\n              } else if (data.unlocked) {\n                console.log(`SERVER SAYS: unlock success! you have released Node ${data.nodeID}`);\n                this.setState({ dbIsLocked: false });\n              }\n            });\n        }\n        this.AppCall('AUTOCOMPLETE_SELECT', { id: 'search' });\n        this.NetCall(\"SRV_RELEASE_EDIT_LOCK\", { editor: EDITORTYPE.NODE });\n      }\n    } // onCancelButtonClick\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ Select the node for editing\n  /*/\n  onEditOriginal(event) {\n    event.preventDefault();\n    let duplicateNodeID = parseInt(this.state.duplicateNodeID);\n    this.clearForm();\n    this.releaseOpenEditor();\n    this.setState({\n      isBeingEdited: false,\n      isDuplicateNodeLabel: false\n    }, () => {\n        // Wait for the edit state to clear, then open up the original node\n        if (DBG) console.log('NodeSelector.onEditOriginal triggering SOURCE_SELECT with', duplicateNodeID)\n        UDATA.LocalCall('SOURCE_SELECT', { nodeIDs: [duplicateNodeID] });\n    });\n    this.AppCall('AUTOCOMPLETE_SELECT', { id: 'search' });\n  }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ User confirms they want to edit the existing node.\n  /*/\n  onCloseDuplicateDialog() {\n    this.setState({ isDuplicateNodeLabel: false });\n  }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ onSubmit ( event ) {\n      event.preventDefault();\n      // Update the data with the selectedNode\n      let formData = this.state.formData;\n      let node = {\n        label : formData.label?formData.label:'',\n        id: formData.id,\n        type: formData.type,\n        info: formData.info,\n        notes: formData.notes,\n        degrees: formData.degrees\n      };\n      this.releaseOpenEditor();\n      this.setState({ isBeingEdited: false });\n      // clear AutoComplete form\n      this.AppCall('AUTOCOMPLETE_SELECT',{id:'search'})\n      .then(()=>{\n        // Reselect the saved node\n        this.AppCall('SOURCE_SEARCH', { searchString: node.label });\n      });\n      // write data to database\n      // setting dbWrite to true will distinguish this update\n      // from a remote one\n      this.AppCall('DB_UPDATE', { node })\n      .then(()=>{\n        this.NetCall('SRV_DBUNLOCKNODE', { nodeID: formData.id })\n          .then((data) => {\n            if (data.NOP) {\n              console.log(`SERVER SAYS: ${data.NOP} ${data.INFO}`);\n            } else if (data.unlocked) {\n              console.log(`SERVER SAYS: unlock success! you have released Node ${data.nodeID}`);\n              this.setState({ dbIsLocked: false });\n            }\n        });\n      });\n      // probably should unlock the node:\n      this.NetCall(\"SRV_RELEASE_EDIT_LOCK\", { editor: EDITORTYPE.NODE });\n    } // onSubmit\n\n\n\n/// REACT LIFECYCLE ///////////////////////////////////////////////////////////\n/*/ REACT calls this to receive the component layout and data sources\n/*/ render () {\n      const {\n        nodeDefs,\n        duplicateWarning,\n        nodeIsLockedMessage,\n        editLockMessage,\n        hideDeleteNodeButton,\n        formData,\n        isLocked,\n        isStandalone,\n        disableEdit,\n        isBeingEdited\n      } = this.state;\n      let { citation } = this.state;\n      if(citation==undefined)\n      {\n          citation = {};\n          citation.hidden = true;\n      }\n        return (\n        <div>\n          <FormGroup className=\"text-right\" style={{marginTop:'-20px',paddingRight:'5px'}}>\n            <Button outline size=\"sm\"\n              disabled={disableEdit}\n              hidden={isLocked || isBeingEdited}\n              onClick={this.onNewNodeButtonClick}\n            >{\"Add New Node\"}</Button>\n          </FormGroup>\n          <Form className='nodeEntry' style={{minHeight:'300px',backgroundColor:'#B8EDFF',padding:'5px',marginBottom:'0px'}}\n            onSubmit={this.onSubmit}>\n            <FormText><b>NODE {formData.id||''}</b></FormText>\n            <FormGroup row>\n              <Col sm={3} style={{hyphens: 'auto'}} className=\"pr-0\">\n                  <Label for=\"nodeLabel\" className=\"tooltipAnchor small text-muted\">\n                    <div className=\"badge\">?</div>\n                    {nodeDefs.label.displayLabel}\n                    <span className=\"tooltiptext\">{this.helpText(nodeDefs.label)}</span>\n                  </Label>\n              </Col>\n              <Col sm={9}>\n                <AutoComplete\n                  identifier={thisIdentifier}\n                  disabledValue={formData.label}\n                  inactiveMode={'disabled'}\n                  shouldIgnoreSelection={isBeingEdited}\n                />\n              </Col>\n              <div hidden={!this.state.isDuplicateNodeLabel}\n                style={{ width: '200px', height: '150px', backgroundColor: '#B8EDFF', position: 'fixed', left: '350px', zIndex: '1000', padding: '10px' }}>\n                <p className=\"text-danger small\">{duplicateWarning}</p>\n                <Button size=\"sm\" onClick={this.onEditOriginal}>View Existing</Button>\n                <Button outline size=\"sm\" onClick={this.onCloseDuplicateDialog}>Continue</Button>\n              </div>\n            </FormGroup>\n            <div style={{position:'absolute',left:'300px',maxWidth:'300px'}}>\n              <NodeDetail/>\n            </div>\n            <FormGroup row hidden={nodeDefs.type.hidden}>\n              <Col sm={3} style={{hyphens: 'auto'}} className=\"pr-0\">\n                  <Label for=\"type\" className=\"tooltipAnchor small text-muted\">\n                    <div className=\"badge\">?</div>\n                    {nodeDefs.type.displayLabel}\n                    <span className=\"tooltiptext\">{this.helpText(nodeDefs.type)}</span>\n                  </Label>\n              </Col>\n              <Col sm={9}>\n                <Input type=\"select\" name=\"type\" id=\"typeSelect\"\n                  value={formData.type||''}\n                  onChange={this.onTypeChange}\n                  disabled={!isBeingEdited}\n                  >\n                  {nodeDefs.type.options.map( option => (\n                    <option key={option.label}>{option.label}</option>\n                  ))}\n                </Input>\n              </Col>\n            </FormGroup>\n            <FormGroup row hidden={nodeDefs.notes.hidden}>\n              <Col sm={3} style={{hyphens: 'auto'}} className=\"pr-0\">\n                  <Label for=\"notes\" className=\"tooltipAnchor small text-muted\">\n                    <div className=\"badge\">?</div>\n                    {nodeDefs.notes.displayLabel}\n                    <span className=\"tooltiptext\">{this.helpText(nodeDefs.notes)}</span>\n                  </Label>\n              </Col>\n              <Col sm={9}>\n                <Input type=\"textarea\" name=\"note\" id=\"notesText\"\n                  style={{display: isBeingEdited ? 'block' : 'none'}}\n                  value={formData.notes||''}\n                  onChange={this.onNotesChange}\n                  readOnly={!isBeingEdited}\n                  />\n                  {this.markdownDisplay(formData.notes||'')}\n              </Col>\n            </FormGroup>\n            <FormGroup row hidden={nodeDefs.info.hidden}>\n              <Col sm={3} style={{hyphens: 'auto'}} className=\"pr-0\">\n                  <Label for=\"info\" className=\"tooltipAnchor small text-muted\">\n                    <div className=\"badge\">?</div>\n                    {nodeDefs.info.displayLabel}\n                    <span className=\"tooltiptext\">{this.helpText(nodeDefs.info)}</span>\n                  </Label>\n              </Col>\n              <Col sm={9}>\n                <Input type=\"text\" name=\"info\" id=\"info\"\n                  value={formData.info||''}\n                  onChange={this.onInfoChange}\n                  readOnly={!isBeingEdited}\n                  />\n              </Col>\n            </FormGroup>\n\n            <div id=\"citationWindow\" hidden={this.state.hideModal} className=\"modal-content\">\n              <span className=\"close\" onClick={this.onCloseCiteClick}>&times;</span>\n              <p><em>Copy the text below:</em><br/><br/>\n                NetCreate {this.AppState('TEMPLATE').name} network, Node: {formData.label} (ID {formData.id}). {citation.text}. Last accessed at {this.dateFormatted()}.</p>\n            </div><br/>\n\n            <FormGroup className=\"text-right\" style={{ paddingRight: '5px' }}>\n              <Button outline size=\"sm\"\n                hidden={ citation.hidden || (formData.id==='') }\n                onClick={this.onCiteButtonClick}\n                >Cite Node</Button>&nbsp;&nbsp;\n              <div hidden={isLocked || isStandalone || isBeingEdited || (formData.id === '')} style={{ display: 'inline' }}>\n                <Button outline size=\"sm\"\n                  disabled={disableEdit}\n                  onClick={this.onEditButtonClick}\n                >Edit Node</Button>\n                <p hidden={!this.state.dbIsLocked} className=\"small text-danger warning\">{nodeIsLockedMessage}\n                  <span hidden={!isAdmin}>&nbsp;<b>ADMINISTRATOR ONLY</b>: If you are absolutely sure this is an error, you can force the unlock:<br/>\n                  <Button className=\"small btn btn-outline-light warning\" size=\"sm\"\n                      onClick={this.onForceUnlock}\n                    >Force Unlock</Button></span>\n                </p>\n                <p hidden={!disableEdit} className=\"small text-danger warning\">{editLockMessage}</p>\n              </div>\n            </FormGroup>\n            <FormGroup className=\"text-right\" style={{ paddingRight: '5px' }}>\n              <Button outline size=\"sm\"\n                hidden={!isBeingEdited}\n                onClick={this.onCancelButtonClick}\n              >{isBeingEdited?'Cancel':'Close'}</Button>&nbsp;\n              <Button color=\"primary\" size=\"sm\"\n                disabled={!this.state.isValid}\n                hidden={!isBeingEdited}\n              >Save</Button>\n            </FormGroup>\n            <FormGroup row className=\"text-left\" style={{\n              padding: '10px 5px', margin: '0 -4px', backgroundColor: '#c5e0ef' }}\n              hidden={\n                !isAdmin ||\n                isLocked ||\n                (formData.id === '') ||\n                hideDeleteNodeButton\n              }\n            >\n              <Col sm={6}>\n                <FormText>Re-link edges to this Node ID (leave blank to delete edge)</FormText>\n              </Col>\n              <Col sm={6}>\n                <Input type=\"text\" name=\"replacementNodeID\" id=\"replacementNodeID\"\n                  value={this.state.replacementNodeID || ''}\n                  onChange={this.onReplacementNodeIDChange}\n                  className=\"\" style={{ width: `4em` }} bsSize=\"sm\"\n                  invalid={!this.state.isValidReplacementNodeID}\n                />\n                <FormFeedback>Invalid Node ID!</FormFeedback>\n                <Button className=\"small btn btn-outline-light\" size=\"sm\"\n                  onClick={this.onDeleteButtonClick}\n                >Delete</Button>\n              </Col>\n            </FormGroup>\n          </Form>\n          <div style={{backgroundColor:'#B9DFFF',padding:'5px',marginBottom:'10px'}}>\n            <FormText>EDGES</FormText>\n            {/* `key` is needed during edge deletion so EdgeEditors are properly\n                 removed when an edge is deleted.\n                 REVIEW: Can we replace edgeID with key?  */}\n            {this.state.edges.map( (edge,i) => (\n              <EdgeEditor\n                edgeID={edge.id}\n                key={edge.id}\n                parentNodeLabel={formData.label}\n                parentNodeIsLocked={isLocked}\n              />\n            ))}\n            <FormGroup className=\"text-right\">\n              <Button outline size=\"sm\"\n                disabled={disableEdit}\n                hidden={isLocked || formData.id===''||isBeingEdited}\n                onClick={this.onAddNewEdgeButtonClick}\n              >Add New Edge</Button>\n            </FormGroup>\n          </div>\n        </div>\n\n      )\n    }\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/\n\nhelpText(obj)\n{\n  var text = \"\";\n\n  if(obj.help == undefined || obj.help == \"\")\n    text = obj.label;\n  else\n    text = obj.help;\n  return text;\n}\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/\nmarkdownDisplay (text){\n\n  if(!this.state.isBeingEdited)\n      return mdReact({onIterate: this.markdownIterate,  markdownOptions:{ typographer: true, linkify: true}, plugins: [mdplugins.emoji]\n    })(text);\n}\n\nmarkdownIterate(Tag, props, children, level){\n if (Tag === 'a') {\n    props.target = '_blank';\n    }\n\n  return <Tag {...props}>{children}</Tag>;\n\n}\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ componentDidMount () {\n      this.onStateChange_SESSION(this.AppState('SESSION'));\n      this.validateForm();\n      this.updateEditState();\n      this.setState({\n        // hide Edit button if in standalone mode\n        isStandalone: UNISYS.IsStandaloneMode()\n      });\n      window.addEventListener(\"beforeunload\", this.checkUnload);\n      window.addEventListener(\"unload\", this.doUnload);\n    }\n\n    checkUnload(e) {\n      e.preventDefault();\n      if (this.state.isBeingEdited) {\n        (e || window.event).returnValue = null;\n      } else {\n        Reflect.deleteProperty(e, 'returnValue');\n      }\n      return e;\n    }\n\n    doUnload(e) {\n      if (this.state.isBeingEdited) {\n        this.NetCall('SRV_DBUNLOCKNODE', { nodeID: this.state.formData.id });\n        this.NetCall(\"SRV_RELEASE_EDIT_LOCK\", { editor: EDITORTYPE.NODE });\n      }\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Release the lock if we're unmounting\n/*/ componentWillUnmount() {\n      if (DBG) console.log('NodeEditor.componentWillUnMount!');\n      if (this.state.isBeingEdited) {\n        this.NetCall('SRV_DBUNLOCKNODE', { nodeID: this.state.formData.id })\n          .then((data) => {\n            if (data.NOP) {\n              if (DBG) console.log(`SERVER SAYS: ${data.NOP} ${data.INFO}`);\n            } else if (data.unlocked) {\n              if (DBG) console.log(`SERVER SAYS: unlock success! you have released Node ${data.nodeID}`);\n              this.setState({ dbIsLocked: false });\n            }\n          });\n        this.NetCall(\"SRV_RELEASE_EDIT_LOCK\", { editor: EDITORTYPE.NODE });\n      }\n      // deregister ACTIVEAUTOMPLETE when component unmounts\n      // otherwise state updates trigger a setState on unmounted component error\n      this.AppStateChangeOff('SESSION', this.onStateChange_SESSION);\n      this.AppStateChangeOff('SELECTION', this.handleSelection);\n      this.AppStateChangeOff('SEARCH', this.onStateChange_SEARCH);\n      this.AppStateChangeOff('TEMPLATE', this.setTemplate);\n      UDATA.UnhandleMessage(\"EDIT_PERMISSIONS_UPDATE\", this.setEditState);\n      window.removeEventListener(\"beforeunload\", this.checkUnload);\n      window.removeEventListener(\"unload\", this.doUnload);\n    }\n\n} // class NodeSelector\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = NodeSelector;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  ## OVERVIEW\n\n    NodeTable is used to to display a table of nodes for review.\n\n    It displays NCDATA.\n    But also checks FILTEREDD3DATA to show highlight/filtered state\n\n  ## TO USE\n\n    NodeTable is self contained and relies on global NCDATA to load.\n\n      <NodeTable/>\n\n  ## 2018-12-07 Update\n\n    Since we're not using tab navigation:\n    1. The table isExpanded is now true by default.\n    2. The \"Show/Hide Table\" button is hidden.\n\n    Reset these to restore previous behavior.\n\n\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nvar DBG = false;\n\nconst SETTINGS     = require('settings');\nconst isLocalHost  = (SETTINGS.EJSProp('client').ip === '127.0.0.1') || (location.href.includes('admin=true'));\n\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst React        = require('react');\nconst ReactStrap   = require('reactstrap');\nconst { Button }    = ReactStrap;\nconst MarkdownNote = require('./MarkdownNote');\nconst UNISYS   = require('unisys/client');\nvar   UDATA    = null;\n\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// export a class object for consumption by brunch/require\nclass NodeTable extends UNISYS.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      nodeDefs: this.AppState('TEMPLATE').nodeDefs,\n      nodes: [],\n      filteredNodes: [],\n      isLocked: false,\n      isExpanded: true,\n      sortkey: 'label'\n    };\n\n    this.onStateChange_SESSION = this.onStateChange_SESSION.bind(this);\n    this.displayUpdated = this.displayUpdated.bind(this);\n    this.updateNodeFilterState = this.updateNodeFilterState.bind(this);\n    this.handleDataUpdate = this.handleDataUpdate.bind(this);\n    this.handleFilterDataUpdate = this.handleFilterDataUpdate.bind(this);\n    this.OnTemplateUpdate = this.OnTemplateUpdate.bind(this);\n    this.onButtonClick = this.onButtonClick.bind(this);\n    this.onToggleExpanded = this.onToggleExpanded.bind(this);\n    this.setSortKey = this.setSortKey.bind(this);\n    this.sortSymbol = this.sortSymbol.bind(this);\n\n    this.sortDirection = 1; // alphabetical A-Z\n\n    /// Initialize UNISYS DATA LINK for REACT\n    UDATA = UNISYS.NewDataLink(this);\n\n    // SESSION is called by SessionSHell when the ID changes\n    //  set system-wide. data: { classId, projId, hashedId, groupId, isValid }\n    this.OnAppStateChange('SESSION',this.onStateChange_SESSION);\n\n    // Always make sure class methods are bind()'d before using them\n    // as a handler, otherwise object context is lost\n    this.OnAppStateChange('NCDATA', this.handleDataUpdate);\n\n    // Track Filtered Data Updates too\n    this.OnAppStateChange('FILTEREDD3DATA', this.handleFilterDataUpdate);\n\n    // Handle Template updates\n    this.OnAppStateChange('TEMPLATE', this.OnTemplateUpdate);\n\n  } // constructor\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ componentDidMount () {\n      if (DBG) console.error('NodeTable.componentDidMount!');\n\n      this.onStateChange_SESSION(this.AppState('SESSION'));\n\n      // Explicitly retrieve data because we may not have gotten a NCDATA\n      // update while we were hidden.\n      // filtered data needs to be set before D3Data\n      const FILTEREDD3DATA = UDATA.AppState('FILTEREDD3DATA');\n      this.setState({ filteredNodes: FILTEREDD3DATA.nodes },\n        () => {\n          let NCDATA = this.AppState('NCDATA');\n          this.handleDataUpdate(NCDATA);\n        }\n      )\n    }\n\n    componentWillUnmount() {\n      this.AppStateChangeOff('SESSION', this.onStateChange_SESSION);\n      this.AppStateChangeOff('NCDATA', this.handleDataUpdate);\n      this.AppStateChangeOff('FILTEREDD3DATA', this.handleFilterDataUpdate);\n      this.AppStateChangeOff('TEMPLATE', this.OnTemplateUpdate);\n    }\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Handle change in SESSION data\n    Called both by componentWillMount() and AppStateChange handler.\n    The 'SESSION' state change is triggered in two places in SessionShell during\n    its handleChange() when active typing is occuring, and also during\n    SessionShell.componentWillMount()\n/*/ onStateChange_SESSION( decoded ) {\n      this.setState({ isLocked: !decoded.isValid });\n    }\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  displayUpdated(nodeEdge) {\n      // Prevent error if `meta` info is not defined yet, or not properly imported\n      if (!nodeEdge.meta) return;\n\n      var d = new Date(nodeEdge.meta.revision > 0 ? nodeEdge.meta.updated : nodeEdge.meta.created);\n\n      var year = String(d.getFullYear());\n      var date = (d.getMonth()+1)+\"/\"+d.getDate()+\"/\"+ year.substr(2,4);\n      var time = d.toTimeString().substr(0,5);\n      var dateTime = date+' at '+time;\n      var titleString = \"v\" + nodeEdge.meta.revision;\n      if (nodeEdge._nlog) titleString += \" by \" + nodeEdge._nlog[nodeEdge._nlog.length-1];\n      var tag = <span title={titleString}> {dateTime} </span>;\n\n      return tag;\n\n    }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// Set node filtered status based on current filteredNodes\n  updateNodeFilterState(nodes, filteredNodes) {\n    // set filter status\n    if (filteredNodes.length > 0) {\n      nodes = nodes.map(node => {\n        const filteredNode = filteredNodes.find(n => n.id === node.id);\n        node.isFiltered = !filteredNode; // not in filteredNode, so it's been removed\n        return node\n      });\n    }\n    this.setState({ nodes });\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ Handle updated SELECTION\n  /*/\n  handleDataUpdate(data) {\n    if (DBG) console.log('handle data update')\n    if (data.nodes) {\n      const nodes = this.sortTable(this.state.sortkey, data.nodes);\n      const { filteredNodes } = this.state;\n      this.updateNodeFilterState(nodes, filteredNodes);\n    }\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  handleFilterDataUpdate(data) {\n    if (data.nodes) {\n      const filteredNodes = data.nodes;\n      this.setState({ filteredNodes }, () => {\n        const nodes = this.sortTable(this.state.sortkey, this.state.nodes);\n        this.updateNodeFilterState(nodes, filteredNodes);\n      });\n    }\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  OnTemplateUpdate(data) {\n    this.setState({nodeDefs: data.nodeDefs});\n  }\n\n/// UTILITIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ sortByID (nodes) {\n      if (nodes) {\n        return nodes.sort( (a,b) => {\n          let akey = a.id,\n              bkey = b.id;\n          if (akey<bkey) return -1*Number(this.sortDirection);\n          if (akey>bkey) return 1*Number(this.sortDirection);\n          return 0;\n        });\n      }\n      return 0;\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ sortByEdgeCount(nodes) {\n      if (nodes) {\n        return nodes.sort( (a, b) => {\n            let akey = a.degrees || 0,\n              bkey = b.degrees || 0;\n          // sort descending\n          if (akey > bkey) return 1*Number(this.sortDirection);\n          if (akey < bkey) return -1*Number(this.sortDirection);\n          return 0;\n        });\n      }\n      return 0;\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ sortByLabel (nodes) {\n      if (nodes) {\n        return nodes.sort( (a,b) => {\n          let akey = a.label?a.label:'',\n              bkey = b.label?b.label:'';\n          return (akey.localeCompare(bkey)*this.sortDirection);\n        });\n      }\n      return 0;\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ DEPRECATED -- 'attributes' is no longer being used\n/*/ sortByAttribute (nodes, key) {\n      if (nodes) {\n        return nodes.sort( (a,b) => {\n          let akey = a.attributes[key],\n              bkey = b.attributes[key];\n          if (akey<bkey) return -1*Number(this.sortDirection);\n          if (akey>bkey) return 1*Number(this.sortDirection);\n          return 0;\n        });\n      }\n      return 0;\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ sortByKey (nodes, key) {\n      if (nodes) {\n        return nodes.sort( (a,b) => {\n          let akey = a[key],\n              bkey = b[key];\n          if (akey<bkey) return -1*Number(this.sortDirection);\n          if (akey>bkey) return 1*Number(this.sortDirection);\n          return 0;\n        });\n      }\n      return 0;\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ sortByUpdated(nodes) {\n      if (nodes) {\n        return nodes.sort( (a,b) => {\n          let akey = (a.meta.revision > 0 ? a.meta.updated : a.meta.created),\n              bkey = (b.meta.revision > 0 ? b.meta.updated : b.meta.created);\n          if (akey<bkey) return -1*Number(this.sortDirection);\n          if (akey>bkey) return 1*Number(this.sortDirection);\n          return 0;\n        });\n      }\n      return undefined;\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ If no `sortkey` is passed, the sort will use the existing state.sortkey\n    Returns the sorted nodes so that the calling function can handle\n    state updates all at once.\n/*/ sortTable ( sortkey=this.state.sortkey, nodes ) {\n      switch (sortkey) {\n        case 'id':\n          return this.sortByID(nodes);\n          break;\n        case 'edgeCount':\n          return this.sortByEdgeCount(nodes);\n          break;\n        case 'type':\n          return this.sortByKey(nodes, 'type');\n          break;\n        case 'notes':\n          return this.sortByKey(nodes, 'notes');\n          break;\n        case 'info':\n          return this.sortByKey(nodes, 'info');\n          break;\n        case 'updated':\n          return this.sortByUpdated(nodes);\n          break;\n        case 'label':\n        default:\n          return this.sortByLabel(nodes);\n          break;\n      }\n    }\n\n    sortSymbol(key) {\n      if (key !== this.state.sortkey) return \"\"; // this is not the current sort, so don't show anything\n      else  return this.sortDirection === 1?\"\":\"\"; // default to \"decreasing\" and flip if clicked again\n    }\n\n\n/// UI EVENT HANDLERS /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ onButtonClick (event) {\n      event.preventDefault();\n\n      // REVIEW: For some reason React converts the integer IDs into string\n      // values when returned in event.target.value.  So we have to convert\n      // it here.\n      let nodeID = parseInt( event.target.value );\n      UDATA.LocalCall('SOURCE_SELECT',{ nodeIDs: [nodeID] })\n      .then(() => {\n        if (DBG) console.error('NodeTable: Calling NODE_EDIT', nodeID);\n        UDATA.LocalCall('NODE_EDIT', { nodeID: nodeID });\n      });\n\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ onToggleExpanded (event) {\n      this.setState({\n        isExpanded: !this.state.isExpanded\n      })\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ setSortKey (key) {\n\n      if (key === this.state.sortkey) this.sortDirection = (-1 * this.sortDirection);// if this was already the key, flip the direction\n      else this.sortDirection = 1;\n\n      const nodes = this.sortTable(key, this.state.nodes);\n      this.setState({ sortkey: key, nodes });\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ selectNode (id, event) {\n      event.preventDefault();\n\n      // REVIEW: For some reason React converts the integer IDs into string\n      // values when returned in event.target.value.  So we have to convert\n      // it here.\n      // Load Source\n      UDATA.LocalCall('SOURCE_SELECT',{ nodeIDs: [parseInt(id)] });\n    }\n\n\n\n/// REACT LIFECYCLE METHODS ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ This is not yet implemented as of React 16.2.  It's implemented in 16.3.\n    getDerivedStateFromProps (props, state) {\n      console.error('getDerivedStateFromProps!!!');\n    }\n/*/\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/\nrender() {\n  if (this.state.nodes === undefined) return \"\";\n  const { nodeDefs, isLocked } = this.state;\n  const { tableHeight } = this.props;\n  const styles = `thead, tbody { font-size: 0.8em }\n                  .table {\n                    display: table; /* override bootstrap for fixed header */\n                    border-spacing: 0;\n                  }\n                  .table th {\n                    position: -webkit-sticky;\n                    position: sticky;\n                    top: 0;\n                    background-color: #eafcff;\n                    border-top: none;\n                  }\n                  xtbody { overflow: auto; }\n                  .btn-sm { font-size: 0.6rem; padding: 0.1rem 0.2rem }\n                  `\n  return (\n    <div style={{\n      overflow: 'auto',\n      position: 'relative',\n      display: 'block',\n      left: '1px', right: '10px',\n      height: tableHeight,\n      backgroundColor: '#eafcff'\n    }}>\n      <style>{styles}</style>\n      <table hidden={!this.state.isExpanded}\n        // size=\"sm\" hover responsive striped // ReactStrap properties\n        // Need to use a standard 'table' not ReactStrap so that we can set\n        // the container div height and support non-scrolling headers\n        className=\"table table-striped table-responsive table-hover table-sm nodetable w-auto\"\n      >\n        <thead>\n          <tr>\n            <th width=\"4%\"><div style={{color: '#f3f3ff'}}>_Edit_</div></th>\n            <th width=\"4%\" hidden={!DBG}><Button size=\"sm\"\n                  onClick={() => this.setSortKey(\"id\")}\n                >ID</Button></th>\n            <th width=\"4%\"><Button size=\"sm\"\n                  onClick={() => this.setSortKey(\"edgeCount\")}\n                >{nodeDefs.degrees.displayLabel} {this.sortSymbol(\"edgeCount\")}</Button></th>\n            <th width=\"15%\"><Button size=\"sm\"\n                  onClick={()=>this.setSortKey(\"label\")}\n                >{nodeDefs.label.displayLabel} {this.sortSymbol(\"label\")}</Button></th>\n            <th width=\"10%\"hidden={nodeDefs.type.hidden}>\n                <Button size=\"sm\"\n                  onClick={()=>this.setSortKey(\"type\")}\n                >{nodeDefs.type.displayLabel} {this.sortSymbol(\"type\")}</Button></th>\n            <th width=\"20%\"hidden={nodeDefs.info.hidden}>\n                <Button size=\"sm\"\n                  onClick={()=>this.setSortKey(\"info\")}\n                >{nodeDefs.info.displayLabel} {this.sortSymbol(\"info\")}</Button></th>\n            <th width=\"30%\" hidden={nodeDefs.notes.hidden}>\n                <Button size=\"sm\"\n                  onClick={()=>this.setSortKey(\"notes\")}\n                >{nodeDefs.notes.displayLabel} {this.sortSymbol(\"notes\")}</Button></th>\n            <th  width=\"10%\"hidden={!isLocalHost}><Button size=\"sm\"\n                  onClick={()=>this.setSortKey(\"updated\")}\n                >Updated {this.sortSymbol(\"updated\")}</Button></th>\n          </tr>\n        </thead>\n        <tbody style={{maxHeight: tableHeight}}>\n        {this.state.nodes.map( (node,i) => (\n          <tr key={i}\n            style={{\n              color: node.isFiltered ? 'red' : 'black',\n              opacity: node.filteredTransparency\n            }}>\n            <td><Button size=\"sm\" outline\n                  value={node.id}\n                  onClick={this.onButtonClick}\n            >{isLocked ? \"View\" : \"Edit\"}</Button>\n            </td>\n            <td hidden={!DBG}>{node.id}</td>\n            <td>{node.degrees}</td>\n            <td><a href=\"#\" onClick={(e)=>this.selectNode(node.id,e)}\n                >{node.label}</a></td>\n            <td hidden={nodeDefs.type.hidden}>{node.type}</td>\n            <td hidden={nodeDefs.info.hidden}>{node.info}</td>\n            <td hidden={nodeDefs.notes.hidden}>\n              {node.notes ? <MarkdownNote text={node.notes} /> : \"\" }\n            </td>\n            <td hidden={!isLocalHost}>{this.displayUpdated(node)}</td>\n          </tr>\n        ))}\n        </tbody>\n      </table>\n    </div>\n  );\n\n}\n\n} // class NodeTable\n\n\n\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = NodeTable;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  ## OVERVIEW\n\n  The DuplicateNodeDialog is displayed when the user is trying to add a new\n  node that share the same label as an existing node.  It presents the user\n  with two options:\n  * Edit the existing ndoe\n  * Continue adding the new node\n\n  The dialog is displayed next to the node label so that the user can make\n  a decision.\n\n  We allow duplicate nodes because there might be places/people with the\n  same name.\n\n  ## PROPS\n      nodeID\n\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nvar DBG = true;\n\n\n/// UNISYS INITIALIZE REQUIRES for REACT ROOT /////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst UNISYS = require('unisys/client');\nvar   UDATA  = null;\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst React = require('react');\nconst ReactStrap = require('reactstrap');\nconst { TabContent, TabPane, Nav, NavItem, NavLink, Row, Col, Button } = ReactStrap;\nconst classnames = require('classnames');\n\nconst Help = require('./Help');\nconst NodeTable = require('./NodeTable');\nconst EdgeTable = require('./EdgeTable');\n\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// export a class object for consumption by brunch/require\nclass SaveChangesDialog extends UNISYS.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      nodeDefs: this.AppState('TEMPLATE').nodeDefs,\n    }\n\n    this.handleEdit = this.handleEdit.bind(this);\n    this.handleCancel = this.handleCancel.bind(this);\n\n    /// Initialize UNISYS DATA LINK for REACT\n    UDATA = UNISYS.NewDataLink(this);\n\n  } // constructor\n\n\n\n  /// UI EVENT HANDLERS /////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ Select the node for editing\n  /*/\n  handleEdit(event) {\n    event.preventDefault();\n    let nodeID = parseInt(event.target.value);\n    UDATA.LocalCall('SOURCE_SELECT', { nodeIDs: [nodeID] });\n  }\n\n  handleCancel () {\n    event.preventDefault();\n\n  }\n\n  /// REACT LIFECYCLE METHODS ///////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ This is not yet implemented as of React 16.2.  It's implemented in 16.3.\n      getDerivedStateFromProps (props, state) {\n        console.error('getDerivedStateFromProps!!!');\n      }\n  /*/\n  /*/ This this fires after render().\n  /*/\n  componentDidMount() {\n    let tabpanel = document.getElementById('tabpanel');\n    this.setState({\n      tabpanelTop: tabpanel.offsetTop\n    });\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/\n  /*/\n  render() {\n    let { nodeDefs } = this.state;\n    return (\n      <Modal>\n        <ModalBody>You've made changes to the Node.  Are you sure you want to </ModalBody>\n      </Modal>\n    );\n  }\n\n} // class SaveChangesDialog\n\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = SaveChangesDialog;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n    ## OVERVIEW\n\n       This provides a search field for looking up nodes.\n\n       1. Users type in the field.\n       2. The field will suggest matching nodes.\n       3. User selects something from the suggestion list.\n       4. The node will get loaded in NodeSelector.\n\n\n    ## USAGE\n\n      <Search/>\n\n    ## TECHNICAL DESCRIPTION\n\n       This provides a simple wrapper around AutoSuggest to handle\n       messaging and data passing.\n\n\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nvar DBG = false;\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst React          = require('react');\nconst ReactStrap     = require('reactstrap');\nconst { Col,\n        FormGroup,\n        Label }      = ReactStrap;\nconst AutoComplete   = require('./AutoComplete');\n\nconst UNISYS         = require('unisys/client');\n\nconst thisIdentifier = 'search';   // SELECTION identifier\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// export a class object for consumption by brunch/require\nclass Search extends UNISYS.Component {\n\n    constructor (props) {\n      super(props);\n      this.state = {\n        searchString:  ''\n      };\n      this.OnStart(()=>{\n        // always wrap UNISYS calls in a lifescycle hook otherwise you may try to execute a call\n        // before it has been declared in another module\n        if (DBG) console.log('Search.OnStart: Setting active autocomplete id to',thisIdentifier);\n        this.AppCall('AUTOCOMPLETE_SELECT',{id:thisIdentifier, value:this.state.searchString});\n      });\n    } // constructor\n\n\n\n/// UI EVENT HANDLERS /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n/// REACT LIFECYCLE ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ componentWillMount () {\n    }\n/*/ REACT calls this to receive the component layout and data sources\n/*/ render () {\n      return (\n        <FormGroup row>\n          <Col>\n            <AutoComplete\n              identifier={thisIdentifier}\n              disabledValue={this.state.searchString}\n              inactiveMode={'disabled'}\n            />\n            <Label className=\"small text-muted\">Type to search or add a node:</Label>\n          </Col>\n        </FormGroup>\n      )\n    }\n} // class Search\n\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = Search;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Template Editor View\n\n  Displays a variety of tools to edit templates:\n  * Edit Node Types\n  * Edit Edge Types\n  * Edit Current Template\n  * Download Current Template\n  * Create New Template\n  * Import Template from File\n\n  This is displayed on the More.jsx component/panel but can be moved\n  anywhere.\n\n  Templates can only be edited if:\n  * There are no nodes or edges being edited\n  * No one is trying to import data\n  * There are no other templates being edited\n\n  Conversely, if a Template is being edited, Import, Node and Edge editing\n  will be disabled.\n\n  ##  BACKGROUND\n\n      Template data is loaded by `server-database` DB.InitializeDatabase call.\n\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nvar DBG = false;\nvar UDATA = null;\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst React = require('react');\nconst ReactStrap = require('reactstrap');\nconst { Button } = ReactStrap;\nimport { JSONEditor } from '@json-editor/json-editor';\nconst UNISYS = require('unisys/client');\nconst { EDITORTYPE } = require(\"system/util/enum\");\nconst TEMPLATE_LOGIC = require(\"../template-logic\");\nconst SCHEMA = require(\"../template-schema\");\n\n/// CONSTANTS /////////////////////////////////////////////////////////////////\n\nlet EDITOR; // json-editor object\nlet typeOptions;\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nclass Template extends UNISYS.Component {\n  constructor (props) {\n    super(props);\n    this.state = {\n      disableEdit: false,\n      isBeingEdited: false,\n      editScope: undefined, // Determines whether the user is tring to edit the\n                            // template's root (everything in the template),\n                            // or just focused on a subsection: nodeTypeOptions,\n                            // edgeTypeOptions\n      tomlfile: undefined,\n      tomlfileStatus: '',\n      tomlfileErrors: undefined\n    };\n    this.loadEditor = this.loadEditor.bind(this);\n    this.updateEditState = this.updateEditState.bind(this);\n    this.disableOrigLabelFields = this.disableOrigLabelFields.bind(this);\n    this.releaseOpenEditor = this.releaseOpenEditor.bind(this);\n    this.onNewTemplate = this.onNewTemplate.bind(this);\n    this.onCurrentTemplateLoad = this.onCurrentTemplateLoad.bind(this);\n    this.onEditNodeTypes = this.onEditNodeTypes.bind(this);\n    this.onEditEdgeTypes = this.onEditEdgeTypes.bind(this);\n    this.onTOMLfileSelect = this.onTOMLfileSelect.bind(this);\n    this.onDownloadTemplate = this.onDownloadTemplate.bind(this);\n    this.onSaveChanges = this.onSaveChanges.bind(this);\n    this.onCancelEdit = this.onCancelEdit.bind(this);\n\n    UDATA = UNISYS.NewDataLink(this);\n    UDATA.HandleMessage(\"EDIT_PERMISSIONS_UPDATE\", this.updateEditState);\n\n  } // constructor\n\n  componentDidMount() {\n    this.updateEditState();\n  }\n\n  componentWillUnmount() {\n    if (EDITOR) EDITOR.destroy();\n    this.releaseOpenEditor();\n    UDATA.UnhandleMessage(\"EDIT_PERMISSIONS_UPDATE\", this.updateEditState);\n  }\n\n  /// METHODS /////////////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /**\n   * Load JSON Editor\n   * -- If schema is not defined, the default schema is used\n   * -- If startval is not defined, an empty template created from the default\n   *    schema is used.\n   * @param {object} parms { schema, startval }\n   * @param {function} cb - Callback function\n   */\n  loadEditor(parms, cb) {\n    UDATA.NetCall(\"SRV_REQ_EDIT_LOCK\", { editor: EDITORTYPE.TEMPLATE })\n      .then(data => {\n        const el = document.getElementById('editor');\n        const schema = (parms && parms.schema) || SCHEMA.TEMPLATE;\n        const startval = parms && parms.startval;\n\n        const options = {\n          theme: 'bootstrap4', // spectre, bootstrap3, tailwind, html\n          disable_edit_json: true, // set to false allow direct viewing/editing of json for debugging\n          disable_properties: false, // needed to allow user to add missing properties\n          object_layout: 'table', // 'grid', 'grid-strict', 'categories'\n          no_additional_properties: true, // prevent users from adding new non-schema properties\n          schema\n          // iconlib: 'fontawesome5', // fontawesome is not currently loaded\n        };\n        if (startval) options.startval = startval; // only add startval if its defined, otherwise you end up with an empty template\n        if (EDITOR) EDITOR.destroy(); // clear any existing editor\n        EDITOR = new JSONEditor(el, options);\n\n        this.setState({ isBeingEdited: true });\n\n        if (cb === undefined || typeof cb !== 'function') return;\n        cb();\n      });\n  }\n\n  /// UI EVENT HANDLERS /////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  updateEditState() {\n    // disable edit if someone else is editing a template, node, or edge\n    let disableEdit = false;\n    UDATA.NetCall(\"SRV_GET_EDIT_STATUS\")\n      .then(data => {\n        // someone else might be editing a template or importing or editing node or edge\n        disableEdit = data.templateBeingEdited || data.importActive || data.nodeOrEdgeBeingEdited;\n        this.setState({ disableEdit });\n      });\n  }\n\n  // When editing Node or Edge Type Options, the original label field should be\n  // disabled so they can't be edited\n  // ClassName added in template-schema.GetTypeEditorSchema()\n  disableOrigLabelFields() {\n    const origLabelFields = document.getElementsByClassName('disabledField');\n    origLabelFields.forEach(f => f.setAttribute(\"disabled\", \"disabled\"));\n  }\n\n  releaseOpenEditor() {\n    UDATA.NetCall(\"SRV_RELEASE_EDIT_LOCK\", { editor: EDITORTYPE.TEMPLATE});\n  }\n\n  onNewTemplate() {\n    this.setState({ editScope: 'root', isBeingEdited: true });\n    this.loadEditor(); // new blank template with default schema\n  }\n\n  onCurrentTemplateLoad(e) {\n    UDATA.LocalCall('EDIT_CURRENT_TEMPLATE') // nc-logic\n      .then(result => {\n        this.setState({ editScope: 'root', isBeingEdited: true });\n        this.loadEditor({ startval: result.template });\n      })\n  }\n\n  onEditNodeTypes() {\n    UDATA.LocalCall('EDIT_CURRENT_TEMPLATE') // nc-logic\n      .then(result => {\n        const schemaNodeTypeOptions = SCHEMA.NODETYPEOPTIONS;\n        // Wrap options in custom Schema to show Delete management UI\n        const nodeTypeEditorSchema = SCHEMA.GetTypeEditorSchema(schemaNodeTypeOptions);\n        // Remove default selected (blank) option\n        // This is added back in in template-logic.UpdateTemplate after saving\n        typeOptions = result.template.nodeDefs.type.options.filter(o => o.label !== '');\n        const startval = { options: typeOptions }\n        this.setState({ editScope: 'nodeTypeOptions', isBeingEdited: true });\n        this.loadEditor(\n          {\n            schema: nodeTypeEditorSchema,\n            startval\n          }, () => {\n            this.disableOrigLabelFields();\n            // HACK: After a row is added, we need to also disable the newly added\n            // \"Label\" field -- the new label should be added in the \"Change To\" field\n            EDITOR.on('addRow', editor => {\n              this.disableOrigLabelFields();\n            });\n          }\n        );\n      })\n  }\n\n  onEditEdgeTypes() {\n    UDATA.LocalCall('EDIT_CURRENT_TEMPLATE') // nc-logic\n      .then(result => {\n        const schemaEdgeTypeOptions = SCHEMA.EDGETYPEOPTIONS;\n        // Wrap options in custom Schema to show Delete management UI\n        const edgeTypeEditorSchema = SCHEMA.GetTypeEditorSchema(schemaEdgeTypeOptions);\n        // Remove default selected (blank) option\n        // This is added back in in template-logic.UpdateTemplate after saving\n        typeOptions = result.template.edgeDefs.type.options.filter(o => o.label !== '');\n        const startval = { options: typeOptions }\n        this.setState({ editScope: 'edgeTypeOptions', isBeingEdited: true });\n        this.loadEditor({\n          schema: edgeTypeEditorSchema,\n          startval\n        }, () => {\n            this.disableOrigLabelFields();\n            // HACK: After a row is added, we need to also disable the newly added\n            // \"Label\" field -- the new label should be added in the \"Change To\" field\n            EDITOR.on('addRow', editor => {\n              this.disableOrigLabelFields();\n            });\n          }\n        );\n      });\n  }\n\n  onTOMLfileSelect(e) { // import\n    const tomlfile = e.target.files[0];\n    TEMPLATE_LOGIC.ValidateTOMLFile({ tomlfile })\n    .then(result => {\n        if (result.isValid) {\n          this.setState({\n            editScope: 'root'\n          });\n          this.loadEditor({\n            schema: SCHEMA.TEMPLATE,\n            startval: result.templateJSON\n          });\n        } else {\n          const errorMsg = result.error;\n          this.setState({\n            tomlfile: undefined,\n            tomlfileStatus: \"Invalid template file!!!\",\n            tomlfileErrors: errorMsg\n          });\n        }\n      });\n  }\n\n  onDownloadTemplate() {\n    TEMPLATE_LOGIC.DownloadTemplate();\n  }\n\n  onSaveChanges() {\n    const templateJSON = EDITOR.getValue(); // could be a snippet\n    const { editScope } = this.state;\n    const template = TEMPLATE_LOGIC.UpdateTemplate(templateJSON, editScope);\n    TEMPLATE_LOGIC.SaveTemplateToFile(template)\n      .then(result => {\n        if (!result.OK) {\n          alert(result.info);\n        } else {\n          this.setState({ isBeingEdited: false });\n        }\n      });\n    this.releaseOpenEditor();\n  }\n\n  onCancelEdit() {\n    this.setState({ isBeingEdited: false });\n    this.releaseOpenEditor();\n  }\n\n\n  /// REACT LIFECYCLE METHODS ///////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n  render() {\n    const {\n      disableEdit,\n      isBeingEdited,\n      tomlfile,\n      tomlfileStatus,\n      tomlfileErrors\n    } = this.state;\n    let editorjsx;\n    if (disableEdit && !isBeingEdited) {\n      // Node or Edge is being edited, show disabled message\n      editorjsx = (\n        <div>\n          <p><i>Templates cannot be edited while someone is editing a node, edge,\n            or template, or importing data.</i></p>\n          <p><i>Please finish editing and try again.</i></p>\n        </div>\n      )\n    } else {\n      // OK to Edit, show edit buttons\n      editorjsx = (\n        <div hidden={isBeingEdited}>\n          <p><b>PROCEED WITH CAUTION!</b>: Editing templates will modify the data\n            in your dataset and may leave your dataset in an unusable state.\n            Only <b>expert users</b> who know how the data is set up should do this.\n          </p>\n          <div style={{\n            display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)',\n            columnGap: '10px', rowGap: '5px'\n          }}>\n            {/* TYPE OPTIONS */}\n            <Button size=\"sm\" onClick={this.onEditNodeTypes}>\n              Edit Node Types\n            </Button>\n            <Button size=\"sm\" onClick={this.onEditEdgeTypes}>\n              Edit Edge Types\n            </Button>\n            {/* CURRENT TEMPLATE */}\n            <Button size=\"sm\" onClick={this.onCurrentTemplateLoad}>\n              Edit Current Template\n            </Button>\n            <Button size=\"sm\" onClick={this.onDownloadTemplate}>\n              Download Current Template\n            </Button>\n            {/* NEW TEMPLATE */}\n            <Button size=\"sm\" onClick={this.onNewTemplate}>\n              New Template\n            </Button>\n            <div>\n              <i className=\"small text-muted\">Import TOML template (replace existing)</i><br/>\n              <label>\n                <input type=\"file\" accept=\"text/toml\" id=\"tomlfileInput\" onChange={this.onTOMLfileSelect}/>\n                &nbsp;<i>{tomlfileStatus}</i><br />\n                {tomlfileErrors && <span style={{ color: \"red\" }}>{tomlfileErrors}</span>}\n              </label><br />\n            </div>\n          </div>\n          <hr />\n        </div>\n      )\n    }\n    return (\n      <div\n        style={{\n          backgroundColor: 'rgba(240,240,240,0.95)',\n          padding: '10px 20px'\n        }}\n      >\n        {editorjsx}\n        <div hidden={!isBeingEdited} >\n          <Button\n            onClick={this.onCancelEdit}\n            size=\"sm\" outline\n          >Cancel</Button>\n          &nbsp;\n          <Button\n            onClick={this.onSaveChanges}\n            size=\"sm\" color=\"primary\"\n          >Save Changes</Button>\n          <hr />\n        </div>\n        <div id=\"editor\" hidden={!isBeingEdited}></div>\n      </div>\n    );\n  }\n\n} // class Help\n\n\n// NOTES on using json-editor\n        // Not needed anymore, but keep for reference for managing json-editor\n        //\n        // // Handle Delete Events\n        // EDITOR.on('deleteRow', editor => {\n        //   const val = EDITOR.getValue();\n        //   const currentOptions = val ? val.options : [];\n        //   console.log('currentOptions', currentOptions);\n        //   typeOptionsRemoved = []; // start from scratch each time\n        //   typeOptions.forEach(o => {\n        //     if (!currentOptions.find(c => c.label === o.label)) typeOptionsRemoved.push(o);\n        //   });\n        //   console.log('removed options', typeOptionsRemoved);\n        //   const deletions = EDITOR.getEditor('root.deletions');\n        //   if (deletions) deletions.setValue(typeOptionsRemoved);\n        //\n        //   // key is 0 for first row\n        //   // editor and key are undefined for last row\n        //   // console.log('deleteRow', editor && editor.key)\n        //   // const deletions = EDITOR.getEditor('root.deletions');\n        //   // if (deletions) deletions.setValue([{ label: 'yo', color: '#ffffff' }]);\n        //   // EDITOR.setValue({ deleted: 'yes' });\n        // });\n        //\n        //\n        // watch one\n        // root.1 refers to second field, fields are 0-indexed\n        // EDITOR.watch('root.1.label', (e) => {\n        //   // `e` is undefined\n        //   console.log('change', e);\n        // });\n        //\n        // watch ALL\n        // works but watches too much?\n        // const watcherCallback = function (path) {\n        //   console.log(`field with path: [${path}] changed to [${JSON.stringify(this.getEditor(path).getValue())}]`);\n        //   // Do something\n        // }\n        // for (let key in EDITOR.editors) {\n        //   if (EDITOR.editors.hasOwnProperty(key) && key !== 'root') {\n        //     EDITOR.watch(key, watcherCallback.bind(EDITOR, key));\n        //   }\n        // }\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = Template;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  ## OVERVIEW\n\n    Vocabulary displays a list of common terms\n\n\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nvar DBG = false;\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst React        = require('react');\nconst ReactStrap   = require('reactstrap');\nconst { Button, Table }    = ReactStrap;\n\nconst UNISYS   = require('unisys/client');\n\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// export a class object for consumption by brunch/require\nclass Vocabulary extends UNISYS.Component {\n  constructor (props) {\n    super(props);\n    this.state = {isExpanded: true};\n  } // constructor\n\n  render () {\n    let { tableHeight } = this.props;\n\n    return (\n      <div\n        style={{\n          backgroundColor: 'rgba(240,240,240,0.95)',\n          padding: '10px 20px'\n        }}>\n\n        <dl>\n          <dt>Network</dt>\n        <dd>This is a collection of nodes and the edges between them. </dd>\n\n        <dt>Graph</dt>\n        <dd>a graphic representation of a network and its components. <em><strong>Similar terms include:</strong> sociogram, visualization</em></dd>\n\n        <dt>Node</dt>\n        <dd>The thing or <em>entity</em> (shown as circles) that is connected through relationships. This could be individual people, groups of people, institutions (like churches, organizations, schools). One way of thinking about this is that nodes are nouns and edges are verbs - nodes are things that are connected through edges. <em><strong>Similar terms include:</strong> actor, vertex</em></dd>\n          <ul>\n          <dl>\n            <dt>Ego</dt>\n            <dd>This refers to the node you are focused on at the moment and the connections that they have. </dd>\n        </dl>\n        </ul>\n\n        <dt>Edge</dt>\n        <dd>The relationships between nodes you are considering (shown as lines). Relationships can take on many forms: nodes could be connected through somewhat intangible relationships, such as friendship or not liking one another. Edges can be based on interactions, such as talking to one another or being in conflict. They could also be defined by sharing resources, such as money or information. <em><strong>Similar terms include:</strong> line, tie, arc</em></dd>\n\n          <ul><dl>\n          <dt>Edge weight</dt>\n          <dd>Edges can have a value attached to them. So, for instance, an node could sent $10,000 to another actor. Or, they could share three interactions of the same type with one another. This value is referred to as a weight. <em><strong>Similar terms include:</strong> value</em></dd>\n\n          <dt>Directed or undirected edges</dt>\n          <dd>Edges can either be directed or undirected. If a relationship is directed, it is being sent from (originating from) one node to another node. Node A may say they are friends with Node B, but Node B does not say Node A does this. Or Node A gives Node B something, such as resources, information, or an illness. However, in some cases, edges are defined as undirected. Two people who share a meal together or are married are both engaged share an undirected edge. <em>Note: in some academic literatures, the term \"edge\" is reserved for an undirected relationship, while the term \"arc\" is used to refer to directed ties.</em></dd>\n          </dl></ul>\n\n        <dt>Attributes</dt>\n        <dd>Characteristics of the nodes or edges. A node could be designated by gender, for instance or the amount of wealth they possess. They could also be characteristics you find from the network itself - such as how many ties an node has (degree centrality). </dd>\n\n        <dt>Centrality</dt>\n        <dd>This is a way of ranking the importance of individuals within a network. There are many different ways to measure importance, such as degree centrality, betweenness centrality, and eigenvector centrality.  </dd>\n        <ul> <dl>\n\n        <dt>Degree Centrality</dt>\n        <dd>Degree centrality is a measure of how many connections a node has. An node with many ties that are being sent to them has a high in-degree centrality. In a friendship network, this can be easily recognized as popularity. Nodes sending many outgoing ties (high out-degree centrality) may be thought of as expansive in their relationship.</dd>\n\n        <dt>Betweenness Centrality</dt>\n        <dd>Nodes with high betweenness centrality serve as connectors between other individuals who wouldn't otherwise be directly connected. They may not be connected to a large number of people (that would be high degree centrality), but they are unique in their connections. If an actor with high betweenness centrality was removed from a network, the network would be more fragmented and less connected. Often researchers are interested in finding actors with high betweenness centrality because they can control whatever flows in the networks. For instance, military analysts often look for nodes with high betweenness in a terrorist network.</dd>\n\n        <dt>Eigenvector Centrality</dt>\n        <dd>Eigenvector centrality ranks actors based on their connection to other highly central nodes. So, a nodes importance as measured by eigenvector centrality are dependent on the other nodes with whom they share connections. Google's PageRank algorithm was a famous application of a version of this type of centrality, and allowed them to return highly relevant results in search for users.</dd>\n        </dl></ul>\n\n        <dt>Communities</dt>\n        <dd>A community in a network is a way of thinking about grouping, often by finding densely connected sets of nodes. A community within a network that is tightly connected to one another but not to an outside group might be seen as a faction, such as rival political groups. In this case, nodes with high betweenness centrality in a network with multiple factions might be some of the only points of contact between rival groups - a potentially powerful but also difficult position to be in.</dd>\n        </dl>\n      </div>\n    );\n  }\n\n} // class Vocabulary\n\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = Vocabulary;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n    D3 Simple NetGraph\n\n    This uses D3 Version 4.0.\n\n    This is designed to work with the NetGraph React component.\n\n    NetGraph calls SetData whenever it receives an updated data object.\n    This triggers D3NetGraph to redraw itself.\n\n    This simplified version derived from D3NetGraph.js was created to address\n    a problem with links not updating properly.\n\n    The first implementation of this removed the fancy force property settings\n    that were needed to handle the realtime UI widgets in 'D3 Force Demo' app.\n    Eventually these were brough back in once the link merging was debugged.\n    However, this hasn't been reconciled with the `D3 Force Demo` widgets.\n    It *might* work, but it *might* not.\n\n    Zooming/panning is handled via D3's zoom() function.  Basically it\n    involves creating a `g` element that wraps the node and link elements\n    and applying transforms on that wrapper.\n\n    This is based on:\n    *  rdpoor's commented version of mbostock's original code\n       https://gist.github.com/rdpoor/3a66b3e082ffeaeb5e6e79961192f7d8\n    *  danilo's v4 update\n       https://bl.ocks.org/tezzutezzu/cd04b3f1efee4186ff42aae66c87d1a7\n    *  mbostock's general update pattern\n       https://bl.ocks.org/mbostock/3808218\n    *  Coderwall's zoom and pan method\n       https://coderwall.com/p/psogia/simplest-way-to-add-zoom-pan-on-d3-js\n    *  Vladyslav Babenko's zoom buttons example\n       https://jsfiddle.net/vbabenko/jcsqqu6j/9/\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst DBG             = false;\nconst PR              = 'd3-simplenetgraph'\n\n/* eslint-disable prefer-reflect */\n/* d3.call() is false-triggering the above rule */\n\n/// SYSTEM LIBRARIES //////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst d3              = require('d3')\nconst UNISYS          = require('unisys/client');\nvar   UDATA           = null;\n\n/// PRIVATE VARS //////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nlet m_width  = 800;\nlet m_height = 800;\nlet mouseoverNodeId = -1;   // id of the node the mouse is currently over\nconst M_FORCEPROPERTIES = {   // values for all forces\n      center: {\n        x: 0.5,\n        y: 0.5\n      },\n      charge: {\n        // 'charge' provides a repelling force against other nodes\n        enabled: true,\n        // -50 works well for small networks with no links\n        strength: -200, // during _UpdateForces, 'strength' is multipled by the size of the node (degrees+1)\n                       // -50 close < -1000 pushes nodes far apart\n        distanceMin: 1, // use 'collide' to keep nodes from intersecting, not distance\n        distanceMax: 750 // max keeps large clusters from pushing unattached nodes too far away\n                         // 250 close < 500 med < 1000 spacious < 10000 far away\n      },\n      collide: {\n        // 'collide' keeps nodes from overlapping each other\n        // collide's `radius` value maintains a minimum distance between nodes\n        enabled: true,\n        strength: 0.75, // 1 keeps nodes from intersecting during drag so nodes feel more solid\n                        // 0.75 softens the collisions so they don't feel so jarring\n                        // 0.3 will allow nodes to intersect, then iterations will push them out\n        iterations: 5, // need at least 3 iterations to stabilize\n                       // at 1 graph takes a long time to reach equilibrium\n        radius: 7 // `radius` is added to node.degrees + defaultSize during _UpdateForces with the node radius\n      },\n      forceX: {\n        // 'forceX' pushes nodes towards a normalized x position\n        // x is calculated relative to the m_width\n        // e.g. x=0.5 is the center\n        // higher strength will push harder towards the x point\n        // e.g. to create a narrow tall graph, use strength: 2\n        enabled: true,\n        strength: 0.25, // 1 clumped < 0.3 med  < 0.2 loose < 0.1 very loose\n        x: 0.5\n      },\n      forceY: {\n        // 'forceY' pushes nodes towards a normalized y position\n        // y is calculated relative to the m_height\n        // e.g. y=0.5 is the center\n        // higher strength will push harder towards the y point\n        // e.g. to create a wide short graph, use strength: 2\n        enabled: true,\n        strength: 0.25, // 1 clumped < 0.3 med  < 0.2 loose < 0.1 very loose\n        y: 0.5\n      },\n      link: {\n        enabled: true,\n        distance: 50, // sets the basic link distance between nodes\n                      // 10 is a little too close\n                      // 25 is cozy\n                      // 50 is spacious\n                      // 100 leaves everything too far apart\n        iterations: 5 // Orig val = 1.  More iterations will give graph time to settle\n      }\n    }; // M_FORCEPROPERTIES\n\n\n\n/// D3NetGraph CLASS //////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nclass D3NetGraph {\n\n    constructor ( rootElement, nodeDefs ) {\n\n      this.rootElement  = rootElement;\n      this.d3svg        = {};\n      this.zoom = {};\n      this.zoomWrapper  = {};\n      this.simulation   = {};\n      this.data         = { nodes: [], edges: [] };\n\n      this.clickFn      = {};\n\n      this.defaultSize  = 5;\n\n      // To handled tooltips\n      this.nodeDefs = nodeDefs;\n\n      /// Initialize UNISYS DATA LINK for REACT\n      UDATA = UNISYS.NewDataLink(this);\n\n\n  /// D3 CODE ///////////////////////////////////////////////////////////////////\n  /// note: this is all inside the class constructor function!\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n      // Set up Zoom\n      this.zoom = d3.zoom().on(\"zoom\", this._HandleZoom);\n\n  /*/ Create svg element which will contain our D3 DOM elements.\n      Add default click handler so when clicking empty space, deselect all.\n      NOTE: the svg element is actualy d3.selection object, not an svg obj.\n  /*/ this.d3svg = d3.select(rootElement).append('svg')\n        .attr('id', 'netgraph')\n        .attr('width',  \"100%\")  // maximize width and height\n        .attr('height', \"100%\")  // then set center dynamically below\n        .on(\"click\", ( e, event ) => {\n            // Deselect\n            UDATA.LocalCall('SOURCE_SELECT',{ nodeLabels: [] });\n            }\n        )\n        .on(\"mouseover\", (d) => {\n          // Deselect edges\n          mouseoverNodeId = -1;\n          d3.selectAll('.edge')\n            .transition()\n            .duration(1500)\n            .style('stroke-width', this._UpdateLinkStrokeWidth)\n          d3.event.stopPropagation();\n        })\n        .call(this.zoom);\n\n      this.zoomWrapper = this.d3svg.append('g').attr(\"class\", \"zoomer\")\n\n      // Set SVG size and centering.\n      let svg = document.getElementById('netgraph');\n      m_width = svg.clientWidth;\n      m_height = svg.clientHeight;\n\n      this.simulation = d3.forceSimulation();\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// END D3 CODE ///////////////////////////////////////////////////////////////\n\n      // bind 'this' to function objects so event handlers can access\n      // contents of this class+module instance\n      this._HandleFilteredD3DataUpdate = this._HandleFilteredD3DataUpdate.bind(this);\n      this._SetData           = this._SetData.bind(this);\n      this._Initialize        = this._Initialize.bind(this);\n      this._UpdateGraph       = this._UpdateGraph.bind(this);\n      this._UpdateForces      = this._UpdateForces.bind(this);\n      this._Tick              = this._Tick.bind(this);\n      this._ColorMap = this._ColorMap.bind(this);\n      this._ZoomReset = this._ZoomReset.bind(this);\n      this._ZoomIn = this._ZoomIn.bind(this);\n      this._ZoomOut = this._ZoomOut.bind(this);\n      this._ZoomPanReset = this._ZoomPanReset.bind(this);\n      this._HandleZoom        = this._HandleZoom.bind(this);\n      this._Dragstarted       = this._Dragstarted.bind(this);\n      this._Dragged           = this._Dragged.bind(this);\n      this._Dragended         = this._Dragended.bind(this);\n\n      // V1.4 CHANGE\n      // Ignore D3DATA Updates!!!  Only listen to FILTEREDD3DATA Updates\n      //\n      // watch for updates to the D3DATA data object\n      // UDATA.OnAppStateChange('D3DATA',(data)=>{\n      //   // expect { nodes, edges } for this namespace\n      //   if (DBG) console.error(PR,'got state D3DATA',data);\n      //   this._SetData(data);\n      // });\n\n      UDATA.OnAppStateChange('FILTEREDD3DATA', this._HandleFilteredD3DataUpdate);\n      UDATA.OnAppStateChange('COLORMAP', this._ColorMap);\n      UDATA.HandleMessage('ZOOM_RESET', this._ZoomReset);\n      UDATA.HandleMessage('ZOOM_IN', this._ZoomIn);\n      UDATA.HandleMessage('ZOOM_OUT', this._ZoomOut);\n      UDATA.HandleMessage('ZOOM_PAN_RESET', this._ZoomPanReset);\n      // UDATA.HandleMessage('GROUP_PROPS', (data) => {\n      //   console.log('GROUP_PROPS got ... ');\n      // });\n\n\n\n  }\n\n\n  /// CLASS PUBLIC METHODS //////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  Deregister() {\n    if (DBG) console.log(PR, 'd3-simplenetgraph.DESTRUCT!!!')\n    UDATA.AppStateChangeOff('FILTEREDD3DATA', this._HandleFilteredD3DataUpdate);\n    UDATA.AppStateChangeOff('COLORMAP', this._ColorMap);\n    UDATA.UnhandleMessage('ZOOM_RESET', this._ZoomReset);\n    UDATA.UnhandleMessage('ZOOM_IN', this._ZoomIn);\n    UDATA.UnhandleMessage('ZOOM_OUT', this._ZoomOut);\n    UDATA.UnhandleMessage('ZOOM_PAN_RESET', this._ZoomPanReset);\n  }\n\n  /// CLASS PRIVATE METHODS /////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /**\n   *\n   * @param {object} data\n   * @param {array} data.nodes\n   * @param {array} data.edges\n   */\n  _HandleFilteredD3DataUpdate(data) {\n    if (DBG) console.log(PR, 'got state FILTEREDD3DATA', data);\n    this._SetData(data);\n  }\n\n/*/ Clear the SVG data\n    Currently not used because we just deconstruct d3-simplenetgraph insead.\n    Was thought to be needed during imports otherwise _UpdateGraph reads data from existing\n    SVG elements rather than the new data.\n/*/\n  _ClearSVG() {\n    this.zoomWrapper.selectAll(\".edge\").remove();\n    this.zoomWrapper.selectAll(\".node\").remove();\n  }\n\n\n/*/ The parent container passes data to the d3 graph via this SetData call\n    which then triggers all the internal updates\n/*/\n  _SetData(newData) {\n    if (newData) {\n      // Make a shallow copy to protect against mutation, while\n      // recycling old nodes to preserve position and velocity.\n      // From https://observablehq.com/@d3/modifying-a-force-directed-graph?collection=@d3/d3-force\n      // grab the SVG nodes\n      const svgNodes = this.zoomWrapper.selectAll(\".node\");\n      const oldNodes = new Map(svgNodes.data().map(d => [d.id, d]));\n\n      this.data.nodes = newData.nodes.map(d => Object.assign(oldNodes.get(d.id) || {}, d));\n      this.data.edges = newData.edges.map(d => Object.assign({}, d));\n\n      this._Initialize()\n      this._UpdateForces()\n      this._UpdateGraph()\n\n      // updates ignored until this is run restarts the simulation\n      // (important if simulation has already slowed down)\n      this.simulation.alpha(.3).restart()  // was 1 - JD\n    }\n  }\n\n/*/ This sets up the force properties for the simulation and tick handler.\n/*/ _Initialize () {\n      // Create the force layout.  After a call to force.start(), the tick\n      // method will be called repeatedly until the layout \"gels\" in a stable\n      // configuration.\n      this.simulation\n        .force(\"link\",    d3.forceLink())\n        .force(\"charge\",  d3.forceManyBody())\n        .force(\"collide\", d3.forceCollide())\n        .force(\"center\",  d3.forceCenter())\n        .force(\"forceX\",  d3.forceX())\n        .force(\"forceY\",  d3.forceY())\n\n        .on(\"tick\", this._Tick)\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Call _UpdateGraph() after new data has been loaded. This creates link and node\n    svg objects and sets their forceProperties.\n    The component `node` structure:\n        <g class=\"node\">  // node group object\n           <circle>\n           <text>         // label\n           <title>        // tooltip\n        </g>\n\n    This method implements the unified enter/exit/update pattern described\n    here: http://d3indepth.com/enterexit/#general-update-pattern\n\n    By convention, selection methods that return the current selection use\n    four spaces of indent, while methods that return a new selection use only two.\n    This helps reveal changes of context by making them stick out of the chain.\n\n    This method actually does more than just \"update\" an existing graph; in D3\n    you can write code that initializes AND updates data.\n\n/*/ _UpdateGraph() {\n      const COLORMAP = UDATA.AppState('COLORMAP');\n\n      // DATA JOIN\n      // select all elemnts with class .node in d3svg\n      // bind selected elements with elements in this.data.nodes,\n      // assigning each one an id using the key function.\n\n      // nodeElements is a d3.selection object\n      let nodeElements = this.zoomWrapper.selectAll(\".node\")\n        .data(this.data.nodes, (d) => { return d.id }); // fn returns the calculated key for the data object\n\n      // linkElements is a d3.selection object\n      let linkElements = this.zoomWrapper.selectAll(\".edge\")\n        .data(this.data.edges, (d) => { return d.id }); // fn returns the calculated key for the data object\n\n\n      // TELL D3 HOW TO HANDLE NEW NODE DATA\n      // the d3.selection.enter() method sets the operational scope for\n      // subsequent calls\n      let elementG = nodeElements.enter()\n        .append(\"g\")\n          .classed('node',true);\n\n      // enter node: append 'g' (group) element and click behavior\n      elementG\n        .call(d3.drag()\n          .on(\"start\", (d) => { this._Dragstarted(d, this) })\n          .on(\"drag\",  this._Dragged)\n          .on(\"end\",   (d) => { this._Dragended(d, this) }))\n        .on(\"click\",   (d) => {\n            if (DBG) console.log('clicked on',d.label,d.id)\n            UDATA.LocalCall('SOURCE_SELECT',{ nodeIDs: [d.id] });\n            d3.event.stopPropagation();\n        })\n        .on(\"mouseover\", (d) => {\n          mouseoverNodeId = d.id;\n          d3.selectAll('.edge')\n            .transition()\n            .duration(500)\n            .style('stroke-width', this._UpdateLinkStrokeWidth)\n          d3.event.stopPropagation();\n        })\n\n      // enter node: also append 'circle' element of a calculated size\n      elementG\n        .append(\"circle\")\n        // \"r\" has to be set here or circles don't draw.\n        .attr(\"r\", (d) => {\n          return this.defaultSize + d.degrees;\n        })\n        //        .attr(\"r\", (d) => { return this.defaultSize }) // d.size ?  d.size/10 : this.defaultSize; })\n        .attr(\"fill\", (d) => {\n          // REVIEW: Using label match.  Should we use id instead?\n          // The advantage of using the label is backward compatibility with\n          // Google Fusion table data as well as exportability.\n          // If we save the type as an id, the data format will be\n          // less human-readable.\n          // The problem with this approach though is that any changes\n          // to the label text will result in a failed color lookup!\n           return COLORMAP.nodeColorMap[d.type];\n        })\n        .style(\"opacity\", d => {\n          return d.filteredTransparency\n        });\n\n      // enter node: also append 'text' element\n      elementG\n        .append(\"text\")\n          .classed('noselect', true)\n          .attr(\"font-size\", 10)\n          .attr(\"dx\", (d=>{return this.defaultSize + 5})) // 8)\n          .attr(\"dy\", \"0.35em\") // \".15em\")\n          .text((d) => { return d.label })\n          .style(\"opacity\", d => {\n            return d.filteredTransparency\n          });\n\n      // enter node: also append a 'title' tag\n      // we should move this to our tooltip functions, but it works for now\n      elementG\n        .append(\"title\") // node tooltip\n          .text((d) => {\n            return this.tooltipForNode(d);\n        });\n\n      /*/ TRICKY D3 CODE CONCEPTS AHEAD\n\n          CONTEXT: The author of this code has assumed that NCDATA may\n          completely changed, so his update code is written with this in mind.\n\n          At this point in the code, nodeElements is operating on the enter()\n          selection set (remember: nodeElements is a REFERENCE to the\n          original d3 selection object, which is being transmutted by every\n          operation).\n\n          Given the above, .merge() will combine the current active d3\n          selection (enter()) with all the nodes (nodeEntry in its entirety).\n\n          It may seem weird because:\n\n          (1) the d3.selection() context isn't always obvious unless you\n              know that d3.selections and key ops like .enter(), .update(),\n              and .exit() affect certain other ops.\n          (2) this code reads like it's executing immediately on nodeElements,\n              but it actually is a PROGRAM being defined for a d3.selection\n              event that runs later. The value of the parameter nodeElements\n              will have a different value in the future than it does at the\n              time of definition here.\n\n          In effect, the merge() operation is used to use the same\n          initialization code for both enter() and manual refresh.\n\n          ASIDE: There is an d3.selection.update() operation, but that  is\n          called when d3 detects that data node bound to an existing DOM\n          element has changed. This code doesn't use update(), and instead\n          relies on manual event detection to force a full data refresh and\n          update. D3 doesn't die because it is aware of the persistent SVG\n          elements  it created, and checks data binding through the id. This\n          is fast, and the SVG elements do not have to be recreated.\n\n      /*/\n\n      // UPDATE circles in each node for all nodes\n      nodeElements.merge(nodeElements)\n        .selectAll(\"circle\")\n          .attr(\"stroke\",       (d) => {\n            if (d.selected)    return d.selected;\n            if (d.strokeColor) return d.strokeColor;\n            return undefined; // don't set stroke color\n          })\n          .attr(\"stroke-width\", (d) => {\n            if (d.selected || d.strokeColor) return '5px';\n            return undefined // don't set stroke width\n          })\n          .attr(\"fill\", (d) => {\n            return COLORMAP.nodeColorMap[d.type];\n          })\n          .attr(\"r\", (d) => {\n            // this \"r\" is necessary to resize after a link is added\n            return this.defaultSize + d.degrees;\n          })\n          .transition()\n          .duration(500)\n          .style(\"opacity\", d => {\n            // console.log(d);\n            return d.filteredTransparency\n          });\n\n      // UPDATE text in each node for all nodes\n      // (technically this could have proceeded from the previous operation,\n      // but this makes it a little easier to findthe text-specific code as\n      // a block\n      nodeElements.merge(nodeElements)\n        .selectAll(\"text\")\n          .attr(\"color\", (d) => {\n            if (d.selected) return d.selected;\n            return undefined; // don't set color\n          })\n          .attr(\"font-weight\", (d) => {\n            if (d.selected) return 'bold';\n            return undefined; // don't set font weight\n          })\n          .text((d) => { return d.label }) // in case text is updated\n          .transition()\n          .duration(500)\n          .style(\"opacity\", d => {\n            return d.filteredTransparency\n          });\n\n      nodeElements.merge(nodeElements)\n        .selectAll(\"title\") // node tooltip\n          .text((d) => {\n            return this.tooltipForNode(d);\n        });\n      // TELL D3 what to do when a data node goes away\n      nodeElements.exit().remove()\n\n      // NOW TELL D3 HOW TO HANDLE NEW EDGE DATA\n      // .insert will add an svg `line` before the objects classed `.node`\n      // .enter() sets the initial state of links as they are created\n      linkElements.enter()\n        .insert(\"line\",\".node\")\n        .classed('edge', true)\n        .style('stroke', this._UpdateLinkStrokeColor)\n        // .style('stroke', 'rgba(0,0,0,0.1)')  // don't use alpha unless we're prepared to handle layering -- reveals unmatching links\n        .style('stroke-width', this._UpdateLinkStrokeWidth )\n        // old stroke setting\n        // .style('stroke-width', (d) => { return d.size**2 } )    // Use **2 to make size differences more noticeable\n        // Edge selection disabled.\n        // .on(\"click\",   (d) => {\n        //   if (DBG) console.log('clicked on',d.label,d.id)\n        //   this.edgeClickFn( d )\n        // })\n        .style(\"opacity\", d => {\n          return d.filteredTransparency\n        });\n\n      // .merge() updates the visuals whenever the data is updated.\n      linkElements.merge(linkElements)\n        .classed(\"selected\",  (d) => { return d.selected })\n        .style('stroke', this._UpdateLinkStrokeColor)\n        .style('stroke-width', this._UpdateLinkStrokeWidth)\n        .transition()\n        .duration(500)\n        .style(\"opacity\", d => {\n          return d.filteredTransparency\n        });\n\n      linkElements.exit().remove()\n\n      // UPDATE ANIMATED SIMULATION\n      // this is a plugin\n      this.simulation.nodes(this.data.nodes)\n      if (this.data.edges) {\n        this.simulation.force(\"link\").links(this.data.edges)\n      }\n    }\n\n// added by Joshua to generate the text, based on the template, for the tooltip on the node\ntooltipForNode(d)\n{\n    let titleText =  \"\";\n    if(this.nodeDefs.label.includeInGraphTooltip != undefined)\n    {\n        // Add Label\n          if(this.nodeDefs.label.includeInGraphTooltip)\n            titleText += this.nodeDefs.label.displayLabel + \": \" + d.label + \"\\n\";\n        // Add type\n          if (this.nodeDefs.type.includeInGraphTooltip)\n            titleText += this.nodeDefs.type.displayLabel + \": \" + d.type + \"\\n\";\n        // Add degrees\n          if(this.nodeDefs.degrees.includeInGraphTooltip)\n            titleText += this.nodeDefs.degrees.displayLabel + \": \" + d.degrees + \"\\n\";\n        // Add notes\n          if(this.nodeDefs.notes.includeInGraphTooltip)\n            titleText += this.nodeDefs.notes.displayLabel + \": \" + d.notes + \"\\n\";\n        // Add info\n          if(this.nodeDefs.info.includeInGraphTooltip)\n            titleText += this.nodeDefs.info.displayLabel + \": \" + d.info + \"\\n\";\n        // Add updated info\n          if(this.nodeDefs.updated.includeInGraphTooltip)\n            titleText += this.nodeDefs.updated.displayLabel + \": \" + this.displayUpdated(d);\n    }\n    else\n    {\n\n       // For backwards compatability\n       titleText += this.nodeDefs.displayLabel.label + \": \" + d.label + \"\\n\";\n\n    }\n    return titleText;\n}\n\ndisplayUpdated(nodeEdge) {\n  const d = new Date(nodeEdge.meta.revision > 0 ? nodeEdge.meta.updated : nodeEdge.meta.created);\n  const year = String(d.getFullYear());\n  const date = (d.getMonth()+1)+\"/\"+d.getDate()+\"/\"+ year.substr(2,4);\n  const time = d.toTimeString().substr(0, 5);\n  const author = nodeEdge._nlog ? nodeEdge._nlog[nodeEdge._nlog.length-1] : 'unknown';\n  const dateTime = date + ' at ' + time + \" by \" + author;\n  return dateTime;\n}\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Apply new force properties\n    Call this on construct and if forceProperties have changed.\n/*/ _UpdateForces() {\n      this.simulation\n        .force(\"link\", d3.forceLink()\n            .id(d => d.id) // note `d` is an edge, not a node\n            // all edges use the same link distance, charge is what pushes them apart\n            .distance(M_FORCEPROPERTIES.link.distance)\n            .iterations(M_FORCEPROPERTIES.link.iterations))\n        .force(\"charge\", d3.forceManyBody()\n            // the larger the node, the harder it pushes\n            .strength(d => (this.defaultSize+d.degrees) * M_FORCEPROPERTIES.charge.strength * M_FORCEPROPERTIES.charge.enabled )\n            .distanceMin(M_FORCEPROPERTIES.charge.distanceMin)\n            .distanceMax(M_FORCEPROPERTIES.charge.distanceMax))\n        .force(\"collide\", d3.forceCollide()\n            .strength(M_FORCEPROPERTIES.collide.strength * M_FORCEPROPERTIES.collide.enabled)\n            // node radius (defaultSize+degrees) + preset radius keeps nodes separated\n            // from each other like bouncing balls\n            .radius(d => this.defaultSize+d.degrees+M_FORCEPROPERTIES.collide.radius)\n            .iterations(M_FORCEPROPERTIES.collide.iterations))\n        .force(\"center\", d3.forceCenter()\n            .x(m_width * M_FORCEPROPERTIES.center.x)\n            .y(m_height * M_FORCEPROPERTIES.center.y))\n        .force(\"forceX\", d3.forceX()\n            .strength(M_FORCEPROPERTIES.forceX.strength * M_FORCEPROPERTIES.forceX.enabled)\n            .x(m_width * M_FORCEPROPERTIES.forceX.x))\n        .force(\"forceY\", d3.forceY()\n            .strength(M_FORCEPROPERTIES.forceY.strength * M_FORCEPROPERTIES.forceY.enabled)\n            .y(m_height * M_FORCEPROPERTIES.forceY.y))\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Update the display positions after each simulation tick\n\n    This tick method is called repeatedly until the layout stabilizes.\n\n    NOTE: the order in which we update nodes and links does NOT determine which\n    gets drawn first -- the drawing order is determined by the ordering in the\n    DOM.  See the notes under link_update.enter() above for one technique for\n    setting the ordering in the DOM.\n/*/ _Tick () {\n      // Drawing the nodes: Update the location of each node group element\n      // from the x, y fields of the corresponding node object.\n      this.zoomWrapper.selectAll(\".node\")\n        .attr(\"transform\", (d) => { return \"translate(\"+d.x+\",\"+d.y+\")\" })\n\n      // Drawing the links: Update the start and end points of each line element\n      // from the x, y fields of the corresponding source and target node objects.\n      this.zoomWrapper.selectAll(\".edge\")\n        .attr(\"x1\", (d) => { return d.source.x; })\n        .attr(\"y1\", (d) => { return d.source.y; })\n        .attr(\"x2\", (d) => { return d.target.x; })\n        .attr(\"y2\", (d) => { return d.target.y; })\n    }\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Sets the width of the links during update cycles\n    Used by linElements.enter() and linkElements.merge()\n    and mouseover events.\n/*/\n_UpdateLinkStrokeWidth(edge) {\n  if (DBG) console.log(PR, '_UpdateLinkStrokeWidth', edge);\n  const sourceId = typeof edge.source === 'number' ? edge.source : edge.source.id;\n  const targetId = typeof edge.target === 'number' ? edge.target : edge.target.id;\n  if (edge.selected ||\n    (mouseoverNodeId === -1) ||\n    (sourceId === mouseoverNodeId) ||\n    (targetId === mouseoverNodeId)\n  ) {\n    return edge.size ** 2;  // Use **2 to make size differences more noticeable\n  } else {\n    return 0.175;             // Barely visible if not selected\n  }\n}\n\n_UpdateLinkStrokeColor(edge) {\n  if (DBG) console.log(PR, '_UpdateLinkStrokeColor', edge)\n  let COLORMAP = UDATA.AppState('COLORMAP');\n  let color = COLORMAP.edgeColorMap[edge.type]\n  return color;\n}\n\n\n/// UI EVENT HANDLERS /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  // The template may be loaded or changed after NCDATA is loaded.\n  // So we need to explicitly update the colors if the color\n  // definitions have changed.\n  _ColorMap(data) {\n    if (DBG) console.log(PR, 'got state COLORMAP', data);\n    this._UpdateGraph();\n  }\n\n  _ZoomReset(data) {\n    if (DBG) console.log(PR, 'ZOOM_RESET got state NCDATA', data);\n    // NOTE: The transition/duration call means _HandleZoom will be called multiple times\n    this.d3svg.transition()\n      .duration(200)\n      .call(this.zoom.scaleTo, 1);\n  }\n\n  _ZoomIn(data) {\n    if (DBG) console.log(PR, 'ZOOM_IN got state NCDATA', data);\n    this._Transition(1.2);\n  }\n\n  _ZoomOut(data) {\n    if (DBG) console.log(PR, 'ZOOM_OUT got state NCDATA', data);\n    this._Transition(0.8);\n  }\n\n  // Pan to 0,0 and zoom scale to 1\n  // (Currently not used)\n  _ZoomPanReset(data) {\n    if (DBG) console.log(PR, 'ZOOM_PAN_RESET got state NCDATA', data);\n    const transform = d3.zoomIdentity.translate(0, 0).scale(1);\n    this.d3svg.call(this.zoom.transform, transform);\n  }\n\n/*/ This primarily handles mousewheel zooms\n/*/\n_HandleZoom() {\n  if (DBG) console.log(PR, '_HandleZoom')\n  d3.select('.zoomer').attr(\"transform\", d3.event.transform);\n}\n/*/ This handles zoom button zooms.\n/*/\n_Transition(zoomLevel) {\n  if (DBG) console.log(PR, '_Transition')\n  this.d3svg.transition()\n    //.delay(100)\n    .duration(200)\n    .call(this.zoom.scaleBy, zoomLevel);\n}\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ _Dragstarted (d, self) {\n      if (DBG) console.log(PR, '_Dragstarted', d.x, d.y)\n      if (!d3.event.active) self.simulation.alphaTarget(0.3).restart();\n      d.fx = d.x;\n      d.fy = d.y;\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ _Dragged (d) {\n      if (DBG) console.log(PR, '_Dragged')\n      d.fx = d3.event.x;\n      d.fy = d3.event.y;\n    }\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/\n/*/ _Dragended (d, self) {\n      if (DBG) console.log(PR, '_Dragended')\n      if (!d3.event.active) self.simulation.alphaTarget(0.0001);\n      d.fx = null;\n      d.fy = null;\n    }\n    // update window size-related forces\n    // d3.select(window).on(\"resize\", (){ =>\n    //     width = +svg.node().getBoundingClientRect().width;\n    //     height = +svg.node().getBoundingClientRect().height;\n    //     updateForces();\n    // });\n} // class D3NetGraph\n\n/// EXPORT MODULE /////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = D3NetGraph\n","const FILTER = {};\n\n// Determines whether filter action is to highlight/fade or remove (filter) nodes and edges\nFILTER.ACTION = {};\nFILTER.ACTION.HIGHLIGHT = 'highlight';\nFILTER.ACTION.FILTER = 'filter';\n\n// Types of filters definable in template files.\nFILTER.TYPES = {};\nFILTER.TYPES.STRING = 'string';\nFILTER.TYPES.NUMBER = 'number';\nFILTER.TYPES.SELECT = 'select';\nFILTER.TYPES.NODE   = 'node'; // edge source / target\nFILTER.TYPES.DATE   = 'date';\nFILTER.TYPES.HIDDEN = 'hidden';\n\n// Special Edge Keys mapped to node objects\n// Used by m_IsEdgeMatchedByFilter to find node labels\nFILTER.KEY = {};\nFILTER.KEY.SOURCE = \"source\";\nFILTER.KEY.TARGET = \"target\";\n\n\nFILTER.OPERATORS = {};\n\n// key needs to match the OPERATOR name for lookup purposes\n// in filter-logic.js\nFILTER.OPERATORS.NO_OP = { key: \"NO_OP\", label: \"--\" };\nFILTER.OPERATORS.CONTAINS = { key: \"CONTAINS\", label: \"contains\" };\nFILTER.OPERATORS.NOT_CONTAINS = { key: \"NOT_CONTAINS\", label: \"does not contain\" };\nFILTER.OPERATORS.GT = { key: \"GT\", label: \">\" };\nFILTER.OPERATORS.GT_EQ = { key: \"GT_EQ\", label: \">=\" };\nFILTER.OPERATORS.LT = { key: \"LT\", label: \"<\" };\nFILTER.OPERATORS.LT_EQ = { key: \"LT_EQ\", label: \"<=\" };\nFILTER.OPERATORS.EQ = { key: \"EQ\", label: \"=\" };\nFILTER.OPERATORS.NOT_EQ = { key: \"NOT_EQ\", label: `\\u2260` };\n\n\n/*/ UDATA MESSAGES ////////////////////////////////////////////////////////////\n\nFilter UDATA Messages\n\n\nAffects ALL Filters\n===================\n\n  FDATA           AppState\n                  Sets the FDATA data object\n                  Triggers AppStateChange\n\n  FILTER_CLEAR    Message / LocalCall\n                  Unhides all objects on the graph\n                  Resets filter form to blank state\n\n  FILTER_SUMMARY_UPDATE\n                  Message / LocalCall\n                  Summary of filters for InfoPanel display\n                  is updated.\n\n\nAffects Individual Filters\n==========================\n\n  FILTER_DEFINE   Define a single new filter\n\n\n/*/\n\nmodule.exports = FILTER;\n","import FILTER from './FilterEnums';\nimport FilterGroupProperties from './FilterGroupProperties';\nimport NumberFilter from './NumberFilter';\nimport React from 'react';\nimport SelectFilter from './SelectFilter';\nimport StringFilter from './StringFilter';\nconst ReactStrap = require('reactstrap');\nconst { Input, Label } = ReactStrap;\n\nexport default function FilterGroup({\n  group, label, filters, filterAction, transparency\n}) {\n  return (\n    <div className=\"filter-group\" style={{margin:'5px 5px 5px 0',padding:'10px',backgroundColor:'rgba(0,0,0,0)'}}>\n      <div className=\"small text-muted\" style={{fontWeight:'bold',textTransform:'uppercase',marginBottom:'0.4em'}}>{label}</div>\n      {filters.map(filter => {\n        switch (filter.type) {\n          case FILTER.TYPES.STRING:\n          case FILTER.TYPES.NODE:\n            return <StringFilter key={filter.id} group={group} filter={filter} filterAction={filterAction}/>\n            break;\n          case FILTER.TYPES.NUMBER:\n            return <NumberFilter key={filter.id} group={group} filter={filter} filterAction={filterAction}/>\n            break;\n          case FILTER.TYPES.SELECT:\n            return <SelectFilter key={filter.id} group={group} filter={filter} filterAction={filterAction}/>\n            break;\n          default:\n            console.error(`FilterGroup: Filter Type not found ${filter.type} for filter`, filter);\n            break;\n        }\n        return '';\n      })}\n      <FilterGroupProperties group={group} transparency={transparency} />\n      <hr/>\n    </div>\n  );\n}\n","\nimport FILTER from './FilterEnums';\nimport React from 'react';\nconst ReactStrap = require('reactstrap');\nconst { Form, FormGroup, Input, Label } = ReactStrap;\n\nconst UNISYS = require('unisys/client');\nvar UDATA = null;\n\n\nclass FilterGroupProperties extends React.Component {\n\n  // Currently inconsistent because not passing in a key, etc.\n  // if we expand on this notion of group-leve globals we'll need to update\n  // the format / approach\n\n  constructor({\n    group, transparency\n  }) {\n    super();\n    this.OnChangeValue = this.OnChangeValue.bind(this);\n    this.TriggerChangeHandler = this.TriggerChangeHandler.bind(this);\n    this.OnSubmit = this.OnSubmit.bind(this);\n\n    this.state = {\n      group: group,\n      transparency: transparency\n    };\n\n    UDATA = UNISYS.NewDataLink(this);\n\n  }\n\n  OnChangeValue(e) {\n    this.setState({\n      transparency: e.target.value\n    }, this.TriggerChangeHandler);\n  }\n\n  // this is overkill to have these be separate, but mirroring the other filter components and aiming\n  // to have future additional properties here, so this way the flow won't change (change functions call trigger change)\n  TriggerChangeHandler()\n  {\n      // for debugging\n      if(false)console.log(\"Filter group for \" + this.state.group + \" setting transparency to \" + this.state.transparency);\n\n      // set the transparency globally for this group (nodes or edges)\n      UDATA.LocalCall('FILTER_DEFINE', {\n        group: this.state.group,\n        type: \"transparency\",\n        transparency: this.state.transparency\n      }); // set a SINGLE filter\n\n      // trigger a refresh of the filters if its not already done?\n      //UDATA.SetAppState(\"FDATA\", fdata);\n\n  }\n\n  OnSubmit(e) {\n    // Prevent \"ENTER\" from triggering form submission!\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  render () {\n    const { group, transparency } = this.props;\n    return (\n      <div>\n        <br/>\n        <Form inline className=\"filter-item\" key={group} onSubmit={this.OnSubmit}>\n        <FormGroup><Label size=\"sm\" className=\"small text-muted\"\n          style={{ fontSize: '0.75em', lineHeight: '1em', width: `5em`, marginLeft: '0em'}}>\n          Transparency&nbsp;</Label>\n          <Input type=\"text\" value={transparency}\n          style={{maxWidth:'9em', height:'1.5em', marginLeft: '1em'}}\n          onChange={this.OnChangeValue} bsSize=\"sm\" />\n          </FormGroup>\n        </Form>\n      </div>\n);\n  }\n\n}\n\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nexport default FilterGroupProperties;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  FILTERSPANEL\n\n  This is the base UI component that displays filters in the InfoPanel.\n\n  FiltersPanel\n  |-- FiltersGroup\n      |-- StringFilter\n      |-- NumberFilter\n      |-- SelectFilter\n\n  FiltersPanel reads data directly from FDATA.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nimport FILTER from './FilterEnums';\nimport FilterGroup from './FilterGroup';\nimport React from 'react';\nimport StringFilter from './StringFilter';\nconst ReactStrap = require('reactstrap');\n\nconst { Button, ButtonGroup, Input, Label } = ReactStrap;\n\nconst UNISYS = require('unisys/client');\nvar UDATA  = null;\n\n/// CLASS /////////////////////////////////////////////////////////////////////\nclass FiltersPanel extends UNISYS.Component {\n  constructor({ filterGroups, onFiltersChange, tableHeight }) {\n    super();\n\n    this.UpdateFilterDefs = this.UpdateFilterDefs.bind(this);\n    this.OnClearBtnClick = this.OnClearBtnClick.bind(this);\n    this.SelectFilterAction = this.SelectFilterAction.bind(this);\n\n    /// Initialize UNISYS DATA LINK for REACT\n    UDATA = UNISYS.NewDataLink(this);\n\n    // Load Templates\n    // The intial `OnAppStateChange(\"FDATA\")` event when the template is\n    // first loaded is called well before FiltersPanel is\n    // even constructed.  So we need to explicitly load it here.\n    const FDATA = UDATA.AppState(\"FDATA\");\n    this.state = {\n      nodes: FDATA.nodes,\n      edges: FDATA.edges,\n      filterAction: FILTER.ACTION.HIGHLIGHT\n    };\n    UDATA.OnAppStateChange(\"FDATA\", this.UpdateFilterDefs);\n  } // constructor\n\n  componentWillUnmount() {\n    // console.error('TBD: gracefully unsubscribe!')\n    UDATA.AppStateChangeOff(\"FDATA\", this.UpdateFilterDefs);\n  }\n\n  UpdateFilterDefs(data) {\n    this.setState(state => {\n      return {\n        nodes: data.nodes,\n        edges: data.edges,\n        filterAction: data.filterAction || state.filterAction\n      }\n    });\n  }\n\n  OnClearBtnClick() {\n    UDATA.LocalCall('FILTER_CLEAR');\n  }\n\n  SelectFilterAction(filterAction) {\n    this.setState({ filterAction });\n    UDATA.LocalCall('FILTERS_UPDATE', { filterAction });\n  }\n\n  render() {\n    const { filterAction } = this.state;\n    const defs = [this.state.nodes, this.state.edges];\n    return (\n      <div className=\"filterPanel\"\n        style={{\n          overflow: 'auto',\n          marginTop: '6px', padding: '5px',\n          display: 'flex', flexDirection: 'column',\n          backgroundColor: '#EEE',\n          zIndex: '2000'\n        }}>\n        <ButtonGroup>\n          <Button\n            onClick={() => this.SelectFilterAction(FILTER.ACTION.HIGHLIGHT)}\n            active={filterAction === FILTER.ACTION.HIGHLIGHT}\n            outline={filterAction === FILTER.ACTION.HIGHLIGHT}\n            disabled={filterAction === FILTER.ACTION.HIGHLIGHT}\n            style={{\n              color: filterAction === FILTER.ACTION.HIGHLIGHT ? '#333' : '#fff',\n              backgroundColor: filterAction === FILTER.ACTION.HIGHLIGHT ? 'transparent' : '#6c757d88'\n            }}\n          >Highlight</Button>\n          <Button\n            onClick={() => this.SelectFilterAction(FILTER.ACTION.FILTER)}\n            active={filterAction === FILTER.ACTION.FILTER}\n            outline={filterAction === FILTER.ACTION.FILTER}\n            disabled={filterAction === FILTER.ACTION.FILTER}\n            style={{\n              color: filterAction === FILTER.ACTION.FILTER ? '#333' : '#fff',\n              backgroundColor: filterAction === FILTER.ACTION.FILTER ? 'transparent' : '#6c757d88'\n            }}\n          >Filter</Button>\n        </ButtonGroup>\n        <Label className=\"small text-muted\" style={{ padding: '0.5em 0 0 0.5em', marginBottom: '0' }}>\n          {filterAction === FILTER.ACTION.HIGHLIGHT\n            ? 'Highlight nodes/edges that match criteria. (Fade others)'\n            : 'Filter shows only nodes/edges that match criteria.  (Removes others)'\n          }\n        </Label>\n        <hr/>\n        <div style={{ display: 'flex', flexDirection: 'column', flexGrow: `1`, justifyContent: 'space-evenly' }}>\n          {defs.map(def => <FilterGroup\n            key={def.label}\n            group={def.group}\n            label={def.label}\n            filters={def.filters}\n            filterAction={filterAction}\n            transparency={def.transparency}\n            onFiltersChange={this.OnFilterChange}\n          />)}\n        </div>\n        <div style={{ display: 'flex', justifyContent: 'space-evenly', padding: '10px' }}>\n          <Button size=\"sm\" onClick={this.OnClearBtnClick} >Clear Filters</Button>\n        </div>\n      </div>\n    )\n  }\n}\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n// Storybook export\n// export default FiltersPanel;\n\n// Brunch export\nmodule.exports = FiltersPanel;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  NUMBERFILTER\n\n  NumberFilter provides the UI for entering search strings for numeric-based\n  node and edge properties.\n\n  Seven Numeric  operators are supported:\n  * >\n  * >=\n  * <\n  * <=\n  * =\n  * !=\n\n  Matches will SHOW the resulting node or edge.\n  Any nodes/edges not matching will be hidden.\n\n  The filter definition is passed in via props.\n\n    props\n      {\n        group       // \"nodes\" or \"edges\"\n        filter: {\n          id,       // numeric id used for unique React key\n          type,     // filter type, e.g \"string\" vs \"number\"\n          key,      // node field key from the template\n          keylabel, // human friendly display name for the key.  This can be customized in the template.\n          operator, // the comparison function, e.g. 'contains' or '>'\n          value     // the search value to be used for matching\n        },\n        onChangeHandler // callback function for parent component\n      }\n\n  The `onChangeHandler` callback function is not currently used.  Instead,\n  selection changes directly trigger a UDATA.LocalCall('FILTER_DEFINE',...).\n\n  The `id` variable allows us to potentially support multiple search filters\n  using the same key, e.g. we could have two 'Label' filters.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n\nimport FILTER from './FilterEnums';\nimport React from 'react';\nconst ReactStrap = require('reactstrap');\nconst { Form, FormGroup, Input, Label } = ReactStrap;\n\nconst UNISYS = require('unisys/client');\nvar UDATA = null;\n\nconst OPERATORS = [\n  FILTER.OPERATORS.NO_OP,\n  FILTER.OPERATORS.GT,\n  FILTER.OPERATORS.GT_EQ,\n  FILTER.OPERATORS.LT,\n  FILTER.OPERATORS.LT_EQ,\n  FILTER.OPERATORS.EQ,\n  FILTER.OPERATORS.NOT_EQ\n];\n\n\n/// CLASS /////////////////////////////////////////////////////////////////////\nclass NumberFilter extends React.Component {\n\n  constructor({\n    group,\n    filter: {id, type, key, keylabel, operator, value},\n    onChangeHandler\n  }) {\n    super();\n    this.OnChangeOperator = this.OnChangeOperator.bind(this);\n    this.OnChangeValue = this.OnChangeValue.bind(this);\n    this.TriggerChangeHandler = this.TriggerChangeHandler.bind(this);\n    this.OnSubmit = this.OnSubmit.bind(this);\n\n    this.state = {\n      operator: FILTER.OPERATORS.NO_OP, // Used locally to define result\n      value: '' // Used locally to define result\n    };\n\n    /// Initialize UNISYS DATA LINK for REACT\n    UDATA = UNISYS.NewDataLink(this);\n  }\n\n  OnChangeOperator(e) {\n    this.setState({\n      operator: e.target.value\n    }, this.TriggerChangeHandler);\n  }\n\n  OnChangeValue(e) {\n    this.setState({\n      value: e.target.value\n    }, this.TriggerChangeHandler);\n  }\n\n  TriggerChangeHandler() {\n    const { filterAction } = this.props;\n    const { id, type, key, keylabel } = this.props.filter;\n    const filter = {\n      id,\n      type,\n      key,\n      keylabel,\n      operator: this.state.operator,\n      value: this.state.value\n    };\n    if (UDATA) UDATA.LocalCall('FILTER_DEFINE', {\n      group: this.props.group,\n      filter,\n      filterAction\n    }); // set a SINGLE filter\n  }\n\n  OnSubmit(e) {\n    // Prevent \"ENTER\" from triggering form submission!\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  render() {\n    const { filterAction } = this.props;\n    const { id, key, keylabel, operator, value } = this.props.filter;\n    return (\n      <Form inline className=\"filter-item\" key={id} onSubmit={this.OnSubmit}>\n        {/* FormGroup needs to unset flexFlow or fields will overflow\n            https://getbootstrap.com/docs/4.5/utilities/flex/\n        */}\n        <FormGroup className=\"flex-nowrap\">\n          <Label size=\"sm\" className=\"small text-muted\"\n            style={{ fontSize: '0.75em', lineHeight: '1em', width: `6em`, justifyContent: 'flex-end' }}>\n            {keylabel}&nbsp;\n          </Label>\n          <Input type=\"select\" value={operator}\n            style={{maxWidth:'12em', height:'1.5em', padding: '0'}}\n            onChange={this.OnChangeOperator} bsSize=\"sm\">\n            {OPERATORS.map(op =>\n              <option value={op.key} key={`${id}${op.key}`} size=\"sm\">{op.label}</option>\n            )}\n          </Input>\n          <Input type=\"text\" value={value} placeholder=\"...\"\n            style={{maxWidth:'12em', height:'1.5em', padding: '0'}}\n            onChange={this.OnChangeValue} bsSize=\"sm\"\n            disabled={operator === FILTER.OPERATORS.NO_OP.key}/>\n        </FormGroup>\n      </Form>\n    );\n  }\n}\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nexport default NumberFilter;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  SELECTFILTER\n\n  SelectFilter provides the UI for setting drop-down menu selection\n  style filters typically used for \"type\" node and edge properties.\n\n  The menu options are defined with the extra `options` property\n  of the filter.\n\n  Two Select operators are supported (These just use the string operators on\n  the values set via the menu selectios):\n  * contains\n  * not contains\n\n  Matches will SHOW the resulting node or edge.\n  Any nodes/edges not matching will be hidden.\n\n  The filter definition is passed in via props.\n\n    props\n      {\n        group       // \"nodes\" or \"edges\"\n        filter: {\n          id,       // numeric id used for unique React key\n          type,     // filter type, e.g \"string\" vs \"number\"\n          key,      // node field key from the template\n          keylabel, // human friendly display name for the key.  This can be customized in the template.\n          operator, // the comparison function, e.g. 'contains' or '>'\n          value     // the search value to be used for matching\n          options   // array of select option strings, e.g. ['abc','def',..]\n        },\n        onChangeHandler // callback function for parent component\n      }\n\n  The `onChangeHandler` callback function is not currently used.  Instead,\n  selection changes directly trigger a UDATA.LocalCall('FILTER_DEFINE',...).\n\n  The `id` variable allows us to potentially support multiple search filters\n  using the same key, e.g. we could have two 'Label' filters.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n\nimport FILTER from './FilterEnums';\nimport React from 'react';\nconst ReactStrap = require('reactstrap');\nconst { Form, FormGroup, Input, Label } = ReactStrap;\n\nconst UNISYS = require('unisys/client');\nvar UDATA = null;\n\nconst OPERATORS = [\n  FILTER.OPERATORS.NO_OP,\n  FILTER.OPERATORS.CONTAINS,\n  FILTER.OPERATORS.NOT_CONTAINS\n]\n\n\n/// CLASS /////////////////////////////////////////////////////////////////////\nclass SelectFilter extends React.Component {\n\n  constructor({\n    group,\n    filter: {id, type, key, keylabel, operator, value, options},\n    onChangeHandler\n  }) {\n    super();\n    this.OnChangeOperator = this.OnChangeOperator.bind(this);\n    this.OnChangeValue = this.OnChangeValue.bind(this);\n    this.TriggerChangeHandler = this.TriggerChangeHandler.bind(this);\n    this.OnSubmit = this.OnSubmit.bind(this);\n\n    this.state = {\n      operator: FILTER.OPERATORS.NO_OP, // Used locally to define result\n      value: '' // Used locally to define result\n    };\n\n    /// Initialize UNISYS DATA LINK for REACT\n    UDATA = UNISYS.NewDataLink(this);\n  }\n\n  OnChangeOperator(e) {\n    this.setState({\n      operator: e.target.value\n    }, this.TriggerChangeHandler);\n  }\n\n  OnChangeValue(e) {\n    this.setState({\n      value: e.target.value\n    }, this.TriggerChangeHandler);\n  }\n\n  TriggerChangeHandler() {\n    const { filterAction } = this.props;\n    const { id, type, key, keylabel, options } = this.props.filter;\n    const filter = {\n      id,\n      type,\n      key,\n      keylabel,\n      operator: this.state.operator,\n      value: this.state.value,\n      options\n    };\n    if (UDATA) UDATA.LocalCall('FILTER_DEFINE', {\n      group: this.props.group,\n      filter,\n      filterAction\n    }); // set a SINGLE filter\n  }\n\n  OnSubmit(e) {\n    // Prevent \"ENTER\" from triggering form submission!\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  componentDidMount() {\n    // Autoselect the first item\n    this.setState({\n      value: this.props.filter.options[0]\n    });\n  }\n\n  render() {\n    const { filterAction } = this.props;\n    const { id, key, keylabel, operator, value, options } = this.props.filter;\n    return (\n      <Form inline className=\"filter-item\" key={id} onSubmit={this.OnSubmit}>\n        {/* FormGroup needs to unset flexFlow or fields will overflow\n            https://getbootstrap.com/docs/4.5/utilities/flex/\n         */}\n        <FormGroup className=\"flex-nowrap\">\n          <Label size=\"sm\" className=\"small text-muted\"\n            style={{ fontSize: '0.75em', lineHeight: '1em', width: `6em`, justifyContent: 'flex-end' }}>\n            {keylabel}&nbsp;\n          </Label>\n          <Input type=\"select\" value={operator}\n            style={{ height:'1.5em', padding: '0'}}\n            onChange={this.OnChangeOperator} bsSize=\"sm\">\n            {OPERATORS.map(op =>\n              <option value={op.key} key={`${id}${op.key}`} size=\"sm\">{op.label}</option>\n            )}\n          </Input>\n          <Input type=\"select\" value={value}\n            style={{maxWidth:'12em', height:'1.5em', padding: '0'}}\n            onChange={this.OnChangeValue} bsSize=\"sm\"\n            disabled={operator === FILTER.OPERATORS.NO_OP.key}>\n            {operator !== FILTER.OPERATORS.NO_OP.key\n              ? options.map(op =>\n                  <option value={op} key={`${id}${op}`} size=\"sm\">{op}</option>\n                )\n              : ''\n            }\n          </Input>\n        </FormGroup>\n      </Form>\n    );\n  }\n}\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nexport default SelectFilter;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  STRINGFILTER\n\n  StringFilter provides the UI for entering search strings for string-based\n  node and edge properties.\n\n  Two String operators are supported:\n  * contains\n  * not contains\n\n  Matches will SHOW the resulting node or edge.\n  Any nodes/edges not matching will be hidden.\n\n  The filter definition is passed in via props.\n\n    props\n      {\n        group       // \"nodes\" or \"edges\"\n        filter: {\n          id,       // numeric id used for unique React key\n          type,     // filter type, e.g \"string\" vs \"number\"\n          key,      // node field key from the template\n          keylabel, // human friendly display name for the key.  This can be customized in the template.\n          operator, // the comparison function, e.g. 'contains' or '>'\n          value     // the search value to be used for matching\n        },\n        onChangeHandler // callback function for parent component\n      }\n\n  The `onChangeHandler` callback function is not currently used.  Instead,\n  selection changes directly trigger a UDATA.LocalCall('FILTER_DEFINE',...).\n\n  The `id` variable allows us to potentially support multiple search filters\n  using the same key, e.g. we could have two 'Label' filters.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n\nimport FILTER from './FilterEnums';\nimport React from 'react';\nconst ReactStrap = require('reactstrap');\nconst { Form, FormGroup, Input, Label } = ReactStrap;\n\nconst UNISYS = require('unisys/client');\nvar UDATA = null;\n\nconst OPERATORS = [\n  FILTER.OPERATORS.NO_OP,\n  FILTER.OPERATORS.CONTAINS,\n  FILTER.OPERATORS.NOT_CONTAINS\n]\n\n\n/// CLASS /////////////////////////////////////////////////////////////////////\nclass StringFilter extends React.Component {\n\n  constructor({\n    group,\n    filter: {id, type, ey, keylabel, operator, value},\n    onChangeHandler\n  }) {\n    super();\n    this.OnChangeOperator = this.OnChangeOperator.bind(this);\n    this.OnChangeValue = this.OnChangeValue.bind(this);\n    this.TriggerChangeHandler = this.TriggerChangeHandler.bind(this);\n    this.OnSubmit = this.OnSubmit.bind(this);\n\n    this.state = {\n      operator: FILTER.OPERATORS.NO_OP, // Used locally to define result\n      value: '' // Used locally to define result\n    };\n\n    /// Initialize UNISYS DATA LINK for REACT\n    UDATA = UNISYS.NewDataLink(this);\n  }\n\n  OnChangeOperator(e) {\n    this.setState({\n      operator: e.target.value\n    }, this.TriggerChangeHandler);\n  }\n\n  OnChangeValue(e) {\n    this.setState({\n      value: e.target.value\n    }, this.TriggerChangeHandler);\n  }\n\n  TriggerChangeHandler() {\n    const { filterAction } = this.props;\n    const { id, type, key, keylabel } = this.props.filter;\n    const filter = {\n      id,\n      type,\n      key,\n      keylabel,\n      operator: this.state.operator,\n      value: this.state.value\n    };\n    if (UDATA) UDATA.LocalCall('FILTER_DEFINE', {\n      group: this.props.group,\n      filter,\n      filterAction\n    }); // set a SINGLE filter\n  }\n\n  OnSubmit(e) {\n    // Prevent \"ENTER\" from triggering form submission!\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  render() {\n    const { filterAction } = this.props;\n    const { id, key, keylabel, operator, value } = this.props.filter;\n    return (\n      <Form inline className=\"filter-item\" key={id} onSubmit={this.OnSubmit}>\n        {/* FormGroup needs to unset flexFlow or fields will overflow\n            https://getbootstrap.com/docs/4.5/utilities/flex/\n         */}\n        <FormGroup className=\"flex-nowrap\">\n          <Label size=\"sm\" className=\"small text-muted\"\n            style={{ fontSize: '0.75em', lineHeight: '1em', width: `6em`, justifyContent: 'flex-end' }}>\n            {keylabel}&nbsp;\n          </Label>\n          <Input type=\"select\" value={operator}\n            style={{maxWidth:'12em', height:'1.5em', padding: '0'}}\n            onChange={this.OnChangeOperator} bsSize=\"sm\">\n            {OPERATORS.map(op =>\n              <option value={op.key} key={`${id}${op.key}`} size=\"sm\">{op.label}</option>\n            )}\n          </Input>\n          <Input type=\"text\" value={value} placeholder=\"...\"\n            style={{ maxWidth: '12em', height: '1.5em' }}\n            onChange={this.OnChangeValue} bsSize=\"sm\"\n            disabled={operator === FILTER.OPERATORS.NO_OP.key}/>\n        </FormGroup>\n      </Form>\n    );\n  }\n}\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nexport default StringFilter;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  FILTER LOGIC\n\n\n  Filter Definitions\n\n  The initial filter definitions are loaded from the current database template.\n\n\n    FDATA = {\n        nodes: {                    // group\n            label: \"Node Filters\",  // group label\n            filters: [              // array of filter objects\n                {\n                  id: '4',\n                  type: 'string',\n                  key: 'label',\n                  keylabel: 'Label',\n                  operator: 'no-op',\n                  value: ''\n                },\n                {\n                  id: '2',\n                  type: 'select',\n                  key: 'type',\n                  keylabel: 'Type',\n                  operator: 'no-op',\n                  value: ''\n                },\n                ...\n            ]\n        },\n        edges: {\n            label: \"Edge Filters\",\n            filters: [...]\n        }\n    }\n\n\n  FEATURES\n\n  * See Whimiscal [diagram](https://whimsical.com/d3-data-flow-B2tTGnQYPSNviUhsPL64Dz)\n\n  * filterAction: \"Highlight\" vs \"Filter\"\n    --  Version 1.4 introduces two different types of filtering:\n        \"Highlight\" highlights the matching nodes/edges and fades the others\n        \"Filter\" shows matching nodes/edges and removes the non-matching\n        nodes/edges from the display without affecting the underlying data.\n\n  * With Version 1.4, the only data that is graphed is FILTEREDD3DATA.\n    --  d3-simplenetgraph no longer plots on NCDATA changes.\n    --  Instead, it plots the new FILTEREDD3DATA state.  Whenever NCDATA changes,\n        FILTERDD3DATA is udpated.\n    --  This way there is only one source of truth: all draw updates\n        are routed through filter-logic.\n    --  If filters have not been defined, we just pass the raw NCDATA\n\n  * Filters can be stacked.\n        You can define two \"Label\" filters, for example.\n        The only reason you can't do it right now is because the filter template\n        is reading directly from the _default.template file.  You can easily\n        insert another filter into the mix programmatically.\n\n\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/* JD added some global settins for filters\n    Settings\n      Transparency\n        Nodes\n        Edges\n\n        NOTE: Default is hand-set to 0 for now, but this should be in a / the template\n    */\n\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nimport FILTER from './components/filter/FilterEnums';\nconst UNISYS = require(\"unisys/client\");\nconst clone = require(\"rfdc\")();\n\n/// INITIALIZE MODULE /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar MOD = UNISYS.NewModule(module.id);\nvar UDATA = UNISYS.NewDataLink(MOD);\n\n/// APP STATE/DATA STRUCTURES /////////////////////////////////////////////////\nconst PROMPTS = require(\"system/util/prompts\");\nconst NCLOGIC = require(\"./nc-logic\");\n\nvar TEMPLATE = null; // template definition for prompts\nvar FDATA_RESTORE; // pristine FDATA for clearing\n\nlet NODE_DEFAULT_TRANSPARENCY;\nlet EDGE_DEFAULT_TRANSPARENCY;\n\n\n/// CONSTANTS /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DATASET = window.NC_CONFIG.dataset || \"netcreate\";\nconst TEMPLATE_URL = `templates/${DATASET}.json`;\n\nconst DBG = false;\nconst PR = \"filter-logic: \";\n\n/// UNISYS HANDLERS ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ lifecycle INITIALIZE handler\n/*/\nMOD.Hook(\"INITIALIZE\", () => {\n\n  UDATA.OnAppStateChange(\"FDATA\", data => {\n    if (DBG) console.log(PR + 'OnAppStateChange: FDATA', data);\n    // The filter defs have been updated, so apply the filters.\n    m_UpdateFilters();\n  });\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ FILTER_DEFINE is called by StringFilter when user has updated filter.\n  /*/\n  UDATA.HandleMessage(\"FILTER_DEFINE\", data => {\n    m_FilterDefine(data);\n  })\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ FILTER_CLEAR is called by FiltersPanel when user clicks \"Clear Filters\" button\n  /*/\n  UDATA.HandleMessage(\"FILTER_CLEAR\", () => {\n    m_ClearFilters();\n  });\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ FILTERS_UPDATE is called by FiltersPanel switches between filters and highlights\n  /*/\n  UDATA.HandleMessage(\"FILTERS_UPDATE\", data => {\n    const FDATA = UDATA.AppState(\"FDATA\");\n    FDATA.filterAction = data.filterAction;\n    UDATA.SetAppState(\"FDATA\", FDATA);\n  });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ Listen for NCDATA updates so we know to trigger change?\n  /*/\n  UDATA.OnAppStateChange('NCDATA', (data) => {\n    m_UpdateFilters();\n  });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /*/ Listen for TEMPLATE updates so we know to trigger change?\n  /*/\n  UDATA.OnAppStateChange(\"TEMPLATE\", data => {\n    // this is critical -- graph will not draw if this is\n    // not called from nc-logic.LOADASSETS\n    m_ImportFilters();\n  });\n\n}); // end UNISYS_INIT\n\n\n/// IMPORT FILTER DEFINITIONS /////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n/**\n * Loads filters from template file\n */\nfunction m_ImportFilters() {\n  TEMPLATE = UDATA.AppState(\"TEMPLATE\");\n  const nodeDefs = TEMPLATE.nodeDefs;\n  const edgeDefs = TEMPLATE.edgeDefs;\n  NODE_DEFAULT_TRANSPARENCY = TEMPLATE.nodeDefaultTransparency;\n  EDGE_DEFAULT_TRANSPARENCY = TEMPLATE.edgeDefaultTransparency;\n\n  let fdata = {\n    nodes: {\n      group: \"nodes\", // this needs to be passed to StringFilter\n      label: \"Node Filters\",\n      filters: m_ImportPrompts(nodeDefs),\n      transparency: 0.2 // Default transparency form for Highlight should be 0.2, not template default which is usu 1.0\n    },\n    edges: {\n      group: \"edges\", // this needs to be passed to StringFilter\n      label: \"Edge Filters\",\n      filters: m_ImportPrompts(edgeDefs),\n      transparency: 0.03 // Default transparency form for Highlight should be 0.03, not template default which is usu 0.3\n    }\n  };\n\n  UDATA.SetAppState(\"FDATA\", fdata);\n\n  // Save off a copy for clearing the form.\n  FDATA_RESTORE = clone(fdata);\n}\n\nfunction m_ImportPrompts(prompts) {\n  let filters = [];\n  let counter = 0;\n\n  for (const [key, prompt] of Object.entries(prompts)) {\n    let operator;\n    switch (prompt.type) {\n      case FILTER.TYPES.STRING:\n        operator = FILTER.OPERATORS.NO_OP.key; // default to no_op\n        break;\n      case FILTER.TYPES.NUMBER:\n        operator = FILTER.OPERATORS.NO_OP.key; // default to no_op\n        break;\n      case FILTER.TYPES.SELECT:\n        operator = FILTER.OPERATORS.NO_OP.key; // default to no_op\n        break;\n      case FILTER.TYPES.NODE:\n        operator = FILTER.OPERATORS.NO_OP.key; // default to no_op\n        break;\n      case FILTER.TYPES.DATE:\n        operator = FILTER.OPERATORS.NO_OP.key; // default to no_op\n        break;\n      case FILTER.TYPES.HIDDEN:\n        break;\n      default:\n        // edge template item \"edgeIsLockedMessage\" will trigger this message\n        // filters will not be created for entries with no `type` defined.\n        if (DBG) console.warn(PR + `Unknown node prompt type ${prompt.type} for ${prompt}`);\n        break;\n    }\n    if (operator === undefined) continue; // don't add filter if operator is hidden\n    if (prompt.hidden) continue; // don't add filter if \"hidden\": true\n    let filter = {\n      id: counter++,\n      key: key,\n      type: prompt.type,\n      keylabel: prompt.displayLabel,\n      operator: operator,\n      value: ''\n    };\n\n    // Add \"Options\" for \"select\" filter types\n    if (prompt.type === FILTER.TYPES.SELECT) {\n      let options = [];\n      prompt.options.forEach(opt => {\n        if (opt.label === \"\") return;\n        options.push(opt.label);\n      })\n      filter.options = options;\n    }\n\n    filters.push(filter);\n  }\n  return filters;\n}\n\n/// UDATA HANDLERS ////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n\n/**\n * Define an individual filter\n * @param {Object} data {group, filter}\n */\nfunction m_FilterDefine(data) {\n  const FDATA = UDATA.AppState(\"FDATA\");\n  FDATA.filterAction = data.filterAction || FDATA.filterAction; // if 'transparency' then filterAction is not passed, so default to existing\n  if (data.group === \"nodes\") {\n\n    if (data.type === \"transparency\")\n    {\n      FDATA.nodes.transparency = data.transparency;\n    }\n    else{\n      let nodeFilters = FDATA.nodes.filters;\n      const index = nodeFilters.findIndex(f => f.id === data.filter.id);\n      nodeFilters.splice(index, 1, data.filter);\n      FDATA.nodes.filters = nodeFilters;\n    }\n  } else if (data.group === \"edges\") {\n\n    if (data.type === \"transparency\")\n    {\n      FDATA.edges.transparency = data.transparency;\n    }\n    else{\n      let edgeFilters = FDATA.edges.filters;\n      const index = edgeFilters.findIndex(f => f.id === data.filter.id);\n      edgeFilters.splice(index, 1, data.filter);\n      FDATA.edges.filters = edgeFilters;\n    }\n  }\n  else {\n    throw `FILTER_DEFINE called with unknown group: ${data.group}`;\n  }\n  UDATA.SetAppState(\"FDATA\", FDATA);\n}\n\n/**\n * Walk down the list of filters and apply them all\n * @param {Object} data A UDATA pkt {defs}\n */\nfunction m_FiltersApply() {\n  const FILTEREDD3DATA = UDATA.AppState(\"NCDATA\");\n  const FDATA = UDATA.AppState(\"FDATA\");\n\n  // skip if FDATA has not been defined yet\n  if (Object.keys(FDATA).length < 1) return;\n\n  // stuff 'sourceLabel' and 'targetLabel' into edges for quicker filtering\n  // otherwise we have to constantly look up the node label\n  FILTEREDD3DATA.edges = FILTEREDD3DATA.edges.map(e => {\n    const source = FILTEREDD3DATA.nodes.find(n => n.id === e.source);\n    const target = FILTEREDD3DATA.nodes.find(n => n.id === e.target);\n    e.sourceLabel = source ? source.label : 'deleted';\n    e.targetLabel = target ? target.label : 'deleted';\n    return e;\n  })\n\n  m_FiltersApplyToNodes(FDATA, FILTEREDD3DATA);\n  m_FiltersApplyToEdges(FDATA, FILTEREDD3DATA);\n  // Update FILTEREDD3DATA\n  UDATA.SetAppState(\"FILTEREDD3DATA\", FILTEREDD3DATA);\n\n}\n\nfunction m_ClearFilters() {\n  // Reload fdata\n  const FDATA = clone(FDATA_RESTORE);\n  UDATA.SetAppState(\"FDATA\", FDATA);\n}\n\nfunction m_UpdateFilterSummary() {\n  const FDATA = UDATA.AppState(\"FDATA\");\n\n  // skip if FDATA has not been defined yet\n  if (Object.keys(FDATA).length < 1) return;\n\n  const nodeFilters = FDATA.nodes.filters;\n  const edgeFilters = FDATA.edges.filters;\n\n  const typeSummary = FDATA.filterAction === FILTER.ACTION.HIGHLIGHT\n    ? 'HIGHLIGHTING ' : 'FILTERING ';\n  const nodeSummary = m_FiltersToString(FDATA.nodes.filters);\n  const edgeSummary = m_FiltersToString(FDATA.edges.filters);\n  let summary = '';\n  if (nodeSummary || edgeSummary) summary =\n    `${typeSummary} ${nodeSummary ? 'NODES: ' : ''}${nodeSummary} ${edgeSummary ? 'EDGES: ' : ''}${edgeSummary}`;\n\n  UDATA.LocalCall('FILTER_SUMMARY_UPDATE', { filtersSummary: summary });\n}\n\nfunction m_UpdateFilters() {\n  m_FiltersApply();\n  m_UpdateFilterSummary();\n}\n\nfunction m_FiltersToString(filters) {\n  let summary = ''\n  filters.forEach(filter => {\n    if ((filter.operator === undefined) ||\n      (filter.value === undefined) ||\n      (filter.value === '')) return;\n    summary += filter.keylabel + ' ';\n    summary += m_OperatorToString(filter.operator) + ' ';\n    summary += '\"' + filter.value + '\"; ';\n  });\n  return summary;\n}\nfunction m_OperatorToString(operator) {\n  return FILTER.OPERATORS[operator].label;\n}\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ UTILITY FUNCTIONS\n/*/\n\nfunction m_MatchString(pin, haystack, contains = true) {\n  pin = NCLOGIC.EscapeRegexChars(pin.trim());\n  const regex = new RegExp(/*'^'+*/ pin, \"i\");\n  let matches;\n  if (pin === \"\") {\n    // empty string matches everything\n    matches = true;\n  } else if (contains) {\n    matches = regex.test(haystack);\n  } else {\n    matches = !regex.test(haystack);\n  }\n  return matches;\n}\n\nfunction m_MatchNumber(operator, filterVal, objVal) {\n  let matches;\n  if (filterVal === \"\") {\n    matches = true;\n  } else {\n    switch (operator) {\n      case FILTER.OPERATORS.GT.key:\n        matches = objVal > filterVal;\n        break;\n      case FILTER.OPERATORS.GT_EQ.key:\n        matches = objVal >= filterVal;\n        break;\n      case FILTER.OPERATORS.LT.key:\n        matches = objVal < filterVal;\n        break;\n      case FILTER.OPERATORS.LT_EQ.key:\n        matches = objVal <= filterVal;\n        break;\n      case FILTER.OPERATORS.EQ.key:\n        matches = objVal === filterVal;\n        break;\n      case FILTER.OPERATORS.NOT_EQ.key:\n        matches = objVal !== filterVal;\n        break;\n      default:\n        console.error(`filter-logic.js: Unknown operator ${operator}`);\n        break;\n    }\n  }\n  return matches;\n}\n\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ NODE FILTERS\n/*/\n\n/**\n * Side effect:\n *   FILTEREDD3DATA.nodes are updated with `isFilteredOut` flags.\n *\n * @param {Array} filters\n */\nfunction m_FiltersApplyToNodes(FDATA, FILTEREDD3DATA) {\n  const { filterAction } = FDATA;\n  const { filters, transparency } = FDATA.nodes;\n  FILTEREDD3DATA.nodes = FILTEREDD3DATA.nodes.filter(node => {\n    return m_NodeIsFiltered(node, filters, transparency, filterAction);\n  });\n}\n\nfunction m_NodeIsFiltered(node, filters, transparency, filterAction) {\n  // let all_no_op = true;\n  let keepNode = true;\n\n  // 1. Look for matches\n  // implicit AND.  ALL filters must return true.\n  filters.forEach(filter => {\n    if (filter.operator === FILTER.OPERATORS.NO_OP.key) return; // skip no_op\n    // all_no_op = false;\n    if (!m_IsNodeMatchedByFilter(node, filter)) {\n      keepNode = false;\n    }\n  });\n\n  // 2. Decide based on filterAction\n  if (filterAction === FILTER.ACTION.FILTER) {\n    // not using highlight, so restore transparency\n    node.filteredTransparency = NODE_DEFAULT_TRANSPARENCY; // opaque, not transparent\n    if (keepNode) return true;\n    return false; // remove from array\n  } else {\n    // FILTER.ACTION.HIGHLIGHT\n    if (!keepNode) {\n      node.filteredTransparency = transparency; // set the transparency value ... right now it is inefficient to set this at the node / edge level, but that's more flexible\n    } else {\n      node.filteredTransparency = NODE_DEFAULT_TRANSPARENCY; // opaque\n    }\n    return true; // don't filter out\n  }\n\n  // all_no_op\n  // This is currently redundant because matchesFilter will always\n  // be true if there are no filters.  If matchesFilter is true,\n  // then the node will not be removed/faded.\n  //\n  // if (all_no_op) {\n  //   // all filters are \"no_op\", so no filters defined, don't filter anything\n  //   node.filteredTransparency = 1.0; // opaque, not tranparent\n  // }\n}\n\nfunction m_IsNodeMatchedByFilter(node, filter) {\n  if ((filter.key === undefined) ||\n    (filter.operator === undefined) ||\n    (filter.value === undefined)) {\n    return false; // nothing to filter\n  }\n\n  const nodeValue = node[filter.key];\n\n  switch (filter.operator) {\n    case FILTER.OPERATORS.CONTAINS.key:\n      return m_MatchString(filter.value, nodeValue, true);\n      break;\n    case FILTER.OPERATORS.NOT_CONTAINS.key:\n      return m_MatchString(filter.value, nodeValue, false);\n      break;\n    default:\n      // Else assume it's a number\n      return m_MatchNumber(filter.operator, filter.value, nodeValue)\n      break;\n  }\n}\n\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ EDGE FILTERS\n/*/\n\nfunction m_FiltersApplyToEdges(FDATA, FILTEREDD3DATA) {\n  const { filterAction } = FDATA;\n  const { filters, transparency } = FDATA.edges;\n  if (!FILTEREDD3DATA.edges) return; // no data\n  FILTEREDD3DATA.edges = FILTEREDD3DATA.edges.filter(edge => {\n    return m_EdgeIsFiltered(edge, filters, transparency, filterAction, FILTEREDD3DATA);\n  });\n}\n\n/*/ Side effect: Sets `isFiltered`\n/*/\nfunction m_EdgeIsFiltered(edge, filters, transparency, filterAction, FILTEREDD3DATA) {\n  // let all_no_op = true; // all filters are no_op\n  let keepEdge = true;\n  const source = FILTEREDD3DATA.nodes.find(e => {\n    // on init, edge.source is just an id.  only with d3 processing does it\n    // get transformed into a node object.  so we have to check the type.\n    const sourceId = (typeof edge.source === 'number') ? edge.source : edge.source.id;\n    return e.id === sourceId;\n  });\n  const target = FILTEREDD3DATA.nodes.find(e => {\n    // on init, edge.target is just an id.  only with d3 processing does it\n    // get transformed into a node object.  so we have to check the type.\n    const targetId = (typeof edge.target === 'number') ? edge.target : edge.target.id;\n    return e.id === targetId;\n  });\n  // 1. if source or target is filtered, then we are filtered too\n  if (source === undefined || target === undefined ||\n    source.filteredTransparency < 1.0 ||\n    target.filteredTransparency < 1.0) {\n    // regardless of filter definition...\n    // ...if filterAction is FILTER\n    // always hide edge if it's attached to a filtered node\n    if (filterAction === FILTER.ACTION.FILTER) return false;\n    // ...else if filterAction is HIGHLIGHT\n    // don't filter, just fade\n    edge.filteredTransparency = transparency; // set the transparency value ... right now it is inefficient to set this at the node / edge level, but that's more flexible\n    return true;\n  }\n\n  // 2. otherwise, look for matches\n  // implicit AND.  ALL filters must return true.\n  // edge is filtered out if it fails ANY filter tests\n  filters.forEach(filter => {\n    if (filter.operator === FILTER.OPERATORS.NO_OP.key) return; // skip no_op\n    // Found a filter!  Apply it!\n    // all_no_op = false;\n    if (!m_IsEdgeMatchedByFilter(edge, filter)) {\n      keepEdge = false;\n    }\n  });\n\n  // 3. Decide how to filter based on filterAction\n  if (filterAction === FILTER.ACTION.FILTER) {\n    // FILTER!\n    // not using highlight, so restore transparency\n    edge.filteredTransparency = EDGE_DEFAULT_TRANSPARENCY; // opaque\n    if (keepEdge) return true; // keep in array\n    return false; // remove from array\n  } else {\n    // FILTER.ACTION.HIGHLIGHT, so don't filter\n    if (!keepEdge) {\n      edge.filteredTransparency = transparency; // set the transparency value ... right now it is inefficient to set this at the node / edge level, but that's more flexible\n    } else {\n      edge.filteredTransparency = EDGE_DEFAULT_TRANSPARENCY; // opaque\n    }\n    return true; // always keep in array\n  }\n\n  // all_no_op\n  // This is currently redundant because matchesFilter will always\n  // be true if there are no filters.  If matchesFilter is true,\n  // then the node will not be removed/faded.\n  //\n  // if (all_no_op) {\n  //   // no filters defined, undo isFilteredOut\n  //   edge.filteredTransparency = 1.0;\n  // } else {\n  // }\n}\n\nfunction m_IsEdgeMatchedByFilter(edge, filter) {\n  if ((filter.key === undefined) ||\n    (filter.operator === undefined) ||\n    (filter.value === undefined)) {\n    return false; // nothing to filter\n  }\n\n  let edgeValue;\n  if (filter.type === FILTER.TYPES.NODE) {\n    // edges fields that poitn to nodes require special handling because `source` and `target`\n    // point to node objects, not simple strings.\n    if (filter.key === 'source') edgeValue = edge.sourceLabel;\n    if (filter.key === 'target') edgeValue = edge.targetLabel;\n  } else {\n    edgeValue = edge[filter.key];\n  }\n\n  switch (filter.operator) {\n    case FILTER.OPERATORS.CONTAINS.key:\n      return m_MatchString(filter.value, edgeValue, true);\n      break;\n    case FILTER.OPERATORS.NOT_CONTAINS.key:\n      return m_MatchString(filter.value, edgeValue, false);\n      break;\n    default:\n      // Else assume it's a number\n      return m_MatchNumber(filter.operator, filter.value, edgeValue)\n      break;\n  }\n}\n\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = MOD;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  ## Import / Export Logic\n\n  See ImportExport.jsx for the UI.\n\n\n  #### Data Format\n\n  The import/export data format is '.csv'.\n\n  The first row should define the headers.\n  Each data row should be comma-delimited and ended with a CR/LF.\n\n  We support:\n  * CR/LF inside of double quotes\n  * Double quotes need to be escaped by repeating the quote, e.g. `\"\"quoted text\"\"\"\n  * Dates can be exported and imported as UTCStrings\n\n  In general, any valid '.csv' file exported by Excel ought to work.\n\n\n  #### Permissions\n\n  Everyone is allowed to EXPORT data.\n  * The data fields that are exported are defined in the project's template.\n    Any field that is NOT marked \"hidden\" is exported.\n\n  In general, only admins are allowed IMPORT data.\n  * If the `allowLoggedInUserToImport` flag is set in the template, then\n    logged-in users are also allowed to import data.\n  * When anyone on the net is importing data, \"Edit Lock\" is set and no\n    one else is allowed to import, edit a node or edge, or edit a template.\n    This is because each of those activities can potentially conflict with\n    each other.\n\n\n  #### How it works\n\n  Coordinating the selection of node and edge files for imports is a complex\n  dance of selection, validation, and reporting.  When an import file is\n  selected, we:\n\n  1. Make sure any headers required by the Template are present\n  2. Attempt to load the field data into memory\n  3. Validate the data, either adding new objects or replacing existing objects\n     For edges, we also check that the sources and targets point to valid nodes\n  4. Display the expected import -- kind of like a dry run output.\n  5. Wait fo the user to confirm and click Import.\n  6. After the user clicks import, erge the data into the database and\n  refresh global NCDATA.\n\n  If there is a failure at any point, we abort immediately and display an error\n  and clear the UI for the user to fix the import file and select a\n  replacement file.  Importing can be a complex process, so we want to provide\n  as much feedback as we can along the way so users know how to fix problems.\n\n  Node and edge import files can be selected separately and in any order.\n  The import data is temporarily stored in `IMPORT_NCDATA` for validation.\n\n  The DB is NOT updated until the user clicks \"Import\".\n\n\n  ####\n\n\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst DBG = true;\nconst PR = 'importexport-logic: ';\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst React = require('react');\nconst UNISYS = require(\"unisys/client\");\nconst DATASTORE = require(\"system/datastore\");\nconst TOML = require(\"@iarna/toml\");\nconst clone = require(\"rfdc\")();\nconst UTILS = require(\"./nc-utils\");\n\n/// INITIALIZE MODULE /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar MOD = UNISYS.NewModule(module.id);\nvar UDATA = UNISYS.NewDataLink(MOD);\n\n/// CONSTANTS /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// For CSV Importing\n/// * new id keyword\nconst NEW_ID_KEYWORD = \"new\"; // use id \"new\" to add a new record during import\n/// We need to match:\n/// * To split lines, we need to split on LF that is NOT wrapped in quotes\nconst REGEXMatchLFNotInQuotes = /\\n(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/;\n/// * To read fields, we need to ignore commas that are between two double quotes\nconst REGEXMatchCommasNotInQuotes = /,(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/;\n\n/// UTILITIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\nfunction m_formatDate(date) {\n  // wrap in quotes because time includes a comma\n  if (date) return `\"${new Date(date).toUTCString()}\"`;\n  return '';\n}\n\nfunction m_encode(data) {\n  let res;\n  // double quotes need to be escaped\n  res = String(data).replace(/\"/g, '\"\"');\n  // Don't encode carriage returns, csv should support LF inside of quotes\n  // `REGEXMatchLFNotInQuotes` should work.\n  // // encode carriage returns\n  // res = String(res).replace(/\\n/g, 'nnn');\n  return res;\n}\n\nfunction m_decode(data) {\n  let res;\n  // double quotes need to be escaped\n  res = String(data).replace(/\"\"/g, '\"');\n  return res;\n}\n\n// DEPRECATED -- Used to flatten 'attributes'\n//    'attributes' have been removed, so this should not be needed anymore\n// Converts nested key definitions into a flat array, e.g.\n//     from ['id', { attributes: ['type', 'info'] } ]\n//     into ['id', 'attributes:type', 'attributes:info']\nfunction m_flattenKeys(keys, prefix) {\n  if (!Array.isArray(keys)) {\n    // Recurse\n    const pre = Object.keys(keys)[0];\n    return m_flattenKeys(keys[pre], pre);\n  } else {\n    const flattenedKeys = keys.map(k => {\n      if (typeof k !== 'string') return m_flattenKeys(k);\n      if (prefix) return `${prefix}:${k}`;\n      else return k;\n    });\n    return flattenedKeys.flat();\n  }\n}\n\n///////////////////////////////////////////////////////////////////////////////\n/// IMPORT / EXPORT HELPERS ///////////////////////////////////////////////////\n///////////////////////////////////////////////////////////////////////////////\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n * Returns an array of export values for a given node record\n * Used during export.\n * @param {array} nodes - array of source nodes to export\n * @param {array} keys - node def keys, e.g. 'id' and 'label'\n *                       NOTE this is usually a subset of nodeDef keys\n *                       with `hidden` keys removed so they won't export\n * @returns - array of node values, e.g. [1,'Tacitus','Person',...]\n */\nfunction m_renderNodeValues(node, keys) {\n  const RESULT = [];\n  keys.forEach(key => {\n    // If the key is an object, recurse\n    // eslint-disable-next-line prefer-reflect\n    if (Object.prototype.toString.call(key) === '[object Object]') {\n      // DEPRECATED -- 'attribute' handler.\n      const subKeys = Object.keys(key); // can have multiple subKeys\n      subKeys.forEach(k => {\n        RESULT.push(m_renderNodeValues(node[k], key[k]));\n      });\n    }\n    // Special Data Handling\n    // -- Number\n    if (['id'].includes(key)) {\n      // Export as a number\n      RESULT.push(node[key]);\n      return;\n    }\n    // -- Revision\n    if (['revision'].includes(key)) {\n      // Export as a number from meta\n      RESULT.push(node.meta[key]);\n      return;\n    }\n    // -- DATE\n    if (['created', 'updated'].includes(key)) {\n      RESULT.push(m_formatDate(node.meta[key]));\n      return;\n    }\n    // -- Normal processing -- wrap in quotes\n    if (node.hasOwnProperty(key)) {\n      RESULT.push(`\"${m_encode(node[key])}\"`); // enclose in quotes to support commas\n      return;\n    }\n    // -- Else, data missing/not defined, add empty string\n    RESULT.push(\"\");\n  });\n  return RESULT;\n}\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n * Returns an array of node records\n * Used during export.\n * @param {array} nodes - array of source nodes to export\n * @param {array} nodekeys - node def keys, e.g. 'id' and 'label'\n *                           NOTE this is usually a subset of nodeDef keys\n *                           with `hidden` keys removed so they won't export\n * @returns - array of nodes, e.g. [[<tacitus>], [<marc antony>], ...]\n */\nfunction m_GenerateNodesArray(nodes, nodekeys) {\n  /// Define Node KEYS\n  const nodesArr = [];\n  nodes.forEach(n => nodesArr.push(m_renderNodeValues(n, nodekeys)));\n  return nodesArr;\n}\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n * Returns an array of export values for a given edge record\n * Used during export.\n * @param {array} edge - array of source nodes to export\n * @param {array} keys - edge def keys, e.g. 'id' and 'label'\n *                       NOTE this is usually a subset of edgeDef keys\n *                       with `hidden` keys removed so they won't export\n * @returns - array of edge values, e.g. [1,'is enemy of',2,...]\n */\nfunction m_renderEdgeValues(edge, keys) {\n  const RESULT = [];\n  keys.forEach(key => {\n    // If the key is an object, recurse\n    // eslint-disable-next-line prefer-reflect\n    if (Object.prototype.toString.call(key) === '[object Object]') {\n      // DEPRECATED -- 'attribute' handler.\n      const subKeys = Object.keys(key); // can have multiple subKeys\n      subKeys.forEach(k => {\n        RESULT.push( m_renderNodeValues(edge[k], key[k]) );\n      });\n    }\n    // Special Data Handling\n    // -- Number\n    if (['id'].includes(key)) {\n      // Export as a number\n      RESULT.push(edge[key]);\n      return;\n    }\n    // -- SOURCE / TARGET\n    if (['source', 'target'].includes(key)) {\n      // source/target is an id not an object\n      RESULT.push(edge[key]);\n      return;\n    }\n    // -- Revision\n    if (['revision'].includes(key)) {\n      // Export as a number from meta\n      RESULT.push(edge.meta[key]);\n      return;\n    }\n    // -- DATE\n    if (['created', 'updated'].includes(key)) {\n      RESULT.push(m_formatDate(edge.meta[key]));\n      return;\n    }\n    // -- normal processing -- wrap in quotes\n    if (edge.hasOwnProperty(key)) {\n      RESULT.push(`\"${m_encode(edge[key])}\"`); // enclose in quotes to support commas\n      return;\n    }\n    // -- Else, data missing/not defined, add empty string\n    RESULT.push(\"\");\n  })\n  return RESULT;\n}\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n * Returns an array of edge records\n * Used during export.\n * @param {array} edges - array of source edges to export\n * @param {array} edgekeys - edge def keys, e.g. 'id' and 'label'\n *                           NOTE this is usually a subset of edgeDef keys\n *                           with `hidden` keys removed so they won't export\n * @returns - array of edges, e.g. [[<1:2>], [<1:4>], ...]\n */\nfunction m_GenerateEdgesArray(edges, edgekeys) {\n  /// Define Edge KEYS\n  const edgeArr = [];\n  edges.forEach(e => edgeArr.push(m_renderEdgeValues(e, edgekeys)));\n  return edgeArr;\n}\n\n\n///////////////////////////////////////////////////////////////////////////////\n/// EXPORT METHODS ////////////////////////////////////////////////////////////\n///////////////////////////////////////////////////////////////////////////////\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// EXPORT NODES //////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Exports FILTERED data, not the full data set.\nMOD.ExportNodes = () => {\n  const DATA = UDATA.AppState('FILTEREDD3DATA');\n  const TEMPLATE = UDATA.AppState('TEMPLATE');\n  const { nodes } = DATA;\n  let EXPORT = '';\n\n  /// 1. Export Nodes\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// Define Node KEYS to export\n  /// Use nodekeys from TEMPLATE, but skip hidden fields\n  const nodekeys = Object.keys(TEMPLATE.nodeDefs).filter(k => {\n    return TEMPLATE.nodeDefs[k].hidden ? false : k;\n  });\n\n  /// 2. Expand to CSV\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  ///    2.1. NODES\n  ///    2.1.1. Create headers\n  const nodeHeadersArr = [];\n  nodekeys.forEach(key => {\n    // eslint-disable-next-line prefer-reflect\n    if (Object.prototype.toString.call(key) === '[object Object]') {\n      // DEPRECATED -- 'attribute' handler.\n      throw new Error(`Unexpected node type for ${JSON.stringify(key)}`);\n      // This shouldn't be called anymore as of 2/2022 because the data fields\n      // have been flattened. See #198.\n      // const subKeys = Object.keys(key); // can have multiple subKeys\n      // const internalkeys = subKeys.map(sk => key[sk].map(k => `${sk}:${k}`)).flat();\n      // return internalkeys.map(k => NODEKEY_LABELS[k]);\n    } else {\n      nodeHeadersArr.push(TEMPLATE.nodeDefs[key].exportLabel);\n    }\n  });\n  const nodeHeaders = nodeHeadersArr.flat();\n  ///    2.1.2 Export Nodes with filtered headers\n  const nodesArr = m_GenerateNodesArray(nodes, nodekeys);\n  ///    2.1.3 Attach headers to front of file\n  nodesArr.unshift(nodeHeaders); // add headers\n  ///    2.1.4 Expand Nodes to CSV\n  const commaDelimitedNodes = nodesArr.map(n => n.join(','));\n  EXPORT += commaDelimitedNodes.join('\\n')\n\n\n  /// 3. Save to File\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  // const encodedURI = encodeURI(EXPORT);\n  const link = document.createElement('a');\n  const blob = new Blob([\"\\ufeff\", EXPORT]);\n  const url = URL.createObjectURL(blob);\n  link.href = url;\n  const DATASET = window.NC_CONFIG.dataset || \"netcreate\";\n  link.download = `${DATASET}_nodes.csv`;\n  // link.setAttribute('href', encodedURI);\n  // link.setAttribute('download', 'netcreate_export.csv');\n  document.body.appendChild(link); // Required for FF\n  link.click();\n  document.body.removeChild(link);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// EXPORT EDGES //////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Exports FILTERED data, not the full data set.\nMOD.ExportEdges = () => {\n  const DATA = UDATA.AppState('FILTEREDD3DATA');\n  const TEMPLATE = UDATA.AppState('TEMPLATE');\n  const { edges } = DATA;\n  let EXPORT = '';\n\n  /// 1. Export Edges\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// Define Edge KEYS\n\n  // Old attributes method\n  // const edgesArr = m_GenerateEdgesArray(edges, EDGEKEYS);\n\n  // New Template method\n  // Use edgekeys from TEMPLATE, but skip hidden fields\n  // const edgekeys = Object.keys(TEMPLATE.edgeDefs);\n  const edgekeys = Object.keys(TEMPLATE.edgeDefs).filter(k => {\n    return TEMPLATE.edgeDefs[k].hidden ? false : k;\n  });\n\n\n  // const edgesArr = m_GenerateEdgesArray(edges, edgekeys);\n\n  /// 3. Expand to CSV\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  ///   3.1. EDGES\n  ///   3.1.1. Create headers\n  const edgeHeadersArr = [];\n  edgekeys.forEach(key => {\n    // eslint-disable-next-line prefer-reflect\n    if (Object.prototype.toString.call(key) === '[object Object]') {\n      // DEPRECATED -- 'attribute' handler.\n      throw new Error(`Unexpected edge type for ${JSON.stringify(key)}`);\n      // const subKeys = Object.keys(key); // can have multiple subKeys\n      // return subKeys.map(sk => key[sk].map(k => `${sk}:${k}`)).flat();\n    } else {\n      edgeHeadersArr.push(TEMPLATE.edgeDefs[key].exportLabel);\n    }\n  });\n  const edgeHeaders = edgeHeadersArr.flat();\n  ///    3.1.2 Export Nodes with filtered headers\n  const edgesArr = m_GenerateEdgesArray(edges, edgekeys);\n  ///    3.1.3 Attach headers to front of file\n  edgesArr.unshift(edgeHeaders);\n  ///    3.1.4 Expand Edges to CSV\n  const commaDelimitedEdges = edgesArr.map(e => e.join(','));\n  EXPORT += commaDelimitedEdges.join('\\n');\n\n  /// 4. Save to File\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  // const encodedURI = encodeURI(EXPORT);\n  const link = document.createElement('a');\n  const blob = new Blob([\"\\ufeff\", EXPORT]);\n  const url = URL.createObjectURL(blob);\n  link.href = url;\n  const DATASET = window.NC_CONFIG.dataset || \"netcreate\";\n  link.download = `${DATASET}_edges.csv`;\n  // link.setAttribute('href', encodedURI);\n  // link.setAttribute('download', 'netcreate_export.csv');\n  document.body.appendChild(link); // Required for FF\n  link.click();\n  document.body.removeChild(link);\n}\n\n///////////////////////////////////////////////////////////////////////////////\n/// IMPORT METHODS ////////////////////////////////////////////////////////////\n///////////////////////////////////////////////////////////////////////////////\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// IMPORT MODULE VARIABLES ///////////////////////////////////////////////////\nlet nodeFile;\nlet edgeFile;\nlet nodesToImport = [];\nlet edgesToImport = [];\nlet IMPORT_NCDATA;\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n * Called by ImportExport when user clicks \"Clear File Selections\".\n * Resets the loaded/validated data for a new set of data\n */\nMOD.ResetImportData = () => {\n  nodeFile = undefined;\n  edgeFile = undefined;\n  nodesToImport = [];\n  edgesToImport = [];\n  IMPORT_NCDATA = clone(UDATA.AppState('NCDATA'));\n}\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// IMPORT HELPERS ////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n/// Make sure source and target have valid ids\n/// If not, add message to edgeImportErrors\n/// `row` is the line number in the import csv file\nfunction m_hasValidSourceTarget(edge, NCDATA, edgeImportErrors, row) {\n  const source = NCDATA.nodes.find(n => n.id === Number(edge.source));\n  const target = NCDATA.nodes.find(n => n.id === Number(edge.target));\n  if (source === undefined) edgeImportErrors.push(`Edge id ${edge.id}, row ${row} references unknown source node id ${edge.source}`);\n  if (target === undefined) edgeImportErrors.push(`Edge id ${edge.id}, row ${row} references unknown target node id ${edge.target}`);\n  return (source && target);\n}\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// IMPORT MODULE METHODS /////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n/**\n * Called by ImportExport if the user Cancels selecting a node file\n */\nMOD.ResetNodeImportData = () => {\n  nodeFile = undefined;\n  nodesToImport = [];\n  if (IMPORT_NCDATA) IMPORT_NCDATA.nodes = clone(UDATA.AppState('NCDATA').nodes);\n}\n/**\n * Called by IMportExport if the user Cancels selecting a node file\n */\nMOD.ResetEdgeImportData = () => {\n  edgeFile = undefined;\n  edgesToImport = [];\n  if (IMPORT_NCDATA) IMPORT_NCDATA.edges = clone(UDATA.AppState('NCDATA').edges);\n}\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// NODE IMPORT ///////////////////////////////////////////////////////////////\n/**\n * Loads the file and checks the first row headers to make sure all the required\n * headers have been defined.\n * @param {Object} data\n * @param {File} data.nodefile - https://developer.mozilla.org/en-US/docs/Web/API/File\n * @returns {isValid:boolean, messageJsx:jsx, headers:[], lines:[]}\n */\nasync function m_NodefileCheckHeaders(data) {\n  let isValid = true;\n  let missingKeys = [];\n  let messageJsx = '';\n\n  // Retrieve import file node keys defined in template\n  const TEMPLATE = UDATA.AppState('TEMPLATE');\n  const NODEKEYS = Object.values(TEMPLATE.nodeDefs)\n    .filter(k => !k.hidden) // Ignore hidden keys\n    .map(k => k.exportLabel);\n\n  const { nodefile } = data;\n  if (nodefile===undefined) return { isValid: false, missingKeys, fileKeys: []}; // User cancelled\n  let result = await nodefile.text();\n  // Validate Data\n  const lines = result.split(REGEXMatchLFNotInQuotes);\n  // First line should list the headers\n  // Remove headers, so 'lines' is just data\n  const headers = lines.shift()\n    .trim()\n    .split(',');\n  // get keys\n  const nodeKeys = m_flattenKeys(NODEKEYS);\n  const fileKeys = m_flattenKeys(headers);\n  // check that ALL nodeKeys are in the fileKeys\n  nodeKeys.forEach(k => {\n    if (!fileKeys.includes(k)) {\n      isValid = false;\n      missingKeys.push(`\"${k}\"`);\n    }\n  });\n  if (!isValid) {\n    // construct missing keys jsx\n    messageJsx = (\n      <div style={{ color: 'red' }}>\n        <div>Error trying to import {data.nodefile.name}!</div>\n        <div>Missing keys: {missingKeys.join(', ')}</div>\n        <div>Keys found in file: {fileKeys.join(', ')}</div>\n      </div>\n    )\n  }\n  return {isValid, messageJsx, headers, lines};\n}\n/**\n * Reads each line, mapping data fields to internal representation fields\n * @param {array} headers\n * @param {array} lines\n * @returns { isValid:boolean, messageJsx:jsx, nodes:[] }\n */\nfunction m_NodefileLoadNodes(headers, lines) {\n  // Map import fields (exportLabel) to internal representation fields, e.g. ID => id,\n  // essentially a reverse look up map\n  const TEMPLATE = UDATA.AppState('TEMPLATE');\n  const INTERNAL_FIELDS_MAP = new Map();\n  Object.entries(TEMPLATE.nodeDefs).map(e => INTERNAL_FIELDS_MAP.set(e[1].exportLabel, e[0]));\n\n  // convert nodefileData to JSON\n  // Load JSON\n  let isValid = true;\n  let messageJsx = '';\n  const nodes = lines.map(l => {\n    const node = {};\n    const subcategories = new Map();\n    const importFields = l.split(REGEXMatchCommasNotInQuotes); // ?=\" needed to match commas in strings\n    importFields.forEach((f, index) => {\n      const field = f.replace(/^\"/, \"\").replace(/\"$/, \"\"); // strip start and end quotes from strings\n      const key = headers[index];\n      const keysplit = String(key).split(':');\n      // Subcategory and subkey are DEPRECATED\n      const subcategory = keysplit[0]; // e.g. 'attributes' of 'attributes:Node_type'\n      const subkey = keysplit[1]; // e.g. 'Node_type'\n      if (subkey) {\n        isValid = false;\n        messageJsx = (<div color=\"red\">`subkey ${subkey} is deprecated!`</div>)\n        console.error(PR, `subkey ${subkey} is deprecated!`);\n        // DEPRECATED: Review if we decide to use this again.\n        // // Using a sub category?  e.g. 'attributes:Node_type'\n        // const currSubfields = subcategories.get(subcategory) || {};\n        // console.log('...currSubfields', currSubfields, field)\n        // currSubfields[subkey] = field;\n        // subcategories.set(subcategory, currSubfields);\n        // console.log('adding subfields', key, currSubfields, subcategories)\n      } else {\n        // not using a subcategory, just a regular field\n        const exportLabel = headers[index];\n        if (exportLabel === undefined) console.error(PR, 'could not find exportLabel for index', index, 'in', headers);\n        const internalLabel = INTERNAL_FIELDS_MAP.get(exportLabel);\n        // special handling for internal fields\n        if (['id'].includes(internalLabel)) {\n          // Note that Number(\"\") => 0\n          // We don't want empty ids to be converted to id 0\n          // so we explicitly replace it with NaN\n          node[internalLabel] = field==='' ? NaN : field; // ids are numbers\n        } else if (['created', 'updated', 'revision'].includes(internalLabel)) {\n          // meta fields\n          if (node.meta === undefined) node.meta = {};\n          node.meta[internalLabel] = field;\n        } else {\n          node[internalLabel] = m_decode(field); // convert double quotes\n        }\n      }\n    })\n    // DEPRECATED\n    // collapse 'attributes' and 'meta' into objects\n    // subcategories.forEach((val, key) => {\n    //   node[key] = val\n    // });\n    return node;\n  });\n  return { isValid, messageJsx, nodes };\n}\n/**\n * Checks to make sure all nodes to import have a valid id or specify \"new\"\n * @param {array} nodes\n * @returns { isValid:boolean, messageJsx:jsx, nodes, IMPORT_NCDATA }\n *          At the end of this method, IMPORT_NCDATA will have imported nodes added EXCEPT for \"new\" id nodes\n */\nfunction m_NodefileValidateNodes(nodes) {\n  let isValid = true;\n  let messageJsx = '';\n  let nodesAdded = 0; // counter\n  let nodesReplaced = 0; // counter\n  const importMsgs = [];\n  const nodeImportErrors = [];\n  nodes.forEach((n, i) => {\n    const row = i + 2; // to account for header row\n    if (String(n.id).toLowerCase() === NEW_ID_KEYWORD) {\n      //  A1.1 \"new\" node\n      importMsgs.push(`New node \"${n.label}\" with auto-generated id will be added.`);\n      //  NOTE: \"new\" nodes are not added until after DB_MERGE since they do not have an id\n      //        Edge imports should not be referencing these new nodes.\n      nodesAdded++;\n    } else {\n      n.id = Number(n.id); // csv imports as string, so convert to Number\n      if (isNaN(n.id)) {\n        // A1.2 Invalid node id, usually a string\n        isValid = false;\n        nodeImportErrors.push(`Node in row ${row} does not have a valid id.  Found: \"${n.id}\".`);\n      } else {\n        const existingNodeIdx = IMPORT_NCDATA.nodes.findIndex(node => node.id === n.id);\n        if (existingNodeIdx > -1) {\n          // A1.3 Replace existing node\n          importMsgs.push(`Existing node id ${n.id} \"${IMPORT_NCDATA.nodes[existingNodeIdx].label}\" will be replaced by node \"${n.label}\" in row ${row} with matching id.`);\n          IMPORT_NCDATA.nodes.splice(existingNodeIdx, 1, n);\n          nodesReplaced++;\n        } else {\n          // A1.4 Referenced unknown id, add if valid\n          importMsgs.push(`New node id ${n.id} \"${n.label}\" will be added.`);\n          IMPORT_NCDATA.nodes.push(n);\n          nodesAdded++;\n        }\n      }\n    }\n  });\n  if (isValid) {\n    messageJsx = (\n      <ul>{importMsgs.map((e, i) => (<li key={i}>{e}</li>))}</ul>\n    );\n  } else {\n    messageJsx = (\n      <ul style={{color: 'red'}}>{nodeImportErrors.map((e, i) => (<li key={i}>{e}</li>))}</ul>\n    )\n  }\n  return { isValid, messageJsx, nodes, IMPORT_NCDATA }\n}\n/**\n * Walks down the checkers/validators one by one and aborts/returns an error message if an\n * an error is encountered.  Data is stored temporarily in `IMPORT_NCDATA` so that we can\n * process edges -- e.g. an edge might refer to a node that is currently being imported.\n *\n * Data is not actually imported in the DB until the user clicks \"Import\"\n *\n * Side effect: Updates `nodesToImport` with validated nodes\n * @param {object} data\n * @param {File} data.nodefile - https://developer.mozilla.org/en-US/docs/Web/API/File\n * @return { isValid:boolean, messages:[], errors:[] }\n */\nMOD.NodefileValidate = async (data) => {\n  // No nodefile passed, user probably clicked cancel\n  if (!data.nodefile) return { isValid: false }\n\n  if (!IMPORT_NCDATA) IMPORT_NCDATA = clone(UDATA.AppState('NCDATA'));\n  const nodeFileName = data.nodefile.name;\n\n  const headerResults = await m_NodefileCheckHeaders(data);\n  if (!headerResults.isValid) return Object.assign(headerResults, {\n    messageTitle: `Nodes import file \"${nodeFileName}\" will not be imported: Header Validation Failed!`\n  });\n\n  const importResults = m_NodefileLoadNodes(headerResults.headers, headerResults.lines);\n  if (!importResults.isValid) return Object.assign(importResults, {\n    messageTitle: `Nodes import file \"${nodeFileName}\" will not be imported: Load File Failed!`\n  });\n\n  const nodeResults = m_NodefileValidateNodes(importResults.nodes, IMPORT_NCDATA);\n  if (!nodeResults.isValid) return Object.assign(nodeResults, {\n    messageTitle: `Nodes import file \"${nodeFileName}\" will not be imported: Data Validation Failed!`\n  });\n\n  // set module-wide vars\n  nodesToImport = nodeResults.nodes;\n  nodeFile = data.nodefile;\n  IMPORT_NCDATA.nodes = Object.assign(IMPORT_NCDATA.nodes, nodeResults.nodes);\n  return Object.assign(nodeResults, {\n    messageTitle: `Nodes import file \"${nodeFileName}\": Validated!`\n  });\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// EDGE IMPORT ///////////////////////////////////////////////////////////////\n/**\n * Loads the file and checks the first row headers to make sure all the required\n * headers have been defined.\n * @param {Object} data\n * @param {File} data.edgefile - https://developer.mozilla.org/en-US/docs/Web/API/File\n * @returns {isValid:boolean, messageJsx:jsx, headers:[], lines:[]}\n */\nasync function m_EdgefileCheckHeaders(data) {\n  let isValid = true;\n  let missingKeys = [];\n  let messageJsx = '';\n\n  // Retrieve import file node keys defined in template\n  const TEMPLATE = UDATA.AppState('TEMPLATE');\n  const EDGEKEYS = Object.values(TEMPLATE.edgeDefs)\n    .filter(k => !k.hidden) // Ignore hidden keys\n    .map(k => k.exportLabel);\n\n  const { edgefile } = data;\n  if (edgefile===undefined) return { isValid: false, missingKeys, fileKeys: []}; // User cancelled\n  let result = await edgefile.text();\n  // Validate Data\n  const lines = result.split(REGEXMatchLFNotInQuotes);\n  // First line should list the headers\n  // Remove headers, so 'lines' is just data\n  const headers = lines.shift()\n    .trim()\n    .split(',');\n  // get keys\n  const edgeKeys = m_flattenKeys(EDGEKEYS);\n  const fileKeys = m_flattenKeys(headers);\n  // check that ALL edgeKeys are in the fileKeys\n  edgeKeys.forEach(k => {\n    if (!fileKeys.includes(k)) {\n      isValid = false;\n      missingKeys.push(`\"${k}\"`);\n    }\n  });\n  if (!isValid) {\n    // construct missing keys jsx\n    messageJsx = (\n      <div style={{ color: 'red' }}>\n        <div>Error trying to import {data.edgefile.name}!</div>\n        <div>Missing keys: {missingKeys.join(', ')}</div>\n        <div>Keys found in file: {fileKeys.join(', ')}</div>\n      </div>\n    )\n  }\n  return {isValid, messageJsx, headers, lines};\n}\n/**\n * Reads each line, mapping data fields to internal representation fields\n * @param {array} headers\n * @param {array} lines\n * @returns { isValid:boolean, messageJsx:jsx, nodes:[] }\n */\nfunction m_EdgefileLoadEdges(headers, lines) {\n  // Map import fields (exportLabel) to internal representation fields, e.g. ID => id,\n  // essentially a reverse look up map\n  const TEMPLATE = UDATA.AppState('TEMPLATE');\n  const INTERNAL_FIELDS_MAP = new Map();\n  Object.entries(TEMPLATE.edgeDefs).map(e => INTERNAL_FIELDS_MAP.set(e[1].exportLabel, e[0]));\n\n  // convert nodefileData to JSON\n  // Load JSON\n  let isValid = true;\n  let messageJsx = '';\n  const edges = lines.map(l => {\n    const edge = {};\n    const subcategories = new Map();\n    const importFields = l.split(REGEXMatchCommasNotInQuotes); // ?=\" needed to match commas in strings\n    importFields.forEach((f, index) => {\n      const field = f.replace(/^\"/, \"\").replace(/\"$/, \"\"); // strip start and end quotes from strings\n      const key = headers[index];\n      const keysplit = String(key).split(':');\n      // Subcategory and subkey are DEPRECATED\n      const subcategory = keysplit[0]; // e.g. 'attributes' of 'attributes:Node_type'\n      const subkey = keysplit[1]; // e.g. 'Node_type'\n      if (subkey) {\n        isValid = false;\n        messageJsx = (<div color=\"red\">`subkey ${subkey} is deprecated!`</div>)\n        console.error(PR, `subkey ${subkey} is deprecated!`);\n        // DEPRECATED: Review if we decide to use this again.\n        // // Using a sub category?  e.g. 'attributes:Node_type'\n        // const currSubfields = subcategories.get(subcategory) || {};\n        // console.log('...currSubfields', currSubfields, field)\n        // currSubfields[subkey] = field;\n        // subcategories.set(subcategory, currSubfields);\n        // console.log('adding subfields', key, currSubfields, subcategories)\n      } else {\n        // not using a subcategory, just a regular field\n        // meta field?\n        const exportLabel = headers[index];\n        if (exportLabel === undefined) console.error(PR, 'could not find exportLabel for index', index, 'in', headers);\n        const internalLabel = INTERNAL_FIELDS_MAP.get(exportLabel);\n        // special handling for internal fields\n        if (['id', 'source', 'target'].includes(internalLabel)) {\n          // Note that Number(\"\") => 0\n          // We don't want empty ids to be converted to id 0\n          // so we explicitly replace it with NaN\n          edge[internalLabel] = field==='' ? NaN : field; // ids are numbers\n        } else if (['created', 'updated', 'revision'].includes(internalLabel)) {\n          // meta fields\n          if (edge.meta === undefined) edge.meta = {};\n          edge.meta[internalLabel] = field;\n        } else {\n          edge[internalLabel] = m_decode(field); // convert double quotes\n        }\n      }\n    })\n    // DEPRECATED\n    // collapse 'attributes' and 'meta' into objects\n    // subcategories.forEach((val, key) => {\n    //   node[key] = val\n    // });\n    return edge;\n  });\n  return { isValid, messageJsx, edges };\n}\n/**\n * Checks to make sure all edges to import have a valid id or specify \"new\"\n * @param {array} edges\n * @returns { isValid:boolean, messageJsx:jsx, nodes, IMPORT_NCDATA }\n *          At the end of this method, IMPORT_NCDATA will have imported edges added EXCEPT for \"new\" id edges\n */\nfunction m_EdgefileValidateEdges(edges) {\n  let isValid = true;\n  let messageJsx = '';\n  let edgesAdded = 0; // counter\n  let edgesReplaced = 0; // counter\n  const importMsgs = [];\n  const edgeImportErrors = [];\n  edges.forEach((e, i) => {\n    const row = i + 2; // to account for header row\n    e.size = 1; // Set default edge size\n\n    // Make sure each edge has a valid source and target\n    if (!m_hasValidSourceTarget(e, IMPORT_NCDATA, edgeImportErrors, row)) isValid = false;\n\n    if (String(e.id).toLowerCase() === NEW_ID_KEYWORD) {\n      //  A1.1 \"new\" edge\n      importMsgs.push(`New edge with auto-generated id will be added.`);\n      //  NOTE: \"new\" edges are not added until after DB_MERGE since they do not have an id\n      edgesAdded++;\n    } else {\n      e.id = Number(e.id); // csv imports as string, so convert to Number\n      if (isNaN(e.id)) {\n        // A1.2 Invalid edge id, usually a string\n        isValid = false;\n        edgeImportErrors.push(`Edge in row ${row} does not have a valid id.  Found: \"${e.id}\".`);\n      } else {\n        const existingEdgeIdx = IMPORT_NCDATA.edges.findIndex(edge => edge.id === e.id);\n        if (existingEdgeIdx > -1) {\n          // A1.3 Replace existing node\n          importMsgs.push(`Existing edge id ${e.id} will be replaced by edge in row ${row} with matching id.`);\n          IMPORT_NCDATA.edges.splice(existingEdgeIdx, 1, e);\n          edgesReplaced++;\n        } else {\n          // A1.4 Referenced unknown id, add if valid\n          importMsgs.push(`New edge id ${e.id} will be added.`);\n          IMPORT_NCDATA.edges.push(e);\n          edgesAdded++;\n        }\n      }\n    }\n  });\n  if (isValid) {\n    messageJsx = (\n      <ul>{importMsgs.map((e, i) => (<li key={i}>{e}</li>))}</ul>\n    );\n  } else {\n    messageJsx = (\n      <ul style={{color: 'red'}}>{edgeImportErrors.map((e, i) => (<li key={i}>{e}</li>))}</ul>\n    )\n  }\n  return { isValid, messageJsx, edges, IMPORT_NCDATA }\n}\n/**\n * Walks down the checkers/validators one by one and aborts/returns an error message if an\n * an error is encountered.  Data is stored temporarily in `IMPORT_NCDATA` so that we can\n * process edges -- e.g. an edge might refer to a node that is currently being imported.\n *\n * Data is not actually imported in the DB until the user clicks \"Import\"\n *\n * Side effect: Updates `edgesToImport` with validated edges\n * @param {object} data\n * @param {File} data.edgefile - https://developer.mozilla.org/en-US/docs/Web/API/File\n * @return { isValid:boolean, messages:[], errors:[] }\n */\nMOD.EdgefileValidate = async (data) => {\n  // No edgefile passed, user probably clicked cancel\n  if (!data.edgefile) return { isValid: false }\n\n  if (!IMPORT_NCDATA) IMPORT_NCDATA = clone(UDATA.AppState('NCDATA'));\n  const edgeFileName = data.edgefile.name;\n\n  const headerResults = await m_EdgefileCheckHeaders(data);\n  if (!headerResults.isValid) return Object.assign(headerResults, {\n    messageTitle: `Edges import file \"${edgeFileName}\" will not be imported: Header Validation Failed!`\n  });\n\n  const importResults = m_EdgefileLoadEdges(headerResults.headers, headerResults.lines);\n  if (!importResults.isValid) return Object.assign(importResults, {\n    messageTitle: `Edges mport file \"${edgeFileName}\" will not be imported: Load File Failed!`\n  });\n\n  const edgeResults = m_EdgefileValidateEdges(importResults.edges, IMPORT_NCDATA);\n  if (!edgeResults.isValid) return Object.assign(edgeResults, {\n    messageTitle: `Edges import file \"${edgeFileName}\" will not be imported: Data Validation Failed!`\n  });\n\n  // set module-wide vars\n  edgesToImport = edgeResults.edges; // set module-wide var\n  edgeFile = data.edgefile; // set module-wide var\n  return Object.assign(edgeResults, {\n    messageTitle: `Edges import file \"${edgeFileName}\": Validated!`\n  });\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// MAIN IMPORT ///////////////////////////////////////////////////////////////\n/**\n * This is triggered when the user clicks the \"Import\" button.\n * Forces a RELOAD_DB after the import data is merged into the database.\n * @returns {messageJsx} -- summary of file imported\n */\nMOD.Import = async () => {\n  // Write to database!\n  const mergeData = { nodes: nodesToImport, edges: edgesToImport };\n  await UDATA.LocalCall(\"DB_MERGE\", mergeData).then(res => {\n    // Reload NCDATA from the DB to get new Node and Edge Ids created during the merge\n    UDATA.LocalCall(\"RELOAD_DB\");\n  });\n  const importedFiles = [];\n  if (nodeFile) importedFiles.push(nodeFile.name);\n  if (edgeFile) importedFiles.push(edgeFile.name);\n  const importedFileNames = importedFiles.join(', ');\n  return {\n    messageJsx: (<div>{importedFileNames} Import Completed!</div>)\n  }\n}\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = MOD;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  * EVENTS: D3 Graph Updates\n\n    Mark Node/Edge          Nodes in the graph are marked via a stroke around\n                            the circle.  There are two types of marks:\n\n                            1. SEARCH -- when a node matches a search, its\n                            strokeColor is set to green.\n\n                            2. SELECTION -- when a node is selected by the\n                            user and shown in the NodeSelector either by\n                            directly clicking on it or by clicking on a\n                            item in the search suggestion list, the node\n                            data is marked `selected` and a blue strokeColor\n                            is applied.\n\n                            The two marks are orthogonal to each other: a\n                            node can be both searched and selected, though\n                            the selection mark will override the search\n                            mark.\n\n                            The rendering is handled by modifying the\n                            node data in NCDATA.  d3-simplenetgraph will\n                            then read any NCDATA updates and redraw\n                            the graph based on the updated data.\n\n    Add New Node/Edge       When the user adds a new edge or node, handlers in\n                            NetCreate will update its `this.state.data`\n                            with the new nodes/edges.  This is passed on to\n                            `NetGraph.jsx` and in turn to `D3SimpleNetGraph.js`\n                            which will display the new data during its update\n                            cycle.\n\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst DBG = false;\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst SETTINGS = require(\"settings\");\nconst UNISYS = require(\"unisys/client\");\nconst JSCLI = require(\"system/util/jscli\");\nconst D3 = require(\"d3\");\nconst UTILS = require(\"./nc-utils\");\n\n/// INITIALIZE MODULE /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar MOD = UNISYS.NewModule(module.id);\nvar UDATA = UNISYS.NewDataLink(MOD);\n\n/// APP STATE/DATA STRUCTURES /////////////////////////////////////////////////\n/*/ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - \\*\\\n\n\n    SELECTION\n\n    The SELECTION state maintains the list of nodes and edges that are\n    currently selected and loaded in the forms.\n\n    Set by      AutoComplete's call to SOURCE_SELECT\n                D3SimpleNetGraph's call to SOURCE_SELECT\n                EdgeEditor's call to EDGE_UPDATE\n    Handled by  NodeSelector to load the currently selected node\n                NodeSelector also sets the edges in EdgeEditor\n                EdgeEditor to select the target node when creating new edge\n\n    * nodes     An array of current selected nodes for editing.\n                This is the node the user clicked on in the graph or selected from\n                the suggestions list\n    * edges     An array of edge objects for editing\n                *REVIEW*: Should this be renamed \"selectedEdges\" to distinguish from\n                *NCDATA.edge\n\n\n\n    SEARCH\n\n    The SEARCH state keeps track of the text being searched for in the\n    main AutoComplete field.  It also provides a list of the nodes that match\n    the search string so that AutoComplete and D3 can display them.  (D3\n    doesn't actually process the SEARCH state change.  Instead it's processed\n    by nc-logic in response to SOURCE_SEARCH calls -- nc-logic\n    will set the node's `selected` or `stroke-color` state if a node\n    is currently selected or matches a search parameter, respectively.)\n\n    Set by      AutoComplete's call to SOURCE_SEARCH when its input changes.\n    Handled by  AutoComplete for its controlled input field\n                NodeSelector for validating when editing the form.\n\n    * searchLabel     A string that the user has typed into AutoComplete\n    * suggestedNodes  An array of nodes that match the searchLabel\n\n\n\n    ACTIVEAUTOCOMPLETE\n\n    The ACTIVEAUTOCOMPLETE state points to the id of the AutoComplete\n    field (either search, or NodeSElector, or EdgeEditor) that has the\n    current focus.  Search results and d3 clicks are routed to the\n    active AutComplete component.\n\n    Set by      Search's call to AUTOCOMPLETE_SELECT on startup\n                NodeSelector's call to AUTOCOMPLETE_SELECT when Edit Node is clicked\n                \" when changes are submitted\n                EdgeEditor's call to AUTOCOMPLETE_SELECT when a new Edge is created\n                \" an edge is selected externally for editing\n                \" an edge being editted is closed (hand back to search)\n                \" changes are submitted\n\n    Handled by  AutoComplete to enable/disable its mode active state,\n                know when and when not to handle SEARCH and SELECTION state updates.\n\n    Looked up   NodeSelector to check if it's the current activeAutoCompleteId\n\n    * activeAutoCompleteId\n                id of active <AutoComplete> field\n                of form: 'node-xx' or 'edge-source-xx' or 'edge-target-xx'\n                where xx = the id of the <AutoComplete> field that has input focus.\n                This is used to keep track of the currently active\n                AutoComplete field. Inactive fields and updates are determined by\n                the value of this property.\n\n\n    NCDATA\n\n    NCDATA is the core pristine network data of nodes and edges. It is read\n    directly from the database, or, when importing data, data is imported\n    into NCDATA.  It is an object consisting of two arrays:\n      `NCDATA = { nodes: [], edges: [] }`\n    See https://whimsical.com/network-data-flow-63qtRETqrfDVfp7EchUdzp\n    NCDATA is maintained as a application-wide AppState, though some modules\n    may keep a local copy.  (This needs to be reviewed and revised).\n    It includes:\n    * nodes: all nodes (not all may be actually changed)\n    * edges: all edges (not all may be actually changed)\n\n\n    FILTEREDD3DATA\n\n    FILTEREDD3DATA is the processed network data. It is derived from NCDATA.\n    It represents a subset of NCDATA with filtered items tagged (for highlight)\n    or removed. d3 will alter FILTEREDD3DATA, replacing edge source/targets\n    ids with node objects.\n    FILTEREDD3DATA is updated whenever NCDATA is updated.\n\n    There are three key differences between NCDATA and FILTEREDD3DATA:\n    1. edge.source and edge.target in NCDATA refer to node ids\n       whereas in FILTEREDD3DATA, edge.source and edge.target are node objects\n    2. Only FILTEREDD3DATA is passed to d3.  d3 never directly touches NCDATA.\n    3. FILTEREDD3DATA is directly derived from NCDATA, and can contain a subset\n       of the nodes or edges of NCDATA. In contrast, NCDATA contains ALL nodes\n       and edges.  When a filter is set, FILTEREDD3DATA is updated from\n       NCDATA, with nodes and edges removed or marked according to the filter.\n\n\\*\\ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -/*/\nvar NCDATA = null; // see above for description\nvar TEMPLATE = null; // template definition for prompts\nconst NETWORK = require(\"unisys/client-network\");\nconst DATASTORE = require(\"system/datastore\");\nconst SESSION = require(\"unisys/common-session\");\nconst PROMPTS = require(\"system/util/prompts\");\nconst PR = PROMPTS.Pad(\"NCLOGIC\");\n\n/// CONSTANTS /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DESELECTED_COLOR = \"\";\n// For backwards compatability, if the template is not setting these\n// Ideally we want to centralize the backwards compatability at some point into one spot\n// OR just remove it, but this was easier to test and shouldn't impact performance substantively\nconst DEFAULT_SEARCH_COLOR = \"#008800\";\nconst DEFAULT_SOURCE_COLOR = \"#FFa500\";\nconst TARGET_COLOR = \"#FF0000\";\n\nconst DATASET = window.NC_CONFIG.dataset || \"netcreate\";\nconst TEMPLATE_URL = `templates/${DATASET}.toml`;\n\n/// DB LOADER HELPERS /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Used by LOADASSETS and RELOAD_DB to reload NCDATA from the database.\n/*/\nfunction m_PromiseLoadDB() {\n  return DATASTORE.PromiseD3Data()\n  .then(data => {\n    if (DBG) console.log(PR, \"DATASTORE returned data\", data);\n    m_MigrateData(data.d3data);\n    UTILS.RecalculateAllEdgeSizes(data.d3data);\n    UTILS.RecalculateAllNodeDegrees(data.d3data);\n    UDATA.SetAppState(\"NCDATA\", data.d3data);\n    UDATA.SetAppState(\"TEMPLATE\", data.template);\n    // Save off local reference because we don't have NCDATA AppStateChange handler\n    NCDATA = data.d3data;\n    TEMPLATE = data.template;\n  });\n}\n\n\n/// UNISYS LIFECYCLE HOOKS ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ LOADASSETS fires before react components are loaded\n    see client-lifecycle.js for description\n/*/\nMOD.Hook(\"LOADASSETS\", () => {\n  if (UNISYS.IsStandaloneMode()) {\n    // STANDALONE MODE\n    // Load read-only database from exported db file.\n\n    const USE_CACHE = false;\n    if (USE_CACHE) {\n      console.warn(PR,\"STANDALONE MODE: 'LOADASSETS' using browser cache\");\n      return new Promise((resolve, reject) => {\n        const lstore = window.localStorage;\n        let ld3 = lstore.getItem(\"NCDATA\");\n        NCDATA = JSON.parse(ld3);\n        if (!NCDATA) reject(Error(\"couldn't get NCDATA from Local Store\"));\n        UDATA.SetAppState(\"NCDATA\", NCDATA);\n        let tem = lstore.getItem(\"TEMPLATE\");\n        TEMPLATE = JSON.parse(tem);\n        console.log(NCDATA, TEMPLATE);\n        if (!TEMPLATE) reject(Error(\"couldn't get TEMPLATE from Local Store\"));\n        UDATA.SetAppState(\"TEMPLATE\", TEMPLATE);\n        resolve();\n      });\n    }\n    // don't use cache, but instead try loading standalone files\n    console.warn(PR,\"STANDALONE MODE: 'LOADASSETS' is using files (USE_CACHE=false)\");\n    // added by Joshua to check for alternative datasets in the folder\n    let urlParams = new URLSearchParams(window.location.search);\n    let dataset = urlParams.get('dataset');\n    if(dataset == null) dataset = \"standalone\";\n    return new Promise((resolve) => {\n      (async () => {\n        let p1 = await DATASTORE.PromiseJSONFile(\"data/\" + dataset + \"-db.json\")\n          .then(d3data => {\n            m_MigrateData(d3data);\n            UTILS.RecalculateAllEdgeSizes(d3data);\n            UTILS.RecalculateAllNodeDegrees(d3data);\n            UDATA.SetAppState(\"NCDATA\", d3data);\n            // Save off local reference because we don't have NCDATA AppStateChange handler\n            NCDATA = d3data;\n          });\n        // load template\n        let p2 = await DATASTORE.PromiseTOMLFile(\"data/\" + dataset + \".template.toml\")\n          .then(data => {\n            TEMPLATE = data;\n            UDATA.SetAppState(\"TEMPLATE\", TEMPLATE);\n          });\n        resolve();\n      })();\n    });\n  }\n  return Promise.all([m_PromiseLoadDB()]);\n}); // loadassets\n\n/// UNISYS LIFECYCLE HOOKS ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ CONFIGURE fires after LOADASSETS, so this is a good place to put TEMPLATE\n    validation.\n/*/\n// eslint-disable-next-line complexity\nMOD.Hook(\"CONFIGURE\", () => {\n  // Process Node, NodeColorMap and Edge options\n  m_ValidateTemplate();\n  m_UpdateColorMap();\n}); // end CONFIGURE HOOK\n\n/// UNISYS LIFECYCLE HOOKS ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ DISCONNECT fires when NetMessage.GlobalOfflineMode()\n/*/\nMOD.Hook(\"DISCONNECT\", () => {\n  console.log(\"DISCONNECT HOOK\");\n  const lstore = window.localStorage;\n  lstore.setItem(\"NCDATA\", JSON.stringify(NCDATA));\n  lstore.setItem(\"TEMPLATE\", JSON.stringify(TEMPLATE));\n  console.log(\"saving d3data, template to localstore\");\n});\n\n/// UNISYS HANDLERS ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ lifecycle INITIALIZE handler\n/*/\nMOD.Hook(\"INITIALIZE\", () => {\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /*/ RELOAD_DB\n      Called by importexport-logic.js.MOD.Import:818\n      During import, DB_MERGE will be called to merge the import data\n      into the DB.  Then it will call RELOAD_DB to re-read the updated\n      NCDATA from the database.  This is necessary because new ids will\n      have been generated during the merge.\n  /*/\n  UDATA.HandleMessage(\"RELOAD_DB\", () => {\n     return Promise.all([m_PromiseLoadDB()]);\n  });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /*/ NCDATA\n  /*/\n  UDATA.OnAppStateChange(\"NCDATA\", stateChange => {\n    if (DBG) console.log(\"nc-logic: Got NCDATA\", stateChange);\n    NCDATA = stateChange;\n  });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /*/ Handle D3-related updates based on state changes. Subcomponents are\n      responsible for updating themselves.\n  /*/\n  UDATA.OnAppStateChange(\"SELECTION\", stateChange => {\n    if (DBG) console.log(\"nc-logic: Got SELECTION\", stateChange);\n    let { nodes, edges } = stateChange;\n    // NODE LIST UPDATE\n    if (nodes !== undefined) {\n      if (nodes.length > 0) {\n        let color = \"#0000DD\";\n        nodes.forEach(node => {\n          m_MarkNodeById(node.id, color);\n          UNISYS.Log(\"select node\", node.id, node.label);\n          let googlea = NC_CONFIG.googlea;\n\n          if(googlea != \"0\"){\n            ga('send', {\n              hitType: 'event',\n              eventCategory: 'Node',\n              eventAction: '' + node.label,\n              eventLabel: '' + window.location\n            });\n          }\n        });\n      } else {\n        m_UnMarkAllNodes();\n      }\n    }\n  }); // StateChange SELECTION\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /*/ Search field has been updated\n  /*/\n  UDATA.OnAppStateChange(\"SEARCH\", stateChange => {\n    if (DBG) console.log(\"nc-logic: Got SEARCH\", stateChange);\n    let { nodes, edges } = stateChange;\n    let { searchLabel } = stateChange;\n    let { activeAutoCompleteId } = stateChange;\n    // NODE LIST UPDATE\n    if (nodes !== undefined) {\n      if (nodes.length > 0) {\n        const color = TEMPLATE.searchColor || DEFAULT_SEARCH_COLOR;\n        nodes.forEach(node => m_MarkNodeById(node.id, color));\n      } else {\n        m_UnMarkAllNodes();\n      }\n    }\n    // SEARCH LABEL UPDATE\n    if (NCDATA.nodes.length < 150) { // JD to speedup processing for large sets\n      if (searchLabel === \"\") {\n        m_UnStrokeAllNodes();\n      } else if (searchLabel !== undefined) {\n         m_SetStrokeColorThatMatch(searchLabel, TEMPLATE.searchColor || DEFAULT_SEARCH_COLOR);\n      }\n    }\n  }); // StateChange SELECTION\n\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /*/ User has clicked on a suggestion from the AutoCopmlete suggestion list.\n      The source node should be loaded in NodeSelector.\n\n      OR, user has clicked on a node in the D3 graph.\n\n      SOURCE_SELECT select node by LABEL. There is only one selected node\n      in the app at any one time, though nodeLabels is passed as an array.\n      SEE ALSO: AutoComplete.onSuggestionSelected() and\n                D3SimpleNetGraph._UpdateGraph click handler\n  /*/\n  UDATA.HandleMessage(\"SOURCE_SELECT\", m_sourceSelect);\n  function m_sourceSelect (data) {\n    if (DBG) console.log(PR, \"SOURCE_SELECT got data\", data);\n\n    let { nodeLabels = [], nodeIDs = [] } = data;\n    let nodeLabel = nodeLabels.shift();\n    let nodeID = nodeIDs.shift();\n    let node, newState;\n\n    if (nodeID) {\n      node = m_FindNodeById(nodeID); // Node IDs should be integers, not strings\n      if (DBG) console.log(PR, \"SOURCE_SELECT found by nodeID\", nodeID, 'node:', node);\n    } else if (nodeLabel) {\n      node = m_FindMatchingNodesByLabel(nodeLabel).shift();\n      if (DBG) console.log(PR, \"SOURCE_SELECT found by nodeLabel\", nodeLabel, \"node:\", node);\n    } else {\n      // No node selected, so deselect\n      if (DBG) console.log(PR, \"SOURCE_SELECT found no node\", node);\n    }\n\n    if (DBG) console.log(PR, \"SOURCE_SELECT found\", node);\n\n    if (node === undefined) {\n      // Node not found, create a new node\n      newState = {\n        nodes: [],\n        edges: []\n      };\n    } else {\n      // Load existing node and edges\n      let edges = [];\n      if (NCDATA.edges) { // if no edges are defined, skip, otherwise chokes on NCDATA.edges.filter\n        if (nodeID) {\n          edges = edges.concat(\n            NCDATA.edges.filter(\n              edge => edge.source === nodeID || edge.target === nodeID\n            )\n          );\n        } else {\n          console.error(PR, `SOURCE_SELECT trying to match edge using \"label\" ${nodeLabel}.  This is deprecated!`);\n          // REVIEW: are we actually matching label anymore?\n          // This should fail because source/target is no longer an object, just an id\n          // edges = edges.concat(\n          //   NCDATA.edges.filter(\n          //     edge => edge.source.label === nodeLabel || edge.target.label === nodeLabel\n          //   )\n          // );\n        }\n      }\n      // create state change object\n      newState = {\n        nodes: [node],\n        edges: edges\n      };\n    }\n\n    // Set the SELECTION state so that listeners such as NodeSelectors update themselves\n    UDATA.SetAppState(\"SELECTION\", newState);\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /*/ SOURCE_SEARCH sets the current matching term as entered in an\n      AutoComplete field.\n  /*/\n  UDATA.HandleMessage(\"SOURCE_SEARCH\", function(data) {\n    let { searchString } = data;\n    let matches = m_FindMatchingNodesByLabel(searchString);\n    let newState = {\n      suggestedNodes: matches.map(n => {\n        return { id: n.id, label: n.label };\n      }),\n      searchLabel: searchString\n    };\n    // let SELECTION state listeners handle display updates\n    UDATA.SetAppState(\"SEARCH\", newState);\n  });\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /*/ SOURCE_SEARCH_AND_SELECT first searches for an exact matching node\n      and if found, selects it.\n      This is called by AutoComplete onBlur in case we need to make an\n      implicit selection.\n  /*/\n  UDATA.HandleMessage(\"SOURCE_SEARCH_AND_SELECT\", function (data) {\n    let { searchString } = data;\n    let node = m_FindMatchingNodesByLabel(searchString).shift();\n    if (node && (node.label === searchString)) {\n      console.log(PR,'SOURCE_SEARCH_AND_SELECT about to trigger SOURCE_SELECT data was',data);\n      m_sourceSelect({ nodeIDs: [node.id] });\n    }\n  });\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /*/ SOURCE_HILITE updates the currently rolled-over node name in a list of\n      node name selections when using AutoComplete.\n      The hilite can be selected via either the label or the node id.\n  /*/\n /* ORIGINAL INQUIRIUM CODE\n  UDATA.HandleMessage(\"SOURCE_HILITE\", function(data) {\n    let { nodeLabel, nodeID, color } = data;\n    if (nodeLabel) {\n      // Only mark nodes if something is selected\n      m_UnMarkAllNodes();\n      m_MarkNodeByLabel(nodeLabel, SOURCE_COLOR);\n    }\n    if (nodeID) {\n      // Only mark nodes if something is selected\n      m_UnMarkAllNodes();\n      m_MarkNodeById(nodeID, SOURCE_COLOR);\n    }\n    */\n\n    UDATA.HandleMessage(\"SOURCE_HILITE\", function(data) {\n    let { nodeLabel, nodeID, color } = data;\n    if (nodeLabel) {\n      // Only mark nodes if something is selected\n      if (NCDATA.nodes.length < 250) { // JD to speedup processing for large\n        m_UnMarkAllNodes();\n        m_MarkNodeByLabel(nodeLabel, TEMPLATE.sourceColor || DEFAULT_SOURCE_COLOR);\n      }\n    }\n    if (nodeID) {\n      // Only mark nodes if something is selected\n      if (NCDATA.nodes.length < 250) { // JD to speedup processing for large\n        m_UnMarkAllNodes();\n        m_MarkNodeById(nodeID, TEMPLATE.sourceColor || DEFAULT_SOURCE_COLOR);\n      }\n    }\n\n    // NOTE: State is updated in the \"MarkNodeBy*\" functions above.\n  });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /*/ SOURCE_UPDATE is called when the properties of a node has changed\n      Globally updates DATASTORE and working NCDATA objects with the new node data.\n      NOTE: SOURCE_UPDATE can be invoked remotely by the server on a DATABASE\n      update.\n  /*/\n  UDATA.HandleMessage(\"SOURCE_UPDATE\", function(data) {\n    let { node } = data;\n    // REVIEW: NodeSelector should probably not be submitting data\n    //         directly to the database.  Instead, it should be notifying\n    //         nc-logic and we handle the degree insertion and db call.\n    // if degrees has not already been set (e.g. this is a new node), default to 0\n    node.degrees = node.degrees || 0;\n    // try updating existing nodes with this id?\n    let updatedNodes = m_SetMatchingNodesByProp({ id: node.id }, node);\n    if (DBG) console.log(\"SOURCE_UPDATE: updated\", updatedNodes);\n    // if no nodes had matched, then add a new node!\n    if (updatedNodes.length > 1) {\n      console.error(\"SOURCE_UPDATE: duplicate ids in\", updatedNodes);\n      throw Error(\"SOURCE_UPDATE: found duplicate IDs\");\n    }\n    if (updatedNodes.length === 0) NCDATA.nodes.push(node);\n    UDATA.SetAppState(\"NCDATA\", NCDATA);\n  });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /*/ NODE_DELETE is called by NodeSelector via datastore.js and\n      Server.js when an node should be removed\n  /*/\n  UDATA.HandleMessage(\"NODE_DELETE\", function(data) {\n    let { nodeID, replacementNodeID } = data;\n\n    // Remove or replace edges\n    let edgesToProcess;\n    if (replacementNodeID !== -1) {\n      // replace source/target with replacement node ID\n      let replacementNode = m_FindNodeById(replacementNodeID);\n      edgesToProcess = NCDATA.edges.map(edge => {\n        if (edge.source === nodeID) edge.source = replacementNodeID;\n        if (edge.target === nodeID) edge.target = replacementNodeID;\n        return edge;\n      });\n    } else {\n      // delete edges\n      edgesToProcess = NCDATA.edges.filter(edge => {\n        let pass = false;\n        if (edge.source !== nodeID && edge.target !== nodeID) {\n          pass = true;\n        }\n        return pass;\n      });\n    }\n    NCDATA.edges = edgesToProcess;\n\n    // // Remove node\n    let updatedNodes = m_DeleteMatchingNodesByProp({ id: nodeID });\n    NCDATA.nodes = updatedNodes;\n    UDATA.SetAppState(\"NCDATA\", NCDATA);\n\n    // Also update selection so nodes in EdgeEditor will update\n    UDATA.SetAppState(\"SELECTION\", {\n      nodes: undefined,\n      edges: undefined\n    });\n    // FIXME: need to also update AutoUpdate!!!\n    // FIXME: Need to also trigger resize!\n  });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /*/ NODE_TYPES_UPDATE is called by template-logic after user has changed the\n      node type options.  This maps changed options to a new name,\n      and deleted type options to existing options.\n      This updates:\n      * The template file with new new node types\n      * NCDATA and the databse file with node type changes\n\n      @param {object} data\n      @param {object} data.nodeTypesChanges - { label, color, replacement, delete }\n      @param {string} data.nodeTypesChanges.label - orig label, used for matching to current node setting\n      @param {string} data.nodeTypesChanges.color\n      @param {string} data.nodeTypesChanges.replacement - text to replace label\n      @param {boolean} data.nodeTypesChanges.delete - option should be removed after mapping\n  /*/\n  UDATA.HandleMessage(\"NODE_TYPES_UPDATE\", data => {\n    const { nodeTypesChanges } = data;\n    const changeMap = new Map();\n    nodeTypesChanges.forEach(c => {\n      changeMap.set(c.label, c);\n    });\n    NCDATA.nodes = NCDATA.nodes.map(n => {\n      const type = n.type;\n      const change = changeMap.get(n.type);\n      if (change && change.replacement) {\n        n.type = change.replacement;\n      }\n      return n;\n    });\n    // DEPRECATED\n    // As of 3/2022 edge source and target use ids, so there's no longer\n    // a need to convert them.\n    // // Convert D3 source/target nodes objects into ids\n    // NCDATA.edges = m_ConvertSourceTarget2ID(NCDATA.edges);\n\n    // Write to database!\n    // IMPORTANT: We have to update the db BEFORE calling SetAppState\n    // because SetAppState will cause d3 to convert edge source/targets\n    // from ids back to node objects.\n    UDATA.LocalCall(\"DBUPDATE_ALL\", NCDATA);\n    UDATA.SetAppState(\"NCDATA\", NCDATA);\n  });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /*/ EDGE_TYPES_UPDATE is called by template-logic after user has changed the\n      edge type options.  This maps changed options to a new name,\n      and deleted type options to existing options.\n      This updates:\n      * The template file with new new edge types\n      * NCDATA and the databse file with edge type changes\n\n      @param {object} data\n      @param {object} data.nodeTypesChanges - { label, color, replacement, delete }\n      @param {string} data.nodeTypesChanges.label - orig label, used for matching to current edge setting\n      @param {string} data.nodeTypesChanges.color\n      @param {string} data.nodeTypesChanges.replacement - text to replace label\n      @param {boolean} data.nodeTypesChanges.delete - option should be removed after mapping\n  /*/\n  UDATA.HandleMessage(\"EDGE_TYPES_UPDATE\", data => {\n    const { edgeTypesChanges } = data;\n    const changeMap = new Map();\n    edgeTypesChanges.forEach(c => {\n      changeMap.set(c.label, c);\n    });\n    NCDATA.edges = NCDATA.edges.map(e => {\n      const type = e.type;\n      const change = changeMap.get(e.type);\n      if (change && change.replacement) {\n        console.log('replacing',e.type,'with',change.replacement)\n        e.type = change.replacement;\n      }\n      return e;\n    });\n    // Write to database!\n    // IMPORTANT: We have to update the db BEFORE calling SetAppState\n    // because SetAppState will cause d3 to convert edge source/targets\n    // from ids back to node objects.\n    UDATA.LocalCall(\"DBUPDATE_ALL\", NCDATA);\n    UDATA.SetAppState(\"NCDATA\", NCDATA);\n  });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /*/ EDGE_UPDATE is called when the properties of an edge has changed\n      NOTE: SOURCE_UPDATE can be invoked remotely by the server on a DATABASE\n      update.\n  /*/\n  UDATA.HandleMessage(\"EDGE_UPDATE\", function(data) {\n    let { edge } = data;\n    if (DBG) console.log(\"nc-logic.EDGE_UPDATE: received edge\", edge);\n    // set matching edges\n    let updatedEdges = m_SetMatchingEdgesByProp({ id: edge.id }, edge);\n    if (DBG) console.log(\"nc-logic.EDGE_UPDATE: updated\", updatedEdges);\n\n    // if no edges had matched, then add a new edge!\n    if (updatedEdges.length === 0) {\n      if (DBG) console.log(\"nc-logic.EDGE_UPDATE: adding new edge\", edge);\n      // created edges should have a default size\n      edge.size = 1;\n      NCDATA.edges.push(edge);\n    }\n    // if there was one edge\n    if (updatedEdges.length === 1) {\n      console.log('nc-logic.EDGE_UPDATE: updating existing edge', updatedEdges)\n    }\n    // if there were more edges than expected\n    if (updatedEdges.length > 1) {\n      throw Error(\"EdgeUpdate found duplicate IDs\");\n    }\n\n    UTILS.RecalculateAllEdgeSizes(NCDATA);\n    UTILS.RecalculateAllNodeDegrees(NCDATA);\n    UDATA.SetAppState(\"NCDATA\", NCDATA);\n  });\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /*/ EDGE_DELETE is called when an edge should be removed from...something?\n  /*/\n  UDATA.HandleMessage(\"EDGE_DELETE\", function(data) {\n    let { edgeID } = data;\n    let edges = [];\n    // remove specified edge from edge list\n    NCDATA.edges = m_DeleteMatchingEdgeByProp({ id: edgeID });\n    UTILS.RecalculateAllEdgeSizes(NCDATA);\n    UTILS.RecalculateAllNodeDegrees(NCDATA);\n    UDATA.SetAppState(\"NCDATA\", NCDATA);\n    // Also update selection so edges in EdgeEditor will update\n    let selection = UDATA.AppState(\"SELECTION\");\n    if (\n      selection.nodes === undefined ||\n      selection.nodes.length < 1 ||\n      selection.nodes[0].id === undefined\n    ) {\n      if (DBG) console.log(PR, \"no selection:\", selection);\n    } else {\n      if (DBG) console.log(PR, \"updating selection:\", selection);\n      let nodeID = selection.nodes[0].id;\n      // Remove the deleted edge from the selection\n      if (selection.edges !== undefined && selection.edges.length > 0) {\n        edges = edges.concat(\n          selection.edges.filter(edge => edge.id !== edgeID)\n        );\n      }\n    }\n    UDATA.SetAppState(\"SELECTION\", {\n      nodes: selection.nodes,\n      edges: edges\n    });\n  });\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /*/ AUTOCOMPLETE_SELECT is called by <AutoComplete> components to tell the\n      module which one has the current focus.\n  /*/\n  UDATA.HandleMessage(\"AUTOCOMPLETE_SELECT\", function(data) {\n    m_HandleAutoCompleteSelect(data);\n  });\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /*/ TEMPLATE has been edited\n      This message is sent from server.js over the net.\n      This is the main handler for the local app.  It updates the appState.\n  /*/\n  UDATA.HandleMessage(\"NET_TEMPLATE_UPDATE\", stateChange => {\n    if (DBG) console.log(PR, 'NET_TEMPLATE_UPDATE state change', stateChange)\n    TEMPLATE = stateChange;\n    UDATA.SetAppState(\"TEMPLATE\", TEMPLATE);\n    m_UpdateColorMap();\n  });\n\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  UDATA.HandleMessage(\"EDIT_CURRENT_TEMPLATE\", () => {\n    return { template: TEMPLATE }\n  })\n\n}); // end UNISYS_INIT\n\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ INIT HANDLERS\n/*/\n\nfunction m_HandleAutoCompleteSelect(data) {\n  if (DBG) console.log(\"ACL: Setting activeAutoCompleteId to\", data.id);\n  UDATA.SetAppState(\"ACTIVEAUTOCOMPLETE\", {\n    activeAutoCompleteId: data.id\n  });\n}\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ lifecycle RESET handler\n/*/\nMOD.Hook(\"RESET\", () => {\n  // Force an AppState update here so that the react components will load\n  // the data after they've been initialized.  The SetAppState call in\n  // LOADASSETS is broadcast before react components have been loaded.\n  UDATA.SetAppState(\"NCDATA\", NCDATA);\n}); // end UNISYS_RESET\n\n/// APP_READY MESSAGE REGISTRATION ////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ The APP_READY hook is fired after all initialization phases have finished\n    and may also fire at other times with a valid info packet\n/*/\nMOD.Hook(\"APP_READY\", function(info) {\n  /// RETURN PROMISE to prevent phase from continuing until after registration\n  /// of messages is successful\n  return new Promise((resolve, reject) => {\n    if (DBG)\n      console.log(`${PR}HOOK 'UNISYS_INIT' Registering Message Handlers...`);\n    // timeout for broken network registration\n    let timeout = setTimeout(() => {\n      reject(new Error(\"UNISYS REGISTER TIMEOUT\"));\n    }, 5000);\n\n    // register ONLY messages we want to make public\n    UNISYS.RegisterMessagesPromise([\n      \"SOURCE_UPDATE\",\n      `NODE_DELETE`,\n      \"EDGE_UPDATE\",\n      \"EDGE_DELETE\",\n      \"EDIT_PERMISSIONS_UPDATE\",\n      \"NET_TEMPLATE_UPDATE\"\n    ]).then(d => {\n      clearTimeout(timeout);\n      if (DBG)\n        console.log(\n          `${PR}HOOK 'UNISYS_INIT' Registered Message Handlers ${JSON.stringify(\n            d.registered\n          )}`\n        );\n      if (DBG)\n        console.log(\n          `INFO: %cMy socket address is ${UNISYS.SocketUADDR()}`,\n          \"color:blue;font-weight:bold\"\n        );\n      resolve();\n    });\n  });\n}); // end UNISYS_READY\n\n/// OBJECT HELPERS ////////////////////////////////////////////////////////////\n/// these probably should go into a utility class\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Return array of objects that match the match_me object keys/values\n    NOTE: make sure that strings are compared with strings, etc\n/*/\nfunction m_FindMatchingObjsByProp(obj_list, match_me = {}) {\n  // operate on arrays only\n  if (!Array.isArray(obj_list))\n    throw Error(\"FindMatchingObjectsByProp arg1 must be array\");\n  let matches = obj_list.filter(obj => {\n    let pass = true;\n    for (let key in match_me) {\n      if (match_me[key] !== obj[key]) pass = false;\n      break;\n    }\n    return pass;\n  });\n  // return array of matches (can be empty array)\n  return matches;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Set array of objects that match to key/values of yes/no respectively\n    Returns array of matched objects\n/*/\nfunction m_SetMatchingObjsByProp(obj_list, match_me = {}, yes = {}, no = {}) {\n  // operate on arrays only\n  if (!Array.isArray(obj_list))\n    throw Error(\"SetMatchingObjsByPropp arg1 must be array\");\n\n  let returnMatches = [];\n  obj_list.forEach(node => {\n    let matched = true;\n    for (let key in match_me) {\n      if (match_me[key] !== node[key]) matched = false;\n      break;\n    }\n    if (matched) {\n      for (let key in yes) node[key] = yes[key];\n      returnMatches.push(node);\n    } else {\n      for (let key in no) node[key] = no[key];\n    }\n  });\n  return returnMatches;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Update props of everything in obj_list\n/*/\nfunction m_SetAllObjs(obj_list, all = {}) {\n  // operate on arrays only\n  if (!Array.isArray(obj_list)) throw Error(\"SetAllNodes arg1 must be array\");\n  obj_list.forEach(obj => {\n    for (let key in all) obj[key] = all[key];\n  });\n}\nMOD.SetAllObjs = m_SetAllObjs; // Expose for filter-logic.js\n\n/// NODE HELPERS //////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n/*/ Validate Template File\n/*/\nfunction m_ValidateTemplate() {\n  try {\n    // nodeDefs\n    let nodeDefs = TEMPLATE.nodeDefs;\n    if (nodeDefs === undefined) {\n      throw \"Missing `nodeDefs` nodeDefs=\" + nodeDefs;\n    }\n    if (nodeDefs.label === undefined) throw \"Missing `nodeDefs.label` label=\" + nodeDefs.label;\n    if (nodeDefs.type === undefined) throw \"Missing `nodeDefs.type` type= \" + nodeDefs.type;\n    if (\n      nodeDefs.type.options === undefined ||\n      !Array.isArray(nodeDefs.type.options)\n    ) {\n      throw \"Missing or bad `nodeDefs.type.options` options=\" +\n        nodeDefs.type.options;\n    }\n    if (nodeDefs.notes === undefined) throw \"Missing `nodeDefs.notes` notes=\" + nodeDefs.notes;\n    if (nodeDefs.info === undefined) throw \"Missing `nodeDefs.info` info=\" + nodeDefs.info;\n\n    // edgeDefs\n    let edgeDefs = TEMPLATE.edgeDefs;\n    if (edgeDefs === undefined) throw \"Missing `edgeDefs` edgeDefs=\" + edgeDefs;\n    if (edgeDefs.source === undefined) throw \"Missing `edgeDefs.source` source=\" + edgeDefs.source;\n    if (edgeDefs.type === undefined) throw \"Missing `edgeDefs.type` type= \" + edgeDefs.type;\n    if (\n      edgeDefs.type.options === undefined ||\n      !Array.isArray(edgeDefs.type.options)\n    ) {\n      throw \"Missing or bad `edgeDefs.type.options` options=\" +\n        edgeDefs.type.options;\n    }\n    if (edgeDefs.target === undefined) throw \"Missing `edgeDefs.target` label=\" + edgeDefs.target;\n    if (edgeDefs.notes === undefined) throw \"Missing `edgeDefs.notes` notes=\" + edgeDefs.notes;\n    if (edgeDefs.info === undefined) throw \"Missing `edgeDefs.info` info=\" + edgeDefs.info;\n    if (edgeDefs.citation === undefined) throw \"Missing `edgeDefs.citation` info=\" + edgeDefs.citation;\n    if (edgeDefs.category === undefined) throw \"Missing `edgeDefs.category` info=\" + edgeDefs.category;\n  } catch (error) {\n    console.error(\n      PR + \"Error loading template `\",\n      TEMPLATE_URL,\n      \"`::::\",\n      error\n    );\n  }\n}\n\n/*/ Update ColorMap\n/*/\nfunction m_UpdateColorMap() {\n  // REVIEW: Load ColorMap in d3?  or elsewhere?  does it need its own state?\n  // Joshua added Edges in here ... it should either be renamed or kept separate\n  // but this was a proof of concept. Probably they should be kept separate in case\n  // someone ever chooses to use the same label twice, but ...\n  try {\n    const nodeColorMap = {};\n    TEMPLATE.nodeDefs.type.options.forEach(o => {\n      nodeColorMap[o.label] = o.color;\n    });\n\n    const edgeColorMap = {};\n    let defaultEdgeColor = TEMPLATE.edgeDefs.color || \"#999\"; //for backwards compatability\n    TEMPLATE.edgeDefs.type.options.forEach(o => {\n      edgeColorMap[o.label] = o.color || defaultEdgeColor;\n    });\n\n    UDATA.SetAppState(\"COLORMAP\", {nodeColorMap, edgeColorMap});\n  } catch (error) {\n    console.error(\n      PR,\n      \"received bad TEMPLATE node options.  ERROR:\",\n      error,\n      \". DATA:\",\n      TEMPLATE\n    );\n  }\n}\n\n/*/ Return array of nodes that DON'T match del_me object keys/values\n/*/\nfunction m_DeleteMatchingNodesByProp(del_me = {}) {\n  let matches = NCDATA.nodes.filter(node => {\n    let pass = false;\n    for (let key in del_me) {\n      if (del_me[key] !== node[key]) {\n        pass = true;\n        break;\n      }\n    }\n    return pass;\n  });\n  // return array of matches (can be empty array)\n  return matches;\n}\n/*/ Return array of nodes that match the match_me object keys/values\n    NOTE: make sure that strings are compared with strings, etc\n/*/\nfunction m_FindMatchingNodeByProp(match_me = {}) {\n  return m_FindMatchingObjsByProp(NCDATA.nodes, match_me);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Convenience function to retrieve node by ID\n/*/ function m_FindNodeById(id) {\n  return m_FindMatchingNodeByProp({ id })[0];\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Return array of nodes with labels that partially match str\n/*/\nfunction m_FindMatchingNodesByLabel(str = \"\") {\n  if (!str) return [];\n  str = u_EscapeRegexChars(str.trim());\n  if (str === \"\") return [];\n  const regex = new RegExp(/*'^'+*/ str, \"i\");\n  return NCDATA.nodes.filter(node => regex.test(node.label));\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Set nodes that PARTIALLY match 'str' to 'yes' props.\n    All others nodes are set to 'no' props. Return matches\n    Optionally resets all the NON matching nodes as well\n/*/\nfunction m_SetMatchingNodesByLabel(str = \"\", yes = {}, no = {}) {\n  let returnMatches = [];\n  str = u_EscapeRegexChars(str.trim());\n  if (str === \"\") return undefined;\n  const regex = new RegExp(/*'^'+*/ str, \"i\");\n  NCDATA.nodes.forEach(node => {\n    if (regex.test(node.label)) {\n      for (let key in yes) node[key] = yes[key];\n      returnMatches.push(node);\n    } else {\n      for (let key in no) node[key] = no[key];\n    }\n  });\n  return returnMatches;\n}\n\n\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Update props of exact matching nodes, returns matches\n    Optionally resets all the NON matching nodes as well\n/*/\nfunction m_SetMatchingNodesByProp(match_me = {}, yes = {}, no = {}) {\n  return m_SetMatchingObjsByProp(NCDATA.nodes, match_me, yes, no);\n}\n\n/// EDGE HELPERS //////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Return array of edges that DON'T match del_me object keys/values\n/*/\nfunction m_DeleteMatchingEdgeByProp(del_me = {}) {\n  let matches = NCDATA.edges.filter(edge => {\n    let pass = false;\n    for (let key in del_me) {\n      if (del_me[key] !== edge[key]) {\n        pass = true;\n        break;\n      }\n    }\n    return pass;\n  });\n  // return array of matches (can be empty array)\n  return matches;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Update props of exact matching edges, returns matches\n/*/\nfunction m_SetMatchingEdgesByProp(match_me = {}, yes = {}, no = {}) {\n  return m_SetMatchingObjsByProp(NCDATA.edges, match_me, yes, no);\n}\n\n/// UTILITIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ REGEX: the chars in brackets are part of matching character set.\n    Declaring this as a constant makes the RegEx run faster (I think).\n/*/\nconst REGEX_REGEXCHARS = /[.*+?^${}()|[\\]\\\\]/g;\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Adds a \\ in front of characters that have special RegEx meaning\n    From https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expression\n/*/\nfunction u_EscapeRegexChars(string) {\n  return string.replace(REGEX_REGEXCHARS, \"\\\\$&\"); // $& means the whole matched string\n}\nMOD.EscapeRegexChars = u_EscapeRegexChars; // Expose for filter-logic.js\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Migrate Data from older formats\n\n    1. Convert all IDs to integers\n        Node and Edge IDs should be integers.\n        This isn't a problem with newly created datasets as the network-generated IDs\n        are integers.  However, with older data sets, the IDs may have been strings.\n        e.g. exports from Gephi will have string IDs.\n        This mismatch is a problem when looking up nodes by ID.\n          `data` is passed by reference\n          This modifies `data`\n          data = { nodes: [], edges: [] }\n    2. Convert 'attributes' from pre v1.4 datasets\n        NODES\n          attributes.Node_type => type\n          attributes[Extra Info] => info\n          attributes.Notes => notes\n        EDGES\n          attributes.Relationship => type\n          attributes.Info => info\n          attributes.Citations = citation\n          attributes.Notes => notes\n    3. Remove the old `attributes` key\n/*/\nfunction m_MigrateData(data) {\n  data.nodes.forEach(node => {\n    node.id = parseInt(node.id);\n    if (node.attributes) { // don't clobber if value is already set\n      node.type = node.type || node.attributes.Node_Type;\n      node.info = node.info || node.attributes[\"Extra Info\"];\n      node.notes = node.notes || node.attributes.Notes;\n      // clear it\n      Reflect.deleteProperty(node, 'attributes');\n    }\n  });\n  data.edges.forEach(edge => {\n    edge.id = parseInt(edge.id);\n    // before D3 processing, edge.source and edge.target are ids\n    edge.source = parseInt(edge.source);\n    edge.target = parseInt(edge.target);\n    if (edge.attributes) { // don't clobber if value is already set\n      edge.type = edge.type || edge.attributes.Relationship;\n      edge.info = edge.info || edge.attributes.Info;\n      edge.citation = edge.citation || edge.attributes.Citations;\n      edge.notes = edge.notes || edge.attributes.Notes;\n      edge.category = edge.category || edge.attributes.Category;\n      // clear it\n      Reflect.deleteProperty(edge, 'attributes');\n    }\n  });\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n// DEPRECATED\n// As of 3/2022 edge source and target use ids, so there's no longer\n// a need to convert them.\n//\n// /*/ Converts edge.source and edge.target from objects to ids\n//     d3 converts edge.source and edget.target from ids to node objects\n//     when it renders NCDATA.  When getting ready to save edges to the database\n//     we need to convert them back to ids.\n// /*/\n// function m_ConvertSourceTarget2ID(edges) {\n//   return edges.map(e => {\n//     e.source = e.source && e.source.id;\n//     e.target = e.target && e.target.id;\n//     return e;\n//   });\n// }\n\n/// NODE MARKING METHODS //////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Visually change all nodes to the deselected color\n/*/\nfunction m_UnMarkAllNodes() {\n  let props = { selected: DESELECTED_COLOR };\n  m_SetAllObjs(NCDATA.nodes, props);\n  UDATA.SetAppState(\"NCDATA\", NCDATA);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Remove the stroke color.  Used to unmark search matches.\n/*/\nfunction m_UnStrokeAllNodes() {\n  let props = { strokeColor: undefined };\n  m_SetAllObjs(NCDATA.nodes, props);\n  UDATA.SetAppState(\"NCDATA\", NCDATA);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Sets the `node.selected` property to `color` so it is hilited on graph\n/*/\nfunction m_MarkNodeById(id, color) {\n  let marked = { selected: TEMPLATE.sourceColor != undefined? TEMPLATE.sourceColor : DEFAULT_SOURCE_COLOR };\n  let normal = { selected: DESELECTED_COLOR };\n  // NOTE: this.getSelectedNodeColor(node,color) and\n  // this.getDeselectedNodeColor(node,color) are not yet implemented\n  // to override the properties\n  m_SetMatchingNodesByProp({ id }, marked, normal);\n\n    UDATA.SetAppState(\"NCDATA\", NCDATA);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Sets the `node.selected` property to `color` so it is hilited on graph\n/*/\nfunction m_MarkNodeByLabel(label, color) {\n  let marked = { selected: color };\n  let normal = { selected: DESELECTED_COLOR };\n  // NOTE: this.getSelectedNodeColor(node,color) and\n  // this.getDeselectedNodeColor(node,color) are not yet implemented\n  // to override the properties\n  m_SetMatchingNodesByLabel(label, marked, normal);\n\n  UDATA.SetAppState(\"NCDATA\", NCDATA);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Sets matching node labels to the passed selection color\n/*/\nfunction m_MarkNodesThatMatch(searchString, color) {\n  if (searchString === \"\") {\n    m_UnMarkAllNodes();\n    return;\n  }\n  let select = { selected: color };\n  let deselect = { selected: DESELECTED_COLOR };\n  m_SetMatchingNodesByLabel(searchString, select, deselect);\n  UDATA.SetAppState(\"NCDATA\", NCDATA);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Sets matching node labels to the passed selection color\n    This sets the stroke color, which is used to display\n    the matching nodes during a search.  If the node is\n    also selected, the selected color will override this color.\n/*/\nfunction m_SetStrokeColorThatMatch(searchString, color) {\n  let matched = { strokeColor: color };\n  let notmatched = { strokeColor: undefined };\n  m_SetMatchingNodesByLabel(searchString, matched, notmatched);\n  UDATA.SetAppState(\"NCDATA\", NCDATA);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Sets the 'selected' state of edges that are attached to the node\n/*/\nfunction m_MarkSelectedEdges(edges, node) {\n  // Delesect all edges first\n  edges.forEach(edge => {\n    edge.selected = false;\n  });\n  // Find connected edges\n  let id = node.id;\n  NCDATA.edges.forEach(edge => {\n    if (edge.source === id || edge.target === id) {\n      edge.selected = true;\n    } else {\n      edge.selected = false;\n    }\n  });\n  UDATA.SetAppState(\"NCDATA\", NCDATA);\n}\n\n/// COMMAND LINE UTILITIES ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Command: RESET THE DATABASE from default data\n/*/\nJSCLI.AddFunction(function ncPushDatabase(jsonFile) {\n  jsonFile = jsonFile || \"data.reducedlinks.json\";\n  DATASTORE.PromiseJSONFile(jsonFile)\n    .then(data => {\n      // data is { nodes, edges }\n      console.log(PR, `Sending data from ${jsonFile} to Server`, data);\n      // UDATA.Call() returns a promise, so return it to\n      // continue the asynchronous chain\n      return UDATA.Call(\"SRV_DBSET\", data);\n    })\n    .then(d => {\n      if (d.OK) {\n        window.alert(\n          `assets/data/${jsonFile} was pushed to Server.\\nPress OK to refresh this page and MANUALLY REFRESH other clients.\\n\\n(note: if data hasn't changed, try command again)`\n        );\n        console.log(\n          `${PR} %cServer Database has been overwritten with ${jsonFile}`,\n          \"color:blue\"\n        );\n        console.log(`${PR} Reload apps to see new data`);\n        setTimeout(UNISYS.ForceReloadOnNavigation, 1000);\n      } else {\n        console.error(PR, \"Server Error\", d);\n        window.alert(`Error ${JSON.stringify(d)}`);\n      }\n    });\n  // return syntax help\n  return \"FYI: ncPushDatabase(jsonFile) can load file in assets/data\";\n});\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Command: EMPTY THE DATABASE from default data\n/*/ JSCLI.AddFunction(\n  function ncEmptyDatabase() {\n    window.ncPushDatabase(\"nada.json\");\n    return \"FYI: pushing empty database from assets/data/nada.json...reloading\";\n  }\n);\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Command: Unlock the database.  Used to recover from error conditions where\n    a node or edge is inadvertently left locked.\n/*/\nJSCLI.AddFunction(\n  function ncUnlockAll() {\n    UDATA.NetCall('SRV_DBUNLOCKALL', {});\n    return \"Unlocking all nodes and edges in the database, and enabling template edits.\";\n  }\n);\nJSCLI.AddFunction(\n  function ncUnlockAllNodes() {\n    UDATA.NetCall('SRV_DBUNLOCKALLNODES', {});\n    return \"Unlocking all nodes in the database.\";\n  }\n);\nJSCLI.AddFunction(\n  function ncUnlockAllEdges() {\n    UDATA.NetCall('SRV_DBUNLOCKALLEDGES', {});\n    return \"Unlocking all edges in the database.\";\n  }\n);\nJSCLI.AddFunction(\n  function ncNodeColorMap() {\n    console.log(UDATA.AppState('COLORMAP'));\n    return \"ncNodeColorMap.\";\n  }\n);\nJSCLI.AddFunction(\n  function ncDumpData() {\n    console.log('NCDATA', NCDATA);\n    return `ncDumpData: ${JSON.stringify(NCDATA)}`;\n  }\n);\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Command: Token Generator\n/*/\nJSCLI.AddFunction(function ncMakeTokens(clsId, projId, dataset, numGroups) {\n  // type checking\n  if (typeof clsId !== \"string\")\n    return \"args: str classId, str projId, str dataset, int numGroups\";\n  if (typeof projId !== \"string\")\n    return \"args: str classId, str projId, str dataset, int numGroups\";\n  if (typeof dataset !== \"string\")\n    return \"args: str classId, str projId, str dataset, int numGroups\";\n  if (clsId.length > 12) return \"classId arg1 should be 12 chars or less\";\n  if (projId.length > 12) return \"classId arg1 should be 12 chars or less\";\n  if (!Number.isInteger(numGroups)) return \"numGroups arg3 must be integer\";\n  if (numGroups < 1) return \"numGroups arg3 must be positive integer\";\n  // let's do this!\n  let out = `\\nTOKEN LIST for class '${clsId}' project '${projId}'\\n\\n`;\n  let pad = String(numGroups).length;\n  for (let i = 1; i <= numGroups; i++) {\n    let id = String(i);\n    id = id.padStart(pad, \"0\");\n    out += `group ${id}\\t${SESSION.MakeToken(clsId, projId, i, dataset)}\\n`;\n  }\n  if (window && window.location) {\n    let ubits = new URL(window.location);\n    let hash = ubits.hash.split(\"/\")[0];\n    let url = `${ubits.protocol}//${ubits.host}/${hash}`;\n    out += `\\nexample url: ${SETTINGS.ServerAppURL()}/edit/${SESSION.MakeToken(\n      clsId,\n      projId,\n      1\n    )}\\n`;\n  }\n  return out;\n});\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = MOD;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  nc-utils\n\n  General purpose utilities for manipulating NCDATA.\n  Used by both nc-logic and importexport-logic.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/**\n * Calculates and sets `degrees` for all nodes\n * `degrees` is the number of edges connected to a node\n * degrees needs to be recalculated whenever an edge is changed\n * This modifies `data`\n * @param {object} data\n * @param {array} data.nodes\n * @param {array} data.edges\n */\nexport function RecalculateAllNodeDegrees(data) {\n  const degrees = new Map();\n  function inc(nodeId) {\n    const val = degrees.get(nodeId) || 0;\n    degrees.set(nodeId, val + 1);\n  }\n  // Count edges efficiently\n  data.edges.forEach(e => {\n    inc(e.source);\n    inc(e.target);\n  });\n  // Apply the sums\n  data.nodes.forEach(n => {\n    n.degrees = degrees.get(n.id) || 0;\n  });\n}\n\n/**\n * Calculates and sets `size` for all edges\n * `size` is the sum of all edge weights that have the same source/targets\n * By default `weight` is 1.\n * @param {object} data\n * @param {array} data.nodes\n * @param {array} data.edges\n */\nexport function RecalculateAllEdgeSizes(data) {\n  const size = new Map();\n  function getKey(sourceId, targetId) {\n    // key always starts with the smaller value\n    return sourceId<targetId ? `${sourceId}-${targetId}` : `${targetId}-${sourceId}`;\n  }\n  function inc(weight, sourceId, targetId) {\n    const w = weight || 1;\n    const key = getKey(sourceId, targetId);\n    const val = size.get(key) || 0;\n    size.set(key, val + w);\n  }\n  // Count edges efficiently\n  data.edges.forEach(e => {\n    inc(e.weight, e.source, e.target);\n  });\n  // Apply the sums\n  data.edges.forEach(e => {\n    const key = getKey(e.source, e.target);\n    e.size = size.get(key) || 1;\n  });\n}\n\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Template Logic\n\n  This handles the UI logic for the \"Edit Template\" subpanel on the \"More...\"\n  tab.\n\n  The actual template loading is handled by `server-database.js`.\n\n  The internal template representation is JSON.\n  The template definition itself is stored as a TOML file, which is then\n  converted to JSON when loaded.\n\n  The default json-editor schema is defined in `template-schema.js`\n\n\n  ##  BACKGROUND\n\n  Template data is loaded by `server-database` DB.InitializeDatabase call.\n\n  With Version 1.4 of NetCreate, we introduce a new TOML template format that\n  is easier to work with directly.\n  * If you open a project that does not have a TOML template, the app will\n    try to load the old JSON version and convert it.  See\n    server-database.m_LoadJSONTemplate() and m_MigrateJSONtoTOML().\n  * If you try to load a TOML template that is missing some key fields\n    (e.g. error message definitions), then the app will fall back on\n    fields defined in the schema.  See server-database.m_LoadTOMLTemplate()).\n\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst DBG = false;\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst UNISYS = require(\"unisys/client\");\nconst TOML = require(\"@iarna/toml\");\nconst DATASTORE = require(\"system/datastore\");\n\n/// INITIALIZE MODULE /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar MOD = UNISYS.NewModule(module.id);\nvar UDATA = UNISYS.NewDataLink(MOD);\n\n/// CONSTANTS /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n\n/// UTILITIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n/// UNISYS LIFECYCLE HOOKS ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n///////////////////////////////////////////////////////////////////////////////\n/// MODULE METHODS ////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n///\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Used when importing a TOML file\n    Makes sure TOML file is readable.\n    Returns JSON\n/*/\nMOD.ValidateTOMLFile = async data => {\n  const { tomlfile } = data;\n  try {\n    let tomlText = await tomlfile.text();\n    const json = TOML.parse(tomlText);\n    const isValid = true;\n    return {isValid, templateJSON: json};\n  }\n  catch (err) {\n    return { isValid: false, error: err };\n  }\n}\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Update TEMPLATE AppState\n    Called by Template.jsx to update the template data with the info from the form.\n    Mostly used to process whether the form is:\n    a) updating the whole template data, or\n    b) updating only node types, or\n    c) updateing only edge types\n\n    IMPORTANT: Does NOT save the template or SetAppState!  Use SaveTemplateFile!\n      SaveTemplateFile will trigger a TEMPLATE state update.\n      Generally you won't call UpdateTemplate without a followup call to\n      SaveTemplateFile.\n\n    MAJOR SIDE EFFECT: Updates NCDATA with changes!\n    `templateSnippet` can be the whole template object, or just the node types or\n    edge types.\n/*/\nMOD.UpdateTemplate = (templateSnippet, editScope) => {\n  let TEMPLATE = UDATA.AppState('TEMPLATE');\n\n  // a) Replace whole template?\n  if (editScope === 'root') TEMPLATE = templateSnippet;\n\n  // b) Replace NODE type options?\n  if (editScope === 'nodeTypeOptions') {\n    // 1. Clean/validate -- Remove any empty labels\n    //    Added Rows will have a blank 'label' but a non-blank 'replacement'\n    TEMPLATE.nodeDefs.type.options = templateSnippet.options.filter(o => {\n      return (o.label !== '') || (o.label === '' && o.replacement !== '');\n    });\n    // 2. Update NCDATA with new types\n    UDATA.LocalCall(\"NODE_TYPES_UPDATE\", { nodeTypesChanges: templateSnippet.options });\n    // 3. Remove Types marked for deletion\n    TEMPLATE.nodeDefs.type.options = TEMPLATE.nodeDefs.type.options.filter(o => !o.delete);\n    // 4. Update types with replacement labels\n    TEMPLATE.nodeDefs.type.options = TEMPLATE.nodeDefs.type.options.map(o => {\n      if (o.replacement) {\n        o.label = o.replacement;\n        o.replacement = \"\";\n      }\n      return o;\n    });\n    // 4. Validate: Make sure there are no other empty labels?\n    // 5. Re-add default selected (blank) option\n    TEMPLATE.nodeDefs.type.options.unshift({\n      label: '', color: '#eeee'\n    });\n  }\n\n  // c) Replace EDGE type options?\n  if (editScope === 'edgeTypeOptions') {\n    console.log('edgeTypeOptions: template snippet', templateSnippet)\n    // 1. Clean/validate -- Remove any empty labels\n    //    Added Rows will have a blank 'label' but a non-blank 'replacement'\n    TEMPLATE.edgeDefs.type.options = templateSnippet.options.filter(o => {\n      return (o.label !== '') || (o.label === '' && o.replacement !== '');\n    });\n    // 2. Update NCDATA with new types\n    UDATA.LocalCall(\"EDGE_TYPES_UPDATE\", { edgeTypesChanges: templateSnippet.options });\n    // 3. Remove Types marked for deletion\n    TEMPLATE.edgeDefs.type.options = TEMPLATE.edgeDefs.type.options.filter(o => !o.delete);\n    // 4. Update types with replacements\n    TEMPLATE.edgeDefs.type.options = TEMPLATE.edgeDefs.type.options.map(o => {\n      if (o.replacement) {\n        o.label = o.replacement;\n        o.replacement = \"\";\n      }\n      return o;\n    });\n    // 4. Validate: Make sure there are no other empty labels?\n    // 5. Re-add default selected (blank) option\n    TEMPLATE.edgeDefs.type.options.unshift({\n      label: '', color: '#eeee'\n    });\n  }\n  // This call is redundant.  SaveTemplateToFile will trigger a state update.\n  // UDATA.SetAppState(\"TEMPLATE\", TEMPLATE);\n  return TEMPLATE;\n}\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Save template file to disk\n    in case we do not necessarily want to autosave template data\n    This calls: datastore > server > server-database\n/*/\nMOD.SaveTemplateToFile = template => {\n  return DATASTORE.SaveTemplateFile(template);\n}\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Download template to local file\n/*/\nMOD.DownloadTemplate = () => {\n  DATASTORE.GetTemplateTOMLFileName() // datastore > server > server-database\n    .then(data => {\n      const filename = data.filename;\n      const TEMPLATE = UDATA.AppState('TEMPLATE');\n      const toml = TOML.stringify(TEMPLATE);\n      const link = document.createElement('a');\n      const blob = new Blob([\"\\ufeff\", toml]);\n      const url = URL.createObjectURL(blob);\n      link.href = url;\n      link.download = filename;\n      document.body.appendChild(link); // Required for FF\n      link.click();\n      document.body.removeChild(link);\n    });\n}\n\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = MOD;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Template Schema\n\n  The Template Schema defines a spec for\n  `[json-editor](https://github.com/json-editor/json-editor)`\n  to generate a UI for editing the template.  It identifies the objects that\n  the json-editor needs to support and provides meta data about how to\n  display and handle the edits.\n\n  `template-logic.js` handles initialization.\n\n  NOTE: This schema is NOT the same as the `toml` template file schema.  This\n  schema is used by `json-editor` to know how to display a UI for editing the\n  template itself.\n\n  FUTURE WORK: We should be able to generate a new\n  `default.template.toml` file from the schema.  That would ensure that\n  default template is up to date.  There isn't a single-button UI for this\n  currently, but you CAN basically do this by:\n  1. Start NetCreate with a new db, e.g. `./nc.js --dataset=newdefault`\n  2. Clicking \"New Template\" on the \"More... > Edit Template\" tab.\n  3. Clicking \"Save Changes\"\n  4. Copy the file to `netcreate-2018/build/app/assets/templates/`\n  5. Renaming the saved template to `_default.template.toml`\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst DBG = false;\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst clone = require(\"rfdc\")();\n\n/// INITIALIZE MODULE /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst MOD = {};\n\n/// CONSTANTS /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n/**\n * Node Type Schema\n * This is a subset of the full template schema.\n *\n * We pull it out separately so that Node Types can be edited by themselves\n * without having to scroll through the whole template.\n *\n * When editing the main Template, this is loaded as a subset of the main schema.\n * When editing node types, this is loaded by MOD.GetTypeEditorSchema to\n * provide additional UI elements to manage deleting and renaming\n * existing field types\n */\nMOD.NODETYPEOPTIONS = {\n  type: 'array',\n  title: 'Node Types',\n  format: 'table',\n  options: {\n    disable_collapse: true,\n    disable_array_add: false,\n    disable_array_delete: false,\n    disable_array_delete_all_rows: true,\n    disable_array_delete_last_row: true,\n    disable_array_reorder: false\n  }, // not editable\n  items: {\n    type: 'object',\n    properties: {\n      'color': {\n        type: 'string',\n        title: 'Color',\n        format: 'color'\n      },\n      'label': {\n        type: 'string',\n        title: 'Label'\n      }\n    }\n  }\n};\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n/**\n * Edge Type Schema\n * This is a subset of the full template schema.\n *\n * We pull it out separately so that Edge Types can be edited by themselves\n * without having to scroll through the whole template.\n *\n * When editing the main Template, this is loaded as a subset of the main schema.\n * When editing edge types, this is loaded by MOD.GetTypeEditorSchema to\n * provide additional UI elements to manage deleting and renaming\n * existing field types\n */\nMOD.EDGETYPEOPTIONS = {\n  type: 'array',\n  title: 'Edge Types',\n  format: 'table',\n  options: {\n    disable_collapse: true,\n    disable_array_add: false,\n    disable_array_delete: false,\n    disable_array_delete_all_rows: true,\n    disable_array_delete_last_row: true,\n    disable_array_reorder: false\n  }, // not editable\n  items: {\n    type: 'object',\n    properties: {\n      'color': { // currently unused\n        type: 'string',\n        title: 'Color',\n        format: 'color'\n      },\n      'label': {\n        type: 'string',\n        title: 'Label'\n      },\n    }\n  }\n}\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n/*/ Main NetCreate Schema Template\n    This references the NODETYPEOPTIONS and EGETYPEOPTIONS above to define\n    options.\n/*/\nMOD.TEMPLATE = {\n  title: 'NetCreate Template',\n  type: 'object',\n  properties: {\n    \"name\": {\n      type: 'string',\n      description: 'A short descriptive title for the project.  This is displayed on the graph view.  It can contain spaces.  e.g. \"Alexander the Great\"',\n      default: 'Untitled Template'\n    },\n    \"description\": {\n      type: 'string',\n      description: 'Short description of the project, e.g. \"This is based on the Secret Histories of Prokopios\"',\n      default: 'No Description'\n    },\n    \"citation\": {\n      type: 'object',\n      description: 'Citation meta data',\n      properties: {\n        \"text\": {\n          type: 'string',\n          description: 'Bibliographic reference',\n          options: {\n            inputAttributes: { placeholder: 'Untitled Network' }\n          }\n        },\n        \"hidden\": {\n          type: 'boolean',\n          format: 'checkbox',\n          description: 'Hides the \"Cite Node\" and \"Cite Edge\" buttons.',\n          default: false\n        }\n      }\n    },\n    \"requireLogin\": {\n      type: 'boolean',\n      format: 'checkbox',\n      default: false\n    },\n    \"hideDeleteNodeButton\": {\n      // Normally, only admins can delete nodes.  You're an admin if:\n      // -- is localhost (e.g. IP is 127.0.0.71)\n      // -- or has `?admin=true` GET parameter\n      // This will force hide the delete button even if you're an admin.\n      type: 'boolean',\n      format: 'checkbox',\n      description: 'Always hide Node delete button, even for admins.',\n      default: false\n    },\n    \"allowLoggedInUserToImport\": {\n      // Normally, only admins can import data.  You're an admin if:\n      // -- is localhost (e.g. IP is 127.0.0.71)\n      // -- or has `?admin=true` GET parameter\n      // This will allow any logged in user to import data.\n      type: 'boolean',\n      format: 'checkbox',\n      description: 'Allow any logged in user to import data.  Admins can always import data.',\n      default: false\n    },\n    \"duplicateWarning\": {\n      type: 'string',\n      description: 'Warning message to display if user is trying to create a node that already exists.',\n      default: 'Youre entering a duplicate node.  Do you want to View the Existing node, or Continue creating?'\n    },\n    \"nodeIsLockedMessage\": {\n      type: 'string',\n      description: 'Warning message to display if user is trying to edit a node that someone is already editing.',\n      default: 'This node is currently being edited by someone else, please try again later.'\n    },\n    \"edgeIsLockedMessage\": {\n      type: 'string',\n      description: 'Warning message to display if user is trying to edit an edge that someone is already editing.',\n      default: 'This edge is currently being edited by someone else, please try again later.'\n    },\n    \"templateIsLockedMessage\": {\n      type: 'string',\n      description: 'Warning message to display if user is trying to edit a node or edge or import while the template is being edited.',\n      default: 'The template is currently being edited, please try again later.'\n    },\n    \"importIsLockedMessage\": {\n      type: 'string',\n      description: 'Warning message to display if user is trying to edit a node, edge, or template import is active.',\n      default: 'Data is currently being imported, please try again later.'\n    },\n    \"nodeDefaultTransparency\": {\n      type: 'number',\n      description: 'Default transparency for nodes.',\n      default: 1.0\n    },\n    \"edgeDefaultTransparency\": {\n      type: 'number',\n      description: 'Default transparency for edges.',\n      default: 0.7\n    },\n    \"searchColor\": {\n      type: 'string',\n      description: 'Outline color of nodes selected via search.',\n      default: '#008800',\n      format: 'color'\n    },\n    \"sourceColor\": {\n      type: 'string',\n      description: 'Outline color of node highlighted during auto complete.',\n      default: '#FFa500',\n      format: 'color'\n    },\n    \"nodeDefs\": {\n      properties: {\n        \"id\": {\n          type: 'object',\n          description: 'System-generated unique id number',\n          properties: {\n            \"type\": {\n              type: 'number',\n              // not editable\n              options: { hidden: true },\n              description: '\"id\" data type',\n              default: 'number'\n            },\n            \"displayLabel\": {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Id'\n            },\n            \"exportLabel\": {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'ID'\n            },\n            \"help\": {\n              type: 'string',\n              // not editable\n              options: { hidden: true },\n              description: 'Help text to display on the Node Editor form',\n              default: 'System-generated unique id number'\n            },\n            \"includeInGraphTooltip\": {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show \"id\" value in tooltip on graph',\n              default: true\n            },\n            \"hidden\": {\n              type: 'boolean',\n              format: 'checkbox',\n              options: { hidden: true }, // not end-user editable, always hidden from Template Editor\n              description: 'Not used.  \"id\" is always hidden.',\n              default: false\n            }\n          }\n        },\n        \"label\": {\n          type: 'object',\n          description: 'Display name of the node',\n          properties: {\n            \"type\": {\n              type: 'string',\n              // not editable\n              options: { hidden: true },\n              description: '\"label\" data type',\n              default: 'string'\n            },\n            \"displayLabel\": {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'label'\n            },\n            \"exportLabel\": {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Label'\n            },\n            \"help\": {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: 'Display name of the node'\n            },\n            \"includeInGraphTooltip\": {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show \"label\" value in tooltip on graph',\n              default: true\n            },\n            \"hidden\": {\n              type: 'boolean',\n              options: { hidden: true }, // not end-user editable, always hidden from Template Editor\n              description: 'Not used.  \"label\" is always shown.',\n              format: 'checkbox',\n              default: false\n            }\n          }\n        },\n        \"type\": {\n          type: 'object',\n          description: 'Enumerated node types',\n          properties: {\n            \"type\": {\n              type: 'string',\n              // not editable\n              options: { hidden: true },\n              description: 'node \"type\" data type',\n              default: 'select'\n            },\n            \"displayLabel\": {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Type'\n            },\n            \"exportLabel\": {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'NodeType' // matches Gephi\n            },\n            \"help\": {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: 'Multiple people are a \"Group\"'\n            },\n            \"includeInGraphTooltip\": {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show \"type\" value in tooltip on graph',\n              default: true\n            },\n            \"hidden\": {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Hides \"type\" from Node Editor, Nodes Table, and exports',\n              default: false\n            },\n            \"options\": Object.assign({}, MOD.NODETYPEOPTIONS, { description: 'NOTE: We recommend using the \"Edit Node Types\" feature to edit Node Types.  It provides additional dataset migration tools.' })\n          }\n        },\n        \"notes\": { // Significance\n          type: 'object',\n          description: 'Display name of the node',\n          properties: {\n            \"type\": {\n              type: 'string',\n              description: '\"notes\" data type',\n              default: 'string'\n            },\n            \"displayLabel\": {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Significance'\n            },\n            \"exportLabel\": {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Notes'\n            },\n            \"help\": {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: 'Display name of the node'\n            },\n            \"includeInGraphTooltip\": {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show \"notes\" value in tooltip on graph',\n              default: true\n            },\n            \"hidden\": {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Hides \"notes\" from Node Editor, Nodes Table, and exports',\n              default: false\n            }\n          }\n        },\n        \"info\": { // Info/Number\n          type: 'object',\n          description: 'Display name of the node',\n          properties: {\n            \"type\": {\n              type: 'string',\n              description: '\"info\" data type',\n              default: 'number'\n            },\n            \"displayLabel\": {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Number'\n            },\n            \"exportLabel\": {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Info'\n            },\n            \"help\": {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: 'Some number comparison'\n            },\n            \"includeInGraphTooltip\": {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show \"info\" value in tooltip on graph',\n              default: true\n            },\n            \"hidden\": {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Hides \"info\" from Node Editor, Nodes Table, and exports',\n              default: false\n            }\n          }\n        },\n        \"degrees\": {\n          type: 'object',\n          description: 'Display name of the node',\n          properties: {\n            \"type\": {\n              type: 'string',\n              description: '\"degrees\" data type',\n              default: 'number'\n            },\n            \"displayLabel\": {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Degrees'\n            },\n            \"exportLabel\": {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Degrees'\n            },\n            \"help\": {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: 'Number of edges connected to this node'\n            },\n            \"includeInGraphTooltip\": {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show \"degrees\" value in tooltip on graph',\n              default: true\n            },\n            \"hidden\": {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Hides \"degrees\" from Node Editor, Nodes Table, and exports',\n              default: false\n            }\n          }\n        },\n        \"created\": { // Built-in data DO NOT MODIFY!\n          type: 'object',\n          description: 'System-generated date.  This setting used to show/hide tooltip in graph and import/export',\n          properties: {\n            \"displayLabel\": {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Created'\n            },\n            \"exportLabel\": {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Created'\n            },\n            \"includeInGraphTooltip\": {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show \"created\" value in tooltip on graph',\n              default: true\n            },\n            \"help\": {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: 'Date and time node was created'\n            },\n            \"hidden\": {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Requires \"created\" for exports and imports',\n              default: false\n            }\n          }\n        },\n        \"updated\": { // Built-in data DO NOT MODIFY!\n          type: 'object',\n          description: 'System-generated date.  This setting used to show/hide tooltip in graph and import/export',\n          properties: {\n            \"displayLabel\": {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Updated'\n            },\n            \"exportLabel\": {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Updated'\n            },\n            \"includeInGraphTooltip\": {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show \"updated\" value in tooltip on graph',\n              default: true\n            },\n            \"help\": {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: 'Date and time node was last modified'\n            },\n            \"hidden\": {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Requires \"updated\" for exports and imports',\n              default: false\n            }\n          }\n        },\n        \"revision\": { // Built-in data DO NOT MODIFY!\n          type: 'object',\n          description: 'System-generated data.  This setting used to show/hide tooltip in graph and import/export',\n          properties: {\n            \"displayLabel\": {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Revision'\n            },\n            \"exportLabel\": {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Revision'\n            },\n            \"includeInGraphTooltip\": {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show \"revision\" value in tooltip on graph',\n              default: true\n            },\n            \"help\": {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: 'Number of times this node has been revised'\n            },\n            \"hidden\": {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Requires \"revision\" for exports and imports',\n              default: true\n            }\n          }\n        }\n      }\n    },\n    \"edgeDefs\": {\n      properties: {\n        \"id\": {\n          type: 'object',\n          description: 'System-generated unique id number',\n          properties: {\n            \"type\": {\n              type: 'number',\n              // not editable\n              options: { hidden: true },\n              description: '\"id\" data type',\n              default: 'number'\n            },\n            \"displayLabel\": {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Id'\n            },\n            \"exportLabel\": {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'ID'\n            },\n            \"help\": {\n              type: 'string',\n              // not editable\n              options: { hidden: true },\n              description: 'Help text to display on the Node Editor form',\n              default: 'System-generated unique id number'\n            },\n            \"hidden\": {\n              type: 'boolean',\n              format: 'checkbox',\n              options: { hidden: true }, // not end-user editable, always hidden from Template Editor\n              description: 'Not used.  \"id\" is always hidden.',\n              default: false\n            }\n          }\n        },\n        \"source\": {\n          type: 'object',\n          description: 'Display name of the node',\n          properties: {\n            \"type\": {\n              type: 'string',\n              // not editable\n              options: { hidden: true },\n              description: '\"source\" data type',\n              default: 'number'\n            },\n            \"displayLabel\": {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Source'\n            },\n            \"exportLabel\": {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Source'\n            },\n            \"help\": {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: 'Edge source node'\n            },\n            \"hidden\": {\n              type: 'boolean',\n              format: 'checkbox',\n              options: { hidden: true }, // not end-user editable, always hidden from Template Editor\n              description: 'Not used.  \"source\" is always shown.',\n              default: false\n            }\n          }\n        },\n        \"target\": {\n          type: 'object',\n          description: 'Display name of the node',\n          properties: {\n            \"type\": {\n              type: 'string',\n              // not editable\n              options: { hidden: true },\n              description: '\"target\" data type',\n              default: 'number'\n            },\n            \"displayLabel\": {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Target'\n            },\n            \"exportLabel\": {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Target'\n            },\n            \"help\": {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: 'Edge target node'\n            },\n            \"hidden\": {\n              type: 'boolean',\n              format: 'checkbox',\n              options: { hidden: true }, // not end-user editable, always hidden from Template Editor\n              description: 'Not used.  \"target\" is always shown.',\n              default: false\n            }\n          }\n        },\n        \"type\": {\n          type: 'object',\n          description: 'Enumerated edge types',\n          properties: {\n            \"type\": {\n              type: 'string',\n              // not editable\n              options: { hidden: true },\n              description: 'edge \"type\" data type',\n              default: 'select'\n            },\n            \"displayLabel\": {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Type'\n            },\n            \"exportLabel\": {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'EdgeType' // matches Gephi?\n            },\n            \"help\": {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: 'Type of edge connection'\n            },\n            \"hidden\": {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Hides \"type\" from Edge Editor, Edges Table, and exports',\n              default: false\n            },\n            \"options\": Object.assign({}, MOD.EDGETYPEOPTIONS, { description: 'NOTE: We recommend using the \"Edit Edge Types\" feature to edit Edge Types.  It provides additional dataset migration tools.' })\n          }\n        },\n        \"notes\": { // Signficance\n          type: 'object',\n          description: 'Display name of the node',\n          properties: {\n            \"type\": {\n              type: 'string',\n              description: '\"notes\" data type',\n              default: 'string'\n            },\n            \"displayLabel\": {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Significance'\n            },\n            \"exportLabel\": {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Notes'\n            },\n            \"help\": {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: 'Significance of the connection'\n            },\n            \"hidden\": {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Hides \"notes\" from Edge Editor, Edges Table, and exports',\n              default: false\n            }\n          }\n        },\n        \"info\": { // Info/Number/Date\n          type: 'object',\n          description: 'Display name of the node',\n          properties: {\n            \"type\": {\n              type: 'string',\n              description: '\"info\" data type',\n              default: 'number'\n            },\n            \"displayLabel\": {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Date'\n            },\n            \"exportLabel\": {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Date'\n            },\n            \"help\": {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: '\"YYYY-MM-DD\" format\"'\n            },\n            \"hidden\": {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Hides \"info\" from Edge Editor, Edges Table, and exports',\n              default: false\n            }\n          }\n        },\n        \"citation\": {\n          type: 'object',\n          description: 'Display name of the node',\n          properties: {\n            \"type\": {\n              type: 'string',\n              description: '\"citation\" data type',\n              default: 'string'\n            },\n            \"displayLabel\": {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Citation'\n            },\n            \"exportLabel\": {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Citation'\n            },\n            \"help\": {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: 'Source Book.Chapter (e.g. \"Part 2 06.03\")'\n            },\n            \"hidden\": {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Hides \"citation\" from Edge Editor, Edges Table, and exports',\n              default: false\n            }\n          }\n        },\n        \"category\": {\n          type: 'object',\n          description: 'Display name of the node',\n          properties: {\n            \"type\": {\n              type: 'string',\n              description: '\"category\" data type',\n              default: 'string'\n            },\n            \"displayLabel\": {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Category'\n            },\n            \"exportLabel\": {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Category'\n            },\n            \"help\": {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: 'Category (deprecated)'\n            },\n            \"hidden\": {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Hides \"category\" from Edge Editor, Edges Table, and exports',\n              default: true\n            }\n          }\n        },\n        \"created\": { // Built-in data DO NOT MODIFY!\n          type: 'object',\n          description: 'System-generated date.  This setting used to show/hide tooltip in graph and import/export',\n          properties: {\n            \"displayLabel\": {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Created'\n            },\n            \"exportLabel\": {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Created'\n            },\n            \"includeInGraphTooltip\": {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show \"created\" value in tooltip on graph',\n              default: true\n            },\n            \"help\": {\n              type: 'string',\n              description: 'Help text to display on the Edge Editor form',\n              default: 'Date and time edge was created'\n            },\n            \"hidden\": {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Requires \"created\" for exports and imports',\n              default: false\n            }\n          }\n        },\n        \"updated\": { // Built-in data DO NOT MODIFY!\n          type: 'object',\n          description: 'System-generated date.  This setting used to show/hide tooltip in graph and import/export',\n          properties: {\n            \"displayLabel\": {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Updated'\n            },\n            \"exportLabel\": {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Updated'\n            },\n            \"includeInGraphTooltip\": {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show \"updated\" value in tooltip on graph',\n              default: true\n            },\n            \"help\": {\n              type: 'string',\n              description: 'Help text to display on the Edge Editor form',\n              default: 'Date and time edge was last modified'\n            },\n            \"hidden\": {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Requires \"updated\" for exports and imports',\n              default: false\n            }\n          }\n        },\n        \"revision\": { // Built-in data DO NOT MODIFY!\n          type: 'object',\n          description: 'System-generated data.  This setting used to show/hide tooltip in graph and import/export',\n          properties: {\n            \"displayLabel\": {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Revision'\n            },\n            \"exportLabel\": {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Revision'\n            },\n            \"includeInGraphTooltip\": {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show \"revision\" value in tooltip on graph',\n              default: true\n            },\n            \"help\": {\n              type: 'string',\n              description: 'Help text to display on the Edge Editor form',\n              default: 'Number of times this edge has been revised'\n            },\n            \"hidden\": {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Requires \"revision\" for exports and imports',\n              default: true\n            }\n          }\n        }\n      }\n    }\n  }\n}\n\n\n\n/// SCHEMA METHODS ////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ Extra schema definition for the Type Editor UI\n\n    This introduces a wrapper around the Node or Edge Type Schema to provide\n    extra UI elements for managing Type changes that the normal Template\n    editor does not have:\n    * Adds a checkbox to mark a type for deletion\n    * Adds a field to map a deleted type to another type\n\n    Used by the \"Edit Node Types\" and \"Edit Edge Types\" buttons.\n/*/\nMOD.GetTypeEditorSchema = schemaTypeOptions => {\n  const typeOptions = clone(schemaTypeOptions);\n  try {\n    typeOptions.options.disable_array_delete = true;\n    typeOptions.items.properties.label.options = {\n      // For some reason inputAttribute 'disabled' does not work here\n      // so we use a className to mark the field\n      // then in Template.onEditNodeTypes we set the\n      // disabled property via js\n      inputAttributes: { class: 'disabledField' }\n    };\n    typeOptions.items.properties.replacement = {\n      type: 'string',\n      title: 'Change To'\n    };\n    typeOptions.items.properties.delete = {\n      type: 'boolean',\n      title: 'Delete?',\n      format: 'checkbox'\n    };\n  } catch (err) {\n    console.error('GetTypeEditorSchema Error:', err);\n  }\n  return {\n    title: 'Edit Type Options',\n    type: 'object',\n    description: 'NOTE that labels are case-sensitive, so \"Person\" is different from \"person\"',\n    options: {\n      disable_array_add: true,\n      disable_array_delete: true,\n      disable_array_delete_all_rows: true,\n      disable_array_delete_last_row: true,\n      disable_array_reorder: true,\n      disable_collapse: true,\n      disable_properties: true\n    }, // not editable\n    properties: {\n      \"options\": typeOptions\n    }\n  }\n}\n\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = MOD;\n"]}